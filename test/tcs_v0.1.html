<!DOCTYPE html>
<html>
<head>
  <title>贪吃蛇游戏</title>
  <style>
    #game-board {
      width: 400px;
      height: 400px;
      border: 1px solid #000;
      display: flex;
      flex-wrap: wrap;
    }
    .cell {
      box-sizing: border-box;
      width: 20px;
      height: 20px;
      background-color: #ccc;
      border: 1px solid #fff;
    }
    .cell.snake {
      background-color: #333;
    }
    .cell.food {
      background-color: #f00;
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="game-board">
      <div v-for="(cell, index) in grid" :key="index" :class="['cell', cell.type]"></div>
    </div>
  </div>

  <script src="https://unpkg.com/vue@next"></script>
  <script>
    const GRID_SIZE = 20;
    const INITIAL_SPEED = 200; // in milliseconds

    const app = Vue.createApp({
      data() {
        return {
          grid: [],
          snake: [],
          direction: 'right',
          food: null,
          speed: INITIAL_SPEED,
          gameOver: false
        };
      },
      created() {
        this.initializeGrid();
        this.initializeSnake();
        this.generateFood();

        // Start the game loop
        this.gameLoop();
      },
      methods: {
        initializeGrid() {
          for (let i = 0; i < GRID_SIZE * GRID_SIZE; i++) {
            this.grid.push({ type: '' });
          }
        },
        initializeSnake() {
          const middleIndex = Math.floor(GRID_SIZE * GRID_SIZE / 2) + Math.floor(GRID_SIZE / 2);
          this.snake.push(middleIndex);
          this.snake.push(middleIndex - 1);
          this.snake.push(middleIndex - 2);

          this.updateGrid();
        },
        generateFood() {
          const emptyCells = [];
          for (let i = 0; i < GRID_SIZE * GRID_SIZE; i++) {
            if (!this.snake.includes(i)) {
              emptyCells.push(i);
            }
          }

          const randomIndex = Math.floor(Math.random() * emptyCells.length);
          this.food = emptyCells[randomIndex];
        },
        moveSnake() {
          const head = this.snake[0];
          let newHead;

          switch (this.direction) {
            case 'up':
              newHead = head - GRID_SIZE;
              break;
            case 'down':
              newHead = head + GRID_SIZE;
              break;
            case 'left':
              newHead = head - 1;
              break;
            case 'right':
              newHead = head + 1;
              break;
          }

          this.snake.unshift(newHead);

          if (newHead === this.food) {
            // Snake has eaten the food, generate a new one
            this.generateFood();
            this.speed -= 10; // Increase speed
          } else {
            this.snake.pop(); // Remove tail segment
          }
        },
        handleKeydown(event) {
          switch (event.key) {
            case 'ArrowUp':
              this.direction = 'up';
              break;
            case 'ArrowDown':
              this.direction = 'down';
              break;
            case 'ArrowLeft':
              this.direction = 'left';
              break;
            case 'ArrowRight':
              this.direction = 'right';
              break;
          }
        },
        updateGrid() {
          for (let i = 0; i < GRID_SIZE * GRID_SIZE; i++) {
            this.grid[i].type = '';
          }

          for (const segment of this.snake) {
            this.grid[segment].type = 'snake';
          }

          this.grid[this.food] = { type: 'food' };
        },
        checkCollision() {
          const head = this.snake[0];

          // Check collision with walls
          if (
            head < 0 ||
            head >= GRID_SIZE * GRID_SIZE ||
            this.snake.slice(1).includes(head)
          ) {
            this.gameOver = true;
          }
        },
        gameLoop() {
          if (this.gameOver) {
            return;
          }

          this.moveSnake();
          this.updateGrid();
          this.checkCollision();

          setTimeout(this.gameLoop, this.speed);
        }
      }
    });

    app.mount('#app');

    window.addEventListener('keydown', function (event) {
      app.$options.methods.handleKeydown.call(app, event);
    });
  </script>
</body>
</html>
