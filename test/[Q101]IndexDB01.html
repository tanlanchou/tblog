<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <script>
        const dbName = 'MyDatabase';
        const objectStoreName = 'MyObjectStore';

        openIndexDB(dbName, 1, {
            onsuccess: function (event) {
                const db = event.target.result;
                const transaction = db.transaction(objectStoreName, 'readonly');
                const service = transaction.objectStore(objectStoreName);
                const countRequest = service.count();
                countRequest.onsuccess = function(event) {
                    debugger
                    db.close();
                }
                
            }
        })

        function openIndexDB(databaseName, version, params) {
            if (!databaseName || databaseName == '') {
                alert('请选择数据库');
                return;
            }

            if (typeof version !== 'number' || version < 1) {
                alert('请输入正确的版本号');
                return;
            }

            if (!params) params = {};

            console.log("尝试打开数据库: " + databaseName)
            const dbOpenRequest = window.indexedDB.open(databaseName, version);

            dbOpenRequest.onerror = function (event) {
                console.log(`触发onerror:${databaseName}`);
                if (params.onerror && typeof params.onerror === 'function') {
                    params.onerror(event);
                }
            };

            dbOpenRequest.onblocked = function (event) {
                console.log(`触发onblocked:${databaseName}`);
                if (params.onblocked && typeof params.onblocked === 'function') {
                    params.onblocked(event);
                }
            };

            dbOpenRequest.onsuccess = function (event) {
                console.log(`成功打开数据库:${databaseName}`);
                if (params.onsuccess && typeof params.onsuccess === 'function') {
                    params.onsuccess(event);
                }
            }

            dbOpenRequest.onupgradeneeded = function (event) {
                console.log(`数据库升级中, 触发onupgradeneeded事件`);
                if (params.onupgradeneeded && typeof params.onupgradeneeded === 'function') {
                    params.onupgradeneeded(event);
                }
            }
        }

    </script>

    <!-- <script>
        const dbName = 'MyDatabase';
        const objectStoreName = 'MyObjectStore';

        const testData = [
            { name: 'John', age: 30 },
            { name: 'Alice', age: 25 },
            { name: 'Bob', age: 35 },
            { name: 'Eva', age: 28 },
            { name: 'Michael', age: 40 },
            { name: 'Olivia', age: 22 },
            { name: 'William', age: 32 },
            { name: 'Sophia', age: 29 },
            { name: 'James', age: 27 },
            { name: 'Emma', age: 38 },
            { name: 'Liam', age: 31 },
            { name: 'Ava', age: 24 },
            { name: 'Benjamin', age: 33 },
            { name: 'Charlotte', age: 26 },
            { name: 'Henry', age: 34 },
            { name: 'Amelia', age: 23 },
            { name: 'Alexander', age: 37 },
            { name: 'Mia', age: 36 },
            { name: 'Elijah', age: 21 },
            { name: 'Scarlett', age: 39 }
        ];

        const request = indexedDB.open(dbName, 1);

        request.onupgradeneeded = function (event) {
            const db = event.target.result;
            const objectStore = db.createObjectStore(objectStoreName, { keyPath: 'id', autoIncrement: true });

            objectStore.createIndex('name', 'name', { unique: false });
            objectStore.createIndex('age', 'age', { unique: false });

            const transaction = event.target.transaction;
            const store = transaction.objectStore(objectStoreName);

            testData.forEach(function (item) {
                store.add(item);
            });
        };

        request.onsuccess = function (event) {
            console.log('Database opened successfully.');
            const db = event.target.result;
            db.close();
        };

        request.onerror = function (event) {
            console.error('Error opening database: ' + event.target.errorCode);
        };

    </script> -->
</body>

</html>