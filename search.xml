<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Prisma åŸºæœ¬åº”ç”¨</title>
      <link href="/2025/07/25/202507/Prisma/"/>
      <url>/2025/07/25/202507/Prisma/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h2 id="Prisma-Nestjs"><a href="#Prisma-Nestjs" class="headerlink" title="Prisma Nestjs"></a>Prisma Nestjs</h2><p><a href="https://prisma.org.cn/docs">Prisma æ–‡æ¡£ - Prisma ä¸­æ–‡</a></p><p>è¿™é‡Œä¸»è¦æ˜¯è¦è®°ä¸€ä¸ªç®€å•çš„ prisma åœ¨ nestjs ä¸Šåº”ç”¨çš„æ•™ç¨‹.</p><p>ä¸»è¦æ˜¯æ‡’å¾—è®°ã€‚</p><h3 id="01-åˆå§‹åŒ–"><a href="#01-åˆå§‹åŒ–" class="headerlink" title="01. åˆå§‹åŒ–"></a>01. åˆå§‹åŒ–</h3><pre><code>npx prisma init</code></pre><p>è¿™ä¸€æ­¥ä¸»è¦æ˜¯å®ä¾‹åŒ–ä¸€ä¸ªåˆå§‹åŒ–çš„è„šæœ¬ã€‚</p><p><strong>prisma\schema.prisma</strong></p><p>ä»–ä¼šåœ¨è¿™ä¸ªç›´æ¥ç”Ÿæˆä¸€ä¸ªè¿™ä¸ªæ–‡ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">generator client &#123; provider = <span class="string">&quot;prisma-client-js&quot;</span> &#125; datasource db &#123; provider = <span class="string">&quot;mysql&quot;</span> url = <span class="title function_">env</span>(<span class="string">&quot;DATABASE_URL&quot;</span>) &#125;</span><br></pre></td></tr></table></figure><p>ç±»ä¼¼äºè¿™æ ·ï¼Œ<code>provider</code> æ ¹æ®æ•°æ®åº“æ¥.</p><h3 id="02-è®¾ç½®DATABASE-URL"><a href="#02-è®¾ç½®DATABASE-URL" class="headerlink" title="02. è®¾ç½®DATABASE_URL"></a>02. è®¾ç½®DATABASE_URL</h3><p>å¯ä»¥ç›´æ¥åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®ï¼Œ<code>env(â€DATABASE_URLâ€)</code> , <strong>docker</strong> æ‰“åŒ…çš„æ—¶å€™ç›´æ¥ä¼ å…¥ç¯å¢ƒå˜é‡</p><p>ä½†æ˜¯å¯¹äºæˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºæˆ‘æ˜¯åœ¨å…¬å…±ç¯å¢ƒä¸­å­˜å‚¨ä»£ç çš„ï¼Œè™½ç„¶ä»“åº“æ˜¯ç§æœ‰çš„..</p><p>å¹¶ä¸”æˆ‘è¿˜å¸Œæœ›èƒ½å¤Ÿç»Ÿä¸€çš„é€šè¿‡ <strong>consul</strong> æ¥ç®¡ç†ï¼Œæ‰€ä»¥å†™äº†ä¸€ä¸ª <code>module</code></p><p>PrismaModule</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Module</span>, <span class="title class_">Global</span>, <span class="title class_">DynamicModule</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PrismaService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ConfigService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;src/common/config/config.service&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">PrismaModuleOptions</span> &#123;</span><br><span class="line">  <span class="attr">configKey</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Global</span>()</span><br><span class="line">@<span class="title class_">Module</span>(&#123;&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">PrismaModule</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">register</span>(<span class="attr">options</span>: <span class="title class_">PrismaModuleOptions</span>): <span class="title class_">DynamicModule</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">module</span>: <span class="title class_">PrismaModule</span>,</span><br><span class="line">      <span class="attr">providers</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">provide</span>: <span class="string">&#x27;DATABASE_URL&#x27;</span>,</span><br><span class="line">          <span class="attr">useFactory</span>: <span class="keyword">async</span> (<span class="attr">consulService</span>: <span class="title class_">ConfigService</span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">const</span> config = <span class="keyword">await</span> consulService.<span class="title function_">get</span>(options.<span class="property">configKey</span>);</span><br><span class="line">            <span class="keyword">return</span> config.<span class="property">dbUrl</span>;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">inject</span>: [<span class="title class_">ConfigService</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title class_">PrismaService</span>,</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">exports</span>: [<span class="string">&#x27;DATABASE_URL&#x27;</span>, <span class="title class_">PrismaService</span>],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>PrismaService</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span>, <span class="title class_">Inject</span>, <span class="title class_">OnModuleInit</span>, <span class="title class_">OnModuleDestroy</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PrismaClient</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@prisma/client&#x27;</span>;</span><br><span class="line">@<span class="title class_">Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">PrismaService</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PrismaClient</span> implements <span class="title class_">OnModuleInit</span>, <span class="title class_">OnModuleDestroy</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">@Inject(<span class="string">&#x27;DATABASE_URL&#x27;</span>) private readonly databaseUrl: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(&#123; <span class="attr">datasources</span>: &#123; <span class="attr">db</span>: &#123; <span class="attr">url</span>: databaseUrl &#125; &#125; &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">onModuleInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.$connect();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">onModuleDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.$disconnect();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç†è®ºä¸Šä½ æ˜¯ä¸éœ€è¦è¿™ä¸€æ­¥çš„ã€‚è¿™æ˜¯å› ä¸ºæˆ‘æƒ³è‡ªåŠ¨å»æ³¨å…¥çš„åŸå› ã€‚</p><h3 id="03-åˆ›å»ºæ•°æ®åº“"><a href="#03-åˆ›å»ºæ•°æ®åº“" class="headerlink" title="03. åˆ›å»ºæ•°æ®åº“"></a>03. åˆ›å»ºæ•°æ®åº“</h3><p>æˆ‘ä¸ªäººæ˜¯æ›´å–œæ¬¢åœ¨æ•°æ®åº“ä¸­åˆ›å»ºå¥½çš„ï¼Œå› ä¸ºæˆ‘è§‰å¾—ä»–çš„é…ç½®æ–‡ä»¶å­¦è¦å†™çš„ä¸œè¥¿å¤ªå¤šäº†ã€‚</p><p>æ‰€ä»¥æˆ‘æ˜¯åœ¨æ•°æ®åº“ä¸­åˆ›å»ºå¥½è¡¨åŒæ­¥åˆ°ä»£ç ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npx primsa db pull </span><br><span class="line">npx prisma generate</span><br></pre></td></tr></table></figure><p>æ‹‰å»æˆåŠŸä¹‹åç¼–ä¸€ä¸‹ã€‚</p><p>ç„¶åå°±ç›´æ¥å¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº†</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> globalService: GlobalService, <span class="keyword">private</span> <span class="keyword">readonly</span> prisma: PrismaService</span>) &#123; &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æƒ³è‡ªå·±å†™ï¼Œå°± <code>push</code> ä¸€ä¸‹æˆ–è€…æœ‰è‡ªåŠ¨åŒæ­¥çš„ï¼Œè¿™ä¸ªéœ€è¦è‡ªå·±æŸ¥ä¸€ä¸‹ã€‚</p><h3 id="04-è¯­æ³•"><a href="#04-è¯­æ³•" class="headerlink" title="04. è¯­æ³•"></a>04. è¯­æ³•</h3><p><a href="https://prisma.org.cn/docs">https://prisma.org.cn/docs</a></p><p>æŸ¥çœ‹æ–‡æ¡£æˆ–è€…ç›´æ¥é—®aiä¹Ÿè¡Œã€‚</p><h3 id="05-ç»“æŸ"><a href="#05-ç»“æŸ" class="headerlink" title="05. ç»“æŸ"></a>05. ç»“æŸ</h3><p>ä½¿ç”¨è¿‡ç¨‹éå¸¸çš„ä¸æ»‘ï¼Œè™½ç„¶ç°åœ¨æˆ‘åŸºæœ¬ä¸Šç”¨ä¸åˆ°æ‰€è°“çš„é«˜æ€§èƒ½è¿™ä¸€å—ï¼Œå¤šæ•°æ®æºï¼Œè¿æ¥æ± ä¹‹ç±»çš„</p><p>ä½†æ˜¯æ¥å…¥è¿‡ç¨‹åŠå…¶ä¸æ»‘ï¼Œé™¤äº†æ•°æ®åº“è¿æ¥æ¥æœ¬ä¸Š0é…ç½®ï¼Œå®Œå…¨ä¸ç”¨å†™ <code>entity</code> ä¹‹ç±»çš„ä¸œè¥¿ã€‚</p><p>ä½“éªŒéå¸¸å¥½ã€‚</p><p>åªæ˜¯ï¼Œåœ¨è¿™ä¸ªAIçš„æ—¶ä»£ï¼Œå…¶å®ç”¨å•¥æ„Ÿè§‰éƒ½ä¸€æ ·ï¼Œæ¯•ç«Ÿå¾ˆå¤šéƒ½ä¸éœ€è¦ä½ è‡ªå·±å†™ã€‚cursor ä¼šå¸®ä½ æå®šã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> Prisma </tag>
            
            <tag> Orm </tag>
            
            <tag> Nestjs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pinia åŸºæœ¬å’Œæºç ç®€å•åˆ†æ</title>
      <link href="/2025/07/24/202507/Pinia/"/>
      <url>/2025/07/24/202507/Pinia/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="Pinia-åŸºæœ¬"><a href="#Pinia-åŸºæœ¬" class="headerlink" title="Pinia åŸºæœ¬"></a>Pinia åŸºæœ¬</h1><h3 id="01-æƒ…å†µ"><a href="#01-æƒ…å†µ" class="headerlink" title="01. æƒ…å†µ"></a>01. æƒ…å†µ</h3><p>åœ¨çœ‹ <code>Pinia</code> ä¹‹å‰ä¸“é—¨çœ‹äº†ä¸‹ <code>Vuex</code> ï¼Œç›¸å½“äºè¯´ä¸ºäº†è¿™ä¸ªé†‹åŒ…äº†é¥ºå­ã€‚</p><p>ä¸»è¦æ˜¯æƒ³çŸ¥é“å·®åˆ«åœ¨ä»€ä¹ˆåœ°æ–¹</p><p>ä¸ºä»€ä¹ˆè¦ç®¡ç†çŠ¶æ€ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä»–ï¼Ÿå…¶å®ä¹‹å‰å·²ç»çœ‹è¿‡äº†ï¼Œéœ€è¦çš„è¯å°±å»çœ‹ <code>Vuex</code> é‚£ä¸€ç¯‡</p><h3 id="02-åŸºæœ¬ä½¿ç”¨"><a href="#02-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="02. åŸºæœ¬ä½¿ç”¨"></a>02. åŸºæœ¬ä½¿ç”¨</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stores/counter.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">double</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">count</span> * <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">incrementBy</span>(<span class="params">n: number</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span> += n</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>App.vue</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Pinia Counter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Count: &#123;&#123; counter.count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Double: &#123;&#123; counter.double &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;counter.increment&quot;</span>&gt;</span>+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;counter.incrementBy(5)&quot;</span>&gt;</span>+5<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; useCounterStore &#125; <span class="keyword">from</span> <span class="string">&#x27;./stores/counter&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> counter = <span class="title function_">useCounterStore</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å®è¯å®è¯´ç®€å•äº†å¾ˆå¤šï¼Œå¾ˆå¤šä¸œè¥¿ç¡®å®åŸæœ¬å°±ä¸éœ€è¦å»å…³æ³¨</p><h3 id="03-æ¦‚å¿µä¸Š-Pinia-å’Œ-Vuex-çš„å·®åˆ«"><a href="#03-æ¦‚å¿µä¸Š-Pinia-å’Œ-Vuex-çš„å·®åˆ«" class="headerlink" title="03. æ¦‚å¿µä¸Š Pinia å’Œ Vuex çš„å·®åˆ«"></a>03. æ¦‚å¿µä¸Š Pinia å’Œ Vuex çš„å·®åˆ«</h3><p>ä»–åœ¨ä½¿ç”¨ä¸Šä¸»è¦æœ‰2ä¸ªå·®åˆ«ã€‚</p><h5 id="03-01-Mutations"><a href="#03-01-Mutations" class="headerlink" title="03.01 Mutations"></a>03.01 Mutations</h5><p>é¦–å…ˆæ˜¯æ²¡æœ‰äº† <code>Mutations</code> ä¹Ÿæ˜¯æœ€é‡è¦çš„ã€‚</p><p>æˆ‘ç¬¬ä¸€ååº”æ˜¯æ”¹å˜äº†è®¾è®¡æ€è·¯ã€‚</p><p>å› ä¸ºå¯¹äº <code>Vuex</code> æ¥è¯´ï¼Œ <code>Mutations =&gt; State</code> çš„ä½œç”¨å…¶å®æ˜¯ä¿è¯æ•°æ®å¯æ§ã€‚</p><p>è®¾è®¡ä¸ºåŒæ­¥ï¼Œä½ å†ä¸¥æ ¼é™åˆ¶æ•°æ®ï¼Œåšæ ¡éªŒï¼Œé‚£ä¹ˆå°±èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿è¯ <code>State</code> æ•°æ®å¯æ§ã€‚</p><p>Actions ç›¸å¯¹æ¥è¯´åªæ˜¯ä¸ºäº†æ˜“ç”¨æ€§æ‰“çš„è¡¥ä¸ã€‚</p><p>ä½†æ˜¯å¦‚æœç›´æ¥ç”¨Actionsï¼Œå°±ç›¸å½“äºä¸ºäº†æ˜“ç”¨æ€§ï¼Œå‡å°‘äº†å¯¹æ•°æ®çš„æ§åˆ¶.</p><p>ä»è®¾è®¡æ€è·¯ä¸Šæ¥è¯´æ˜¯è¿™æ ·</p><p>ä¹Ÿæœ‰äººè®¤ä¸º <code>Actions =&gt; Mutations</code> æœ¬èº«å°±æ˜¯è„±äº†è£¤å­æ”¾å±ï¼Œåè€Œå¤šä¸€ä¸ªæ¦‚å¿µï¼Œè„±äº†è£¤å­æ”¾å±ã€‚</p><p>å½¢å¼å¤§äºå®é™…</p><p>å–æ¶ˆæ‰äº† <code>Mutations</code> , ä¾ç„¶éœ€è¦è°ƒç”¨ <code>Actions</code> ï¼Œä¾ç„¶ä¸èƒ½éšæ„ä¿®æ”¹</p><p>å› ä¸ºæ•°æ®æ˜¯å“åº”å¼çš„ï¼Œè¿˜æ˜¯å¯ä»¥è¿½è¸ª</p><p>ä¾ç„¶æ˜¯éœ€è¦ <code>UseXXXStore</code> ä¸éšæ„ä¿®æ”¹</p><p>åªæ˜¯å…è®¸äº†å¼‚æ­¥çš„ <code>Actions</code> çš„å·®åˆ«ï¼Œå¯¹äºæ•´ä½“çš„ç›®çš„æ²¡æœ‰ç›´æ¥ç ´å</p><h5 id="03-02-modules"><a href="#03-02-modules" class="headerlink" title="03.02 modules"></a>03.02 modules</h5><p>è¿™ä¸ªæ˜¯æ”¹æˆäº†ä½ ç›´æ¥è°ƒç”¨ä½ å†™çš„ï¼Œè€Œä¸æ˜¯ç»Ÿä¸€è°ƒç”¨ç„¶å â€œxxx&#x2F;xxxâ€</p><p>æ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚</p><h3 id="04-ç®€å•çš„æºç è§£æ"><a href="#04-ç®€å•çš„æºç è§£æ" class="headerlink" title="04. ç®€å•çš„æºç è§£æ"></a>04. ç®€å•çš„æºç è§£æ</h3><p>ä¸»è¦è®²2ä¸ªç‚¹ã€‚</p><h5 id="04-01-ä¼ é€’æ–¹å¼"><a href="#04-01-ä¼ é€’æ–¹å¼" class="headerlink" title="04.01 ä¼ é€’æ–¹å¼"></a>04.01 ä¼ é€’æ–¹å¼</h5><p>ä»–å’Œ <code>Vuex</code> ä¸€æ ·ï¼Œéƒ½ä½¿ç”¨æ³¨å…¥æå®šçš„ï¼Œä½†æ˜¯ç»†èŠ‚è¿˜æ˜¯æœ‰å˜åŒ–çš„</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useStore</span>(<span class="params">pinia?: Pinia | <span class="literal">null</span>, hot?: StoreGeneric</span>): <span class="title class_">StoreGeneric</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> hasContext = <span class="title function_">hasInjectionContext</span>()</span><br><span class="line">    pinia =</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      (hasContext ? <span class="title function_">inject</span>(piniaSymbol, <span class="literal">null</span>) : <span class="literal">null</span>) <span class="comment">// &lt;-- å…³é”®åœ¨è¿™é‡Œï¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pinia) <span class="title function_">setActivePinia</span>(pinia)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>çœ‹å¾—æ‡‚å§ã€‚</p><h5 id="04-02-createOptionsStore"><a href="#04-02-createOptionsStore" class="headerlink" title="04.02 createOptionsStore"></a>04.02 <code>createOptionsStore</code></h5><p>è¿™ä¸ªæ˜¯æ ¸å¿ƒä»£ç ï¼Œåˆ›å»º state, getter, action éƒ½åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> createOptionsStore&lt;</span><br><span class="line">  <span class="title class_">Id</span> <span class="keyword">extends</span> <span class="built_in">string</span>,</span><br><span class="line">  S <span class="keyword">extends</span> <span class="title class_">StateTree</span>,</span><br><span class="line">  G <span class="keyword">extends</span> _GettersTree&lt;S&gt;,</span><br><span class="line">  A <span class="keyword">extends</span> _ActionsTree,</span><br><span class="line">&gt;(</span><br><span class="line">  <span class="attr">id</span>: <span class="title class_">Id</span>,</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">DefineStoreOptions</span>&lt;<span class="title class_">Id</span>, S, G, A&gt;,</span><br><span class="line">  <span class="attr">pinia</span>: <span class="title class_">Pinia</span>,</span><br><span class="line">  hot?: <span class="built_in">boolean</span></span><br><span class="line">): <span class="title class_">Store</span>&lt;<span class="title class_">Id</span>, S, G, A&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; state, actions, getters &#125; = options</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">initialState</span>: <span class="title class_">StateTree</span> | <span class="literal">undefined</span> = pinia.<span class="property">state</span>.<span class="property">value</span>[id]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">store</span>: <span class="title class_">Store</span>&lt;<span class="title class_">Id</span>, S, G, A&gt;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!initialState &amp;&amp; (!__DEV__ || !hot)) &#123;</span><br><span class="line">      <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">      pinia.<span class="property">state</span>.<span class="property">value</span>[id] = state ? <span class="title function_">state</span>() : &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// avoid creating a state in pinia.state.value</span></span><br><span class="line">    <span class="keyword">const</span> localState =</span><br><span class="line">      __DEV__ &amp;&amp; hot</span><br><span class="line">        ? <span class="comment">// use ref() to unwrap refs inside state <span class="doctag">TODO:</span> check if this is still necessary</span></span><br><span class="line">          <span class="title function_">toRefs</span>(<span class="title function_">ref</span>(state ? <span class="title function_">state</span>() : &#123;&#125;).<span class="property">value</span>)</span><br><span class="line">        : <span class="title function_">toRefs</span>(pinia.<span class="property">state</span>.<span class="property">value</span>[id])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">assign</span>(</span><br><span class="line">      localState,</span><br><span class="line">      actions,</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">keys</span>(getters || &#123;&#125;).<span class="title function_">reduce</span>(</span><br><span class="line">        <span class="function">(<span class="params">computedGetters, name</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (__DEV__ &amp;&amp; name <span class="keyword">in</span> localState) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">              <span class="string">`[ğŸ]: A getter cannot have the same name as another state property. Rename one of them. Found with &quot;<span class="subst">$&#123;name&#125;</span>&quot; in store &quot;<span class="subst">$&#123;id&#125;</span>&quot;.`</span></span><br><span class="line">            )</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          computedGetters[name] = <span class="title function_">markRaw</span>(</span><br><span class="line">            <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="title function_">setActivePinia</span>(pinia)</span><br><span class="line">              <span class="comment">// it was created just before</span></span><br><span class="line">              <span class="keyword">const</span> store = pinia.<span class="property">_s</span>.<span class="title function_">get</span>(id)!</span><br><span class="line"></span><br><span class="line">              <span class="comment">// allow cross using stores</span></span><br><span class="line"></span><br><span class="line">              <span class="comment">// @ts-expect-error</span></span><br><span class="line">              <span class="comment">// return getters![name].call(context, context)</span></span><br><span class="line">              <span class="comment">// <span class="doctag">TODO:</span> avoid reading the getter while assigning with a global variable</span></span><br><span class="line">              <span class="keyword">return</span> getters![name].<span class="title function_">call</span>(store, store)</span><br><span class="line">            &#125;)</span><br><span class="line">          )</span><br><span class="line">          <span class="keyword">return</span> computedGetters</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;&#125; <span class="keyword">as</span> <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="title class_">ComputedRef</span>&gt;</span><br><span class="line">      )</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  store = <span class="title function_">createSetupStore</span>(id, setup, options, pinia, hot, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> store <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¦–å…ˆçœ‹ <code>state</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">initialState</span>: <span class="title class_">StateTree</span> | <span class="literal">undefined</span> = pinia.<span class="property">state</span>.<span class="property">value</span>[id]st</span><br><span class="line"></span><br><span class="line"> pinia.<span class="property">state</span>.<span class="property">value</span></span><br><span class="line">    <span class="keyword">const</span> localState =</span><br><span class="line">      __DEV__ &amp;&amp; hot</span><br><span class="line">        ? <span class="comment">// use ref() to unwrap refs inside state <span class="doctag">TODO:</span> check if this is still necessary</span></span><br><span class="line">          <span class="title function_">toRefs</span>(<span class="title function_">ref</span>(state ? <span class="title function_">state</span>() : &#123;&#125;).<span class="property">value</span>)</span><br><span class="line">        : t  : t</span><br></pre></td></tr></table></figure><p>å°±æ˜¯è·å– ä½ ä¼ å…¥çš„ <code>options</code> ï¼Œ ç„¶åå“åº”å¼</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title function_">assign</span>(</span><br><span class="line">  localState,</span><br><span class="line">  actions,</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(getters || &#123;&#125;).<span class="title function_">reduce</span>(</span><br></pre></td></tr></table></figure><p>ç„¶åä¼ é€’ç»™æ–°ç”Ÿçš„ <code>newStore</code></p><p>ä½ å°±å¯ä»¥é€šè¿‡ <code>actions</code>  å»è®¿é—®ï¼Œæ¯”å¦‚è¯´ </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">  <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª <code>this</code> æ˜¯æŒ‡å‘ <code>store</code> çš„, å°±èƒ½é€šè¿‡ <code>store =&gt; pinia.state.value</code></p><p><code>getter</code> åœ¨åˆšæ‰ä»£ç é‡Œé¢ä¹Ÿè¯´æ˜äº†</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(getters || &#123;&#125;).<span class="title function_">reduce</span>(</span><br><span class="line">  <span class="function">(<span class="params">computedGetters, name</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__ &amp;&amp; name <span class="keyword">in</span> localState) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">`[ğŸ]: A getter cannot have the same name as another state property. Rename one of them. Found with &quot;<span class="subst">$&#123;name&#125;</span>&quot; in store &quot;<span class="subst">$&#123;id&#125;</span>&quot;.`</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    computedGetters[name] = <span class="title function_">markRaw</span>(</span><br><span class="line">      <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setActivePinia</span>(pinia)</span><br><span class="line">        <span class="comment">// it was created just before</span></span><br><span class="line">        <span class="keyword">const</span> store = pinia.<span class="property">_s</span>.<span class="title function_">get</span>(id)!</span><br><span class="line"></span><br><span class="line">        <span class="comment">// allow cross using stores</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// @ts-expect-error</span></span><br><span class="line">        <span class="comment">// return getters![name].call(context, context)</span></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> avoid reading the getter while assigning with a global variable</span></span><br><span class="line">        <span class="keyword">return</span> getters![name].<span class="title function_">call</span>(store, store)</span><br><span class="line">      &#125;)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> computedGetters</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;&#125; <span class="keyword">as</span> <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="title class_">ComputedRef</span>&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>åªéœ€è¦æ³¨æ„2ä¸ªç‚¹</p><p>ä¸ºä»€ä¹ˆè¦å»ç”¨ <code>computed</code> ä¸»è¦æ˜¯ä¸ºäº†ç¼“å­˜å’Œä¾èµ–è¿½è¸ª</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> getters![name].<span class="title function_">call</span>(store, store)</span><br></pre></td></tr></table></figure><p>è·å–æœ€æ–°çš„å€¼</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> Vue3 </tag>
            
            <tag> Pinia </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2025/07/24/202507/ethercat%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B/"/>
      <url>/2025/07/24/202507/ethercat%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="é…ç½®æµç¨‹"><a href="#é…ç½®æµç¨‹" class="headerlink" title="é…ç½®æµç¨‹"></a>é…ç½®æµç¨‹</h3><p>01ecrt_request_master è¿æ¥ä¸»ç«™</p><p>ecrt_master_create_domain åˆ›å»ºæ•°æ®åŸŸ &#x3D;&gt; ç±»ä¼¼æ–°å»ºæ–‡ä»¶å¤¹å†…ï¼Œåç»­PDOä¹‹ç±»çš„ä¼šè¿›æ¥</p><p>ecrt_master_get_slaveè·å–ä»ç«™ä¿¡æ¯(è¿™é‡Œå¯ä»¥æ‰¹é‡)</p><p>ecrt_master_slave_config æŠŠä»ç«™ä¿¡æ¯å‘Šè¯‰ä¸»ç«™</p><p>ecrt_slave_config_pdos é…ç½®pdo è§„èŒƒ</p><ul><li><p><strong>ç›®çš„</strong>ï¼šè¿™æ˜¯æœ€å…³é”®çš„é…ç½®æ­¥éª¤ä¹‹ä¸€ã€‚å¯¹äºæ¯ä¸ªä»ç«™ï¼Œä½ éœ€è¦ç²¾ç¡®åœ°å®šä¹‰ï¼š</p></li><li><p>**åŒæ­¥ç®¡ç†å™¨ (Sync Managers)**ï¼šé…ç½®å“ªäº›â€œé‚®ç®±â€ç”¨äºè¾“å…¥ï¼ˆä»ç«™ -&gt; ä¸»ç«™ï¼‰å’Œè¾“å‡ºï¼ˆä¸»ç«™ -&gt; ä»ç«™ï¼‰ã€‚</p></li><li><p>**è¿‡ç¨‹æ•°æ®å¯¹è±¡ (PDOs)**ï¼šæŒ‡å®šä½ å¸Œæœ›é€šè¿‡è¿™äº›â€œé‚®ç®±â€äº¤æ¢çš„å…·ä½“æ•°æ®æ˜¯ä»€ä¹ˆã€‚ä¾‹å¦‚ï¼Œâ€œæˆ‘å¸Œæœ›å°†â€˜ç›®æ ‡ä½ç½®â€™è¿™ä¸ªPDOæ˜ å°„åˆ°è¾“å‡ºé‚®ç®±ï¼Œå¹¶å°†â€˜å®é™…ä½ç½®â€™è¿™ä¸ªPDOæ˜ å°„åˆ°è¾“å…¥é‚®ç®±â€ã€‚</p></li><li><p><strong>ä¿¡æ¯æ¥æº</strong>ï¼šè¿™äº›é…ç½®ä¿¡æ¯ï¼ˆPDOç´¢å¼•ã€åŒæ­¥ç®¡ç†å™¨è®¾ç½®ï¼‰é€šå¸¸æ¥è‡ªäºä»ç«™è®¾å¤‡çš„ESI (EtherCAT Slave Information) æ–‡ä»¶ï¼Œæˆ–è€…é€šè¿‡ <code>ethercat</code> å‘½ä»¤è¡Œå·¥å…·æ‰«æå¾—åˆ°</p></li></ul><p>ecrt_slave_config_dc è®¾ç½®åˆ†å¸ƒå¼æ—¶é’Ÿ</p><table><thead><tr><th>æ•°å€¼</th><th>å«ä¹‰è¯´æ˜</th></tr></thead><tbody><tr><td><code>0x0001</code></td><td>å¯ç”¨ DC æ”¯æŒ</td></tr><tr><td><code>0x0300</code></td><td>å¯ç”¨ Sync0 è¾“å‡º + åŒæ­¥æ¿€æ´»ï¼ˆå¸¸ç”¨ï¼‰</td></tr><tr><td><code>0x0700</code></td><td>å¯ç”¨ Sync0 å’Œ Sync1 è¾“å‡º</td></tr></tbody></table><p>ecrt_master_select_reference_clock è®¾ç½®å‚è€ƒæ—¶é’Ÿï¼ˆå¯é€‰ï¼‰</p><p>ecrt_domain_reg_pdo_entry_list æ³¨å†Œpdo</p><p>ecrt_master_sdo_download é€šè¿‡SDO è·å–å’Œè®¾ç½®å­—å…¸å¯¹è±¡.</p><p>ecrt_slave_config_emcy_handler æ³¨å†Œ EMCY å›è°ƒå¤„ç†å‡½æ•°</p><table><thead><tr><th>ç»„æˆ</th><th>ä½œç”¨</th><th>ä¸¾ä¾‹</th></tr></thead><tbody><tr><td><strong>å¯¹è±¡å­—å…¸ï¼ˆObject Dictionaryï¼‰</strong></td><td>å®šä¹‰è®¾å¤‡çš„æ•°æ®ç»“æ„</td><td><code>0x6040</code>ã€<code>0x6060</code>ã€<code>0x607A</code> ç­‰</td></tr><tr><td><strong>SDOï¼ˆService Data Objectï¼‰æœåŠ¡</strong></td><td>è¯»&#x2F;å†™å¯¹è±¡å­—å…¸å‚æ•°ï¼ˆéå®æ—¶ï¼‰</td><td>ä¿®æ”¹åŠ é€Ÿåº¦ã€è¯»å–å›ºä»¶ç‰ˆæœ¬ç­‰</td></tr><tr><td><strong>PDOï¼ˆProcess Data Objectï¼‰æœåŠ¡</strong></td><td>å®æ—¶æ•°æ®ä¼ è¾“ï¼ˆå‘¨æœŸæ€§ï¼‰</td><td>æ§åˆ¶å­—ã€ç›®æ ‡ä½ç½®ã€åé¦ˆä½ç½®</td></tr><tr><td><strong>Emergencyï¼ˆEMCYï¼‰æŠ¥æ–‡</strong></td><td>å¼‚å¸¸æŠ¥è­¦æœºåˆ¶</td><td>ç”µæœºè¿‡è½½ã€ç¼–ç å™¨é”™è¯¯ç­‰</td></tr><tr><td><strong>SYNC åŒæ­¥æœºåˆ¶</strong></td><td>æ—¶é—´åŒæ­¥ï¼ˆå¦‚æœä½¿ç”¨åŒæ­¥æ¨¡å¼ï¼‰</td><td>ä¸»ç«™å‘åŒæ­¥è§¦å‘ä¿¡å·</td></tr><tr><td><strong>CiA 301&#x2F;40x è®¾å¤‡é…ç½®è§„èŒƒ</strong></td><td>è®¾å¤‡è¡Œä¸ºæ ‡å‡†ï¼ˆå¦‚ CiA 402ï¼‰</td><td>ç”µæœºçŠ¶æ€åˆ‡æ¢é€»è¾‘ã€æ¨¡å¼è®¾ç½®</td></tr></tbody></table><h5 id="ğŸ“‚-æ§åˆ¶ä¸çŠ¶æ€ç›¸å…³å¯¹è±¡ï¼ˆCiA-402ï¼‰"><a href="#ğŸ“‚-æ§åˆ¶ä¸çŠ¶æ€ç›¸å…³å¯¹è±¡ï¼ˆCiA-402ï¼‰" class="headerlink" title="ğŸ“‚ æ§åˆ¶ä¸çŠ¶æ€ç›¸å…³å¯¹è±¡ï¼ˆCiA 402ï¼‰"></a>ğŸ“‚ æ§åˆ¶ä¸çŠ¶æ€ç›¸å…³å¯¹è±¡ï¼ˆCiA 402ï¼‰</h5><table><thead><tr><th>Index</th><th>Sub</th><th>Name</th><th>ç±»å‹</th><th>å«ä¹‰ä¸ä½œç”¨</th></tr></thead><tbody><tr><td><strong>0x603F</strong></td><td>0</td><td>Error code</td><td>UINT16</td><td>æœ€è¿‘ä¸€æ¬¡é”™è¯¯ç ï¼Œæ¯”å¦‚è¿‡æµã€è¿‡å‹ç­‰ (<a href="https://doc-legacy.synapticon.com/software/42/documentation_html/object_htmls/603F/index.html?utm_source=chatgpt.com" title="0x603F Error code - Synapticon Documentation">doc-legacy.synapticon.com</a>)</td></tr><tr><td><strong>0x6040</strong></td><td>0</td><td>Controlword</td><td>UINT16</td><td>æ§åˆ¶çŠ¶æ€æœºï¼Œä¾‹å¦‚ Enable&#x2F;RUN&#x2F;Reset (<a href="https://www.kollmorgen.com/sites/default/files/public_downloads/RGM_CANopen_PDF.pdf?utm_source=chatgpt.com" title="[PDF] RGM CANopen - Kollmorgen">kollmorgen.com</a>, <a href="https://download.variodrive.nl/ACS/product_guides/EtherCAT-DS402-Products-User-Guide.pdf?utm_source=chatgpt.com" title="[PDF] EtherCAT DS402 Products User Guide - My Document">download.variodrive.nl</a>)</td></tr><tr><td><strong>0x6041</strong></td><td>0</td><td>Statusword</td><td>UINT16</td><td>çŠ¶æ€åé¦ˆï¼Œå¦‚ Fault&#x2F;Operation enabledç­‰ (<a href="https://www.kollmorgen.com/sites/default/files/public_downloads/RGM_CANopen_PDF.pdf?utm_source=chatgpt.com" title="[PDF] RGM CANopen - Kollmorgen">kollmorgen.com</a>, <a href="https://download.variodrive.nl/ACS/product_guides/EtherCAT-DS402-Products-User-Guide.pdf?utm_source=chatgpt.com" title="[PDF] EtherCAT DS402 Products User Guide - My Document">download.variodrive.nl</a>)</td></tr><tr><td><strong>0x6060</strong></td><td>0</td><td>Modes of operation</td><td>SINT8</td><td>è®¾ç½®è¿è¡Œæ¨¡å¼ï¼šCSP&#x2F;CST&#x2F;CSVç­‰ (<a href="https://www.kollmorgen.com/sites/default/files/public_downloads/RGM_CANopen_PDF.pdf?utm_source=chatgpt.com" title="[PDF] RGM CANopen - Kollmorgen">kollmorgen.com</a>, <a href="https://download.variodrive.nl/ACS/product_guides/EtherCAT-DS402-Products-User-Guide.pdf?utm_source=chatgpt.com" title="[PDF] EtherCAT DS402 Products User Guide - My Document">download.variodrive.nl</a>)</td></tr><tr><td><strong>0x6061</strong></td><td>0</td><td>Modes display</td><td>SINT8</td><td>å½“å‰è¿è¡Œæ¨¡å¼åé¦ˆ (<a href="https://www.kollmorgen.com/sites/default/files/public_downloads/RGM_CANopen_PDF.pdf?utm_source=chatgpt.com" title="[PDF] RGM CANopen - Kollmorgen">kollmorgen.com</a>, <a href="https://download.variodrive.nl/ACS/product_guides/EtherCAT-DS402-Products-User-Guide.pdf?utm_source=chatgpt.com" title="[PDF] EtherCAT DS402 Products User Guide - My Document">download.variodrive.nl</a>)</td></tr><tr><td><strong>0x6071</strong></td><td>0</td><td>Target torque</td><td>INT16</td><td>è®¾ç½®ç›®æ ‡è½¬çŸ© (<a href="https://doc-legacy.synapticon.com/software/41/object_dict/all_objects/index.html?utm_source=chatgpt.com" title="List of all Objects - Synapticon Documentation">doc-legacy.synapticon.com</a>, <a href="https://www.kollmorgen.com/sites/default/files/public_downloads/RGM_CANopen_PDF.pdf?utm_source=chatgpt.com" title="[PDF] RGM CANopen - Kollmorgen">kollmorgen.com</a>)</td></tr><tr><td><strong>0x607A</strong></td><td>0</td><td>Target position</td><td>INT32</td><td>è®¾ç½®ç›®æ ‡ä½ç½® (<a href="https://doc-legacy.synapticon.com/software/41/object_dict/all_objects/index.html?utm_source=chatgpt.com" title="List of all Objects - Synapticon Documentation">doc-legacy.synapticon.com</a>, <a href="https://www.kollmorgen.com/sites/default/files/public_downloads/RGM_CANopen_PDF.pdf?utm_source=chatgpt.com" title="[PDF] RGM CANopen - Kollmorgen">kollmorgen.com</a>)</td></tr><tr><td><strong>0x60FF</strong></td><td>0</td><td>Target velocity</td><td>INT32</td><td>è®¾ç½®ç›®æ ‡é€Ÿåº¦ (<a href="https://doc-legacy.synapticon.com/software/41/object_dict/all_objects/index.html?utm_source=chatgpt.com" title="List of all Objects - Synapticon Documentation">doc-legacy.synapticon.com</a>, <a href="https://www.kollmorgen.com/sites/default/files/public_downloads/RGM_CANopen_PDF.pdf?utm_source=chatgpt.com" title="[PDF] RGM CANopen - Kollmorgen">kollmorgen.com</a>)</td></tr><tr><td><strong>0x6064</strong></td><td>0</td><td>Actual position</td><td>INT32</td><td>å®é™…ä½ç½®åé¦ˆ (<a href="https://doc-legacy.synapticon.com/software/41/object_dict/all_objects/index.html?utm_source=chatgpt.com" title="List of all Objects - Synapticon Documentation">doc-legacy.synapticon.com</a>, <a href="https://www.kollmorgen.com/sites/default/files/public_downloads/RGM_CANopen_PDF.pdf?utm_source=chatgpt.com" title="[PDF] RGM CANopen - Kollmorgen">kollmorgen.com</a>)</td></tr><tr><td><strong>0x606C</strong></td><td>0</td><td>Actual velocity</td><td>INT32</td><td>å®é™…é€Ÿåº¦åé¦ˆ (<a href="https://doc-legacy.synapticon.com/software/41/object_dict/all_objects/index.html?utm_source=chatgpt.com" title="List of all Objects - Synapticon Documentation">doc-legacy.synapticon.com</a>, <a href="https://www.kollmorgen.com/sites/default/files/public_downloads/RGM_CANopen_PDF.pdf?utm_source=chatgpt.com" title="[PDF] RGM CANopen - Kollmorgen">kollmorgen.com</a>)</td></tr><tr><td><strong>0x6077</strong></td><td>0</td><td>Actual torque</td><td>INT16</td><td>å®é™…è½¬çŸ©åé¦ˆ (<a href="https://doc-legacy.synapticon.com/software/41/object_dict/all_objects/index.html?utm_source=chatgpt.com" title="List of all Objects - Synapticon Documentation">doc-legacy.synapticon.com</a>, <a href="https://www.kollmorgen.com/sites/default/files/public_downloads/RGM_CANopen_PDF.pdf?utm_source=chatgpt.com" title="[PDF] RGM CANopen - Kollmorgen">kollmorgen.com</a>)</td></tr><tr><td><strong>0x60B0</strong></td><td>0</td><td>Position offset</td><td>INT32</td><td>CSP æ¨¡å¼ä¸‹çš„ä½ç½®åç§»ï¼ˆå¯é€‰ï¼‰ (<a href="https://doc-legacy.synapticon.com/software/41/object_dict/all_objects/index.html?utm_source=chatgpt.com" title="List of all Objects - Synapticon Documentation">doc-legacy.synapticon.com</a>)</td></tr><tr><td><strong>0x60B1</strong></td><td>0</td><td>Velocity offset</td><td>INT32</td><td>CSV æ¨¡å¼ä¸‹çš„é€Ÿåº¦åç§»ï¼ˆå¯é€‰ï¼‰ (<a href="https://doc-legacy.synapticon.com/software/41/object_dict/all_objects/index.html?utm_source=chatgpt.com" title="List of all Objects - Synapticon Documentation">doc-legacy.synapticon.com</a>)</td></tr><tr><td><strong>0x60B2</strong></td><td>0</td><td>Torque offset</td><td>INT16</td><td>CST æ¨¡å¼ä¸‹çš„è½¬çŸ©åç§»ï¼ˆå¯é€‰ï¼‰ (<a href="https://doc-legacy.synapticon.com/software/41/object_dict/all_objects/index.html?utm_source=chatgpt.com" title="List of all Objects - Synapticon Documentation">doc-legacy.synapticon.com</a>)</td></tr></tbody></table><h5 id="âš™ï¸-è®¾å¤‡é…ç½®ä¸è¯Šæ–­ç±»å¯¹è±¡ï¼ˆé€šç”¨ï¼‰"><a href="#âš™ï¸-è®¾å¤‡é…ç½®ä¸è¯Šæ–­ç±»å¯¹è±¡ï¼ˆé€šç”¨ï¼‰" class="headerlink" title="âš™ï¸ è®¾å¤‡é…ç½®ä¸è¯Šæ–­ç±»å¯¹è±¡ï¼ˆé€šç”¨ï¼‰"></a>âš™ï¸ è®¾å¤‡é…ç½®ä¸è¯Šæ–­ç±»å¯¹è±¡ï¼ˆé€šç”¨ï¼‰</h5><table><thead><tr><th>ç´¢å¼•</th><th>åç§°</th><th>ç”¨é€”è¯´æ˜</th></tr></thead><tbody><tr><td><strong>0x1000</strong></td><td>Device Type</td><td>è®¾å¤‡ç±»å‹æ ‡è¯†</td></tr><tr><td><strong>0x1001</strong></td><td>Error Register</td><td>é”™è¯¯çŠ¶æ€</td></tr><tr><td><strong>0x1018</strong></td><td>Identity Object</td><td>å‚å•†IDã€äº§å“IDã€ç‰ˆæœ¬å·ç­‰</td></tr><tr><td><strong>0x1020</strong></td><td>Verify Configuration Date</td><td>é…ç½®æ ¡éªŒ</td></tr><tr><td><strong>0x10F1</strong></td><td>Firmware Versionï¼ˆéæ ‡å‡†ï¼‰</td><td>æŸäº›å‚å•†æ‰©å±•çš„å›ºä»¶ä¿¡æ¯</td></tr></tbody></table><p>å¼ºçƒˆå»ºè®®æŸ¥è¯¢è¿™ä¸ªï¼ŒåŸºæœ¬çš„è¯¥æœ‰çš„éƒ½æœ‰ã€‚</p></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Vuex åŸºæœ¬ç”¨æ³•</title>
      <link href="/2025/07/23/202507/Vuex/"/>
      <url>/2025/07/23/202507/Vuex/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-ä»€ä¹ˆæ˜¯Vuex"><a href="#01-ä»€ä¹ˆæ˜¯Vuex" class="headerlink" title="01. ä»€ä¹ˆæ˜¯Vuex?"></a>01. ä»€ä¹ˆæ˜¯Vuex?</h3><p>ä»–å°±æ˜¯ä¸€ä¸ªVueæ’ä»¶ï¼Œç”¨æ¥ç®¡ç†çŠ¶æ€ã€‚</p><p>é‚£ä¹ˆç¬¬ä¸€ä¸ªé—®é¢˜å°±æ¥äº†ï¼Œä»€ä¹ˆæ˜¯çŠ¶æ€</p><h5 id="01-01-ä»€ä¹ˆæ˜¯çŠ¶æ€"><a href="#01-01-ä»€ä¹ˆæ˜¯çŠ¶æ€" class="headerlink" title="01.01 ä»€ä¹ˆæ˜¯çŠ¶æ€?"></a>01.01 ä»€ä¹ˆæ˜¯çŠ¶æ€?</h5><p>ä»–ä¸æ˜¯ä¸€ä¸ªå•çº¯çš„<strong>boolean</strong>å€¼</p><p>æ¯”å¦‚ä½ æ˜¯å¦ç™»å½•ï¼Œè¿™ä¸ªæ˜¯ä¸€ç§çŠ¶æ€ã€‚</p><p>æ¯”å¦‚ç”¨æˆ·ä¿¡æ¯ï¼Œç”¨æˆ·åï¼Œé‚®ç®±ï¼Œä»–çš„æƒé™ï¼Œè¿™äº›å¯èƒ½å±äºä¿¡æ¯ï¼Œä½†æ˜¯ä¸€èˆ¬ä¹Ÿæ”¾è¿›å»äº†ã€‚</p><p>æ¯”å¦‚è®¾ç½®é‡Œé¢çš„ä¸œè¥¿ï¼Œæ¯”å¦‚UIã€‚æ¯”å¦‚ä¸€äº›åŠŸèƒ½çš„å¼€å…³ï¼Ÿ</p><p>å°±æ˜¯ä¸€ä¸ªå¤§å®¶éƒ½ä¼šç”¨çš„ä¸œè¥¿ï¼Œè¿™é‡Œçš„å¤§å®¶å°±æ˜¯æŒ‡ç»„ä»¶ï¼Œå„ä¸ªé¡µé¢éœ€è¦ç”¨çš„ä¸œè¥¿.</p><p>ç”šè‡³ä¸€äº›å¸¸ç”¨çš„APIæˆ‘çœ‹æœ‰äº›é¡¹ç›®ä¹Ÿä¼šç¼“å­˜åœ¨é‡Œé¢ã€‚</p><h5 id="01-02-ä¸ºä»€ä¹ˆè¦ç»Ÿä¸€ç®¡ç†çŠ¶æ€"><a href="#01-02-ä¸ºä»€ä¹ˆè¦ç»Ÿä¸€ç®¡ç†çŠ¶æ€" class="headerlink" title="01.02 ä¸ºä»€ä¹ˆè¦ç»Ÿä¸€ç®¡ç†çŠ¶æ€"></a>01.02 ä¸ºä»€ä¹ˆè¦ç»Ÿä¸€ç®¡ç†çŠ¶æ€</h5><p>okï¼Œæˆ‘çŠ¶æ€è‚¯å®šæ˜¯è¦å¸¸ç”¨çš„å¯¹å§ï¼Œæˆ‘ç›´æ¥ç¼“å­˜èµ·æ¥ï¼Œæ¯”å¦‚å…¨éƒ¨æ”¾åœ¨æ ¹ç»„ä»¶ä¸Šã€‚</p><p>ä½ å“ªä¸ªç»„ä»¶æˆ‘ä¸€ä¸ªä¸€ä¸ªä¼ ä¸‹å»ã€‚</p><p>è¿™ä¸ªæ—¶å€™å°±å‘ç°é—®é¢˜äº†ï¼Œå¾ˆéº»çƒ¦ã€‚</p><p>æ¯”å¦‚æˆ‘é€šè¿‡ <code>props</code> ä¸€ä¸ªä¸€ä¸ªä¼ ä¸‹å», ä»–ä¸æ˜¯ä¸è¡Œï¼Œä»–æ˜¯çœŸçš„ç´¯ã€‚</p><p>é‚£æˆ‘æ”¹ä¸€ä¸‹ã€‚æˆ‘ç›´æ¥æŒ‚åœ¨å…¨å±€ä¸Šï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$myGlobalString</span> = <span class="string">&#x27;A global string&#x27;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä¸€æ ·å¯ä»¥ <code>watch</code> æˆ–è€… <code>computed</code> ç›‘æ§å˜åŒ–å¯¹å§ã€‚</p><p>æœ‰å‡ ä¸ªé—®é¢˜ã€‚</p><ol><li><p>ä»»ä½•äººéƒ½å¯ä»¥ä¿®æ”¹å…¨å±€å˜é‡ï¼Œä½ ç”¨è¿™ä¸ª <code>Vuex</code> å¯ä»¥é¢„æµ‹æ”¹å˜</p></li><li><p>é…åˆå¼€å‘å·¥å…· <code>Vuex</code> å¯ä»¥è¿½æº¯å˜åŒ–</p></li><li><p>å°è£…åå¯ä»¥é€»è¾‘åˆ†ç¦»</p></li></ol><p>å½“ç„¶ï¼Œå¦‚æœä½ è‡ªå·±é¡¹ç›®å°ï¼Œå…¶å® <code>Provide</code> å’Œ <code>Inject</code> å°±å¯ä»¥äº†ï¼Œç®€å•åšåšç®¡ç†</p><h3 id="02-åŸºæœ¬æ¦‚å¿µ"><a href="#02-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="02. åŸºæœ¬æ¦‚å¿µ"></a>02. åŸºæœ¬æ¦‚å¿µ</h3><ol><li><p>State(çŠ¶æ€)</p></li><li><p>Getters(è·å–å™¨)</p></li><li><p>Mutations(å˜æ›´)</p></li><li><p>Actions(åŠ¨ä½œ)</p></li><li><p>modules(æ¨¡å—)</p></li></ol><p>é€»è¾‘å¾ˆç®€å•</p><p><code>State</code>  å°±æ˜¯æ•°æ®</p><p><code>Getters </code> å°±æ˜¯è·å–</p><p><code>Mutations</code> å»ä¿®æ”¹ä»–çš„å€¼(æ³¨æ„ä»–æ˜¯åŒæ­¥çš„ï¼Œå¹¶ä¸”æ€ä¹ˆä¿®æ”¹ä¹Ÿæ˜¯å›ºå®šçš„)</p><p><code>actions</code> ä¸šåŠ¡æµç¨‹çš„æ“ä½œï¼Œå¯ä»¥è¿›è¡Œå¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚è·å–è®¾ç½®çŠ¶æ€ï¼Œç„¶åè°ƒç”¨ <code>Mutations</code> è¿›è¡Œä¿®æ”¹</p><p>å®šä¹‰ä¸€ä¸ª counter</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// testvuevuex/src/store/modules/counter.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  <span class="attr">doubleCount</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">count</span> * <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="title function_">incrementAsync</span>(<span class="params">&#123; commit &#125;</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;increment&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">200</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="title function_">increment</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    state.<span class="property">count</span>++;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">decrement</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    state.<span class="property">count</span>--;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  state,</span><br><span class="line">  getters,</span><br><span class="line">  actions,</span><br><span class="line">  mutations</span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure><p>ç„¶åç»„ä»¶è°ƒç”¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">useStore</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ computed æ¥è®¿é—® state å’Œ gettersï¼Œç¡®ä¿å“åº”æ€§</span></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> store.<span class="property">state</span>.<span class="property">counter</span>.<span class="property">count</span>);</span><br><span class="line"><span class="keyword">const</span> doubleCount = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> store.<span class="property">getters</span>[<span class="string">&#x27;counter/doubleCount&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// mutations å’Œ actions å¯ä»¥ç›´æ¥ commit æˆ– dispatch</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; store.<span class="title function_">commit</span>(<span class="string">&#x27;counter/increment&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">decrement</span> = (<span class="params"></span>) =&gt; store.<span class="title function_">commit</span>(<span class="string">&#x27;counter/decrement&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">incrementAsync</span> = (<span class="params"></span>) =&gt; store.<span class="title function_">dispatch</span>(<span class="string">&#x27;counter/incrementAsync&#x27;</span>);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Vuex Counter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      Count: &#123;&#123; count &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      Double Count (Getter): &#123;&#123; doubleCount &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;decrement&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;incrementAsync&quot;</span>&gt;</span>Increment Async<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¤§æ¦‚çš„è¿‡ç¨‹å°±æ˜¯è¿™æ ·ã€‚ æœ‰ä¸ª <code>counter</code> å°±å¯ä»¥äº†</p><p>éœ€è¦ç¨å¾®æ³¨æ„çš„å°±æ˜¯ï¼Œ<code>Modules</code></p><p><code>namespace: true</code> è¿™ä¸ªæ˜¯æˆ‘åœ¨ <code>counter</code> ä¸­åŠ çš„.</p><p>ç„¶åå°±é¿å…çš„é‡åé—®é¢˜ï¼Œå› ä¸ºè°ƒç”¨çš„æ—¶å€™éƒ½éœ€è¦åœ¨å‰é¢ <code>counter/doubleCount</code> è¿™ç§</p><h3 id="03-ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡ï¼Ÿ"><a href="#03-ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡ï¼Ÿ" class="headerlink" title="03. ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡ï¼Ÿ"></a>03. ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡ï¼Ÿ</h3><p>å…¶å®åº”è¯¥æ˜¯ç›´æ¥ç”¨äº† <strong>react redux</strong> çš„åšæ³•ã€‚</p><p>æ ¸å¿ƒå…¶å®æ˜¯ï¼Œ<strong>æ•°æ®æµå‘å•ä¸€</strong></p><p>****å…¶å®è¿™ä¸ªç¬¬ä¸€ä¸ªè¯åè¿‡æ¥å°±æ˜¯ä¸å•ä¸€ï¼Œä»€ä¹ˆå«ä¸å•ä¸€ï¼Ÿ</p><p>æ¯”å¦‚æˆ‘ç”¨ å…¨å±€å˜é‡ï¼Œæˆ‘ç”¨ <code>Provide</code>, å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè°éƒ½å¯ä»¥æ”¹è¿™ä¸ª</p><p>ä»–çš„å…¥å£æ˜¯å¤šæ˜¯ï¼Œä»»ä½•ä¸€ä¸ªåœ°æ–¹éƒ½å¯ä»¥ä¿®æ”¹ã€‚</p><p>ä½ æ ¹æœ¬ä¸çŸ¥é“æ˜¯è°æ”¹çš„ã€‚è¿™ä¸ªæ—¶å€™å°±åªèƒ½ä¸€ä¸ªä¸€ä¸ªçš„æ’æŸ¥ã€‚</p><p>è€Œä¸”æ¥æºæ ¹æœ¬ä¸å›ºå®šï¼Œç”šè‡³æœ‰äººæ‹¿æ¥åšåŒå‘ç»‘å®šéƒ½å¯èƒ½</p><p>æ‰€ä»¥è‡³å°‘ä»–å¿…é¡»ç”¨ <code>mutations</code> ï¼Œä½ åŠ æ–­ç‚¹éƒ½å¥½åŠ ä¸€äº›ã€‚</p><p>å½“ä½ æ•°æ®æ¥æºç»Ÿä¸€çš„èµ°äº† <code>mutations </code>, é‚£ä¹ˆå°±å¯ä»¥ç®¡ç†äº† </p><p>è€Œä¸”ç”±äº mutations çš„å­˜åœ¨ï¼Œå¯ä»¥æ§åˆ¶ç±»å‹ï¼Œæ§åˆ¶ç»“æœï¼Œæ§åˆ¶æ•°æ®ï¼Œè®©çŠ¶æ€å¤„äºå¯ä»¥é¢„æµ‹ã€‚</p><p>æµ‹è¯•ä¹Ÿæ–¹é¢ï¼ŒåŒæ ·å—ç›Šã€‚</p><p>æ€»ä¹‹ä»–å°±æ˜¯å¸Œæœ›è¿›è¡Œå•å‘æ•°æ®æµï¼Œä¿è¯ç»“æœå¯é æ€§ï¼Œæ•°æ®å¯é æ€§ï¼Œå¹¶ä¸”å¯ä»¥è¿½è¸ªã€‚</p><h3 id="04-Vuex-æ˜¯æ€ä¹ˆå®ç°çš„"><a href="#04-Vuex-æ˜¯æ€ä¹ˆå®ç°çš„" class="headerlink" title="04. Vuex æ˜¯æ€ä¹ˆå®ç°çš„?"></a>04. Vuex æ˜¯æ€ä¹ˆå®ç°çš„?</h3><p>è¿™æ¬¡æœ¬æ¥å°±æ˜¯ä¸ºäº†çœ‹æºç è€Œæ¥çš„ã€‚</p><p>æ’ä»¶æ³¨å†Œçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ª </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">install (app, injectKey) &#123;</span><br><span class="line">  app.<span class="title function_">provide</span>(injectKey || storeKey, <span class="variable language_">this</span>)</span><br><span class="line">  app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$store</span> = <span class="variable language_">this</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> useDevtools = <span class="variable language_">this</span>.<span class="property">_devtools</span> !== <span class="literal">undefined</span></span><br><span class="line">    ? <span class="variable language_">this</span>.<span class="property">_devtools</span></span><br><span class="line">    : __DEV__ || __VUE_PROD_DEVTOOLS__</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (useDevtools) &#123;</span><br><span class="line">    <span class="title function_">addDevtools</span>(app, <span class="variable language_">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ useStore çš„æ—¶å€™</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/injectKey.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> storeKey = <span class="string">&#x27;store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useStore</span> (key = <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">inject</span>(key !== <span class="literal">null</span> ? key : storeKey)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹ï¼Œå…¶å®è¿™å°±æ˜¯æ ¸å¿ƒä»£ç ..</p><p><code>app.use(store)Â -&gt;Â store.install()Â -&gt;Â app.provide(&#39;store&#39;, ...)</code></p><p><code>ç»„ä»¶Â setup()Â -&gt;Â useStore()Â -&gt;Â inject(&#39;store&#39;)</code></p><p>å…¶ä»–æºç ç®€å•çœ‹äº†ä¸€ä¸‹ã€‚</p><p>å°±æ˜¯æœ‰ä¸€ä¸ªå¯¹è±¡ <code>store</code></p><p>ç„¶åéå†å‡º <code>options</code>,  options å°±æ˜¯å‚æ•°, stateï¼Œgetter, mutations ä¹‹ç±»çš„</p><p>ç„¶åæ³¨å†Œï¼Œç„¶åç»‘å®šï¼Œå¹¶ä¸”è®© state computer å¹¶ä¸” å“åº”å¼.</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> Vue3 </tag>
            
            <tag> Vuex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>can ç”µæœºæ˜¯å¦æ¥å…¥</title>
      <link href="/2025/07/21/202507/can%E5%8D%8F%E8%AE%AE%E7%94%B5%E6%9C%BA%E6%8E%A5%E5%85%A5/"/>
      <url>/2025/07/21/202507/can%E5%8D%8F%E8%AE%AE%E7%94%B5%E6%9C%BA%E6%8E%A5%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="canåè®®ç”µæœºæ¥å…¥"><a href="#canåè®®ç”µæœºæ¥å…¥" class="headerlink" title="canåè®®ç”µæœºæ¥å…¥"></a>canåè®®ç”µæœºæ¥å…¥</h1><h3 id="01-æ¥å…¥ç”µæœº"><a href="#01-æ¥å…¥ç”µæœº" class="headerlink" title="01. æ¥å…¥ç”µæœº"></a>01. æ¥å…¥ç”µæœº</h3><p>æ’å¥½ç”µæœºï¼Œé€šç”µï¼Œå¹¶ä¸”å’Œæ”¯æŒcanåè®®é‚£ä¸ªåŒç»çº¿æ¥å¥½ï¼Œé«˜ä½ç¡®è®¤å¥½</p><p>è¿™ä¸€æ­¥æˆ‘æ˜¯è€ƒç¡¬ä»¶çš„åŒäº‹å®Œæˆçš„.</p><h3 id="02-ç¡®è®¤æ˜¯å¦æ­£ç¡®æ¥å…¥"><a href="#02-ç¡®è®¤æ˜¯å¦æ­£ç¡®æ¥å…¥" class="headerlink" title="02. ç¡®è®¤æ˜¯å¦æ­£ç¡®æ¥å…¥"></a>02. ç¡®è®¤æ˜¯å¦æ­£ç¡®æ¥å…¥</h3><h5 id="02-01-ç¡®è®¤ç½‘å£æ˜¯å¦æ­£å¸¸"><a href="#02-01-ç¡®è®¤ç½‘å£æ˜¯å¦æ­£å¸¸" class="headerlink" title="02.01 ç¡®è®¤ç½‘å£æ˜¯å¦æ­£å¸¸"></a>02.01 ç¡®è®¤ç½‘å£æ˜¯å¦æ­£å¸¸</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip <span class="built_in">link</span> show</span><br></pre></td></tr></table></figure><p>ä½ å¾—æœ‰ <strong>can</strong> åè®®çš„ç½‘å£å‡ºç°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3: can0: &lt;NOARP,UP,LOWER_UP,ECHO&gt; mtu 16 qdisc pfifo_fast state UP mode DEFAULT group default qlen 10</span><br><span class="line">    <span class="built_in">link</span>/can </span><br><span class="line">4: can1: &lt;NOARP,UP,LOWER_UP,ECHO&gt; mtu 16 qdisc pfifo_fast state UP mode DEFAULT group default qlen 10</span><br><span class="line">    <span class="built_in">link</span>/can </span><br></pre></td></tr></table></figure><p>å¹¶ä¸”ä¹Ÿéœ€è¦æ˜¯ up çŠ¶æ€</p><blockquote><p>up çŠ¶æ€è¡¨ç¤ºè¯¥æ¥å£<strong>å·²ç»è¢«å¯ç”¨</strong>ï¼Œå¹¶ä¸”<strong>å¤„äºæ´»åŠ¨çŠ¶æ€</strong></p></blockquote><p>æœ‰è¿™ä¸ªåªèƒ½è¡¨æ˜ä½ æœ‰å¸¦åŒé€šé“çš„CANæ¥å£ï¼ŒCANæ§åˆ¶å™¨é©±åŠ¨åº”è¯¥æ­£å¸¸ã€‚</p><p>è¿˜å¯ä»¥å†ç»†èŠ‚çš„æŸ¥ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip -details link show can0</span><br><span class="line">ip -details link show can1</span><br></pre></td></tr></table></figure><p>æ‹¿æˆ‘çš„è¿”å›æ¥è¯´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">user@ak41-ubuntu:~/canopen$ ip -details link show can0</span><br><span class="line">3: can0: &lt;NOARP,UP,LOWER_UP,ECHO&gt; mtu 16 qdisc pfifo_fast state UP mode DEFAULT group default qlen 10</span><br><span class="line">    link/can  promiscuity 0 minmtu 0 maxmtu 0 </span><br><span class="line">    can state ERROR-ACTIVE (berr-counter tx 0 rx 0) restart-ms 0 </span><br><span class="line">          bitrate 1000000 sample-point 0.740 </span><br><span class="line">          tq 20 prop-seg 18 phase-seg1 18 phase-seg2 13 sjw 1</span><br><span class="line">          mttcan: tseg1 2..255 tseg2 0..127 sjw 1..127 brp 1..511 brp-inc 1</span><br><span class="line">          mttcan: dtseg1 1..31 dtseg2 0..15 dsjw 1..15 dbrp 1..15 dbrp-inc 1</span><br><span class="line">          clock 50000000 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 parentbus platform parentdev c310000.mttcan </span><br><span class="line">user@ak41-ubuntu:~/canopen$ ip -details link show can1</span><br><span class="line">4: can1: &lt;NOARP,UP,LOWER_UP,ECHO&gt; mtu 16 qdisc pfifo_fast state UP mode DEFAULT group default qlen 10</span><br><span class="line">    link/can  promiscuity 0 minmtu 0 maxmtu 0 </span><br><span class="line">    can state ERROR-ACTIVE (berr-counter tx 0 rx 0) restart-ms 0 </span><br><span class="line">          bitrate 1000000 sample-point 0.740 </span><br><span class="line">          tq 20 prop-seg 18 phase-seg1 18 phase-seg2 13 sjw 1</span><br><span class="line">          mttcan: tseg1 2..255 tseg2 0..127 sjw 1..127 brp 1..511 brp-inc 1</span><br><span class="line">          mttcan: dtseg1 1..31 dtseg2 0..15 dsjw 1..15 dbrp 1..15 dbrp-inc 1</span><br><span class="line">          clock 50000000 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 parentbus platform parentdev c320000.mttcan </span><br></pre></td></tr></table></figure><p><strong><code>state ERROR-ACTIVE</code></strong> è¯´æ˜canæ§åˆ¶å™¨å·¥ä½œæ­£å¸¸</p><p><strong><code>berr-counter tx 0 rx 0</code></strong> è¯´æ²¡æ²¡æœ‰é”™è¯¯</p><p><strong><code>bitrate 1000000</code></strong> æ¯”ç‰¹ç‡ <strong>1,000,000 bps</strong></p><p>è¿™ä¸ªå¾ˆé‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ç¡®è®¤ç”µæœºçš„æ¯”ç‰¹ç‡æ˜¯å¤šå°‘ï¼Œå¹¶ä¸”è¿™é‡Œè¦åŒæ­¥ã€‚</p><p>å› ä¸ºç”µæœºçš„æ³¢ç‰¹ç‡å¯èƒ½æ˜¯å¦ä¸€ä¸ªå€¼ï¼ˆæ¯”å¦‚ 500kbps, 250kbps ç­‰ï¼‰ï¼Œæ‰€æœ‰CANè®¾å¤‡å¿…é¡»ä½¿ç”¨å®Œå…¨ç›¸åŒçš„æ³¢ç‰¹ç‡æ‰èƒ½é€šä¿¡ã€‚</p><p>å¦‚æœæ˜ç¡®ä¸ä¸€æ ·ï¼Œéœ€è¦ä¿®æ”¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. å…ˆå…³é—­can0æ¥å£</span></span><br><span class="line">sudo ip link set can0 down</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. è®¾ç½®æ–°çš„æ³¢ç‰¹ç‡</span></span><br><span class="line">sudo ip link set can0 type can bitrate 500000</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. é‡æ–°æ‰“å¼€can0æ¥å£</span></span><br><span class="line">sudo ip link set can0 up</span><br></pre></td></tr></table></figure><p> è¿™é‡Œåªæ˜¯ä¸¾ä¸ªä¾‹å­</p><h5 id="02-02-ç¡®è®¤ç”µæœºæ˜¯å¦è¿æ¥ä¸Š"><a href="#02-02-ç¡®è®¤ç”µæœºæ˜¯å¦è¿æ¥ä¸Š" class="headerlink" title="02.02 ç¡®è®¤ç”µæœºæ˜¯å¦è¿æ¥ä¸Š"></a>02.02 ç¡®è®¤ç”µæœºæ˜¯å¦è¿æ¥ä¸Š</h5><p>ç¡®è®¤è‚¯å®šå°±éœ€è¦é€šä¿¡äº†ã€‚</p><p>é¦–å…ˆéœ€è¦å®‰è£…ä¸€ä¸ªä¸œè¥¿ï¼Œæ‰èƒ½é€šè¿‡å‘½ä»¤è¡Œå’Œç”µæœºé€šä¿¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install can-utils</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆå°±å¯ä»¥å¼€å§‹äº†</p><p>ä¸€ä¸ªç»ˆç«¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">candump any</span><br></pre></td></tr></table></figure><p>ä»–ç”¨æ¥ç›‘å¬æ‰€æœ‰çš„ä¿¡æ¯</p><p>ç„¶åå¼€å¦ä¸€ä¸ªç»ˆç«¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cansend can0 000#0100</span><br></pre></td></tr></table></figure><p>can çš„å‘é€åè®®é‡Œ <strong>[CAN-ID] # [Data]</strong></p><p><strong>000</strong> è¡¨ç¤ºç³»ç»Ÿå¹¿æ’­ï¼Œå°±æ˜¯æ‰€æœ‰çš„è®¾å¤‡éƒ½å¿…é¡»ç›‘å¬çš„</p><p><strong>01</strong> è¡¨ç¤ºå¯åŠ¨è¿œç¨‹èŠ‚ç‚¹</p><p><strong>00</strong> è¡¨ç¤ºæ‰€æœ‰èŠ‚ç‚¹</p><p>ä½†æ˜¯æˆ‘æ²¡æœ‰æ”¶åˆ°å›å¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user@ak41-ubuntu:~/canopen$     candump any</span><br><span class="line">  can0  000   [2]  01 00</span><br><span class="line">  can1  000   [2]  01 00</span><br><span class="line">  can1  000   [2]  01 00</span><br><span class="line">  can0  000   [2]  01 00</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåªèƒ½ä»£è¡¨æˆ‘çš„canæ¥å£ä¹‹é—´é€šä¿¡æ²¡é—®é¢˜, æ¥å£éƒ½è¿æ¥åˆ°äº†åŒä¸€ä¸ªCANæ€»çº¿ä¸Š, ç‰©ç†è¿æ¥æ²¡é—®é¢˜.</p><p>ç†è®ºä¸Šæ¥è¯´, æˆ‘æœ‰é…ç½®æ–‡ä»¶ä¹‹ç±»çš„ä¸œè¥¿ï¼Œæˆ‘å¯ä»¥ç¡®å®šèŠ‚ç‚¹æ˜¯ä»€ä¹ˆã€‚ä½†æ˜¯ä¾›åº”å•†è¿˜æ²¡æœ‰å›å¤æˆ‘ã€‚</p><p>æ‰€ä»¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for i in $(seq 1 127); do</span><br><span class="line">  printf &quot;Pinging Node ID %d...\n&quot; &quot;$i&quot;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">This sends a request to <span class="built_in">read</span> a standard object (Vendor ID)</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">The CAN ID is 0x600 + the node ID we are trying</span></span><br><span class="line">  cansend can0 $(printf &quot;%X#4018100000000000&quot; $((0x600 + i)) )</span><br><span class="line">  sleep 0.05  # wait a tiny bit for a response</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°±æ˜¯å¾ªç¯å»è¯·æ±‚ä¸åŒçš„<strong>Can-ID</strong>, è®©ä»–ç»™æˆ‘å‘è®¾å¤‡çš„èº«ä»½ä¿¡æ¯</p><p>äºæ˜¯å¾—åˆ°äº†ä¸€ä¸ªç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">can0  601   [8]  40 18 10 00 00 00 00 00</span><br><span class="line">can0  581   [8]  4F 18 10 00 04 00 00 00</span><br></pre></td></tr></table></figure><p>Â <strong>4Fh</strong> æ˜¯åº”ç­”ç </p><p><strong>18 10 00</strong> ç¡®è®¤åœ°å€æ²¡é—®é¢˜</p><p><strong>04 00 00 00</strong> æ˜¯å°ç«¯ï¼Œç¿»è¿‡æ¥ <strong>0x00000004</strong> </p><p>ok. è¿™é‡Œå…¶å®å°±æ˜¯åŸºæœ¬ç¡®è®¤äº†é€šä¿¡æˆåŠŸäº†ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šäº† can åè®®çš„ç”µæœºè¿æ¥ä¸Šäº†</p><p>è¿™ä¸ªä¸œè¥¿æ˜¯ <strong>CANopen é»˜è®¤æ ‡è¯†ç¬¦ï¼ˆCOB-IDï¼‰åˆ—è¡¨</strong></p><p><a href="https://en.wikipedia.org/wiki/CANopen">https://en.wikipedia.org/wiki/CANopen</a></p><h3 id="03-æœ€æœ€æœ€åŸºæœ¬çš„æ¦‚å¿µ"><a href="#03-æœ€æœ€æœ€åŸºæœ¬çš„æ¦‚å¿µ" class="headerlink" title="03. æœ€æœ€æœ€åŸºæœ¬çš„æ¦‚å¿µ"></a>03. æœ€æœ€æœ€åŸºæœ¬çš„æ¦‚å¿µ</h3><table><thead><tr><th>å¯¹è±¡</th><th>æ¯”å–»</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>SDO</td><td>å®¢æˆ·æœåŠ¡æŸœå°</td><td>é…ç½®å‚æ•°ï¼Œè¯»å†™å¯¹è±¡å­—å…¸ï¼Œå‡†ç¡®ä½†æ…¢</td></tr><tr><td>PDO</td><td>å¤§å–‡å­å¹¿æ’­</td><td>å®æ—¶æ•°æ®ï¼Œä¼ è¾“ä½ç½®&#x2F;é€Ÿåº¦ï¼Œå¿«ä½†æ— ç¡®è®¤</td></tr><tr><td>NMT</td><td>ç³»ç»Ÿç®¡ç†å‘˜</td><td>æ§åˆ¶ç½‘ç»œï¼Œå¯åŠ¨&#x2F;åœæ­¢&#x2F;å¤ä½è®¾å¤‡</td></tr><tr><td>SYNC</td><td>èŠ‚æ‹å™¨</td><td>åŒæ­¥åŠ¨ä½œï¼Œè®©æ‰€æœ‰è®¾å¤‡æ­¥è°ƒä¸€è‡´</td></tr><tr><td>EMCY</td><td>æ€¥æ•‘è­¦æŠ¥</td><td>æŠ¥å‘Šæ•…éšœï¼Œè®¾å¤‡ä¸»åŠ¨ä¸ŠæŠ¥ä¸¥é‡é”™è¯¯</td></tr></tbody></table><p>åé¢æˆ‘ä»¬éœ€è¦ä¸€ä¸ªSDO, æ‰€ä»¥ä¼˜å…ˆçŸ¥é“ä»–çš„æ¦‚å¿µ</p><p><a href="https://www.can-cia.org/can-knowledge/sdo-protocol">https://www.can-cia.org/can-knowledge/sdo-protocol</a></p><blockquote><p>CAN ID: 0x601  ï¼ˆ0x600 + NodeID 0x01ï¼‰ â† å‘ç»™ node 1 çš„ SDO è¯·æ±‚<br>DLC: 8<br>Data:<br>   Byte 0: command specifierï¼ˆæ§åˆ¶å­—èŠ‚ï¼‰<br>   Byte 1-2: indexï¼ˆå¯¹è±¡å­—å…¸ç´¢å¼•ï¼Œä½å­—èŠ‚åœ¨å‰ï¼‰<br>   Byte 3: subindexï¼ˆå­ç´¢å¼•ï¼‰<br>   Byte 4-7: dataï¼ˆæ•°æ®ï¼Œ4 å­—èŠ‚ä»¥å†…ï¼‰</p></blockquote><p>è¯¦ç»†çš„å‘½ä»¤å¯ä»¥é€šè¿‡è¿™ä¸ªç½‘ç«™æŸ¥è¯¢ï¼Œæ¯”å¦‚æˆ‘æ¥ä¸‹æ¥è¦ä¿®æ”¹æ¨¡å¼ </p><p><a href="https://doc-legacy.synapticon.com/software/44/object_dict/all_objects/index.html#all-objects">List of all Objects &amp;#8212; Synapticon Documentation</a></p><blockquote><table><thead><tr><th><a href="https://doc-legacy.synapticon.com/software/44/documentation_html/object_htmls/6060/index.html">0x6060</a></th><th><a href="https://doc-legacy.synapticon.com/software/44/documentation_html/object_htmls/6060/index.html">Modes of operation</a></th></tr></thead></table></blockquote><p>ç„¶åè¯¦ç»†ç‚¹è¿›å»</p><table><thead><tr><th>Value</th><th>Definition</th></tr></thead><tbody><tr><td>-2</td><td>Commutation offset detection mode</td></tr><tr><td>-1</td><td>Cogging compensation recording mode</td></tr><tr><td>+1</td><td>Profile position mode</td></tr><tr><td>+3</td><td>Profile velocity mode</td></tr><tr><td>+4</td><td>Torque profile mode</td></tr><tr><td>+6</td><td>Homing mode</td></tr><tr><td>+8</td><td>Cyclic sync position mode</td></tr><tr><td>+9</td><td>Cyclic sync velocity mode</td></tr><tr><td>+10</td><td>Cyclic sync torque mode</td></tr></tbody></table><p>åº”è¯¥æ€ä¹ˆè®¾ç½®å¤§æ¦‚å°±çŸ¥é“äº†ã€‚</p><h3 id="04-è®©ç”µæœºåŠ¨èµ·æ¥"><a href="#04-è®©ç”µæœºåŠ¨èµ·æ¥" class="headerlink" title="04. è®©ç”µæœºåŠ¨èµ·æ¥"></a>04. è®©ç”µæœºåŠ¨èµ·æ¥</h3><p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”µæœºå‚å•†æä¾›çš„edsæ–‡ä»¶äº†ï¼Œæˆ‘æµ‹è¯•ç”¨çš„æ˜¯ EYOUçš„ç”µæœº</p><h5 id="04-01-è¿›å…¥è½®å»“é€Ÿåº¦æ¨¡å¼"><a href="#04-01-è¿›å…¥è½®å»“é€Ÿåº¦æ¨¡å¼" class="headerlink" title="04.01 è¿›å…¥è½®å»“é€Ÿåº¦æ¨¡å¼"></a>04.01 è¿›å…¥è½®å»“é€Ÿåº¦æ¨¡å¼</h5><blockquote><p>[6060]<br>ParameterName&#x3D;Modes of operation<br>ObjectType&#x3D;7<br>AccessType&#x3D;RW<br>DataType&#x3D;0x0002<br>PDOMapping&#x3D;1<br>ObjFlags&#x3D;0x00000000<br>DefaultValue&#x3D;1</p></blockquote><p>ç„¶åæ ¹æ®æ–‡æ¡£</p><blockquote><p>è½®å»“ä½ç½®æ¨¡å¼,profile position mode(1)</p><p>è½®å»“é€Ÿåº¦æ¨¡å¼,profile velocity mode(3)</p><p>è½®å»“æ‰­çŸ©æ¨¡å¼,profile torque mode(4)</p><p>æ’è¡¥ä½ç½®æ¨¡å¼,interpolated position mode(7)</p><p>å¾ªç¯åŒæ­¥ä½ç½®æ¨¡å¼,cyclic synchronous position mode(8)</p><p>å¾ªç¯åŒæ­¥é€Ÿåº¦æ¨¡å¼, cyclic synchronous velocity mode(9)</p><p>å¾ªç¯åŒæ­¥æ‰­çŸ©æ¨¡å¼, cyclic synchronous torque mode(10)</p></blockquote><table><thead><tr><th>æ“ä½œ</th><th>COB-ID</th><th>Byte0(CS)</th><th>Byte1(Byte2)</th><th>Byte3</th><th>Byte4</th><th>Byte5</th><th>Byte6</th><th>Byte7</th></tr></thead><tbody><tr><td>å†™</td><td>0x600+NodeID</td><td>0x23</td><td>index</td><td>subindex</td><td>data</td><td></td><td></td><td></td></tr><tr><td>å†™</td><td>0x600+NodeID</td><td>0x27</td><td>index</td><td>subindex</td><td>data</td><td></td><td></td><td>&#x2F;</td></tr><tr><td>å†™</td><td>0x600+NodeID</td><td>0x2B</td><td>index</td><td>subindex</td><td>data</td><td></td><td>&#x2F;</td><td>&#x2F;</td></tr><tr><td>å†™</td><td>0x600+NodeID</td><td>0x2F</td><td>index</td><td>subindex</td><td>data</td><td>&#x2F;</td><td>&#x2F;</td><td>&#x2F;</td></tr><tr><td>è¿”å›</td><td>0x580+NodeID</td><td>0x60</td><td>index</td><td>subindex</td><td>-</td><td></td><td></td><td></td></tr><tr><td>è¿”å›</td><td>0x580+NodeID</td><td>0x80</td><td>index</td><td>subindex</td><td>aborting code</td><td></td><td></td><td></td></tr></tbody></table><p>é‚£æˆ‘ä»¬ç”¨ <strong>CANopen SDO</strong> å‘½ä»¤, åŸºäº <strong>03</strong> ä¸­çš„è§„åˆ™, æˆ‘ä»¬çš„å‘½ä»¤å°±å¾ˆæ¸…æ™°äº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">601#</span><span class="language-bash">2F60600003000000</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬è¿›å…¥äº† <strong>è½®å»“é€Ÿåº¦æ¨¡å¼,profile velocity mode(3)</strong></p><h5 id="04-02-å¤ä½æ•…éšœçŠ¶æ€"><a href="#04-02-å¤ä½æ•…éšœçŠ¶æ€" class="headerlink" title="04.02 å¤ä½æ•…éšœçŠ¶æ€"></a>04.02 å¤ä½æ•…éšœçŠ¶æ€</h5><p>è¿™ä¸€æ­¥ä¸»è¦æ˜¯ä¸ºäº†ä¸‡ä¸€ä¸Šæ¬¡æœ‰é”™è¯¯ï¼Œå…ˆå¤ä½</p><blockquote><p>[6040]<br>ParameterName&#x3D;Controlword<br>ObjectType&#x3D;7<br>AccessType&#x3D;RW<br>DataType&#x3D;0x0006<br>PDOMapping&#x3D;1<br>ObjFlags&#x3D;0x00000000<br>DefaultValue&#x3D;0</p></blockquote><p>è¿™æ¬¡æ˜¯ä¸¤ä¸ªå­—èŠ‚äº†</p><table><thead><tr><th>ä½ (Bit)</th><th>15-11</th><th>10</th><th>9</th><th>8</th><th>7</th><th>6-5</th><th>4</th><th>3</th><th>2</th><th>1</th><th>0</th></tr></thead><tbody><tr><td>ä½ çš„ç¼©å†™</td><td>ms</td><td>r</td><td>oms</td><td>h</td><td>fr</td><td>oms</td><td>eo</td><td>qs</td><td>ev</td><td>so</td><td>so</td></tr><tr><td>å®Œæ•´åç§°</td><td>Manufacturer Specific</td><td>Reserved</td><td>Operation Mode Specific</td><td>Halt</td><td>FaultÂ Reset</td><td>Operation Mode Specific</td><td>EnableÂ Operation</td><td>QuickÂ Stop</td><td>EnableÂ Voltage</td><td>SwitchÂ On</td><td>SwitchÂ On</td></tr><tr><td>ä¸­æ–‡è§£é‡Š</td><td>å‚å•†è‡ªå®šä¹‰</td><td>ä¿ç•™</td><td>æ“ä½œæ¨¡å¼ç‰¹å®š</td><td>æš‚åœ</td><td>æ•…éšœå¤ä½</td><td>æ“ä½œæ¨¡å¼ç‰¹å®š</td><td>è¿è¡Œä½¿èƒ½</td><td>å¿«é€Ÿåœæ­¢</td><td>ç”µå‹ä½¿èƒ½</td><td>ä¸Šç”µ</td><td>ä¸Šç”µ</td></tr></tbody></table><p>ç„¶åæˆ‘å°è¯•å»å¤ä½äº†ä»–çš„çŠ¶æ€, å¤§æ¦‚å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;SDO_ID&#125;<span class="comment">#2B40600008000000</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;SDO_ID&#125;<span class="comment">#2B40600006000000</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;SDO_ID&#125;<span class="comment">#2B40600007000000</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;SDO_ID&#125;<span class="comment">#2B4060000F000000</span></span></span><br></pre></td></tr></table></figure><p>ä½œä¸ºä¸€ä¸ªç©æœºå™¨äººçš„å‰ç«¯ï¼Œåˆšå¼€å§‹çœŸçš„æ‡µäº†ã€‚<br><code>0F</code> æ˜¯ä¸ªåå…­è¿›åˆ¶çš„å€¼ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ <code>0000 1111</code></p><p>æ‰€ä»¥ä»£è¡¨ç€ ä¸Šç”µï¼Œç”µå‹ä½¿èƒ½ï¼Œå¿«é€Ÿåœæ­¢</p><h5 id="04-03-è®¾ç½®é€Ÿåº¦è½¬åŠ¨"><a href="#04-03-è®¾ç½®é€Ÿåº¦è½¬åŠ¨" class="headerlink" title="04.03 è®¾ç½®é€Ÿåº¦è½¬åŠ¨"></a>04.03 è®¾ç½®é€Ÿåº¦è½¬åŠ¨</h5><table><thead><tr><th>Name</th><th>Index:Sub</th><th>Type</th><th>Bit Size</th><th>Min Data</th><th>Max Data</th><th>Default Data</th><th>Unit</th><th>Access</th><th>PDO Mapping</th></tr></thead><tbody><tr><td>Target velocity</td><td>0x60FF:0</td><td>DINT</td><td>32</td><td></td><td></td><td>0</td><td>rpm</td><td>readwrite</td><td>Receive PDO (Outputs)</td></tr></tbody></table><p>äºæ˜¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cansend $INTERFACE &quot;$&#123;SDO_ID&#125;#23FF6000$&#123;SPEED_HEX&#125;&quot;</span><br></pre></td></tr></table></figure><p>ç”µæœºå°±è¿™ä¹ˆè½¬èµ·æ¥äº†co</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> can2.0 </tag>
            
            <tag> canopen </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tree-Sharking, rollupè§£æï¼Œvue</title>
      <link href="/2025/07/20/202507/tree_shaking_base/"/>
      <url>/2025/07/20/202507/tree_shaking_base/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="Tree-Sharking-rollupè§£æï¼Œvue"><a href="#Tree-Sharking-rollupè§£æï¼Œvue" class="headerlink" title="Tree-Sharking, rollupè§£æï¼Œvue"></a>Tree-Sharking, rollupè§£æï¼Œvue</h1><h3 id="01-ä»€ä¹ˆæ˜¯-Tree-Sharking"><a href="#01-ä»€ä¹ˆæ˜¯-Tree-Sharking" class="headerlink" title="01. ä»€ä¹ˆæ˜¯ Tree-Sharking"></a>01. ä»€ä¹ˆæ˜¯ Tree-Sharking</h3><blockquote><p>Tree Shaking æ˜¯ä¸€ç§é€šè¿‡é™æ€åˆ†ææ¥æ¶ˆé™¤Â JavaScriptÂ ä¸­æœªä½¿ç”¨ä»£ç çš„æŠ€æœ¯ã€‚å®ƒçš„åå­—æ¥æºäºâ€æ‘‡æ ‘â€çš„æ¯”å–»Â - å°±åƒæ‘‡åŠ¨ä¸€æ£µæ ‘æ¥è®©æˆç†Ÿçš„æœå®æ‰è½ä¸€æ ·ï¼ŒTree Shaking ä¼šâ€æ‘‡æ‰â€é‚£äº›æ²¡æœ‰è¢«ä½¿ç”¨çš„ä»£ç ã€‚</p></blockquote><p>ä¸Šé¢æ˜¯aiè¯´çš„</p><p>ç®€å•è¯´å°±æ˜¯ä½ ä»£ç ä¸­æœ‰å¾ˆå¤šä¸ç”¨çš„ä¸œè¥¿ï¼Œä¸ç®¡æ˜¯ç¬¬ä¸‰æ–¹çš„ï¼Œè¿˜æ˜¯è‡ªå·±çš„å†™ï¼Œé€šè¿‡ Tree-Sharking çš„æ–¹å¼ï¼Œè®©ä»–ä¸æ‰“åŒ…åœ¨æœ€ç»ˆä»£ç ä¸­ï¼Œä»è€Œè¾¾åˆ°å‡å°‘ä½“ç§¯çš„ä½œç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// math.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">subtract</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">multiply</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">&#x27;./math.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€ä¸ªä»£ç ï¼Œå¸Œæœ›çš„ç»“æœå°±æ˜¯åªæ‰“åŒ… <code>add</code> è€Œä¸æ˜¯æ‰€æœ‰ math.js éƒ½æ‰“åŒ…ã€‚</p><h3 id="02-åº”ç”¨åœºæ™¯"><a href="#02-åº”ç”¨åœºæ™¯" class="headerlink" title="02. åº”ç”¨åœºæ™¯"></a>02. åº”ç”¨åœºæ™¯</h3><p>è‚¯å®šæ˜¯éœ€è¦å¯¹ä½“ç§¯æ•æ„Ÿçš„åœ°æ–¹ï¼Œæ¯”å¦‚è¯´æµè§ˆå™¨ç«¯ã€‚</p><p>ç›¸æ¯”ä¹‹ä¸‹æ¯”å¦‚electronä¹‹ç±»çš„åœ°æ–¹ç¡®å®ä¸æ˜¯å¾ˆæ•æ„Ÿï¼Œæˆ‘éƒ½æœ¬åœ°äº†ï¼Œæˆ‘éƒ½ç”¨electronäº†ã€‚</p><p>éšä¾¿å§ã€‚ åªè¦ä¸æ˜¯å¤§åˆ°ç¦»è°±ã€‚</p><h3 id="03-å¦‚ä½•å®ç°çš„"><a href="#03-å¦‚ä½•å®ç°çš„" class="headerlink" title="03. å¦‚ä½•å®ç°çš„"></a>03. å¦‚ä½•å®ç°çš„</h3><p>æ‹¿ <strong>Vue3</strong> ä¸¾ä¾‹</p><blockquote><p>Vue TemplateÂ -&gt;Â (Vue Compiler + AST)Â -&gt;Â ä¼˜åŒ–çš„ JavaScript æ¸²æŸ“å‡½æ•° (å¸¦Â import)Â -&gt;Â (Rollup&#x2F;Vite)Â -&gt;Â Tree ShakingÂ -&gt;Â æœ€ç»ˆçš„ã€æœ€å°åŒ–çš„ JS åŒ…</p></blockquote><p>éœ€è¦æ³¨æ„ (Rollup&#x2F;Vite) å°±æ˜¯è¯´è¿™ç§æ‰“åŒ…å·¥å…·ä»–å¤šåšä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯å»æ ‡è®° â€œæ´»ä»£ç â€ æˆ–è€… â€œæ­»ä»£ç â€. </p><p>ä¸ºæœ€ç»ˆçš„ <strong>Tree Shaking</strong> åšå‡†å¤‡</p><h3 id="04-rollupæ€è·¯è§£æ"><a href="#04-rollupæ€è·¯è§£æ" class="headerlink" title="04. rollupæ€è·¯è§£æ"></a>04. rollupæ€è·¯è§£æ</h3><p><strong>vite</strong> å®ç° <strong>Tree Shaking</strong> çš„æ–¹å¼æ˜¯ä½¿ç”¨ <strong>rollup</strong> , æ‰€ä»¥ç®€å•æŸ¥äº†ä¸‹</p><h5 id="04-01-è¯æ³•è§£æ"><a href="#04-01-è¯æ³•è§£æ" class="headerlink" title="04.01 è¯æ³•è§£æ"></a>04.01 è¯æ³•è§£æ</h5><p>é€šè¿‡ <strong>Acorn</strong> éå†å‡º <strong>token</strong>ï¼Œä¹Ÿå°±æ˜¯è¯æ³•åˆ†æ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">* <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Keyword&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;import&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">* <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Punctuator&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">* <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;add&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">* <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Punctuator&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#125;&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">* <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;from&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">* <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;String&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#x27;./utils&#x27;&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">* <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Punctuator&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;;&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥çš„ç›®çš„æ˜¯ç•™ä¸‹ä¸€ä¸ªæ²¡æœ‰ç©ºæ ¼ï¼Œæ¢è¡Œç­‰ç­‰ï¼Œç»“æ„åŒ–çš„èŠ‚ç‚¹ã€‚</p><h5 id="04-02-è¯­æ³•åˆ†æ"><a href="#04-02-è¯­æ³•åˆ†æ" class="headerlink" title="04.02 è¯­æ³•åˆ†æ"></a>04.02 è¯­æ³•åˆ†æ</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ImportDeclaration&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">28</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;specifiers&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ImportSpecifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;imported&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;add&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;local&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Identifier&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;add&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Literal&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./utils&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>åŸºäº <strong>token</strong> è€Œæ¥ï¼Œå½¢æˆä¸€ä¸ª Â <strong>ESTree</strong> è§„èŒƒÂ çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œä¹Ÿå°±æ˜¯ <strong>AST</strong></p><p>ä¸Šé¢çš„éƒ½æ˜¯åŸºäº  <strong>Acorn</strong> æ¥åšçš„ï¼Œä»–æ˜¯ä¸€ä¸ªè¯æ³•&#x2F;è¯­æ³•è§£æå™¨</p><p>è¿™ä¸ªæ—¶å€™æœ‰äº†å±‚çº§ï¼Œæœ‰äº†ç±»å‹ã€‚</p><h5 id="04-03-é€’å½’è§£æ"><a href="#04-03-é€’å½’è§£æ" class="headerlink" title="04.03 é€’å½’è§£æ"></a>04.03 é€’å½’è§£æ</h5><p>æ¯”å¦‚æˆ‘æ˜¯ä¸€ä¸ª <strong>main.js</strong></p><p>æˆ‘åšå¥½å‰ä¸¤æ­¥ï¼Œç„¶åå¼€å§‹é€’å½’ã€‚</p><p>ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„å¯¹è±¡å»å­˜å‚¨ASTå¯¹è±¡ã€‚ï¼ˆå¯¹è±¡ä½ å¯ä»¥è‡ªå·±å®šä¹‰ï¼Œæ€»ä¹‹å°±æ˜¯æè¿°æ¸…æ¥šï¼‰</p><p>å½“éå†å®Œæˆã€‚</p><p>å°±å¼€å§‹æ¢³ç†ã€‚</p><p>æœ‰æ²¡æœ‰å¼•ç”¨ï¼Ÿæœ‰å°±ç»§ç»­ è¯æ³•ï¼Œè¯­æ³•è§£æï¼Œå¾€é‡Œèµ°ï¼Œç»§ç»­ç›®å‰è¿™ä¸ªæ­¥éª¤</p><p>æœ€åå¼€å§‹æ ‡è®°ï¼Œå“ªäº›æ˜¯<strong>æ­»</strong>çš„ï¼Œå“ªäº›æ˜¯<strong>æ´»</strong>çš„ </p><p>ä¸åœçš„æ›´æ–°</p><p>æœ€åå°±æœ‰ä¸€ä¸ªå®Œæˆçš„æ„å›¾ï¼Œä½ çŸ¥é“å“ªäº›æ˜¯æ­»çš„ï¼Œå“ªäº›æ˜¯æ´»çš„ä»£ç ã€‚</p><p>å½“ç„¶ä¸­é—´æœ‰å¾ˆå¤šç»†èŠ‚ã€‚</p><p>æ¯”å¦‚ä½ éå†çš„ç®—æ³•ï¼Ÿ rollup ç”¨çš„æ˜¯æ·±åº¦ä¼˜å…ˆã€‚</p><p>æœ‰äº›å…¨å±€å˜é‡æ€ä¹ˆå¤„ç†ï¼Ÿæœ‰æ²¡æœ‰å…¶ä»–æ¶å¿ƒçš„åœ°æ–¹å¯ä»¥æ”¹å˜ä»–ï¼Ÿ</p><p>æ¯”å¦‚æœ‰äº›å˜é‡ç°åœ¨çœ‹èµ·æ¥æ²¡ç”¨ï¼Œå®é™…ä¸Šå¾ˆæ·±çš„å±‚æ¬¡æ‰æœ‰å¼•ç”¨ï¼Ÿ</p><p>æ˜¯å¦æœ‰ç¼“å­˜ï¼Ÿä¸€æ ·çš„ä¸œè¥¿æ˜¯å¦åˆ¤æ–­ï¼Ÿ</p><p>ç­‰ç­‰ç­‰ç­‰ï¼Œæˆ‘åªæ˜¯è¯´äº†ä¸€ä¸ªç®€å•çš„è¿‡ç¨‹.</p><p>ç†è®ºä¸Šä»–æ˜¯ä¸€ä¸ªä¸åœçš„æ›´æ–°è¿‡ç¨‹ï¼Œè¿™ä¸ªå¯¹è±¡éœ€è¦ä¸åœçš„æ›´æ–°ï¼Œç›´åˆ°æœ€åä¸€ä¸ªæ–‡ä»¶éå†å®Œæˆ.</p><h5 id="04-04-æ„å»º"><a href="#04-04-æ„å»º" class="headerlink" title="04.04 æ„å»º"></a>04.04 æ„å»º</h5><p>å¦‚æœåªæ˜¯å¯¹äº <strong>tree shaking</strong> æ¥è¯´è¿™ä¸€æ­¥å·²ç»å®Œæˆå¤§éƒ¨åˆ†å·¥ä½œäº†ã€‚</p><p>ç¼–è¯‘æ¥è¯´å°±æ˜¯æ¯æ¬¡ç¼–è¯‘çš„æ—¶å€™ï¼Œè®¿é—®ä¸€ä¸‹æˆ‘ä»¬ç”Ÿæˆçš„å¯¹è±¡ï¼ŒçŸ¥é“æ­»å’Œæ´»å°±è¡Œäº†</p><h4 id="04-05-rollup-æµç¨‹å›¾"><a href="#04-05-rollup-æµç¨‹å›¾" class="headerlink" title="04.05 rollup æµç¨‹å›¾"></a>04.05 rollup æµç¨‹å›¾</h4><p>graph TD;<br>    subgraph â€œGraph (æ€»åè°ƒå™¨)â€<br>        A[â€œå¼€å§‹: build(â€˜main.jsâ€™)â€] â€“&gt; B{â€œè·å–æˆ–è§£ææ¨¡å—(â€˜main.jsâ€™)â€};<br>    end<br>    subgraph â€œè·å–æˆ–è§£ææ¨¡å—(æ–‡ä»¶è·¯å¾„)â€<br>        C{â€œæ¨¡å—æ˜¯å¦åœ¨ç¼“å­˜ä¸­?â€} â€“ æ˜¯ â€“&gt; D[è¿”å›ç¼“å­˜çš„æ¨¡å—];<br>        C â€“ å¦ â€“&gt; E[â€œåˆ›å»ºæ–°æ¨¡å—(æ–‡ä»¶è·¯å¾„)â€];<br>        E â€“&gt; F[â€œæ¨¡å—è¯»å–æ–‡ä»¶å¹¶<br/>ç”¨ Acorn è§£ææˆ ASTâ€];<br>        F â€“&gt; G[â€œæ¨¡å—åˆ†æ AST å¯»æ‰¾ import è¯­å¥â€];<br>        G â€“ â€œå¯¹äºæ¯ä¸ª â€˜importâ€™ çš„ä¾èµ–è·¯å¾„â€ â€“&gt; H{â€œè·å–æˆ–è§£ææ¨¡å—(ä¾èµ–è·¯å¾„)<br/><b>(é€’å½’è°ƒç”¨)</b>â€œ};<br>        H â€“&gt; I[â€œå°†ä¾èµ–é“¾æ¥åˆ°çˆ¶æ¨¡å—â€];<br>        I â€“&gt; G;<br>        G â€“ â€œåˆ†æå®Œæˆâ€ â€“&gt; J[â€œå°†æ–°æ¨¡å—æ·»åŠ åˆ°ç¼“å­˜â€];<br>        J â€“&gt; D;<br>    end<br>    B â€“&gt; C;<br>    D â€“&gt; K[â€œæ¨¡å—ä¾èµ–å›¾æ„å»ºå®Œæˆâ€];<br>    style H fill:#e6f3ff,stroke:#333,stroke-width:2px,font-weight:bold<br>    style B fill:#ccffcc,stroke:#333,stroke-width:2px</p><h3 id="05-ä¸ºä»€ä¹ˆvue2-x3D-gt-vue3-tree-shaking-å˜å¥½äº†ï¼Ÿ"><a href="#05-ä¸ºä»€ä¹ˆvue2-x3D-gt-vue3-tree-shaking-å˜å¥½äº†ï¼Ÿ" class="headerlink" title="05. ä¸ºä»€ä¹ˆvue2 &#x3D;&gt; vue3 tree shaking å˜å¥½äº†ï¼Ÿ"></a>05. ä¸ºä»€ä¹ˆvue2 &#x3D;&gt; vue3 tree shaking å˜å¥½äº†ï¼Ÿ</h3><p>é¦–å…ˆå°±å¾—å¯¹æ¯”ä»£ç äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;Hello Vue 2!&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ ¹æ®æˆ‘ä»¬åˆšæ‰çš„æµç¨‹è¿™ä¸ªä»£ç å°±å·²ç»å¾ˆæœ‰é—®é¢˜äº†ã€‚</p><p>ä»–æ˜¯å…¨éƒ¨å¼•å…¥çš„ï¼Œæ™®é€š <strong>tree shaking</strong> æ ¹æœ¬æ²¡ç”¨ã€‚</p><p>åªèƒ½åšä¸“é—¨çš„ï¼Œä»–å¾ˆå¤šä¸œè¥¿éƒ½æ˜¯å…¨å±€ç»‘å®šçš„ï¼Œ <code>Vue.set, Vue.nextTick</code></p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ <code>vue2</code> <strong>tree shaking</strong> åŸºæœ¬æ²¡ç”¨çš„åŸå› </p><p>å½“ç„¶ä¹Ÿä¸æ˜¯è¯´å®Œå…¨ä¸èƒ½åšï¼Œæ”¹ä¸€ä¸‹ rollupï¼Œ åšä¸€äº›ä¸“é—¨å¤„ç†ï¼Œå¯¹å˜é‡åšä¸“é—¨çš„å¤„ç†ã€‚</p><p>å†çœ‹çœ‹ <strong>vue3</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp, ref, computed, nextTick &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> message = <span class="title function_">ref</span>(<span class="string">&#x27;Hello Vue 3!&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> double = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> message.<span class="property">value</span>.<span class="property">length</span> * <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; message, double &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç¾ä¸½ã€‚</p><h3 id="06-ç–‘é—®ï¼Œä¸ºä»€ä¹ˆcommonjs-æˆ–è€…-import-å…¨éƒ¨ä¸èƒ½-tree-shaking"><a href="#06-ç–‘é—®ï¼Œä¸ºä»€ä¹ˆcommonjs-æˆ–è€…-import-å…¨éƒ¨ä¸èƒ½-tree-shaking" class="headerlink" title="06. ç–‘é—®ï¼Œä¸ºä»€ä¹ˆcommonjs æˆ–è€… import å…¨éƒ¨ä¸èƒ½ tree shaking"></a>06. ç–‘é—®ï¼Œä¸ºä»€ä¹ˆcommonjs æˆ–è€… import å…¨éƒ¨ä¸èƒ½ tree shaking</h3><blockquote><p><strong>CommonJS</strong> æ˜¯ä¸€ç§ JavaScript æ¨¡å—è§„èŒƒï¼Œæœ€æ—©æ˜¯ä¸º <strong>Node.js</strong> å’ŒæœåŠ¡å™¨ç«¯ JavaScript åº”ç”¨è®¾è®¡çš„ã€‚å®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯ä¸º JavaScript æä¾›ä¸€ä¸ªæ ‡å‡†çš„æ¨¡å—ç³»ç»Ÿï¼Œè®©å¼€å‘è€…å¯ä»¥åƒåœ¨å…¶ä»–è¯­è¨€ä¸­é‚£æ ·ï¼Œä½¿ç”¨ <code>require()</code> å¯¼å…¥æ¨¡å—ã€ä½¿ç”¨ <code>module.exports</code> å¯¼å‡ºæ¨¡å—ã€‚</p></blockquote><p>ä»–å’Œ </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br></pre></td></tr></table></figure><p>ä¸€æ ·ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯å…¨éƒ¨å¯¼å…¥ã€‚</p><p>æˆ‘äº§ç”Ÿäº†ä¸€ä¸ªç–‘é—®</p><p>ä¸ºä»€ä¹ˆå…¨éƒ¨å¯¼å…¥æ— æ³• <strong>tree shaking</strong> ?</p><p>ç†è®ºä¸Šæ¥è¯´ï¼Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">vue.<span class="property">ref</span></span><br></pre></td></tr></table></figure><p>Â·<code>vue.ref</code> æ˜¯å¯ä»¥æ”¶é›†çš„å•Š</p><p>äºæ˜¯æˆ‘åˆ°å¤„æŸ¥äº†ä¸‹ã€‚</p><p>ä¸»è¦æ˜¯è¦å¤„ç†å¤ªå¤šæƒ…å†µäº†ã€‚ç†è®ºä¸Šå…¶å®æ²¡é—®é¢˜ï¼Œå¦‚æœå°†æ¥æœ‰ç²¾å‡†çš„<strong>AI</strong>ï¼Œé‚£ä¹ˆå…¶å®æ˜¯å¯è¡Œçš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™æ³•ä¸€ï¼šé™æ€åˆ†æå™¨èƒ½çœ‹æ‡‚</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">set</span>(&#123; <span class="attr">a</span>: <span class="number">1</span> &#125;, <span class="string">&#x27;b&#x27;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™æ³•äºŒï¼šé™æ€åˆ†æå™¨å½»åº•æ‡µäº†</span></span><br><span class="line"><span class="keyword">const</span> myMethod = <span class="string">&#x27;set&#x27;</span>;</span><br><span class="line"><span class="title class_">Vue</span>[myMethod](&#123; <span class="attr">a</span>: <span class="number">1</span> &#125;, <span class="string">&#x27;b&#x27;</span>, <span class="number">2</span>); </span><br></pre></td></tr></table></figure><p><code>myMethod</code> å¯ä»¥æ˜¯ä»»ä½•æ–¹å¼ï¼Œ<code>function</code> ä¼ å…¥ï¼Œå…¨å±€å˜é‡ç­‰ç­‰</p><p>åˆ†æå™¨ä¸å¯èƒ½åº”å¯¹æ‰€æœ‰æƒ…å†µã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initializePlugin</span>(<span class="params">framework</span>) &#123;</span><br><span class="line">  <span class="comment">// åœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨ï¼ŒRollup æ€ä¹ˆçŸ¥é“ framework å°±æ˜¯ Vueï¼Ÿ</span></span><br><span class="line">  <span class="comment">// è¿½è¸ªå¯¹è±¡çš„åˆ«åæ˜¯ä¸€é¡¹éå¸¸å¤æ‚ä¸”è€—æ€§èƒ½çš„å·¥ä½œã€‚</span></span><br><span class="line">  framework.<span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">/* ... */</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">initializePlugin</span>(<span class="title class_">Vue</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´ç³Ÿç³•çš„æƒ…å†µï¼šä¿®æ”¹å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyFramework</span> = &#123; ...<span class="title class_">Vue</span> &#125;; <span class="comment">// åˆ›å»ºäº†ä¸€ä¸ªå‰¯æœ¬</span></span><br><span class="line"><span class="title class_">MyFramework</span>.<span class="property">version</span> = <span class="string">&#x27;custom&#x27;</span>; <span class="comment">// ä¿®æ”¹äº†å®ƒ</span></span><br><span class="line"><span class="comment">// æ¥ä¸‹æ¥å¯¹ MyFramework.set çš„è°ƒç”¨ï¼ŒRollup å¾ˆéš¾å†æŠŠå®ƒå’ŒåŸå§‹çš„ Vue å…³è”èµ·æ¥</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyComponent.vue</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™äº›æƒ…å†µåˆ†æå™¨éƒ½ä¸å¥½å¤„ç†</p><p>æ‰€ä»¥ä¸ºä»€ä¹ˆä¸èƒ½åˆ†æå…¨éƒ¨å¯¼å…¥ï¼Ÿå› ä¸ºå˜æ•°å¤ªå¤šå¤ªå¤šäº†ã€‚</p><p>é™¤éä½ èƒ½å®Œå…¨æ§åˆ¶è‡ªå·±çš„ä»£ç ï¼Œä¸ºè‡ªå·±çš„ä»£ç ä¸“é—¨åšä¸€å¥—ã€‚</p><h3 id="07-æ€»ç»“"><a href="#07-æ€»ç»“" class="headerlink" title="07 æ€»ç»“"></a>07 æ€»ç»“</h3><p>ä»Šå¤©å¤§æ¦‚äº†è§£äº†ä¸‹ <strong>tree shaking</strong> çš„æ¦‚å¿µ</p><p>ä»¥åŠä¸ºä»€ä¹ˆ <strong>Vue2</strong> ä¸èƒ½åš <strong>tree shaking</strong></p><p><strong>Vue3</strong> å¥½åš <strong>tree shaking</strong></p><p>ä¸ºä»€ä¹ˆ <strong>commonjs</strong> ä¸èƒ½åš <strong>tree shaking</strong></p><p>æœ‰ç©ºè‡ªå·±å†™ä¸€ä¸ªå§</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> Vue3 </tag>
            
            <tag> Vue2 </tag>
            
            <tag> Tree-Sharking </tag>
            
            <tag> Commonjs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jwtå®ç°åŸç†</title>
      <link href="/2024/12/05/202412/jwt/"/>
      <url>/2024/12/05/202412/jwt/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è™½ç„¶æˆ‘æ˜¯ä¸€ä¸ªå…¨æ ˆï¼Œä½†æ˜¯æˆ‘å±…ç„¶ä¸€ç›´æ²¡å†™è¿‡jwtã€‚</p><p>å› ä¸ºæˆ‘çœŸçš„æ²¡æœ‰ä»å¤´åˆ°å°¾ï¼Œä»å‰ç«¯åˆ°åç«¯å»è´Ÿè´£è¿‡ä¸€ä¸ªé¡¹ç›®ï¼Œå…¨éƒ¨è‡ªå·±åš</p><p>ä»¥è‡³äºæˆ‘çŠ¯äº†ä¸€ä¸ªä½çº§é”™è¯¯ï¼Œè®¤ä¸ºtokenï¼Œä¹Ÿå°±æ˜¯jwtç”Ÿæˆçš„tokenæ˜¯å¯ä»¥å»¶é•¿æ—¶é—´çš„ã€‚</p><p>å“ˆå“ˆå“ˆå“ˆå“ˆï¼Œå¾ˆå°´å°¬</p><h2 id="JWT-çš„åŸºæœ¬æœºåˆ¶"><a href="#JWT-çš„åŸºæœ¬æœºåˆ¶" class="headerlink" title="JWT çš„åŸºæœ¬æœºåˆ¶"></a>JWT çš„åŸºæœ¬æœºåˆ¶</h2><p>JWTï¼ˆJSON Web Tokenï¼‰æ˜¯ä¸€ç§ç”¨äºèº«ä»½éªŒè¯å’Œä¿¡æ¯äº¤æ¢çš„å¼€æ”¾æ ‡å‡†ã€‚å®ƒçš„åŸºæœ¬æœºåˆ¶å¦‚ä¸‹ï¼š</p><ol><li>ç»„æˆï¼šJWT ç”±ä¸‰éƒ¨åˆ†ç»„æˆ - å¤´éƒ¨ï¼ˆHeaderï¼‰ã€è½½è·ï¼ˆPayloadï¼‰å’Œç­¾åï¼ˆSignatureï¼‰</li><li>ç”Ÿæˆï¼šæœåŠ¡å™¨åœ¨ç”¨æˆ·ç™»å½•æˆåŠŸååˆ›å»º JWT</li><li>ä¼ é€’ï¼šæœåŠ¡å™¨å°† JWT è¿”å›ç»™å®¢æˆ·ç«¯</li><li>å­˜å‚¨ï¼šå®¢æˆ·ç«¯å­˜å‚¨ JWTï¼ˆé€šå¸¸åœ¨æœ¬åœ°å­˜å‚¨æˆ– Cookie ä¸­ï¼‰</li><li>ä½¿ç”¨ï¼šå®¢æˆ·ç«¯åœ¨åç»­è¯·æ±‚ä¸­æºå¸¦ JWTï¼ˆé€šå¸¸åœ¨ Authorization å¤´ä¸­ï¼‰</li><li>éªŒè¯ï¼šæœåŠ¡å™¨éªŒè¯ JWT çš„æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§</li></ol><h2 id="åç«¯æ€ä¹ˆåšï¼Ÿæˆ–è€…è¯´jwtåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#åç«¯æ€ä¹ˆåšï¼Ÿæˆ–è€…è¯´jwtåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åç«¯æ€ä¹ˆåšï¼Ÿæˆ–è€…è¯´jwtåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>åç«¯æ€ä¹ˆåšï¼Ÿæˆ–è€…è¯´jwtåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>ä¸€èˆ¬æ˜¯å¼•å…¥ç¬¬ä¸‰æ–¹åŒ…ã€‚</p><p>åŸç†çš„è¯ï¼Œæˆ‘ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯å­˜å‚¨ã€‚åé¢å‘ç°ä¸æ˜¯</p><p>å› ä¸ºçœ‹äº†æºç <code>@nestjs/jwt</code>æ˜¯ç”¨ HS256</p><p>ä¹Ÿå°±æ˜¯é€šè¿‡é‚£ä¸ªå­—ç¬¦ä¸²åŠ å¯†è§£å¯†è§£å†³é—®é¢˜</p><p>æ‰€ä»¥åˆ›å»ºï¼Œåˆ·æ–°ï¼ŒéªŒè¯ï¼Œå…¶å®æ˜¯ä¸€ç§åŠ å¯†ç®—æ³•ï¼Œå‡å°äº†å­˜å‚¨çš„å‹åŠ›ï¼Œä½†æ˜¯è®¡ç®—çš„å‹åŠ›ï¼Ÿ</p><p>æ‰€ä»¥ä¹Ÿå°±ä¸å­˜åœ¨å»¶é•¿æŸä¸ªtokençš„ç™»å½•æ—¶é—´ï¼Œå› ä¸ºä¸€æ—¦ç”Ÿæˆå°±æ˜¯å›ºå®šçš„ã€‚</p><p>æ‰€ä»¥ï¼Œä½ è‡ªå·±å†™ä¹Ÿä¸æ˜¯ä¸è¡Œã€‚</p><h2 id="æ€ä¹ˆåˆ·æ–°ï¼Ÿ"><a href="#æ€ä¹ˆåˆ·æ–°ï¼Ÿ" class="headerlink" title="æ€ä¹ˆåˆ·æ–°ï¼Ÿ"></a>æ€ä¹ˆåˆ·æ–°ï¼Ÿ</h2><p>æ— éå°±æ˜¯å‰ç«¯å’Œåç«¯è°åšã€‚ä¸€èˆ¬æ˜¯åç«¯åš</p><p>å°±æ˜¯è¯·æ±‚çš„æ—¶å€™ï¼ŒéªŒè¯tokenä¹‹åè¿”å›æ–°token</p><p>ä½†æ˜¯è¿™ä¸ªæ—¶é—´å°±å¾ˆç©å‘³äº†</p><p>ä»–é¢‘ç¹çš„è¯·æ±‚ï¼Œä½ æ¯æ¬¡éƒ½åˆ·æ–°å¾ˆæµªè´¹ã€‚</p><p>æˆ‘ä¸€èˆ¬æ˜¯è¶…è¿‡1ä¸ªå°æ—¶ï¼Œç»§ç»­è¯·æ±‚å°±åˆ·æ–°token</p><p>åæ­£ä½ äº†è§£äº†æœºåˆ¶ï¼ŒæŒ‰ç…§ä½ çš„éœ€æ±‚è€ƒè™‘å§</p><h2 id="å‰ç«¯æ¥å…¥-JWT"><a href="#å‰ç«¯æ¥å…¥-JWT" class="headerlink" title="å‰ç«¯æ¥å…¥ JWT"></a>å‰ç«¯æ¥å…¥ JWT</h2><p>å‰ç«¯æ¥å…¥ JWT çš„åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>ç™»å½•ï¼šå‘é€ç”¨æˆ·å‡­è¯åˆ°æœåŠ¡å™¨ï¼Œè·å– JWT</li><li>å­˜å‚¨ï¼šå°†è·å–çš„ JWT å­˜å‚¨åœ¨æœ¬åœ°ï¼ˆå¦‚ localStorage æˆ– sessionStorageï¼‰</li><li>è¯·æ±‚æ‹¦æˆªï¼šä½¿ç”¨ Axios ç­‰åº“è®¾ç½®è¯·æ±‚æ‹¦æˆªå™¨ï¼Œè‡ªåŠ¨åœ¨æ¯ä¸ªè¯·æ±‚çš„ header ä¸­æ·»åŠ  JWT</li><li>å“åº”å¤„ç†ï¼šå¤„ç† 401ï¼ˆæœªæˆæƒï¼‰é”™è¯¯ï¼Œå¯èƒ½éœ€è¦åˆ·æ–° token æˆ–é‡æ–°ç™»å½•</li><li>ç™»å‡ºï¼šæ¸…é™¤å­˜å‚¨çš„ JWT</li></ol><p>ç¤ºä¾‹ä»£ç ï¼ˆä½¿ç”¨ Axiosï¼‰ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­˜å‚¨ JWT</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">storeJWT</span> = (<span class="params">token</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;jwt&#x27;</span>, token);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å– JWT</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getJWT</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;jwt&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®è¯·æ±‚æ‹¦æˆªå™¨</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="title function_">getJWT</span>();</span><br><span class="line">  <span class="keyword">if</span> (token) &#123;</span><br><span class="line">    config.<span class="property">headers</span>[<span class="string">&#x27;Authorization&#x27;</span>] = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†å“åº”</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> response,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">response</span>.<span class="property">status</span> === <span class="number">401</span>) &#123;</span><br><span class="line">      <span class="comment">// å¤„ç†æœªæˆæƒé”™è¯¯ï¼Œå¦‚åˆ·æ–° token æˆ–é‡å®šå‘åˆ°ç™»å½•é¡µ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™»å‡º</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">logout</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;jwt&#x27;</span>);</span><br><span class="line">  <span class="comment">// é‡å®šå‘åˆ°ç™»å½•é¡µæˆ–é¦–é¡µ</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šJWT æ˜¯æ— çŠ¶æ€çš„ï¼ŒæœåŠ¡å™¨ä¸èƒ½ä¸»åŠ¨ä½¿å…¶å¤±æ•ˆã€‚å› æ­¤ï¼Œé€šå¸¸è®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´å¹¶ä½¿ç”¨åˆ·æ–° token æœºåˆ¶æ¥å¹³è¡¡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>thx</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> jwt </tag>
            
            <tag> åŸç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sse EventSource ç©ºæ ¼</title>
      <link href="/2024/12/04/202412/eventsource_space/"/>
      <url>/2024/12/04/202412/eventsource_space/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>ä¸çŸ¥é“åŸºæœ¬çš„ä¿¡æ¯çš„å¯ä»¥çœ‹ <a href="https://www.ruanyifeng.com/blog/2017/05/server-sent_events.html">https://www.ruanyifeng.com/blog/2017/05/server-sent_events.html</a></p><p>æœ¬è´¨ä¸Šæ˜¯ä¸€ç§é•¿é“¾æ¥ï¼Œæ‰€ä»¥æ˜¯æœåŠ¡å™¨å•å‘æµè§ˆå™¨ï¼ˆæˆ–è€…è¯´å®¢æˆ·ç«¯ï¼‰çš„ä¸€ç§æ–¹å¼</p><p>ä½†æ˜¯è¿™æ¬¡æˆ‘çº ç»“çš„æ˜¯ <code>EventSource</code></p><h2 id="åŸºæœ¬æƒ…å†µ"><a href="#åŸºæœ¬æƒ…å†µ" class="headerlink" title="åŸºæœ¬æƒ…å†µ"></a>åŸºæœ¬æƒ…å†µ</h2><p>å†™äº†ä¸€ä¸ªè¶…ç®€å•çš„æ¥æ”¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fullUrl = <span class="string">`<span class="subst">$&#123;myUrl&#125;</span>?<span class="subst">$&#123;params.toString()&#125;</span>`</span>;</span><br><span class="line"><span class="keyword">let</span> eventSource = <span class="keyword">new</span> <span class="title class_">EventSource</span>(fullUrl);</span><br><span class="line">eventSource.<span class="property">onopen</span> = <span class="function">() =&gt;</span> &#123;&#125;;</span><br><span class="line">eventSource.<span class="property">onmessage</span> = <span class="keyword">async</span> (event) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (event.<span class="property">data</span> === <span class="string">&quot;[DONE]&quot;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">aiReturnDataLoading</span> = <span class="literal">false</span>;</span><br><span class="line">    eventSource.<span class="title function_">close</span>();</span><br><span class="line">    eventSource = <span class="literal">null</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">aiReturnData</span> += event.<span class="property">data</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getBottom</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">eventSource.<span class="property">onerror</span> = <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¼ çš„æ˜¯markdownï¼Œä½†æ˜¯å‘ç°markdownæ˜¯ä¹±çš„ï¼Œå°±æ˜¯æœ‰äº›ä¸è§£æã€‚</p><p>æ‰“å‡ºæ¥ä»¥åå‘ç°æ˜¯åç«¯æ²¡ä¼ ç©ºæ ¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-aaaa</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰ç©ºæ ¼å°±æ²¡æ³•è§£æã€‚</p><p>åç«¯ç›´æ¥ç”¨äº†curlç»™æˆ‘æ‰“å‡ºæ¥äº†ï¼Œæœ‰ç©ºæ ¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data: \n</span><br></pre></td></tr></table></figure><p><code>\n</code> å‰é¢ç¡®å®æœ‰ç©ºæ ¼ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆæˆ‘è¿™é‡Œåªèƒ½æ”¶åˆ°ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Ÿ</p><p>äºæ˜¯æŸ¥äº†ä¸‹æ–‡æ¡£ä¹Ÿå°±æ˜¯é˜®ä¸€å³°çš„å“ªä¸ª</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data:  message\n\n</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ <code>message</code> å‰é¢æ˜¯æœ‰ç©ºæ ¼çš„, äºæ˜¯è‡ªå·±å†™äº†ä¸€ä¸ª <strong>sse</strong> çš„æœåŠ¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/stream&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è®¾ç½®å“åº”å¤´</span></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/event-stream&quot;</span>);</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;keep-alive&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> message =</span><br><span class="line">    <span class="string">&quot;djslkadjlaksjdlkasjdlkasjdlkasjdlkasjdlsajlkjdlakjsdlajldkjaslkd&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> interval = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; message.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> char = message.<span class="title function_">charAt</span>(index);</span><br><span class="line">      res.<span class="title function_">write</span>(<span class="string">`data: <span class="subst">$&#123;char&#125;</span> \n\n`</span>);</span><br><span class="line">      res.<span class="title function_">write</span>(<span class="string">`data:  \n\n`</span>);</span><br><span class="line">      index++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(interval);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;close&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(interval);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Client disconnected&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åå¤ä¿®æ”¹äº† res.write çš„ç©ºæ ¼ï¼Œç„¶åå‰ç«¯è°ƒç”¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> eventSource = <span class="keyword">new</span> <span class="title class_">EventSource</span>(<span class="string">&#x27;/stream&#x27;</span>);</span><br><span class="line">eventSource.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(event.<span class="property">data</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(event.<span class="property">data</span>.<span class="property">length</span>)</span><br><span class="line">&#125;;</span><br><span class="line">eventSource.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;EventSource failed:&#x27;</span>, err);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¯æ˜äº†ä¸€ä¸ªäº‹å®</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>:ç©ºæ ¼message\n\n</span><br></pre></td></tr></table></figure><p>å¿…é¡»è¦æœ‰ç©ºæ ¼ï¼Œåç«¯ç»™æˆ‘çœ‹äº†ä¸‹ <strong>java</strong> æºç ï¼Œç¡®å®æ²¡æœ‰ <code>append</code> ç©ºæ ¼, ä¸æ˜¯å¾ˆç†è§£ï¼Œä¸è¿‡å¯ä»¥æ‰‹åŠ¨äº†ç©ºæ ¼ä»¥åé—®é¢˜è§£å†³</p><p>ä¸ºäº†ä¸¥è°¨æˆ‘è¿˜æ˜¯æŸ¥äº†ä¸‹å®˜æ–¹æ–‡æ¡£</p><p><a href="https://html.spec.whatwg.org/multipage/server-sent-events.html#server-sent-events">https://html.spec.whatwg.org/multipage/server-sent-events.html#server-sent-events</a></p><p>åœ¨ <strong>9.2.6Â Interpreting an event stream ä¸­</strong></p><blockquote><p>Collect the characters on the line after the first U+003A COLON character (:), and letÂ be that string. IfÂ starts with a U+0020 SPACE character, remove it fromÂ .valuevaluevalue</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´å‰é¢å‡­å€Ÿç»éªŒçš„åˆ¤æ–­è¿˜æ˜¯æœ‰é—®é¢˜ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè§„åˆ™æ˜¯ç¬¬ä¸€ä¸ªç©ºæ ¼ä¼šåˆ é™¤ï¼Œæ°å¥½è¿™è¾¹åç«¯ä¼ è¿‡æ¥ä¸€ä¸ªç©ºæ ¼ï¼Œé‚£ä¹ˆå°±è¢«åˆ é™¤äº†ï¼Œå°±å°‘äº†ä¸€ä¸ªç©ºæ ¼</p><h2 id="æœ€åçš„è§£å†³æ–¹æ¡ˆ"><a href="#æœ€åçš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æœ€åçš„è§£å†³æ–¹æ¡ˆ"></a>æœ€åçš„è§£å†³æ–¹æ¡ˆ</h2><p>å› ä¸ºç›´æ¥ç¡¬åŠ ç©ºæ ¼å¯èƒ½å¯¼è‡´å…¶ä»–é—®é¢˜ï¼Œæ‰€ä»¥æœ€åæ”¹æˆä¼ base64æå®šã€‚</p><p>ä¸è¿‡base64è½¬ä¸­æ–‡GBKç¼–ç ï¼Œæœ€ç®€å•è¿˜æ˜¯ç”¨</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> eventsource </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¼ä¸šå¾®ä¿¡ç™»å½•æµç¨‹</title>
      <link href="/2024/12/03/202412/company_wechat_login/"/>
      <url>/2024/12/03/202412/company_wechat_login/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>ä½¿ç”¨ç™»å½•çš„å‰ææ˜¯ï¼Œä½ é…ç½®å¥½äº†å›è°ƒï¼Œä¿¡ä»»åŸŸåä¹‹ç±»çš„ã€‚</p><h2 id="01-å¼€å§‹"><a href="#01-å¼€å§‹" class="headerlink" title="01. å¼€å§‹"></a>01. å¼€å§‹</h2><p><a href="https://developer.work.weixin.qq.com/document/path/91335">https://developer.work.weixin.qq.com/document/path/91335</a></p><p><a href="https://prod-files-secure.s3.us-west-2.amazonaws.com/c58c4e60-4e7d-412f-8331-564f16cae57b/9131eeda-181c-4487-9edd-557f14553944/image.png" title="image.png" class="gallery-item" style="box-shadow: none;"> <img src="https://prod-files-secure.s3.us-west-2.amazonaws.com/c58c4e60-4e7d-412f-8331-564f16cae57b/9131eeda-181c-4487-9edd-557f14553944/image.png" alt="image.png"></a></p><p>è¿™ä¸ªæ˜¯ä¼ä¸šå¾®ä¿¡ç»™çš„ä¸€å¼ å›¾</p><p>ä¹Ÿå°±æ˜¯è¯´ å®¢æˆ·ç«¯é‡å®šå‘ â‡’ å¾®ä¿¡ä¼ä¸šåå° â‡’ è¿”å› code state â‡’ å®¢æˆ·ç«¯ code state â‡’ è‡ªå·±åå° â‡’ åå°åˆ°ä¼ä¸šå¾®ä¿¡åå° â‡’ è¿”å›ç”¨æˆ·ä¿¡æ¯ â‡’ è¿”å›ç”¨æˆ·ä¿¡æ¯åˆ°å®¢æˆ·ç«¯</p><p>è¿™ç§åº”è¯¥å°±æ˜¯é™é»˜è·å–ç”¨æˆ·ä¿¡æ¯ã€‚</p><h2 id="è·å–-code-å’Œ-state"><a href="#è·å–-code-å’Œ-state" class="headerlink" title="è·å– code å’Œ state"></a>è·å– code å’Œ state</h2><p><a href="https://developer.work.weixin.qq.com/document/path/91022">https://developer.work.weixin.qq.com/document/path/91022</a></p><blockquote><p><a href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=CORPID&redirect_uri=REDIRECT_URI&response_type=code&scope=snsapi_base&state=STATE&agentid=AGENTID#wechat_redirect">https://open.weixin.qq.com/connect/oauth2/authorize?appid=CORPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=snsapi_base&amp;state=STATE&amp;agentid=AGENTID#wechat_redirect</a></p></blockquote><p>æŒ‰ç…§ä¸Šé¢çš„æµç¨‹å›¾ä¸Šé¢ï¼Œè¿™ä¸€æ­¥æ˜¯ä¸éœ€è¦è‡ªå·±çš„åå°å‚ä¸çš„ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦ä¼  <a href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=CORPID&redirect_uri=REDIRECT_URI&response_type=code&scope=snsapi_base&state=STATE&agentid=AGENTID#wechat_redirect"><code>REDIRECT_URI</code></a> </p><p>ç†ç”±æ˜¯éœ€è¦éªŒè¯ å‚æ•° <code>CORPID</code> å’Œ <code>REDIRECT_URI</code> çš„åˆæ³•æ€§</p><p><code>REDIRECT_URI</code>  éœ€è¦æ˜¯ä½ é…ç½®é‚£ä¸ªåŸŸåï¼Œæˆ‘è¿™è¾¹ä½¿ç”¨çš„æ˜¯å‰ç«¯åœ°å€ï¼Œä½ è¦ç”¨åç«¯ä¹Ÿè¡Œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const redirectUri = encodeURIComponent(window.location.href);</span><br><span class="line">const weChatAuthUrl = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=&amp;redirect_uri=$&#123;redirectUri&#125;&amp;response_type=code&amp;scope=snsapi_base&amp;state=STATE&amp;agentid=#wechat_redirect`;</span><br><span class="line">window.location.href = weChatAuthUrl;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æœåŠ¡å°±ä¼šä¼ ç»™ä½ ç±»ä¼¼è¿™ç§è¿æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://api.3dept.com/cgi-bin/query?action=get&amp;code=AAAAAAgG333qs9EdaPbCAP1VaOrjuNkiAZHTWgaWsZQ&amp;state=</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä¸Šé¢çš„ä»£ç ä»–ä¼šä¸€ç›´åˆ·æ–°é¡µé¢ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦åˆ¤æ–­æ˜¯å¦æ˜¯åœ¨ä¼ä¸šå¾®ä¿¡ç¯å¢ƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navigator.userAgent.toLowerCase().match(/wxwork/i) == &quot;wxwork&quot;</span><br></pre></td></tr></table></figure><p>ç„¶åå†™ä¸€ä¸ªåˆ¤æ–­å³å¯</p><h2 id="åç«¯æ¶ˆè´¹code"><a href="#åç«¯æ¶ˆè´¹code" class="headerlink" title="åç«¯æ¶ˆè´¹code"></a>åç«¯æ¶ˆè´¹code</h2><p><a href="https://developer.work.weixin.qq.com/document/path/91023">è·å–è®¿é—®ç”¨æˆ·èº«ä»½ - æ–‡æ¡£ - ä¼ä¸šå¾®ä¿¡å¼€å‘è€…ä¸­å¿ƒ (qq.com)</a></p><blockquote><p><a href="https://qyapi.weixin.qq.com/cgi-bin/auth/getuserinfo?access_token=ACCESS_TOKEN&code=CODE">https://qyapi.weixin.qq.com/cgi-bin/auth/getuserinfo?access_token=ACCESS_TOKEN&amp;code=CODE</a></p></blockquote><p>éœ€è¦å…ˆè·å– <code>ACCESS_TOKEN</code></p><p><a href="https://developer.work.weixin.qq.com/document/path/91023#15074">https://developer.work.weixin.qq.com/document/path/91023#15074</a></p><p><a href="https://developer.work.weixin.qq.com/document/path/91039">è·å–access_token - æ–‡æ¡£ - ä¼ä¸šå¾®ä¿¡å¼€å‘è€…ä¸­å¿ƒ (qq.com)</a></p><blockquote><p><a href="https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=ID&corpsecret=SECRET">https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=ID&amp;corpsecret=SECRET</a></p></blockquote><p>è¿™ä¸ªåç«¯å°±å¥½å†™äº†ã€‚</p><p>æ— éå‡ ä¸ªè¯·æ±‚ï¼Œå”¯ä¸€è§‰å¾—ç¥å¥‡çš„æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://qyapi.weixin.qq.com/cgi-bin/user/get?access_token=&quot; + accessToken + &quot;&amp;userid=&quot;</span><br><span class="line">                + userId;</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯èƒ½è¯·æ±‚éƒ¨åˆ†ç”¨æˆ·ä¿¡æ¯ï¼ŒæŒ‰ç†è¯´é™é»˜åªèƒ½è·å– <code>userid</code> å•Š, ä¸è¿‡ä¸é‡è¦ã€‚</p><p>ä»£ç é€šäº†ï¼Œä¸è¿‡éœ€è¦å¤„ç†ç”¨æˆ·ç›´æ¥åˆ·æ–°çš„é—®é¢˜</p><h2 id="ç½‘é¡µç™»å½•"><a href="#ç½‘é¡µç™»å½•" class="headerlink" title="ç½‘é¡µç™»å½•"></a>ç½‘é¡µç™»å½•</h2><p>è¿™ä¸ªæ–¹æ¡ˆæ˜¯ä¸éœ€è¦ï¼Œä½†æ˜¯æŸ¥çš„æ—¶å€™é¡ºä¾¿æµ‹è¯•äº†ä¸€ä¸‹ï¼Œä¹Ÿå¯ä»¥ï¼Œåœºæ™¯å°±æ˜¯ä¸åœ¨ä¼ä¸šå¾®ä¿¡çš„ç¯å¢ƒé‡Œï¼Œé€šè¿‡æ‰«æç™»å½•ã€‚</p><p>å‰ç«¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const urlParams = new URLSearchParams(window.location.search);</span><br><span class="line">const user = urlParams.get(&#x27;user&#x27;);</span><br><span class="line">if (user) &#123;</span><br><span class="line">    // å‡è®¾useræ˜¯ä¸€ä¸ªJSONå­—ç¬¦ä¸²ï¼Œå¯ä»¥è§£æå®ƒ</span><br><span class="line">    const parsedUser = JSON.parse(decodeURIComponent(user));</span><br><span class="line">    this.$store.commit(&#x27;setUser&#x27;, parsedUser);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    // é‡å®šå‘åˆ°ä¼ä¸šå¾®ä¿¡è®¤è¯</span><br><span class="line">    const redirectUri = encodeURIComponent(`$&#123;window.location.origin&#125;/wechat/callback`);</span><br><span class="line">    const weChatAuthUrl = `https://open.work.weixin.qq.com/wwopen/sso/qrConnect?appid=wwd93305cfd28429fb&amp;agentid=1000025&amp;redirect_uri=$&#123;redirectUri&#125;&amp;state=STATE`;</span><br><span class="line">    window.location.href = weChatAuthUrl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª redirectUri  å¿…é¡»æ˜¯åç«¯çš„</p><p>åç«¯ä¼šæ¥æ”¶ä¸€ä¸ª <code>code</code>ï¼Œç„¶åé€šè¿‡ <code>code + access_token</code> è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶åç”Ÿæˆtokenæˆ–è€…ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶ååšä¸€ä¸ªæµè§ˆå™¨çš„é‡å®šå‘ç»™å‰ç«¯ã€‚</p><p>ä»£ç é‡å…¶å®å·®åˆ«ä¸å¤§ï¼Œç”šè‡³ä»£ç å·®åˆ«ä¹Ÿä¸å¤§</p><p>è¿™ä¸ªæ–¹æ¡ˆçš„é—®é¢˜åœ¨äºä¿¡æ¯ç›´æ¥ <strong>get</strong> ä¼ å¾ˆä¸‘é™‹, è™½ç„¶è¿™ç©æ„å„¿ä¹Ÿä¸æ˜¯ä»€ä¹ˆç§˜å¯†. æ¯•ç«Ÿä½  <strong>F12</strong> æˆ–è€…æ‹¦æˆªä¹Ÿèƒ½çœ‹å¾—åˆ°ï¼Œä½†æ˜¯ç›´æ¥ <strong>url</strong> é‡Œé¢ä¼ è¿˜æ˜¯â€¦</p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p><a href="https://developer.work.weixin.qq.com/document/path/90315#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B0%83%E8%AF%95">https://developer.work.weixin.qq.com/document/path/90315#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B0%83%E8%AF%95</a></p><p>ä¼ä¸šå¾®ä¿¡å¯ä»¥è°ƒè¯•ï¼Œè¯¦æƒ…è§è¿æ¥.</p><p>è¿™ç‚¹æˆ‘è§‰å¾—æ¯”é’‰é’‰å¥½å¤šäº†ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> ä¼ä¸šå¾®ä¿¡ </tag>
            
            <tag> javascrip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bitlockerå‘½ä»¤è¡Œè§£é”</title>
      <link href="/2024/12/02/202412/bitlocker/"/>
      <url>/2024/12/02/202412/bitlocker/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>éœ€æ±‚æ˜¯ä¸ç”¨å‘½ä»¤è¡Œæˆ–è€…ä¸èƒ½ç›´æ¥ç‚¹å‡»å³é”®Uç›˜è¾“å…¥å¯†ç </p><p>å› ä¸ºç”¨æˆ·ä¸å¸Œæœ›ç‚¹é™¤è¿™ä¸ªè½¯ä»¶ä»¥å¤–çš„ä¸œè¥¿.</p><p>æ‰€ä»¥éœ€è¦åœ¨è½¯ä»¶å†…è§£é”bitlocker</p><p>ç›®å‰4ç§åŠæ³•</p><ol><li>unlocker-bitlocker</li></ol><p>æœ€ç®€å•çš„æ–¹æ¡ˆ, ç›´æ¥ä¸€ä¸ªpowershell ä¼ å‚è§£å†³</p><p>ç¼ºç‚¹, éä¸“ä¸šç‰ˆæ²¡æœ‰è¿™ç©æ„å„¿, æ“ä½œç³»ç»Ÿå…¼å®¹è¦å…ˆæƒ³å¥½.</p><p>å‰ææ˜¯å®¢æˆ·ç³»ç»Ÿæ”¯æŒbitlocker, å¹¶ä¸”å…è®¸å®‰è£…, å¦‚æœä¸å…è®¸æˆ–è€…ç³»ç»Ÿç›´æ¥ä¸èƒ½å®‰è£…bitlocker</p><p>æ˜¯ä¸èƒ½ä½¿ç”¨è¿™ä¸ªæ–¹æ³•çš„</p><p>è€Œä¸”è¿˜éœ€è¦æ”¯æŒpowershell, å¹¶ä¸”å…è®¸å‡çº§</p><p>è¿˜æœ‰å…¶ä»–ç±»ä¼¼çš„æ–¹æ¡ˆ, ä½†æ˜¯å‰æä¹Ÿéƒ½æ˜¯å¼€å¯äº†bitlockeråŠŸèƒ½</p><p>è¿˜æœ‰ä¸€ä¸ªç‰ˆæœ¬åœ¨é‡Œé¢, ä¸åŒç‰ˆæœ¬çš„unlocker-bitlocker é«˜å…¼å®¹ä½</p><p>ä½†æ˜¯ä½ç‰ˆæœ¬æ— æ³•å…¼å®¹é«˜ç‰ˆæœ¬</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-BitLockerVolumeInternal</span> : The management information stored on the drive contained an unknown <span class="built_in">type</span>. <span class="keyword">If</span> you are <span class="keyword">using</span> an old version of Windows, try accessing the drive from the latest version. (Exception from HRESULT: 0x8031009B) At C:\Windows\system32\WindowsPowerShell\v1.0\<span class="keyword">Module</span>s\BitLocker\BitLocker.psm1:1198 char:40 + ... umeInternal = Get-BitLockerVolumeInternal -MountPoint $MountPoint[$i] + </span><br></pre></td></tr></table></figure><ol><li>manage-dbe</li></ol><p>ä¸¤ç§æ–¹æ¡ˆ</p><ol><li>å‘½ä»¤è¡Œè¾“å…¥</li></ol><p><a href="https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/manage-bde-unlock">https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/manage-bde-unlock</a></p><p>ä¹Ÿåªèƒ½å‘½ä»¤è¡Œè¾“å…¥, å› ä¸º manage-bde -unlock F: -password ä¸æ”¯æŒ ç®¡é“è¾“å…¥, ä¹Ÿå°±æ˜¯ manage-bde does not support piping passwords</p><ol><li>é€šè¿‡ç§˜é’¥è¿›è¡Œæ¢å¤</li></ol><p>éœ€è¦ç”¨æˆ·ä¸Šä¼ ç§˜é’¥, è¯ä¹¦ç­‰ç­‰æ–¹å¼</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">manage<span class="literal">-bde</span> <span class="literal">-unlock</span> X: <span class="literal">-RecoveryPassword</span> &lt;æ¢å¤ç§˜é’¥&gt;</span><br><span class="line">manage<span class="literal">-bde</span> <span class="literal">-unlock</span> D: <span class="literal">-RecoveryPassword</span> <span class="number">123456</span><span class="literal">-789012-345678-901234-567890-123456-789012-345678</span></span><br><span class="line"></span><br><span class="line">manage<span class="literal">-bde</span> <span class="literal">-unlock</span> X: <span class="literal">-KeyProtector</span> &lt;å¯†é’¥æ–‡ä»¶è·¯å¾„&gt;</span><br><span class="line">manage<span class="literal">-bde</span> <span class="literal">-unlock</span> D: <span class="literal">-KeyProtector</span> F:\mykey.bek</span><br><span class="line"></span><br><span class="line">manage<span class="literal">-bde</span> <span class="literal">-unlock</span> X: <span class="literal">-Cert</span></span><br><span class="line"></span><br><span class="line">manage<span class="literal">-bde</span> <span class="literal">-unlock</span> X:</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šä¼ å, é€šè¿‡å¯†ç æˆ–è€…å…¶ä»–æ–¹å¼å…³è”ç§˜é’¥, ç„¶åè¾“å…¥è§£é”</p><p>å¯ä»¥åš, ä½†æ˜¯ä¸æ”¯æŒæ²¡ç»‘å®šè¿‡çš„uç›˜å’ŒåªçŸ¥é“å¯†ç çš„uç›˜</p><ol><li>é€šè¿‡windows api è‡ªå·±å†™</li><li>ç¬¬ä¸‰æ–¹ ç›®å‰æ²¡æœ‰æ‰¾åˆ°å…è´¹ä¸”æ”¯æŒå‘½ä»¤è¡Œè§£é”çš„</li></ol></div>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> bitlocker </tag>
            
            <tag> bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>setInterval æµè§ˆå™¨æ‰§è¡Œé¢‘ç‡</title>
      <link href="/2024/03/11/javascript/setInterval_browser_execution_frequency/"/>
      <url>/2024/03/11/javascript/setInterval_browser_execution_frequency/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>åœ¨å†™ä¸€ä¸ªä¸œè¥¿çš„æ—¶å€™éœ€è¦åœ¨æŸä¸ªæ—¶é—´å®šæ—¶æ‰§è¡Œä¸€äº›ä»»åŠ¡, åœ¨æµè§ˆå™¨.</p><p>ä¸œè¥¿å¾ˆå¿«å°±å†™å¥½äº†.</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123; </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"><span class="comment">//todo something</span></span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><p>ç»“æœå‘ç°ä¸€äº›é—®é¢˜, <code>setInterval</code> åœ¨5åˆ†é’Ÿåæµè§ˆå™¨ä¼šé™ä½jså®šæ—¶å™¨çš„æ‰§è¡Œé¢‘ç‡ï¼ˆ1åˆ†é’Ÿä¸€æ¬¡ï¼‰</p><p>äºæ˜¯ä¸èƒ½å‡†ç¡®çš„æ‰§è¡Œæˆ‘æƒ³è¦åšçš„äº‹æƒ…, å…·ä½“è¯¦æƒ…å¯ä»¥çœ‹ä¸‹é¢æ–‡ç« </p><p><a href="https://developer.chrome.com/blog/timer-throttling-in-chrome-88?hl=zh-cn">ä» Chrome 88 å¼€å§‹ï¼Œç³»ç»Ÿä¼šå¯¹é“¾æ¥çš„ JS è®¡æ—¶å™¨æ–½åŠ ä¸¥æ ¼çš„èŠ‚æµé™åˆ¶ Â |Â  Blog Â |Â  Chrome for Developers</a></p><p><a href="https://www.zdnet.com/article/chrome-javascript-timer-throttling-googles-tests-show-it-saves-up-to-2-hours-battery-life/">Chrome JavaScript timer throttling: Googleâ€™s tests show it saves up to 2 hoursâ€™ battery life</a></p><p>ç»è¿‡æˆ‘æŸ¥è¯¢, éœ€è¦è§£å†³é—®é¢˜æœ‰3ä¸ªåŠæ³•.</p><ol><li>settimeout</li><li>webworker</li><li>æµè§ˆå™¨è§£å†³</li></ol><p>ä¸€ä¸ªä¸€ä¸ªçœ‹. </p><h3 id="01-settimeout"><a href="#01-settimeout" class="headerlink" title="01. settimeout"></a>01. settimeout</h3><p><code>settimeout</code> è§£å†³å°±æ˜¯ä¸é€šè¿‡ <code>setInterval</code> æ¯æ¬¡æ‰§è¡Œ, è€Œæ˜¯ <code>settimeout</code> æ‰§è¡Œå®Œæˆ, å†å¯åŠ¨ä¸€ä¸ª <code>settimeout</code> , ä»è€Œé¿è¿‡è¿™ä¸ªé—®é¢˜</p><p>æˆ‘ä»ä¸€å¼€å§‹å°±è§‰å¾—è¿™ä¸ªæ–¹æ¡ˆè§£å†³ä¸äº†, å› ä¸ºæµè§ˆå™¨å…¨å±€è®¾ç½®å¯¼è‡´äº†è¿™ä¸ªé—®é¢˜, ä¸ä¼šå› ä¸ºä½ é‡æ–°è®¾ç½®é¿è¿‡</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">startOrder</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toTimeString</span>().<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">8</span>))</span><br><span class="line">      <span class="title function_">startOrder</span>();</span><br><span class="line">  &#125;, <span class="number">500</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">startOrder</span>();</span><br><span class="line">  </span><br><span class="line"><span class="number">14</span>:<span class="number">02</span>:<span class="number">42</span></span><br><span class="line"><span class="number">14</span>:<span class="number">03</span>:<span class="number">24</span></span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">24</span></span><br><span class="line"><span class="number">14</span>:<span class="number">05</span>:<span class="number">24</span></span><br><span class="line"><span class="number">14</span>:<span class="number">06</span>:<span class="number">24</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸ªå¯ä»¥è§£å†³ç³»ç»Ÿè¿‡äºç¹å¿™å¯¼è‡´çš„åŠ é€Ÿæ‰§è¡Œçš„é—®é¢˜.</p><p>æ¯”å¦‚è¯´åŸè®¡åˆ’ </p><ol><li>500æ¯«ç§’æ‰§è¡Œä¸€æ¬¡</li></ol><p>ä½†æ˜¯æŸä¸€æ¬¡æ‰§è¡Œå¤ªä¹…, å¯¼è‡´é˜»å¡, æ‰§è¡Œäº†600æ¯«ç§’. ä¸‹ä¸€æ¬¡æ‰§è¡Œå®åœ¨1ç§’å¤„. å®é™…ä¸Šä¸¤æ¬¡æ‰§è¡Œçš„é—´éš”æ˜¯400æ¯«ç§’.</p><p>å¯ä»¥ä½¿ç”¨ <code>settimeout</code> è¿™ç§æ–¹å¼æ¥ä¿è¯æ¯æ¬¡æ‰§è¡Œéƒ½æ˜¯ 500æ¯«ç§’.</p><p>ä½†æ˜¯ä»–ä¹Ÿæ— æ³•è§£å†³æ•´ä¸ªæµè§ˆå™¨çš„è®¾ç½®é—®é¢˜, ä¹Ÿå°±æ˜¯5åˆ†é’Ÿå 1åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡çš„é—®é¢˜</p><h3 id="02-webworker"><a href="#02-webworker" class="headerlink" title="02. webworker"></a>02. webworker</h3><p>webworker èƒ½å¥æ•ˆçš„åŸå› æ˜¯å› ä¸ºä»–ä¸å—é™åˆ¶, ä¹Ÿå°±æ˜¯æµè§ˆå™¨æ²¡æœ‰ç»™ä»–é™åˆ¶. æ‰€ä»¥ç›´æ¥æŠŠ setimeout, setInterval å†™åœ¨ webworker ä¸­. ä»è€Œç»•è¿‡é™åˆ¶.</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers">ä½¿ç”¨ Web Workers - Web API æ¥å£å‚è€ƒ | MDN</a></p><p>è¿™ç§æ–¹å¼æ˜ç¡®æœ‰æ•ˆ. å¦‚æœä¸æƒ³è‡ªå·±å†™</p><p><a href="https://github.com/ctubio/HackTimer_fork">https://github.com/ctubio/HackTimer_fork</a></p><h3 id="03-æµè§ˆå™¨è®¾ç½®"><a href="#03-æµè§ˆå™¨è®¾ç½®" class="headerlink" title="03. æµè§ˆå™¨è®¾ç½®"></a>03. æµè§ˆå™¨è®¾ç½®</h3><p>æ¥æºäºä¸‹é¢è¿™ä¸ªé“¾æ¥</p><p><a href="https://www.zdnet.com/article/chrome-javascript-timer-throttling-googles-tests-show-it-saves-up-to-2-hours-battery-life/">Chrome JavaScript timer throttling: Googleâ€™s tests show it saves up to 2 hoursâ€™ battery life</a></p><p>ä½†æ˜¯æˆ‘æ²¡æœ‰æµ‹è¯• å› ä¸ºé€šè¿‡è¿™ç§æ–¹å¼ç»•è¿‡å»å®é™…æ“ä½œæ€§å¤ªå°äº†.</p><p>ä½ æ€»ä¸å¯èƒ½è®©æ‰€æœ‰å®¢æˆ·éƒ½è¿™æ ·æå§.</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯åŸ‹ç‚¹</title>
      <link href="/2024/02/23/%E5%89%8D%E7%AB%AF%E5%9F%8B%E7%82%B9/"/>
      <url>/2024/02/23/%E5%89%8D%E7%AB%AF%E5%9F%8B%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h2 id="1-é¦–å…ˆéœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯åŸ‹ç‚¹"><a href="#1-é¦–å…ˆéœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯åŸ‹ç‚¹" class="headerlink" title="1. é¦–å…ˆéœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯åŸ‹ç‚¹"></a>1. é¦–å…ˆéœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯åŸ‹ç‚¹</h2><blockquote><p>æ‰€è°“â€œåŸ‹ç‚¹â€ï¼Œæ˜¯æ•°æ®é‡‡é›†é¢†åŸŸï¼ˆå°¤å…¶æ˜¯ç”¨æˆ·è¡Œä¸ºæ•°æ®é‡‡é›†é¢†åŸŸï¼‰çš„æœ¯è¯­ï¼ŒæŒ‡çš„æ˜¯é’ˆå¯¹ç‰¹å®šç”¨æˆ·è¡Œä¸ºæˆ–äº‹ä»¶è¿›è¡Œæ•è·ã€å¤„ç†å’Œå‘é€çš„ç›¸å…³æŠ€æœ¯åŠå…¶å®æ–½è¿‡ç¨‹ã€‚æ¯”å¦‚ç”¨æˆ·æŸä¸ªiconç‚¹å‡»æ¬¡æ•°ã€è§‚çœ‹æŸä¸ªè§†é¢‘çš„æ—¶é•¿ç­‰ç­‰ã€‚</p><p>åŸ‹ç‚¹çš„æŠ€æœ¯å®è´¨ï¼Œæ˜¯å…ˆç›‘å¬è½¯ä»¶åº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­çš„äº‹ä»¶ï¼Œå½“éœ€è¦å…³æ³¨çš„äº‹ä»¶å‘ç”Ÿæ—¶è¿›è¡Œåˆ¤æ–­å’Œæ•è·ã€‚</p></blockquote><p>ç½‘ç«™åˆ†æã€ç”¨æˆ·è¡Œä¸ºåˆ†æã€äº§å“æ•°æ®åˆ†æç­‰é¢†åŸŸï¼Œä»¥å¸®åŠ©ä¼ä¸šäº†è§£ç”¨æˆ·è¡Œä¸ºä¹ æƒ¯ã€ä¼˜åŒ–äº§å“è®¾è®¡ã€æ”¹è¿›ç”¨æˆ·ä½“éªŒï¼Œä»è€Œæå‡äº§å“çš„ç”¨æˆ·æ»¡æ„åº¦å’Œå¸‚åœºç«äº‰åŠ›</p><p>å…¶å®å¼‚å¸¸æ•è·ä¹Ÿç®—æ˜¯ä¸€ç§åŸ‹ç‚¹.</p><p>æ‰€ä»¥å¯¹äºå‰ç«¯æ¥è¯´, APP, å°ç¨‹åº, ç½‘é¡µå¯èƒ½éƒ½éœ€è¦åŸ‹ç‚¹. å¦‚æœä½ ä½¿ç”¨çš„æ˜¯å„ç§æ¡†æ¶å°±åˆéœ€è¦æ³¨æ„æ¡†æ¶é‡Œåº”è¯¥æ€ä¹ˆåŸ‹ç‚¹</p><h2 id="2-æœ€ä¼ ç»Ÿçš„æ–¹å¼-ä¹Ÿå°±æ˜¯æ‰‹åŠ¨å»åŸ‹"><a href="#2-æœ€ä¼ ç»Ÿçš„æ–¹å¼-ä¹Ÿå°±æ˜¯æ‰‹åŠ¨å»åŸ‹" class="headerlink" title="2. æœ€ä¼ ç»Ÿçš„æ–¹å¼, ä¹Ÿå°±æ˜¯æ‰‹åŠ¨å»åŸ‹."></a>2. <strong>æœ€ä¼ ç»Ÿçš„æ–¹å¼, ä¹Ÿå°±æ˜¯æ‰‹åŠ¨å»åŸ‹.</strong></h2><p>è¿›å…¥é¡µé¢, ä½ æ ¹æ®é¡µé¢ç”Ÿå‘½å‘¨æœŸ, å»ç®—, ç‚¹å‡»äº†å“ªäº›, å»å¸ƒç½®äº‹ä»¶, ä¹Ÿå¯ä»¥æ‹¿<code>performance</code>æ•°æ®</p><p>å­˜åœ¨å¯¹è±¡é‡Œ, å­˜åœ¨localstorage, indexdbé‡Œ</p><p>ç„¶ååœ¨ç‰¹å®šæ—¶é—´æˆ–è€…äº‹ä»¶ç‚¹, ä¸Šä¼ æœåŠ¡å™¨.</p><p>è§‰å¾—å¤ªéº»çƒ¦å°±ç”¨åˆ«çš„ç»Ÿè®¡, æ¯”å¦‚å½“å¹´æˆ‘ç”¨è¿‡çš„ç™¾åº¦</p><p><a href="https://tongji.baidu.com/web5/welcome/login">ç™¾åº¦ç»Ÿè®¡â€”â€”ä¸€ç«™å¼æ™ºèƒ½æ•°æ®åˆ†æä¸åº”ç”¨å¹³å°</a></p><p>å¼•å…¥å³å¯è·å¾—é¡µé¢ä¸Šçš„æ´»åŠ¨.</p><h2 id="3-å¯è§†åŒ–åŸ‹ç‚¹"><a href="#3-å¯è§†åŒ–åŸ‹ç‚¹" class="headerlink" title="3. å¯è§†åŒ–åŸ‹ç‚¹"></a>3. å¯è§†åŒ–åŸ‹ç‚¹</h2><p>ä¼ ç»Ÿæ‰‹åŠ¨åŸ‹ç‚¹çš„é—®é¢˜åœ¨äºéº»çƒ¦, å°±æ˜¯æ²Ÿé€šéº»çƒ¦, ç¨‹åºå‘˜ä½ å¼€å‘ä¹Ÿéº»çƒ¦. æ‰€ä»¥æœ‰å¯è§†åŒ–åŸ‹ç‚¹è¿™ä¸ªåŠŸèƒ½.</p><p>å¾ˆç¾å¥½, å°±æ˜¯äº§å“ç”¨å¯è§†åŒ–çš„æ–¹å¼, ç‚¹å‡»è½¯ä»¶, ç½‘é¡µ, ç„¶åé€‰æ‹©è¦æ€ä¹ˆåŸ‹ç‚¹. ç„¶åå°±ä¸éœ€è¦ç¨‹åºå‘˜å†™ä»£ç äº†</p><p><a href="https://manual.sensorsdata.cn/sa/1.17/zh_cn/app-7541658.html">App å¯è§†åŒ–å…¨åŸ‹ç‚¹ä½¿ç”¨æŒ‡å—</a></p><p><a href="https://juejin.cn/post/6844903878371049480">å¯è§†åŒ–åŸ‹ç‚¹æŠ€æœ¯æ­ç§˜ - æ˜é‡‘</a></p><p>å¥½å¤„, çµæ´», ä¸ç”¨å¼€å‘äººå‘˜å°±å¯ä»¥æ. </p><p>åå¤„</p><ol><li>å¤§æ¦‚ç‡è¦æ¥å…¥ç¬¬ä¸‰æ–¹api, å¯èƒ½æ”¶è´¹</li><li>æ€§èƒ½ä¸æ˜</li><li>ç‰¹æ®Šåœºæ™¯æ— æ³•å¤„ç†</li><li>å…¼å®¹æ€§ä¸æ˜</li><li>ç‰¹æ®Šå¹³å°å¯èƒ½ä¸å¯ç”¨, æ¯”å¦‚è¯´ä½ ä½¿ç”¨uniappè¿™ç§æ–¹æ¡ˆ, ä½ æ€ä¹ˆæ¥å…¥ç¬¬ä¸‰æ–¹åŸ‹ç‚¹å‘¢? å¯èƒ½è¿˜æ˜¯åªèƒ½æ¥å…¥é¡µé¢åŸ‹ç‚¹, å…³æ³¨ä¸€ä¸‹æ•´ä½“æ€§èƒ½, ä½†æ˜¯æ— æ³•å®ç°å¯è§†åŒ–åŸ‹ç‚¹.</li></ol><p>æœ€å¤§çš„é—®é¢˜åœ¨äº, å¾ˆå¤šé¡¹ç›®æ—©æœŸæ˜¯ä¸éœ€è¦åŸ‹ç‚¹çš„, åˆ°è¾¾ä¸€å®šè§„æ¨¡æ‰å¼€å§‹åšè¿™ä»¶äº‹, è¿™ä¸ªæ—¶å€™ä»£ä»·å°±æ¯”è¾ƒå¤§äº†</p><p>å¦‚æœåªæ˜¯ç®€å•çš„ä½¿ç”¨åŸ‹ç‚¹åŠŸèƒ½, æˆ‘è§‰å¾—ok. çœçš„å¼€å‘äº†</p><p>å¤§æ–¹å‘ä¸Šä¸»è¦æ˜¯è¿™ä¸¤ä¸ªåˆ†ç±», æ— éå°±æ˜¯è‡ªå·±å¼€å‘æˆ–è€…å¼•å…¥å¦ä¸€å¥—ç³»ç»Ÿ</p><h2 id="4-åº”è¯¥æ€ä¹ˆåŸ‹ç‚¹-åŸ‹ç‚¹çš„å…·ä½“æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ"><a href="#4-åº”è¯¥æ€ä¹ˆåŸ‹ç‚¹-åŸ‹ç‚¹çš„å…·ä½“æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ" class="headerlink" title="4. åº”è¯¥æ€ä¹ˆåŸ‹ç‚¹? åŸ‹ç‚¹çš„å…·ä½“æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ?"></a>4. åº”è¯¥æ€ä¹ˆåŸ‹ç‚¹? åŸ‹ç‚¹çš„å…·ä½“æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ?</h2><p>å‰é¢æ˜¯å¤§æ–¹å‘, é‚£ä¹ˆå½“ä¸šåŠ¡æ¥äº†, ç©¶ç«Ÿéœ€è¦æ€ä¹ˆå»åŸ‹ç‚¹?</p><p><a href="https://juejin.cn/post/6978131459655598094">VueåŸ‹ç‚¹åˆæ¢ | å‰ç«¯åŸ‹ç‚¹ | PVåŸ‹ç‚¹| äº¤äº’åŸ‹ç‚¹ - æ˜é‡‘</a></p><p>åœ¨ä¸Šé¢è¿™ç¯‡æ–‡ç« ä¸­æå‡ºäº†å‡ ä¸ªæ–¹æ¡ˆ</p><ul><li><strong>å‘½ä»¤å¼åŸ‹ç‚¹</strong>æ˜¯ç”¨æ¯”è¾ƒå¸¸è§çš„æ–¹å¼ï¼Œåœ¨ç”¨æˆ·äº§ç”Ÿè¡Œä¸ºçš„åœ°æ–¹ä½¿ç”¨jsæ–¹æ³•è¿›è¡Œæ•°æ®ä¸ŠæŠ¥ï¼Œä¼˜ç‚¹æ˜¯åŸ‹ç‚¹æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œç¼ºç‚¹æ˜¯ä¸ä¸šåŠ¡è€¦åˆåº¦è¾ƒé«˜</li><li><strong>å£°æ˜å¼åŸ‹ç‚¹</strong>æ˜¯åœ¨å…·ä½“DOMå…ƒç´ ä¸Šè¿›è¡Œæ•°æ®ç»‘å®šï¼Œåªéœ€ç»„ä»¶å¼€å‘äººå‘˜åœ¨sdkä¸Šåˆ¶å®šåŸ‹ç‚¹æ–¹æ¡ˆï¼Œä¸šåŠ¡å¼€å‘äººå‘˜è®¾ç½®æ•°æ®å³å¯ï¼Œä¼˜ç‚¹æ˜¯åŸ‹ç‚¹ä»£ç ä¸å…·ä½“çš„äº¤äº’å’Œä¸šåŠ¡é€»è¾‘è§£è€¦</li><li><strong>å¯è§†åŒ–åŸ‹ç‚¹</strong>æ˜¯é€šè¿‡å¯è§†åŒ–å·¥å…·é…ç½®åŸ‹ç‚¹ï¼Œéœ€è¦å¦å¤–é…å¥—ä¸€ä¸ªå¹³å°æ§åˆ¶åŸ‹ç‚¹çš„åŸ‹å…¥ï¼Œä¼˜ç‚¹æ˜¯è‡ªåŠ¨ç”ŸæˆåŸ‹ç‚¹ä»£ç åµŒå…¥åˆ°é¡µé¢ä¸­ï¼Œå‡è½»ä¸šåŠ¡å¼€å‘äººå‘˜çš„åŸ‹ç‚¹è´Ÿæ‹…ï¼Œç›®å‰åšå¾—å¥½å¾—ä¾‹å¦‚<a href="https://link.juejin.cn/?target=https://github.com/mixpanel">Mixpanel</a></li><li><strong>æ— åŸ‹ç‚¹</strong>æ˜¯å‰ç«¯è‡ªåŠ¨é‡‡é›†å…¨éƒ¨äº‹ä»¶ï¼Œä¸ŠæŠ¥åŸ‹ç‚¹æ•°æ®ï¼Œç”±åç«¯æ¥è¿‡æ»¤å’Œè®¡ç®—å‡ºæœ‰ç”¨çš„æ•°æ®ï¼Œä¼˜ç‚¹æ˜¯å®Œå…¨æ— éœ€ä¸šåŠ¡å‚ä¸ï¼Œå®Œå…¨ä¸ä¸šåŠ¡è§£è€¦ï¼Œç›®å‰æ¯”è¾ƒæµè¡Œçš„ä¾‹å¦‚<a href="https://link.juejin.cn/?target=https://www.growingio.com/">GrowingIO</a></li></ul><p>è¿™ä¸ªä¸œè¥¿åœ¨è¯æ±‡ä¸Šå¾ˆæ··ä¹±</p><p><a href="https://zhuanlan.zhihu.com/p/79439716">å¸¦ä½ äº†è§£åŸ‹ç‚¹ã€æ— åŸ‹ç‚¹ã€å…¨åŸ‹ç‚¹</a></p><p><a href="https://mtj.baidu.com/static/userguide/book/chapter5/what.html">ä»€ä¹ˆæ˜¯æ— åŸ‹ç‚¹æŠ€æœ¯ Â· ç™¾åº¦ç§»åŠ¨ç»Ÿè®¡å¸®åŠ©æ–‡æ¡£</a></p><p>æ— åŸ‹ç‚¹å’Œå¯è§†åŒ–åŸ‹ç‚¹æœ‰ç‚¹å†²çª.</p><p>æ€»ä¹‹å¯ä»¥ç†è§£ä¸ºä»–ç»™å‡ºäº†4ç§æ–¹æ¡ˆ</p><ol><li>è‡ªå·±çº¯æ‰‹å†™</li><li>è‡ªå·±å†™åº“(ä½ å«sdkä¹Ÿå¯ä»¥), ç„¶ååˆçº§ç¨‹åºå‘˜è°ƒç”¨åº“åŸ‹ç‚¹, æœ¬è´¨ä¸Šå’Œç¬¬ä¸€ç§æ²¡åŒºåˆ«, åªæ˜¯å¢åŠ äº†åˆ†å·¥</li><li>å¯è§†åŒ–é…ç½®åŸ‹ç‚¹</li><li>å…¨éƒ¨æ”¶é›†</li></ol><p>å¯è§†åŒ–åŸ‹ç‚¹æˆ‘åˆšæ‰è¯´äº†, ä¼˜ç¼ºç‚¹.</p><p>å…¨éƒ¨æ”¶é›†, ä¹Ÿå°±æ˜¯ç”¨æˆ·æ‰€æœ‰åŠ¨ä½œéƒ½æ•æ‰, é¡µé¢æ»‘åŠ¨, æ»šåŠ¨æ¡æ»šåŠ¨, ç‚¹å‡», åŒå‡»â€¦â€¦.</p><p>è¿™ç§æ”¶é›†ç®€å•ç²—æš´, ä½†æ˜¯æ•°æ®å¯èƒ½æ²¡æœ‰é’ˆå¯¹æ€§. å› ä¸ºæ•°æ®å¤š, å‹åŠ›å¯èƒ½ç¨å¾®å¤§ä¸€ç‚¹.</p><h2 id="05-è‡ªå·±å®ç°çš„å…·ä½“æ–¹æ¡ˆ"><a href="#05-è‡ªå·±å®ç°çš„å…·ä½“æ–¹æ¡ˆ" class="headerlink" title="05. è‡ªå·±å®ç°çš„å…·ä½“æ–¹æ¡ˆ"></a>05. è‡ªå·±å®ç°çš„å…·ä½“æ–¹æ¡ˆ</h2><p>å¾ˆå¤šæ—¶å€™è¿˜æ˜¯è¦è‡ªå·±å†™, å»ä¹°åˆ«äººçš„.</p><p>è¿™ç§æƒ…å†µä¸‹æ€ä¹ˆå¿«é€Ÿçš„é«˜æ•ˆçš„åŸ‹ç‚¹?</p><p><strong>é¡µé¢pv,</strong> è¿™ä¸ªä¸»è¦æ˜¯å—æ”¶é›†é¡µé¢åŠ è½½æ—¶é—´, æ€§èƒ½, æŠ¥é”™, ç”¨æˆ·åœç•™æ—¶é—´ç­‰ç­‰</p><p>è¿™ä¸ªå°±çœ‹æ¡†æ¶ç”Ÿå‘½å‘¨æœŸäº†, å¦‚æœæ˜¯åŸç”Ÿçš„domä¹Ÿæœ‰ç”Ÿå‘½å‘¨æœŸ.</p><p>æ“ä½œçš„è®°å½•</p><p>vue ç”¨è‡ªå®šä¹‰æŒ‡ä»¤è§£å†³é—®é¢˜</p><p><a href="https://cn.vuejs.org/guide/reusability/custom-directives">Vue.js</a></p><p>ä¹Ÿå°±æ˜¯æ‰€è°“çš„å£°æ˜å¼</p><p>react æˆ‘ä¸æ˜¯å¾ˆäº†è§£. ä½†æ˜¯é«˜é˜¶ç»„ä»¶(ä¹Ÿå°±æ˜¯é—­åŒ…) æˆ‘è§‰å¾—å¯ä»¥è§£å†³.</p><p>ag å°±å®Œå…¨ä¸ç†Ÿæ‚‰äº†.</p><p>å‰©ä¸‹çš„â€ç—›ç‚¹â€ å°±åœ¨äºå¦‚æœè®©äº§å“å¿«é€Ÿè‡ªå®šä¹‰, å½¢æˆä¸€ä¸ªæ–‡æ¡£å¾ˆéº»çƒ¦. è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå¾ˆå¤šæ—¶å€™ å¯è§†åŒ–åŸ‹ç‚¹æ–¹ä¾¿çš„ç‚¹.</p><p><a href="https://hughfenghen.github.io/posts/2018/05/01/vue-directive-track/">åŸºäºvue directiveå®ç°å£°æ˜å¼åŸ‹ç‚¹æ–¹æ¡ˆ | é£ç—• Â· è¡“&amp;æ€</a></p><p>è¿™ç¯‡æ–‡ç« çš„åšæ³•æ˜¯, å†™chromeæ’ä»¶, userscipt. </p><p>å¯ä»¥è§£å†³éƒ¨åˆ†é—®é¢˜</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> åŸ‹ç‚¹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rssæ•°æ®å¯¹æ¯”</title>
      <link href="/2024/02/23/rss%E6%95%B0%E6%8D%AE%E5%AF%B9%E6%AF%94/"/>
      <url>/2024/02/23/rss%E6%95%B0%E6%8D%AE%E5%AF%B9%E6%AF%94/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>åšäº‹å„¿çš„ç›®çš„åœ¨äºæˆ‘éœ€è¦å¯¹æ¯”ä¸¤ä¸ª <code>xml</code>, ä¹Ÿå°±æ˜¯ <code>rss</code> ä¹‹é—´çš„å·®å¼‚</p><p>æœ€å¼€å§‹æ˜¯è‡ªå·±åšå¯¹æ¯”, ä½†æ˜¯è¿˜æ˜¯è§‰å¾—å¤ªéº»çƒ¦.</p><p><code>xml</code> å¯¹æ¯”åœ¨ <code>npmjs</code> ä¸Šæ²¡æœ‰æ‰¾åˆ°ç‰¹åˆ«å¥½çš„å·¥å…·, äºæ˜¯èµ°äº†æ­ªè·¯, <strong>xml â‡’ json â‡’ diff</strong></p><p>é€šè¿‡ <code>rss-parser</code> è·å– <code>rss</code> æ•°æ®æº, ç„¶åå›ç›´æ¥è½¬ä¸º <code>json</code> æ•°æ®, ä¹Ÿå°±æ˜¯ <code>object</code></p><p><a href="https://www.npmjs.com/package/rss-parser">npm: rss-parser</a></p><p>ç„¶åå°±å¯ä»¥å¯¹æ¯”ä¸¤ä¸ª <code>json</code></p><p><a href="https://github.com/andreyvit/json-diff">https://github.com/andreyvit/json-diff</a></p><p>json-diffå·¥å…·åœ¨æ¯”è¾ƒä¸¤ä¸ªJSONæ–‡ä»¶æˆ–å¯¹è±¡åï¼Œä¼šç”Ÿæˆä¸€ä¸ªå·®å¼‚æŠ¥å‘Šã€‚è¿™ä¸ªæŠ¥å‘Šå°†è¯¦ç»†åˆ—å‡ºä¸¤è€…ä¹‹é—´çš„å·®å¼‚ï¼ŒåŒ…æ‹¬æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„å†…å®¹ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥æ¸…æ¥šåœ°äº†è§£æ•°æ®çš„å˜åŒ–æƒ…å†µã€‚</p><p><code>json-diff</code> æœ€å¥½çš„åœ°æ–¹åœ¨äºä»–å¯ä»¥æ˜ç¡®å‘Šè¯‰ä½ æ·»åŠ åˆ é™¤ä¿®æ”¹</p><p>æ¯”å¦‚ <strong>[1,2,3,4,5,6]</strong> å¯¹æ¯” <strong>[2,3,4,5,6,7]</strong></p><p>ä¸€èˆ¬çš„å¯¹æ¯”å·¥å…·ä¼šå‘Šè¯‰ä½  <code>1 â‰  2</code> è¿™é‡Œæœ‰å˜åŒ–, å…¶å®æ˜¯åˆ é™¤äº†1, æ–°å¢äº†7.</p><p>æˆ‘æ²¡æœ‰çœ‹ä»–å¯¹æ¯”çš„ç®—æ³•, å¤§æ¦‚ç‡ä¼šå¤æ‚å¾ˆå¤š</p><p>æœ‰äº†è¿™ä¸¤ä¸ªå·¥å…·çš„å¸®åŠ©, è¿™ä»¶äº‹å„¿å°±ç®€å•å¤šäº†</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> rss </tag>
            
            <tag> diff </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nestjs modules mailer</title>
      <link href="/2024/02/23/nestjs-modules-mailer/"/>
      <url>/2024/02/23/nestjs-modules-mailer/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h2 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h2><p><a href="https://nest-modules.github.io/mailer/docs/mailer.html">How to use? Â· NestJS - Mailer (nest-modules.github.io)</a></p><p><a href="https://github.com/yanarp/nestjs-mailer?tab=readme-ov-file">yanarp&#x2F;nestjs-mailerï¼šä¸€ä¸ªç®€å•çš„å®ç°ç¤ºä¾‹ï¼Œä½¿ç”¨åŸºäºnodemaileræ„å»ºçš„nest jsçš„maileræ¨¡å—ï¼ŒğŸŒˆä½¿ç”¨é‚®ä»¶æ¨¡æ¿ã€‚ (github.com)</a></p><p><a href="https://github.com/leemunroe/responsive-html-email-template">https://github.com/leemunroe/responsive-html-email-template</a></p><h2 id="ç›®æ ‡å’ŒåŸºæœ¬ä½¿ç”¨"><a href="#ç›®æ ‡å’ŒåŸºæœ¬ä½¿ç”¨" class="headerlink" title="ç›®æ ‡å’ŒåŸºæœ¬ä½¿ç”¨"></a>ç›®æ ‡å’ŒåŸºæœ¬ä½¿ç”¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save @nestjs-modules/mailer nodemailer</span><br><span class="line">npm install --save-dev @types/nodemailer</span><br></pre></td></tr></table></figure><p>åœ¨ module ä¸­å¼•å…¥</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">MailerModule</span>.<span class="title function_">forRootAsync</span>(&#123;</span><br><span class="line">      <span class="attr">imports</span>: [<span class="title class_">ConfigModule</span>],</span><br><span class="line">      <span class="attr">useFactory</span>: <span class="keyword">async</span> (<span class="attr">configService</span>: <span class="title class_">ConfigService</span>) =&gt; (&#123;</span><br><span class="line">        <span class="attr">transport</span>: &#123;</span><br><span class="line">          <span class="attr">service</span>: configService.<span class="title function_">get</span>(<span class="string">&#x27;MAIL_SERVICE&#x27;</span>),</span><br><span class="line">          <span class="attr">auth</span>: &#123;</span><br><span class="line">            <span class="attr">user</span>: configService.<span class="title function_">get</span>(<span class="string">&#x27;MAIL_USERNAME&#x27;</span>),</span><br><span class="line">            <span class="attr">pass</span>: configService.<span class="title function_">get</span>(<span class="string">&#x27;MAIL_PASSWORD&#x27;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">defaults</span>: &#123;</span><br><span class="line">          <span class="attr">from</span>: configService.<span class="title function_">get</span>(<span class="string">&#x27;MAIL_FROM&#x27;</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="attr">inject</span>: [<span class="title class_">ConfigService</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br></pre></td></tr></table></figure><p>æˆ‘çš„ç›®çš„æ˜¯ä½¿ç”¨QQé‚®ç®±å‘é€é‚®ä»¶, è¿™æ ·é…ç½®å°±okäº†. æ¥ä¸‹æ¥å°±å¯ä»¥è°ƒç”¨</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">sendMail</span>(<span class="attr">to</span>: <span class="built_in">string</span>, <span class="attr">subject</span>: <span class="built_in">string</span>, <span class="attr">template</span>: <span class="built_in">string</span>, <span class="attr">html</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">mailerService</span>.<span class="title function_">sendMail</span>(&#123;</span><br><span class="line">            to,</span><br><span class="line">            <span class="attr">from</span>: <span class="variable language_">this</span>.<span class="property">configService</span>.<span class="title function_">get</span>(<span class="string">&#x27;MAIL_FROM&#x27;</span>),</span><br><span class="line">            subject,</span><br><span class="line">            html,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="æ¨¡ç‰ˆçš„ä½¿ç”¨"><a href="#æ¨¡ç‰ˆçš„ä½¿ç”¨" class="headerlink" title="æ¨¡ç‰ˆçš„ä½¿ç”¨"></a>æ¨¡ç‰ˆçš„ä½¿ç”¨</h2><p>é¦–å…ˆä½ å¯ä»¥ä¸ä½¿ç”¨æ¨¡ç‰ˆ, å°±ç”¨html, æ¨¡ç‰ˆä¹Ÿæ˜¯ç¼–è¯‘æˆhtml, åªèƒ½è¯´æ¨¡ç‰ˆåœ¨å¤šä¸ªæ¨¡ç‰ˆæƒ…å†µä¸‹, ä½ å¥½åšä¸€ç‚¹.</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">sendMail</span>(<span class="attr">to</span>: <span class="built_in">string</span>, <span class="attr">subject</span>: <span class="built_in">string</span>, <span class="attr">template</span>: <span class="built_in">string</span> = <span class="string">&quot;diff&quot;</span>, <span class="attr">context</span>: <span class="built_in">any</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;      </span><br><span class="line">    <span class="keyword">let</span> html = templates[template];</span><br><span class="line">    <span class="keyword">if</span>(context) &#123;</span><br><span class="line">        <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(context);</span><br><span class="line">        keys.<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">            html = html.<span class="title function_">replace</span>(<span class="string">`&#123;&#123;<span class="subst">$&#123;key&#125;</span>&#125;&#125;`</span>, context[key]);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">mailerService</span>.<span class="title function_">sendMail</span>(&#123;</span><br><span class="line">        to,</span><br><span class="line">        <span class="attr">from</span>: <span class="variable language_">this</span>.<span class="property">configService</span>.<span class="title function_">get</span>(<span class="string">&#x27;MAIL_FROM&#x27;</span>),</span><br><span class="line">        subject,            </span><br><span class="line">        html</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦ä½¿ç”¨æ¨¡ç‰ˆåŠŸèƒ½</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">template</span>: &#123;</span><br><span class="line">  <span class="attr">dir</span>: __dirname + <span class="string">&#x27;/mail.template&#x27;</span>,</span><br><span class="line">  <span class="attr">adapter</span>: <span class="keyword">new</span> <span class="title class_">EjsAdapter</span>(), </span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="attr">strict</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å°±è¿™æ ·, é€‰æ‹©ä½ éœ€è¦çš„æ¨¡ç‰ˆå¼•æ“, æˆ‘è¿™é‡Œç”¨ <code>ejs</code>, å› ä¸ºæˆ‘ç†Ÿæ‚‰. <code>context</code> ä¼ å€¼å°±<strong>ok</strong>äº†</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> typescript </tag>
            
            <tag> åç«¯ </tag>
            
            <tag> nestjs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨ç¼“å­˜å¤§èµ.</title>
      <link href="/2023/12/14/browser/cache/"/>
      <url>/2023/12/14/browser/cache/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-å¼ºåˆ¶ç¼“å­˜"><a href="#01-å¼ºåˆ¶ç¼“å­˜" class="headerlink" title="01. å¼ºåˆ¶ç¼“å­˜"></a>01. å¼ºåˆ¶ç¼“å­˜</h3><p><a href="https://blog.csdn.net/weixin_44765930/article/details/129819711">https://blog.csdn.net/weixin_44765930/article/details/129819711</a></p><p>è¿™ç¯‡æ–‡ç« è¯¦ç»†è§£é‡Šäº†ä»€ä¹ˆæ˜¯å¼ºåˆ¶ç¼“å­˜.</p><blockquote><p>Cache-Control</p><p>Cache-Controlæ˜¯HTTP&#x2F;1.1ä¸­å®šä¹‰çš„ç¼“å­˜æ§åˆ¶å­—æ®µï¼Œå¸¸è§çš„å–å€¼å¦‚ä¸‹ï¼š<br>publicï¼šå“åº”å¯ä»¥è¢«ä»»æ„ç¼“å­˜ï¼ˆåŒ…æ‹¬å®¢æˆ·ç«¯å’Œä»£ç†æœåŠ¡å™¨ï¼‰ç¼“å­˜ã€‚<br>privateï¼šå“åº”åªèƒ½è¢«å®¢æˆ·ç«¯ç¼“å­˜ï¼Œä¸èƒ½è¢«ä»£ç†æœåŠ¡å™¨ç¼“å­˜ã€‚<br>max-ageï¼šæŒ‡å®šç¼“å­˜çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚<br>no-cacheï¼šè¡¨ç¤ºéœ€è¦åå•†ç¼“å­˜ï¼Œæµè§ˆå™¨æ¯æ¬¡éƒ½éœ€è¦å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç¡®è®¤èµ„æºæ˜¯å¦æœ‰æ›´æ–°ã€‚<br>no-storeï¼šç¦æ­¢ç¼“å­˜ï¼Œæ¯æ¬¡éƒ½éœ€è¦å‘æœåŠ¡å™¨å‘é€è¯·æ±‚è·å–æœ€æ–°èµ„æºã€‚</p><p>Expires</p><p>Expiresæ˜¯HTTP&#x2F;1.0ä¸­å®šä¹‰çš„ç¼“å­˜æ§åˆ¶å­—æ®µï¼Œå®ƒè¡¨ç¤ºèµ„æºçš„è¿‡æœŸæ—¶é—´ï¼Œæ˜¯ä¸€ä¸ªGMTæ ¼å¼çš„æ—¥æœŸå­—ç¬¦ä¸²ã€‚å½“æµè§ˆå™¨å‘é€è¯·æ±‚æ—¶ï¼Œä¼šæ¯”è¾ƒå½“å‰æ—¶é—´å’ŒExpireså­—æ®µçš„å€¼ï¼Œå¦‚æœå½“å‰æ—¶é—´åœ¨è¿‡æœŸæ—¶é—´ä¹‹å‰ï¼Œå°±ç›´æ¥ä»ç¼“å­˜ä¸­è·å–èµ„æºã€‚</p></blockquote><p>è¿™é‡Œè¯´ä¸€ä¸‹ä»–æ²¡è¯´åˆ°çš„ç‚¹.</p><p>max-age è®¾ç½®ä¸º0, ä¹Ÿè¡¨ç¤ºä¸ç¼“å­˜.</p><p>å¼ºåˆ¶ç¼“å­˜ä¼˜å…ˆçº§ &gt; åå•†ç¼“å­˜, ä½†æ˜¯å¼ºåˆ¶ç¼“å­˜å†…éƒ¨ä¹Ÿæ˜¯æœ‰ä¼˜å…ˆçº§çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cache-Control: max-age=3600</span><br><span class="line">Expires: Wed, 14 Dec 2023 12:00:00 GMT</span><br></pre></td></tr></table></figure><p><code>Cache-Control</code> ä¸­çš„ max-age æŒ‡ä»¤å°†ä¼˜å…ˆäº <code>Expires</code></p><p>åœ¨å‘ä¸‹å…¼å®¹çš„è¿™ç§è€ƒè™‘ä¸‹, æ˜¯éœ€è¦ä½¿ç”¨ <code>Expires</code> çš„.</p><h3 id="02-ç ´åç¼“å­˜"><a href="#02-ç ´åç¼“å­˜" class="headerlink" title="02. ç ´åç¼“å­˜"></a>02. ç ´åç¼“å­˜</h3><p>å½“è®¾ç½®äº†å¼ºåˆ¶ç¼“å­˜, ä½†æ˜¯æ–‡ä»¶æ›´æ–°äº†, æ€ä¹ˆåŠ?</p><p>æœ¬åœ°æµ‹è¯•, <strong>ctrl + f5</strong> æˆ–è€…ç›´æ¥æ¸…ç†æµè§ˆå™¨ç¼“å­˜, <strong>f12</strong> å¼ºåˆ¶ä¸ç”¨ç¼“å­˜</p><p>å¼€å‘ç«¯, è€åŠæ³•æ˜¯ç”¨ç‰ˆæœ¬å·</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/path/to/your/resource/style.css?version=123456&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å˜åŒ–å°±ä¼šå¼ºåˆ¶æ›´æ–°, ç°ä»£çš„æ¡†æ¶, vue, react, ag æ¯æ¬¡æ›´æ–°å…¶å®éƒ½æ˜¯ä¼šé‡æ–°æ‰“åŒ…, éƒ½æœ‰å®Œå…¨ä¸åŒçš„hash, è‡ªç„¶ä¹Ÿå°±ä¸å­˜åœ¨ç¼“å­˜é—®é¢˜äº†.</p><h3 id="03-åå•†ç¼“å­˜"><a href="#03-åå•†ç¼“å­˜" class="headerlink" title="03. åå•†ç¼“å­˜"></a>03. åå•†ç¼“å­˜</h3><p>åå•†ç¼“å­˜çš„å¥½å¤„åœ¨äºå¯ä»¥å®æ—¶è·å–æœ€æ–°çš„èµ„æº, é™ä½äº†æœåŠ¡å™¨å‹åŠ›(æ²¡æœ‰å¼ºåˆ¶ç¼“å­˜å¤š), åˆæ²¡æœ‰ç¼“å­˜çš„å‹åŠ›.</p><blockquote><p>Last-Modified: æœåŠ¡å™¨é€šè¿‡ Last-Modified å¤´éƒ¨è¿”å›èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ã€‚æµè§ˆå™¨åœ¨åç»­è¯·æ±‚ä¸­å¯ä»¥ä½¿ç”¨ If-Modified-Since å¤´éƒ¨å°†ä¸Šä¸€æ¬¡æ”¶åˆ°çš„æœ€åä¿®æ”¹æ—¶é—´å‘é€ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªæ—¶é—´åˆ¤æ–­èµ„æºæ˜¯å¦æœ‰æ›´æ–°ã€‚</p><p>ETag æ˜¯æœåŠ¡å™¨ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºè¡¨ç¤ºèµ„æºçš„ç‰ˆæœ¬ã€‚æµè§ˆå™¨åœ¨åç»­è¯·æ±‚ä¸­å¯ä»¥ä½¿ç”¨ If-None-Match å¤´éƒ¨å°†ä¸Šä¸€æ¬¡æ”¶åˆ°çš„ ETag å‘é€ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªæ ‡è¯†åˆ¤æ–­èµ„æºæ˜¯å¦æœ‰æ›´æ–°ã€‚</p></blockquote><p>æ¢å¥è¯è¯´, å¦‚æœæœåŠ¡å™¨èµ„æºæ²¡æœ‰å˜åŒ–, å°±å‘ä¸€æ¬¡è¯·æ±‚, ä½†æ˜¯è¿™æ¬¡è¯·æ±‚åªæ˜¯åšä¸€ä¸ªå¯¹æ¯”, å‡å°‘äº†è¯·æ±‚çš„å‹åŠ›.</p><p>å¦‚æœæœåŠ¡å™¨èµ„æºæœ‰å˜åŒ–, å°±å‘ä¸¤æ¬¡è¯·æ±‚, ç¬¬ä¸€æ¬¡è¯·æ±‚è¿”å›304, ç¬¬äºŒæ¬¡è¯·æ±‚è¿”å›æœ€æ–°èµ„æº.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cache-Control: no-cache</span><br><span class="line">Last-Modified: Wed, 14 Dec 2023 12:00:00 GMT</span><br></pre></td></tr></table></figure><p>æ ¹æ® Last-Modified æˆ–è€… ETag å’ŒæœåŠ¡å™¨åšå¯¹æ¯”</p><h3 id="04-æˆ‘ä»¬åº”è¯¥æ€ä¹ˆè®¾ç½®ç¼“å­˜"><a href="#04-æˆ‘ä»¬åº”è¯¥æ€ä¹ˆè®¾ç½®ç¼“å­˜" class="headerlink" title="04. æˆ‘ä»¬åº”è¯¥æ€ä¹ˆè®¾ç½®ç¼“å­˜."></a>04. æˆ‘ä»¬åº”è¯¥æ€ä¹ˆè®¾ç½®ç¼“å­˜.</h3><p>è¿™é‡Œå°±è¦åŒºåˆ† API è¿˜æ˜¯é™æ€èµ„æº.</p><p>API ä¸€èˆ¬æ˜¯ä¸ç¼“å­˜çš„, å› ä¸ºå®ƒæ˜¯æœ‰çŠ¶æ€çš„, æ‰€ä»¥æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦é‡æ–°è·å–æ•°æ®.</p><p>é™æ€èµ„æºç¼“å­˜, ç°åœ¨ä¹Ÿå’Œåç«¯æ— å…³, å› ä¸ºå‰ç«¯æ˜¯ä¸€ä¸ªç‹¬ç«‹é¡¹ç›®.</p><p>åªæœ‰æŸäº›ç‰¹æ®Šçš„èµ„æº, æ¯”å¦‚ CDN, ä¸€äº›ç‰¹æ®Šçš„å›ºå®š css, js è¿™äº›èµ„æºæ˜¯ç”±åç«¯ä¸»åŠ¨ç¼“å­˜</p><p>æ‹¿ express ä¸¾ä¾‹å­</p><p><a href="https://stackoverflow.com/questions/42418503/how-do-i-return-304-unmodified-status-with-express-js">https://stackoverflow.com/questions/42418503/how-do-i-return-304-unmodified-status-with-express-js</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/static/styles.css&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è®¾ç½® Cache-Control å¤´ï¼Œè¡¨ç¤ºç¼“å­˜æœ‰æ•ˆæ—¶é—´ä¸º1å°æ—¶</span></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Cache-Control&#x27;</span>, <span class="string">&#x27;max-age=3600&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½® Expires å¤´ï¼Œè¡¨ç¤ºèµ„æºè¿‡æœŸæ—¶é—´ä¸ºå½“å‰æ—¶é—´ + 1å°æ—¶</span></span><br><span class="line">  <span class="keyword">const</span> expires = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  expires.<span class="title function_">setHours</span>(expires.<span class="title function_">getHours</span>() + <span class="number">1</span>);</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Expires&#x27;</span>, expires.<span class="title function_">toUTCString</span>());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç„¶åæ¯æ¬¡å†æ£€æŸ¥. ç®€å•çš„æ–¹å¼æ˜¯äº›ä¸­é—´ä»¶.</p><p>ç°åœ¨æ­£å¸¸å¤§éƒ¨åˆ†æƒ…å†µå…¶å®éƒ½æ˜¯ç°ä»£jsæ¡†æ¶, ä¸€èˆ¬éƒ½æ˜¯ç”¨ docker å†…éƒ¨å°±æ˜¯ nginx åšæœåŠ¡, é‚£ä¹ˆå°±éœ€è¦å‰ç«¯åœ¨ ngixn.conf ä¸­è®¾ç½®.</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~* \.css$</span> &#123;</span><br><span class="line">    <span class="attribute">add_header</span> Cache-Control <span class="string">&quot;max-age=3600&quot;</span>;</span><br><span class="line">    <span class="attribute">add_header</span> Expires <span class="string">&quot;Thu, 01 Jan 1970 00:00:01 GMT&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$uri</span> <span class="regexp">~* /special\.css)</span> &#123;</span><br><span class="line">        <span class="attribute">add_header</span> Cache-Control <span class="string">&quot;no-store&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯å…¶ä»–äººçš„è®¾ç½®</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">map</span> <span class="variable">$sent_http_content_type</span> <span class="variable">$expires</span> &#123;</span><br><span class="line">    <span class="attribute">default</span>                    <span class="literal">off</span>;</span><br><span class="line">    <span class="comment">#text/html                  epoch; # ä¸ç¼“å­˜</span></span><br><span class="line">    text/<span class="attribute">css</span>                   <span class="number">30d</span>; <span class="comment"># ç¼“å­˜30å¤©ï¼Œé•¿æ—¶ç¼“å­˜å¯ä»¥è®¾ç½®ä¸ºmax</span></span><br><span class="line">    application/<span class="attribute">javascript</span>     <span class="number">30d</span>;</span><br><span class="line">    ~image/                    30d;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥å®ç°è¿™äº›è®¾ç½®.</p><h3 id="05-Web-Storage"><a href="#05-Web-Storage" class="headerlink" title="05. Web Storage"></a>05. Web Storage</h3><p>è¿™ä¸ªå…¶å®å°±æ˜¯ localstorage, sessionstorage è¿™ä¸¤ç§ä¸œè¥¿.</p><p>å¯ä»¥ç®€å•çš„å­˜ä¸€ç‚¹å„¿ä¸œè¥¿, æ¯”å¦‚ token, è™½ç„¶ä»–æ¯” cookie å¤§. ä½†æ˜¯å¤§çš„ä¸å¤š, ä¸€èˆ¬ä¸è¶…è¿‡ 5M.</p><p>å­˜ç‚¹å…³é”®ä¿¡æ¯ok, ä½†æ˜¯å¦‚æœè¦å­˜å¤§é‡æ•°æ®, å°±ä¸åˆé€‚äº†.</p><p>ä»–çš„å¥½å¤„åœ¨äºæµè§ˆå™¨æ”¯æŒå¹¿æ³›, è®¾ç½®IE8éƒ½æ”¯æŒ. ä½¿ç”¨å’Œè®¾ç½®ç®€å•</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage">https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage</a></p><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage">https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage</a></p><p>ä¸¤è€…åŒºåˆ«åœ¨äº, sessionStorage æµè§ˆå™¨å…³é—­çš„æ—¶å€™ä¼šæ¸…é™¤. localStorage åˆ™æ˜¯æ°¸ä¹…å­˜å‚¨, é™¤éæ‰‹åŠ¨åˆ é™¤.</p><h3 id="06-indexDB"><a href="#06-indexDB" class="headerlink" title="06. indexDB"></a>06. indexDB</h3><p>ä¹‹å‰æˆ‘å†™è¿‡ä¸€ä¸ª </p><p><a href="https://tanlanchou.github.io/tblog/2023/11/02/%5BQ103%5DIndexDB_Base/">https://tanlanchou.github.io/tblog/2023/11/02/%5BQ103%5DIndexDB_Base/</a></p><p><a href="https://github.com/tanlanchou/indexdb_book_store">https://github.com/tanlanchou/indexdb_book_store</a></p><p>ç°ä»£æµè§ˆå™¨åŸºæœ¬ä¸Šéƒ½æ”¯æŒäº†, å…¼å®¹æ€§æˆ‘æ²¡æœ‰æ‰€æœ‰éƒ½è¯•è¿‡, å¦‚æœæœ‰è¦ä¹ˆè‡ªå·±å°è£…, åˆ«äººå°è£…åº”è¯¥ä¹Ÿæœ‰.</p><p>å¥½å¤„æ˜¯å¤§, æ ¹æ®ä½ ç¡¬ç›˜æ¥ç®—çš„, åŸºæœ¬ä¸ç”¨è€ƒè™‘å¤§å°.</p><p>ä½†æ˜¯æ“ä½œæ˜¯çœŸçš„ä¸èˆ’æœ, ä¸æ”¯æŒsql. å†™ä¸ªåˆ†é¡µçœŸçš„ç»™æˆ‘ç´¯ç˜«äº†..</p><p>æ€»ä½“æ²¡ä»€ä¹ˆæ¯›ç—….</p><h3 id="07-service-worker"><a href="#07-service-worker" class="headerlink" title="07. service worker"></a>07. service worker</h3><blockquote><p>Service Worker æ˜¯ä¸€ä¸ªåœ¨ Web åº”ç”¨ç¨‹åºèƒŒåè¿è¡Œçš„è„šæœ¬ï¼Œå®ƒå¯ä»¥æ‹¦æˆªå’Œå¤„ç†ç½‘ç»œè¯·æ±‚ã€ç®¡ç†ç¼“å­˜ä»¥åŠæ¨é€é€šçŸ¥ã€‚Service Worker è¢«è®¾è®¡ä¸ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œä¸ç½‘é¡µä¸»çº¿ç¨‹åˆ†ç¦»ï¼Œå› æ­¤å¯ä»¥åœ¨åå°æ‰§è¡Œä»»åŠ¡è€Œä¸é˜»å¡ç”¨æˆ·ç•Œé¢ã€‚</p><ol><li>ä¸èƒ½è®¿é—®ï¼æ“ä½œdom</li><li>ä¼šè‡ªåŠ¨ä¼‘çœ ï¼Œä¸ä¼šéšæµè§ˆå™¨å…³é—­æ‰€å¤±æ•ˆ(å¿…é¡»æ‰‹åŠ¨å¸è½½)</li><li>ç¦»çº¿ç¼“å­˜å†…å®¹å¼€å‘è€…å¯æ§</li><li>å¿…é¡»åœ¨httpsæˆ–è€…localhostä¸‹ä½¿ç”¨</li><li>æ‰€æœ‰çš„apiéƒ½åŸºäºpromise</li></ol></blockquote><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API</a></p><p>ä»–å¯ä»¥æ‹¦æˆªè¯·æ±‚, å¹¶ä¸”è®¾ç½®ç¼“å­˜.</p><p>serviceWorker æˆ‘äº†è§£çš„æ¯”è¾ƒå°‘, åæ­£è¦æ pwa, åé¢å­¦ä¹ ä¸€ä¸‹</p><h3 id="08-æ€»ç»“"><a href="#08-æ€»ç»“" class="headerlink" title="08. æ€»ç»“"></a>08. æ€»ç»“</h3><p>æœ¨æœ‰.</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> browser </tag>
            
            <tag> cache </tag>
            
            <tag> Cache-Control </tag>
            
            <tag> Expires </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯ docker é¡¹ç›®å¦‚ä½•åŠ¨æ€åŠ è½½ç¯å¢ƒå˜é‡</title>
      <link href="/2023/12/07/zaxiang/front_docker_env/"/>
      <url>/2023/12/07/zaxiang/front_docker_env/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç™½ä¸€ä¸ªå‰æ, å‰ç«¯æ‰“åŒ…å‡ºæ¥çš„ä¸œè¥¿æ˜¯ html, css, js, å­—ä½“, å›¾ç‰‡â€¦â€¦</p><p>ä»–æ˜¯æ²¡æœ‰èƒ½åŠ›è®¿é—®æœåŠ¡å™¨çš„ç¯å¢ƒå˜é‡çš„. æ‰€ä»¥å¦‚æœè¦åŠ¨æ€ä½¿ç”¨ç¯å¢ƒå˜é‡, æˆ‘å¤§æ¦‚æƒ³äº†ä¸€æƒ³, æœ‰3ç§æ–¹å¼.</p><ol><li>nginx æ’ä»¶æœ‰èƒ½åŠ›è®¿é—®ç¯å¢ƒå˜é‡</li><li>node ç¯å¢ƒ</li><li>shell</li></ol><p>ç¬¬ä¸€ç§åŠæ³•æ€æ¥æƒ³å»å¤ªéº»çƒ¦äº†, é¦–å…ˆNginxé…ç½®ä¸€ç›´æ˜¯è®©æˆ‘è„‘å£³ç–¼çš„ä¸œè¥¿. è¿˜æœ‰å°±æ˜¯æœ‰äº›é“¾æ¥å’Œé…ç½®æ˜¯æ²¡æœ‰è½¬å‘çš„, ç°åœ¨åˆéœ€è¦è½¬å‘å¤ªéº»çƒ¦äº†.</p><p>ç¬¬äºŒç§è¢«å¦äº†, å› ä¸ºå¦‚æœåŒ…å«nodeç¯å¢ƒ, åŒ…å¤ªå¤§, è€Œä¸”å¯åŠ¨çš„æ—¶å€™build å¤ªæ…¢.</p><p>æ‰€ä»¥æˆ‘é€‰æ‹©äº†ç¬¬ä¸‰ç§</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‹·è´ update.env.sh åˆ°å®¹å™¨</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> update.env.sh /usr/share/nginx/update.env.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½® update.env.sh å¯æ‰§è¡Œæƒé™</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x /usr/share/nginx/update.env.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ Nginx</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;/usr/share/nginx/update.env.sh &amp;&amp; nginx -g &#x27;daemon off;&#x27;&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>ç„¶å <strong>shell</strong> è„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">sed -i &quot;s|proxy_pass http://.*:.*;|proxy_pass &quot;$VUE_APP_MODEL_BASE_URL&quot;/;|g&quot; /etc/nginx/conf.d/default.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰¾åŒ…å«æŒ‡å®šå†…å®¹çš„æ–‡ä»¶</span></span><br><span class="line">file_path=$(grep -rl &#x27;location.protocol.indexOf(&quot;s&quot;)&lt;0?&#x27; /usr/share/nginx/html)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">if [ -z &quot;$file_path&quot; ]; then</span><br><span class="line">  echo &quot;æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ã€‚&quot;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°å¤šä¸ªæ–‡ä»¶</span></span><br><span class="line">file_count=$(echo &quot;$file_path&quot; | wc -l)</span><br><span class="line">if [ &quot;$file_count&quot; -gt 1 ]; then</span><br><span class="line">  echo &quot;æ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥ã€‚&quot;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ›¿æ¢æ–‡ä»¶å†…å®¹</span></span><br><span class="line">sed -i &#x27;s|Nr=window.location.protocol.indexOf(&quot;s&quot;)&lt;0?&quot;[^&quot;]*&quot;:&quot;[^&quot;]*&quot;|Nr=window.location.protocol.indexOf(&quot;s&quot;)&lt;0?&quot;&#x27;$VUE_APP_NOVNC_BASE_URL&#x27;&quot;:&quot;&#x27;$VUE_APP_NOVNC_BASE_URLS&#x27;&quot;|&#x27; &quot;$file_path&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;æ›¿æ¢å®Œæˆã€‚&quot;</span><br></pre></td></tr></table></figure><p>è§£å†³é—®é¢˜.</p><p>è¿™ä¸ªæ–¹æ³•æœ¬æ¥ä¹Ÿå¾ˆéº»çƒ¦çš„, å¾—ç›Šäº chatgpt, å†™è¿™ç§è„šæœ¬ç®€ç›´ä¸è¦å¤ªè½»æ¾.</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> docker </tag>
            
            <tag> shell </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯è¯·æ±‚æ¨¡æ‹Ÿ</title>
      <link href="/2023/12/07/zaxiang/mock/"/>
      <url>/2023/12/07/zaxiang/mock/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>è¿™ä¸ªè¿­ä»£åç«¯å¾ˆéº»çƒ¦, æ‰€ä»¥æ¥å£ä¸å¤ªå¯èƒ½ç¬¬ä¸€æ—¶é—´æä¾›ç»™æˆ‘.</p><p>äºæ˜¯æˆ‘å…ˆå¼€ä¼šçº¦å®šäº†æ¥å£, å°±å¼€å§‹æ‰¾ç½‘ä¸Šçš„æ¨¡æ‹Ÿè§£å†³åŠæ³•.</p><h2 id="è¦æ±‚"><a href="#è¦æ±‚" class="headerlink" title="è¦æ±‚"></a>è¦æ±‚</h2><ol><li>èƒ½å¤Ÿæ¨¡æ‹Ÿè¯·æ±‚</li><li>èƒ½å¤Ÿæ¨¡æ‹Ÿæ•°æ®</li></ol><p>æ¨¡æ‹Ÿçš„åŸå› å¾ˆç®€å•, æˆ‘ä¸æƒ³åç«¯æ¥äº†æˆ‘åˆéœ€è¦æ”¹å¾ˆå¤šä»£ç .</p><p>æ‰€ä»¥æœ€å¥½çš„æ–¹å¼å°±æ˜¯å…¶ä»–éƒ½ä¸€æ ·, åªæ˜¯è¯·æ±‚çš„å…·ä½“ä»£ç å˜ä¸€ä¸‹.</p><p>ç®€å•çš„æ–¹å¼è‡ªå·±å†™ <code>settimeout</code>, ç„¶å <code>promise</code> å°è£…ä¸€ä¸‹. </p><p>ä½†æ˜¯æˆ‘æ€•æˆ‘æƒ³ä¸å…¨, è€Œä¸”ç½‘ä¸Šåº”è¯¥æœ‰è½®å­, äºæ˜¯æ‰¾åˆ°äº†å®ƒ</p><p><code>axios-mock-adapter</code></p><p>æ¨¡æ‹Ÿè¯·æ±‚æå®šäº†, è¿˜è¦æ¨¡æ‹Ÿæ•°æ®, è¿™ä¸€æ­¥å…¶å®å¯ä»¥ä¸ç”¨. å¦‚æœè¦ä½¿ç”¨çš„è¯ <code>Mock.js</code> æˆ‘ç®€å•æµ‹è¯•äº†ä¸€ä¸‹ä¹Ÿå¤Ÿç”¨äº†.</p><h2 id="axios-mock-adapter"><a href="#axios-mock-adapter" class="headerlink" title="axios-mock-adapter"></a>axios-mock-adapter</h2><p><a href="https://www.npmjs.com/package/axios-mock-adapter">npm: axios-mock-adapter</a></p><p>ä»–å¥½ç”¨çš„ç‚¹åœ¨äºå®ƒå¯ä»¥ç›´æ¥æ‹¦æˆª, ä¸å…¥ä¾µä½ åŸæœ‰çš„ä»£ç , ä½ åŸæœ‰çš„ä»£ç è¯¥æ€ä¹ˆå†™å°±æ€ä¹ˆå†™</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">  <span class="title class_">Promise</span>.<span class="title function_">all</span>([<span class="keyword">import</span>(<span class="string">&#x27;axios-mock-adapter&#x27;</span>), <span class="keyword">import</span>(<span class="string">&#x27;@/api/system&#x27;</span>)]).<span class="title function_">then</span>(<span class="function"><span class="params">results</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">MockAdapter</span> = results[<span class="number">0</span>].<span class="property">default</span></span><br><span class="line">    <span class="keyword">const</span> mock = <span class="keyword">new</span> <span class="title class_">MockAdapter</span>(service)</span><br><span class="line">    <span class="keyword">const</span> systemApi = results[<span class="number">1</span>].<span class="property">default</span></span><br><span class="line"></span><br><span class="line">    mock.<span class="title function_">onGet</span>(systemApi.<span class="property">getSystemVerify</span>).<span class="title function_">reply</span>(<span class="number">200</span>, &#123; <span class="attr">code</span>: <span class="number">0</span>, <span class="attr">data</span>: &#123; <span class="attr">machineCode</span>: <span class="string">&#x27;djalksdjlaksjd123111sda&#x27;</span> &#125; &#125;)</span><br><span class="line">    mock.<span class="title function_">onPost</span>(systemApi.<span class="property">getSystemUpload</span>).<span class="title function_">reply</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = config.<span class="property">data</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶è¢«ä¸Šä¼ </span></span><br><span class="line">      <span class="keyword">if</span> (data.<span class="title function_">has</span>(<span class="string">&#x27;file&#x27;</span>)) &#123;</span><br><span class="line">        <span class="comment">// è·å–ä¸Šä¼ çš„æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">const</span> file = data.<span class="title function_">get</span>(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> [<span class="number">200</span>, &#123; <span class="attr">code</span>: <span class="number">0</span>, <span class="attr">data</span>: &#123; <span class="attr">expireDate</span>: <span class="string">&#x27;2025-01-01 11:22:33&#x27;</span>, <span class="attr">mateMaxNum</span>: <span class="number">100</span> &#125; &#125;]</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="number">500</span>, &#123; <span class="attr">error</span>: <span class="string">&#x27;No file provided&#x27;</span> &#125;]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    mock.<span class="title function_">onAny</span>().<span class="title function_">passThrough</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘å°±æ˜¯åœ¨è¯·æ±‚çš„ä½ç½®åŠ äº†ä¸€æ®µä»£ç .</p><p>ä¸Šä¼ å’Œè·å–çš„æ¥å£å°±è¢«æˆ‘æ¨¡æ‹Ÿäº†, å…¶ä»–åœ°æ–¹æ­£å¸¸å†™</p><p>è¿™æ®µä»£ç çš„é€»è¾‘å°±æ˜¯,  å½“é‡åˆ° <code>systemApi.getSystemVerify</code> å’Œ <code>systemApi.getSystemUpload</code> è¿™ä¸¤ä¸ª <strong>API</strong> çš„æ—¶å€™æ‹¦æˆª, å…¶ä»– <strong>pass</strong></p><p>è¿™æ˜¯ä»–æœ€å¸¸ç”¨æœ€ç®€å•çš„åŠŸèƒ½</p><p>ä»–è¿˜æœ‰å„ç§ç©æ³•, æ¯”å¦‚æ¨¡æ‹Ÿç½‘ç»œè¶…æ—¶, ç½‘ç»œé”™è¯¯, æ­£åˆ™åŒ¹é…è·¯å¾„, ç”šè‡³è¿˜å¯ä»¥åšå•å…ƒæµ‹è¯•.</p><p>è¿™ç§åœ¨å®šäº†æ¥å£ä½†æ˜¯æ²¡æœ‰APIçš„æ—¶å€™å¤ªå¥½ç”¨.</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> axios-mock-adapter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‡ªå·±å®ç°ä¸€ä¸ª bind</title>
      <link href="/2023/12/07/shuati/001_bind/"/>
      <url>/2023/12/07/shuati/001_bind/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ JavaScript ä¸­ï¼Œ<code>bind</code> æ–¹æ³•æ˜¯ç”¨æ¥æ”¹å˜å‡½æ•°çš„ <code>this</code> æŒ‡å‘çš„ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myBind</span> = <span class="keyword">function</span>(<span class="params">context</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">apply</span>(context, args)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ç›´æ¥å†™</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myBind</span>(<span class="params">context</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">apply</span>(context, args)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>electron urlå¯åŠ¨, æ³¨å†Œè¡¨, æ‰“åŒ…</title>
      <link href="/2023/12/07/electron/electron_caiken_01/"/>
      <url>/2023/12/07/electron/electron_caiken_01/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>æœ€è¿‘ä¸€ç›´åœ¨åš electron é¡¹ç›®, é‡åˆ°äº†ä¸€äº›é—®é¢˜, è¿™é‡Œè®°å½•ä¸€ä¸‹</p><h3 id="01-urlå¯åŠ¨"><a href="#01-urlå¯åŠ¨" class="headerlink" title="01. urlå¯åŠ¨."></a>01. urlå¯åŠ¨.</h3><p>é¦–å…ˆåŸç”Ÿå°±æœ‰æ–¹æ³•èƒ½å¤Ÿå†™, æœ¬è´¨ä¸Šå°±æ˜¯åœ¨æ³¨å†Œè¡¨å†™å…¥.</p><p><a href="https://github.com/tanlanchou/tblog/blob/view/img/Snipaste_2023-12-07_11-41-01.png?raw=true" title="è‡ªå®šä¹‰åè®®" class="gallery-item" style="box-shadow: none;"> <img src="https://github.com/tanlanchou/tblog/blob/view/img/Snipaste_2023-12-07_11-41-01.png?raw=true" alt="è‡ªå®šä¹‰åè®®"></a></p><p>ä¸Šå›¾è‡ªå®šä¹‰åè®®</p><p><a href="https://github.com/tanlanchou/tblog/blob/view/img/Snipaste_2023-12-07_11-41-37.png?raw=true" title="è½¯ä»¶è·¯å¾„" class="gallery-item" style="box-shadow: none;"> <img src="https://github.com/tanlanchou/tblog/blob/view/img/Snipaste_2023-12-07_11-41-37.png?raw=true" alt="è½¯ä»¶è·¯å¾„"></a></p><p>ä¸Šå›¾å…·ä½“è½¯ä»¶è·¯å¾„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">setAsDefaultProtocolClient</span>(protocol[, path, args])</span><br></pre></td></tr></table></figure><blockquote><p>app.setAsDefaultProtocolClient(protocol[, path, args])</p><p>protocol string - The name of your protocol, without :&#x2F;&#x2F;. For example, if you want your app to handle electron:&#x2F;&#x2F; links, call this method with electron as the parameter.</p><p>path string (optional) Windows - The path to the Electron executable. Defaults to process.execPath</p><p>args string[] (optional) Windows - Arguments passed to the executable. Defaults to an empty array<br>Returns boolean - Whether the call succeeded.</p></blockquote><p>å…¶å®è¿™ä¸ªæ–¹æ³•æ˜¯æœ€å¥½çš„, å› ä¸ºä»–ä¸éœ€è¦å…¶ä»–æ“ä½œ. ä½ å†™å°±å¥½äº†. å¹¶ä¸”è·¨å¹³å°.</p><p>ä½†æ˜¯ä»–æœ‰ä¸€ä¸ªç¼ºç‚¹, å°±æ˜¯å¿…é¡»è½¯ä»¶å¯åŠ¨ä¸€æ¬¡ä»¥å, å› ä¸ºä»–æ˜¯åœ¨ä½ ä¸»è¿›ç¨‹é‡Œé¢, æ¯”å¦‚æˆ‘è¿™ä¸ªè½¯ä»¶å°±ä¸è¡Œ, å› ä¸ºå¿…é¡»æ”¯æŒä¸æ‰“å¼€å°±èƒ½è§¦å‘.</p><p>æ‰€ä»¥æˆ‘å°è¯•äº†å¦ä¸€ç§æ–¹å¼. <code>nsis</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;nsis&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;oneClick&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;perMachine&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;allowToChangeInstallationDirectory&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deleteAppDataOnUninstall&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./installer.nsh&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ installer.nsh å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">!macro customInstall</span><br><span class="line">  DeleteRegKey HKCR &quot;ipc.vnc.loader&quot;</span><br><span class="line">  WriteRegStr HKCR &quot;ipc.vnc.loader&quot; &quot;&quot; &quot;URL:ipc.vnc.loader&quot;</span><br><span class="line">  WriteRegStr HKCR &quot;ipc.vnc.loader&quot; &quot;URL Protocol&quot; &quot;&quot;</span><br><span class="line">  WriteRegStr HKCR &quot;ipc.vnc.loader\shell&quot; &quot;&quot; &quot;&quot;</span><br><span class="line">  WriteRegStr HKCR &quot;ipc.vnc.loader\shell\Open&quot; &quot;&quot; &quot;&quot;</span><br><span class="line">  WriteRegStr HKCR &quot;ipc.vnc.loader\shell\Open\command&quot; &quot;&quot; &quot;$INSTDIR\$&#123;APP_EXECUTABLE_FILENAME&#125; %1&quot;</span><br><span class="line">!macroend</span><br><span class="line"></span><br><span class="line">!macro customUnInstall</span><br><span class="line">  DeleteRegKey HKCR &quot;ipc.vnc.loader&quot;</span><br><span class="line">!macroend</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥äº†, è¿™ç§å†™æ³•åŒæ ·ä¸‡é‡‘æ²¹, åªæ˜¯éº»çƒ¦.</p><h3 id="02-icon"><a href="#02-icon" class="headerlink" title="02. icon"></a>02. icon</h3><p>æ›´æ”¹å›¾æ ‡, æŸ¥äº†å¾ˆå¤šèµ„æ–™, åœ¨ <strong>electron-builder.json</strong> ä¸­ win ä¸‹é¢åŠ äº† icon è¿˜æ˜¯ä¼šæŠ¥é”™, ä¼šä½¿ç”¨é»˜è®¤å›¾ç‰‡.</p><p>åæ¥åœ¨çœ‹è¿™ä¸ªissueçš„æ—¶å€™ <a href="https://github.com/ElectronNET/Electron.NET/issues/292">https://github.com/ElectronNET/Electron.NET/issues/292</a> ç»™äº†æˆ‘å¯å‘.</p><p>ä¹Ÿå°±æ˜¯è¯´, æ‰“åŒ…ä»¥åä»–å…¶å®æ˜¯åœ¨æ‰“åŒ…ä¸‹çš„ä¸€ä¸ªç›®å½•. äºæ˜¯æˆ‘æµ‹è¯•äº†ä¸€ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">win<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../dist/icon.ico&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è§£å†³.</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> ç¯å¢ƒ </tag>
            
            <tag> electron </tag>
            
            <tag> æ‰“åŒ… </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>url é€šè¿‡åè®®å¯åŠ¨åº”ç”¨ç¨‹åº</title>
      <link href="/2023/12/01/javascript/url_open_software/"/>
      <url>/2023/12/01/javascript/url_open_software/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="01-url-å¦‚ä½•å…³è”åˆ°åº”ç”¨ç¨‹åº"><a href="#01-url-å¦‚ä½•å…³è”åˆ°åº”ç”¨ç¨‹åº" class="headerlink" title="01. url å¦‚ä½•å…³è”åˆ°åº”ç”¨ç¨‹åº?"></a>01. url å¦‚ä½•å…³è”åˆ°åº”ç”¨ç¨‹åº?</h1><p>åšè¿‡htmlè‚¯å®šéƒ½çŸ¥é“ä¸‹é¢è¿™æ®µä»£ç </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;mailto:xxx@xxx.com&quot;</span>&gt;</span>å‘é€é‚®ä»¶<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>href</code>å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªurlï¼Œå½“ç”¨æˆ·ç‚¹å‡»è¿™ä¸ªé“¾æ¥çš„æ—¶å€™ï¼Œæµè§ˆå™¨å°±ä¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„æµè§ˆå™¨çª—å£ï¼Œå¹¶ä¸”æ‰“å¼€ä¸€ä¸ªæ–°çš„é‚®ä»¶å®¢æˆ·ç«¯ï¼Œå¹¶å°†é‚®ä»¶åœ°å€å¡«å…¥å…¶ä¸­ã€‚</p><p>é‚£ä¹ˆï¼Œurl å¦‚ä½•å…³è”åˆ°åº”ç”¨ç¨‹åºå‘¢ï¼Ÿ</p><h1 id="02-åè®®æ€ä¹ˆæ¥çš„"><a href="#02-åè®®æ€ä¹ˆæ¥çš„" class="headerlink" title="02. åè®®æ€ä¹ˆæ¥çš„?"></a>02. åè®®æ€ä¹ˆæ¥çš„?</h1><p>è¿™é‡Œéœ€è¦åŒºåˆ†5ä¸ªä¸åŒçš„å¹³å°, ä¹Ÿå°±æ˜¯ windows, mac, linux, android, ios</p><ol><li>windows åœ¨æ³¨å†Œè¡¨ä¸­æ³¨å†Œä½ çš„è‡ªå®šä¹‰ URL åè®®ï¼ŒæŒ‡å®šåº”ç”¨ç¨‹åºçš„å¤„ç†å™¨</li><li>mac åœ¨åº”ç”¨ç¨‹åºçš„ Info.plist æ–‡ä»¶ä¸­æ³¨å†Œè‡ªå®šä¹‰ URL åè®®ï¼ŒæŒ‡å®šåº”ç”¨ç¨‹åºçš„å¤„ç†å™¨</li><li>linux é€šè¿‡æ³¨å†Œ MIME ç±»å‹å’Œå…³è”å®ƒä»¬çš„å¤„ç†ç¨‹åºæ¥å®ç°</li><li>android AndroidManifest.xml æ–‡ä»¶, æ³¨å†Œ <intent-filter></li><li>ios åŒæ ·Info.plist</li></ol><p>ä¹Ÿå°±æ˜¯è¯´,ä½ çš„ç¨‹åºåœ¨å®‰è£…çš„æ—¶å€™,éœ€è¦æ³¨å†Œä¸€ä¸ªåè®®,ç„¶ååœ¨ç¨‹åºä¸­æŒ‡å®šè¿™ä¸ªåè®®,å½“ç”¨æˆ·ç‚¹å‡»è¿™ä¸ªåè®®çš„æ—¶å€™,å°±ä¼šæ‰“å¼€ä½ çš„ç¨‹åº.</p><h1 id="03-html-å¦‚ä½•çŸ¥é“åè®®æ˜¯å¦æ‰“å¼€"><a href="#03-html-å¦‚ä½•çŸ¥é“åè®®æ˜¯å¦æ‰“å¼€" class="headerlink" title="03. html å¦‚ä½•çŸ¥é“åè®®æ˜¯å¦æ‰“å¼€?"></a>03. html å¦‚ä½•çŸ¥é“åè®®æ˜¯å¦æ‰“å¼€?</h1><p>æ— æ³•çŸ¥é“, è‡³å°‘æ²¡æœ‰ä¸€ä¸ªé€šç”¨çš„æ¥å£</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;mailto:xxx@xxx.com&quot;</span>&gt;</span>å‘é€é‚®ä»¶<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ˜¯æ²¡æœ‰è¿”å›å€¼çš„, ç½‘ä¸ŠæŸ¥è¯¢æœ‰ä¸€ä¸ªæ–¹æ¡ˆ.</p><p><a href="https://github.com/ismailhabib/custom-protocol-detection">https://github.com/ismailhabib/custom-protocol-detection</a></p><p>ä»–çš„æ–¹æ¡ˆå…¶å®æ˜¯é€šè¿‡ hack æ–¹å¼.</p><blockquote><p>Firefox: try to open the handler in a hidden iframe and catch exception if the custom protocol is not available.</p><p>Chrome: using window onBlur to detect whether the focus is stolen from the browser. When the focus is stolen, it assumes that the custom protocol launches external app and therefore it exists.</p><p>IEs and Edge in Win 8&#x2F;Win 10: the cleanest solution. IEs and Edge in Windows 8 and Windows 10 does provide an API to check the existence of custom protocol handlers.</p><p>Other IEs: various different implementation. Worth to notice that even the same IE version might have a different behavior (I suspect due to different commit number). It means that for these IEs, the implementation is the least reliable.</p></blockquote><p>ä»–ä»£ç æœ€è¿‘æ›´æ–°çš„ä¹Ÿæ˜¯5å¹´å‰çš„. è€Œä¸”æ›´æ–°çš„æ˜¯ package.json.</p><p>ä½†æ˜¯æˆ‘æµ‹è¯•äº†å›½å†…ä½¿ç”¨çš„å¤§éƒ¨åˆ†æµè§ˆå™¨çš„æœ€æ–°ç‰ˆæœ¬, å±…ç„¶æ˜¯å¯ç”¨çš„(åŒ…æ‹¬æœ€æ–°ç‰ˆæœ¬chrome). å¹¶ä¸åƒæˆ‘æŸ¥è¯¢çš„å…¶ä»–æ–‡ç« è¯´ä¸å¯ç”¨.</p><p>è¿˜èƒ½è¯´ä½¿ç”¨é£é™©è¿˜æ˜¯å¾ˆå¤§.</p><p>æˆ‘ä¹Ÿçœ‹äº†ç™¾åº¦ç›˜çš„æ–¹æ¡ˆ, æ–¹æ¡ˆå°±æ˜¯åè®®é‡Œä¼ å‚æ•°, éƒ½å’ŒæœåŠ¡å™¨è¿›è¡Œé€šä¿¡.</p><p>å…¶å®ç™¾åº¦ç›˜é¡µé¢ç‚¹ä¸‹è½½, æ‰“å¼€F12 å…¶å®å°±çŸ¥é“äº†.</p><h3 id="04-æ€»ç»“"><a href="#04-æ€»ç»“" class="headerlink" title="04. æ€»ç»“"></a>04. æ€»ç»“</h3><p>æœ€ä¼˜æƒ…å†µè¿˜æ˜¯ä½¿ç”¨ç™¾åº¦çš„æ–¹æ¡ˆ, æœ€ç¨³å®š, æœ‰å°±ä¸€å®šæœ‰, ä¸æ€•æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜.</p><p>å‰ææ˜¯éœ€è¦è½¯ä»¶æ˜¯ä½ è‡ªå·±çš„, å¦‚æœä¸æ˜¯ä½ è‡ªå·±çš„, å°±åªèƒ½çœ‹åˆ«äººæ˜¯å¦å®ç°è¿™ä¸€å¥—æˆ–è€…ä½ åŠ ä¸€ä¸ªå¯åŠ¨å™¨..</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IndexDB API</title>
      <link href="/2023/11/02/%5BQ103%5DIndexDB_Base/"/>
      <url>/2023/11/02/%5BQ103%5DIndexDB_Base/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-ä»€ä¹ˆæ˜¯IndexDB"><a href="#01-ä»€ä¹ˆæ˜¯IndexDB" class="headerlink" title="01. ä»€ä¹ˆæ˜¯IndexDB?"></a>01. ä»€ä¹ˆæ˜¯IndexDB?</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API">https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API</a></p><blockquote><p>IndexedDB æ˜¯ä¸€ä¸ªäº‹åŠ¡å‹æ•°æ®åº“ç³»ç»Ÿï¼Œç±»ä¼¼äºåŸºäº SQL çš„ RDBMSã€‚ç„¶è€Œï¼Œä¸åƒ RDBMS ä½¿ç”¨å›ºå®šåˆ—è¡¨ï¼ŒIndexedDB æ˜¯ä¸€ä¸ªåŸºäº JavaScript çš„é¢å‘å¯¹è±¡æ•°æ®åº“ã€‚IndexedDB å…è®¸ä½ å­˜å‚¨å’Œæ£€ç´¢ç”¨é”®ç´¢å¼•çš„å¯¹è±¡ï¼›å¯ä»¥å­˜å‚¨ç»“æ„åŒ–å…‹éš†ç®—æ³•æ”¯æŒçš„ä»»ä½•å¯¹è±¡ã€‚ä½ åªéœ€è¦æŒ‡å®šæ•°æ®åº“æ¨¡å¼ï¼Œæ‰“å¼€ä¸æ•°æ®åº“çš„è¿æ¥ï¼Œç„¶åæ£€ç´¢å’Œæ›´æ–°ä¸€ç³»åˆ—äº‹åŠ¡ã€‚</p></blockquote><p>å…¶å®æ²¡å¾—é€‰, å¦‚æœè¦åœ¨æµè§ˆå™¨å­˜å‚¨å¤§é‡ä¸œè¥¿,ä½ åªèƒ½é€‰ IndexDB.</p><p>ä»–å¯ä»¥å¼‚æ­¥, æ”¯æŒäº‹åŠ¡, æœ‰ç´¢å¼•, å¯ä»¥è·¨åŸŸ. è€Œä¸”æ˜¯ NoSql.</p><p>è¿˜æœ‰å°±æ˜¯ä»–æ•°æ®æ˜¯ç»“æ„åŒ–çš„, è¯´äººè¯å°±æ˜¯, ä»–ç†è®ºä¸Šæ²¡æœ‰é™åˆ¶, ä½ å¯ä»¥å­˜ä»»ä½•ä¸œè¥¿.</p><h3 id="02-æµè§ˆå™¨æ”¯æŒé—®é¢˜"><a href="#02-æµè§ˆå™¨æ”¯æŒé—®é¢˜" class="headerlink" title="02. æµè§ˆå™¨æ”¯æŒé—®é¢˜"></a>02. æµè§ˆå™¨æ”¯æŒé—®é¢˜</h3><p><a href="https://caniuse.com/?search=indexdb">https://caniuse.com/?search=indexdb</a></p><p>ç†è®ºä¸Šåªè¦ä½ ä¸å…¼å®¹ IE, é—®é¢˜éƒ½ä¸å¤§, å¦‚æœè¦å…¼å®¹IE, éœ€è¦è€ƒè™‘ IndexDBä¸åŒç‰ˆæœ¬çš„å†™æ³•å…¼å®¹æ€§é—®é¢˜</p><h3 id="03-å¤§å°"><a href="#03-å¤§å°" class="headerlink" title="03. å¤§å°"></a>03. å¤§å°</h3><p>ä¸åŒæµè§ˆå™¨å¤§å°ä¸åŒ, ä½†æ˜¯ä¹Ÿä¸å¥½æµ‹è¯•.</p><p>å› ä¸ºä½ éœ€è¦çœ‹æ¯ä¸ªæµè§ˆå™¨è‡ªå·±çš„å…¬å‘Š, å¹¶ä¸”ä½ ä¹Ÿä¸çŸ¥é“éšç€æ›´æ–°æ˜¯å¦ä¼šæœ‰è°ƒæ•´, æ¯ä¸ªç‰ˆæœ¬éƒ½å¯èƒ½ä¸å¤ªä¸€æ ·.</p><p>æŸ¥äº†åŠå¤©ä¹Ÿæ²¡æœ‰è°å»åšäº†ä¸€ä¸ªç»Ÿè®¡.</p><p>ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢ä»£ç è¿›è¡Œæ£€æµ‹.</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">navigator.<span class="property">storage</span>.<span class="title function_">estimate</span>().<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">estimate</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> usedSpaceInMB = estimate.<span class="property">usage</span> / <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">const</span> totalSpaceInMB = estimate.<span class="property">quota</span> / <span class="number">1024</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åªæ˜¯è¿™ä¸ªä»£ç ä¹Ÿæœ‰é—®é¢˜</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/StorageManager/estimate">https://developer.mozilla.org/zh-CN/docs/Web/API/StorageManager/estimate</a></p><blockquote><p>å®‰å…¨ä¸Šä¸‹æ–‡: æ­¤é¡¹åŠŸèƒ½ä»…åœ¨ä¸€äº›æ”¯æŒçš„æµè§ˆå™¨çš„å®‰å…¨ä¸Šä¸‹æ–‡ï¼ˆHTTPSï¼‰ä¸­å¯ç”¨ã€‚</p></blockquote><p>æµ‹è¯•çš„æ—¶å€™éœ€è¦æ³¨æ„</p><h3 id="04-æ–‡æ¡£"><a href="#04-æ–‡æ¡£" class="headerlink" title="04. æ–‡æ¡£"></a>04. æ–‡æ¡£</h3><p>é¦–å…ˆæ¨èçœ‹æ–‡æ¡£</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API">https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API</a></p><p>è¿™ä¸ªæ¯”è¾ƒå¤æ‚, ç®€å•ä½¿ç”¨çœ‹é˜®ä¸€å³°çš„ä¹Ÿè¡Œ</p><p><a href="https://www.ruanyifeng.com/blog/2018/07/indexeddb.html">https://www.ruanyifeng.com/blog/2018/07/indexeddb.html</a></p><p>å¼„æ‡‚, ç®€å•ä½¿ç”¨æ˜¯æ²¡é—®é¢˜äº†.</p><h3 id="05-Indexdb-amp-IDBFactory"><a href="#05-Indexdb-amp-IDBFactory" class="headerlink" title="05. Indexdb &amp; IDBFactory"></a>05. Indexdb &amp; IDBFactory</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IDBFactory">https://developer.mozilla.org/zh-CN/docs/Web/API/IDBFactory</a></p><p>IDBFactory å¯¹è±¡è¡¨ç¤º IndexedDB å·¥å‚ã€‚ å®ƒæä¾›æ‰“å¼€å’Œå…³é—­æ•°æ®åº“çš„æ–¹æ³•ã€‚</p><p>ä¹Ÿå°±æ˜¯ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">indexedDB</span>.<span class="title function_">open</span>(name, version)</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">indexedDB</span>.<span class="title function_">deleteDatabase</span>(name)</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯, å¦‚æœ <code>open</code> çš„æ—¶å€™, æ•°æ®åº“ä¸å­˜åœ¨, ä¼šè‡ªåŠ¨åˆ›å»º.</p><p><code>open</code> å’Œ <code>deleteDatabase</code> éƒ½ä¼šè¿”å› <code>IDBOpenDBRequest</code></p><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBOpenDBRequest">https://developer.mozilla.org/en-US/docs/Web/API/IDBOpenDBRequest</a></p><p><code>IDBOpenDBRequest</code> éœ€è¦æ³¨æ„ä¸‹é¢4ä¸ªäº‹ä»¶.</p><ol><li><code>blocked</code> <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBOpenDBRequest">https://developer.mozilla.org/en-US/docs/Web/API/IDBOpenDBRequest</a></li><li><code>upgradeneeded</code> <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBOpenDBRequest/upgradeneeded_event">https://developer.mozilla.org/en-US/docs/Web/API/IDBOpenDBRequest/upgradeneeded_event</a></li><li><code>error</code> <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBRequest/error_event">https://developer.mozilla.org/en-US/docs/Web/API/IDBRequest/error_event</a></li><li><code>success</code> <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBRequest/success_event">https://developer.mozilla.org/en-US/docs/Web/API/IDBRequest/success_event</a></li></ol><p><code>blocked</code></p><blockquote><p>å½“ä¸€ä¸ªç½‘é¡µæˆ–åº”ç”¨ç¨‹åºå°è¯•æ‰“å¼€ä¸€ä¸ªå·²ç»è¢«å…¶ä»–ç½‘é¡µæˆ–åº”ç”¨ç¨‹åºæ‰“å¼€å¹¶æ­£åœ¨æ‰§è¡Œå†™å…¥äº‹åŠ¡çš„æ•°æ®åº“æ—¶ï¼Œä¼šè§¦å‘ blocked äº‹ä»¶ã€‚</p></blockquote><p>æ‰€ä»¥è¿™ä¸ªäº‹ä»¶çš„åº”ç”¨åœºæ™¯å°±éœ€è¦è€ƒè™‘äº†, æˆ‘ç›®å‰è¦å†™çš„åœºæ™¯æ˜¯ä¸éœ€è¦è¿™ä¸ªäº‹ä»¶çš„.</p><p>å¦‚æœæœ‰è¿™ä¸ªå¤šç½‘é¡µä½¿ç”¨ indexDB çš„æƒ…å†µ, å°±éœ€è¦è€ƒè™‘äº†.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">addEventListener</span>(<span class="string">&quot;blocked&quot;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure><p><code>upgradeneeded</code></p><blockquote><p>The upgradeneeded event is fired when an attempt was made to open a database with a version number higher than its current version. </p></blockquote><p>å­—é¢æ„æ€, åœ¨å°è¯•ç”¨ä¸€ä¸ªæ›´é«˜ç‰ˆæœ¬ç‰ˆæœ¬å·æ‰“å¼€æ•°æ®åº“çš„æ—¶å€™, å°±ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶.</p><p>å…¶å®è¿˜æœ‰ä¸€ä¸ªæƒ…å†µ, å°±æ˜¯é¦–æ¬¡æ‰“å¼€çš„æ—¶å€™.</p><h3 id="05-IDBFactory"><a href="#05-IDBFactory" class="headerlink" title="05. IDBFactory"></a>05. IDBFactory</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase">https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase</a></p><p>IDBDatabase å°±æ˜¯å½“ä½ ä½¿ç”¨ open æ•°æ®åº“ä¹‹åçš„è¿”å›å€¼ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onsuccess = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    db = event.<span class="property">target</span>.<span class="property">result</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»–å¯ä»¥åšä»€ä¹ˆï¼Ÿ</p><p>é¦–å…ˆè·å–è¿™ä¸ªæ•°æ®åº“çš„åŸºæœ¬ä¿¡æ¯</p><ol><li>name æ•°æ®åº“åç§°</li><li>version æ•°æ®åº“ç‰ˆæœ¬</li><li>objectStoreNames è¡¨åç§°åˆé›†</li></ol><p>å…¶æ¬¡ï¼Œä¹Ÿå°±æ˜¯æœ€ä¸»è¦çš„</p><ol><li>close()</li><li>createObjectStore()</li><li>deleteObjectStore()</li><li>transaction()</li><li>versionchange</li></ol><p>è¿™é‡Œä¸»è¦è¯´å‰ä¸‰ä¸ªï¼Œç¬¬å››ä¸ªåé¢ç»§ç»­çœ‹ã€‚</p><p><code>close</code> å°±æ˜¯å…³é—­æ•°æ®åº“é“¾æ¥ã€‚åœ¨é€‚å½“çš„æ—¶å€™å…³é—­æ•°æ®åº“ï¼Œé¿å…é˜»å¡ï¼Œå†…å­˜è¿‡é«˜ç­‰é—®é¢˜</p><p><code>createObjectStore</code> åˆ›å»ºè¡¨</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/createObjectStore">https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/createObjectStore</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">createObjectStore</span>(name)</span><br><span class="line"><span class="title function_">createObjectStore</span>(name, options)</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸‹è¯•ä¸€è¯•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line"><span class="keyword">const</span> objectStore = db.<span class="title function_">createObjectStore</span>(<span class="string">&quot;user&quot;</span>, &#123;</span><br><span class="line"><span class="attr">keyPath</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line"><span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">objectStore.<span class="title function_">add</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;tommy&quot;</span>, <span class="attr">age</span>: <span class="string">&quot;18&quot;</span>, <span class="attr">sex</span>: <span class="number">1</span> &#125;);</span><br><span class="line">objectStore.<span class="title function_">add</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;tommy1&quot;</span>, <span class="attr">age</span>: <span class="string">&quot;19&quot;</span>, <span class="attr">sex</span>: <span class="number">0</span> &#125;);</span><br><span class="line">objectStore.<span class="title function_">add</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;tommy2&quot;</span>, <span class="attr">age</span>: <span class="string">&quot;20&quot;</span>, <span class="attr">sex</span>: <span class="number">1</span> &#125;);</span><br><span class="line"></span><br><span class="line">db.<span class="title function_">close</span>();</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå»ºè®® <code>autoIncrement</code> è®¾ç½®ï¼Œä¸ç„¶ä½ éœ€è¦è‡ªå·±è®¾ç½® <code>id</code>.</p><p>å…¶æ¬¡ï¼Œ<code>createObjectStore</code> åªèƒ½åœ¨ <code>upgradeneeded</code> é˜¶æ®µä½¿ç”¨ï¼Œä¸ç„¶ä¼šæŠ¥é”™çš„.</p><p>è¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªè¡¨ï¼Œå¹¶ä¸”æ·»åŠ äº†3æ¡æ•°æ®ã€‚</p><p><code>deleteObjectStore</code> åˆ é™¤è¡¨</p><p>æœ€å¼€å§‹æœ‰ç‚¹æ‡µï¼Œå› ä¸ºåˆ é™¤ä¹Ÿä¸èƒ½ç›´æ¥åœ¨ <code>onsuccess</code>, ä¼šæŠ¥é”™ï¼Œå¦‚æœæƒ³è¦åœ¨ <code>upgradeneeded</code> ä½¿ç”¨ï¼Œéš¾é“æˆ‘ä¸æ›´æ”¹ç‰ˆæœ¬å°±ä¸èƒ½åˆ é™¤å—ï¼Ÿ</p><p>é—®äº†AIä¹‹åï¼Œç»™äº†ä¸€ä¸ªæ–¹æ¡ˆ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰“å¼€æ•°æ®åº“å¹¶è·å–æ•°æ®åº“è¿æ¥</span></span><br><span class="line"><span class="keyword">var</span> request = indexedDB.<span class="title function_">open</span>(<span class="string">&quot;myDatabase&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">request.<span class="property">onsuccess</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰§è¡Œç‰ˆæœ¬æ›´æ”¹äº‹åŠ¡</span></span><br><span class="line">    <span class="keyword">var</span> versionChange = db.<span class="title function_">setVersion</span>(<span class="number">2</span>); <span class="comment">// ä½¿ç”¨setVersionæ¥åˆ›å»ºç‰ˆæœ¬æ›´æ”¹äº‹åŠ¡</span></span><br><span class="line"></span><br><span class="line">    versionChange.<span class="property">onsuccess</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// åœ¨ç‰ˆæœ¬æ›´æ”¹äº‹åŠ¡ä¸­åˆ é™¤ Object Store</span></span><br><span class="line">        <span class="keyword">if</span> (db.<span class="property">objectStoreNames</span>.<span class="title function_">contains</span>(<span class="string">&quot;myObjectStore&quot;</span>)) &#123;</span><br><span class="line">            db.<span class="title function_">deleteObjectStore</span>(<span class="string">&quot;myObjectStore&quot;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Object Store &#x27;myObjectStore&#x27; deleted.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Object Store &#x27;myObjectStore&#x27; not found.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        versionChange = versionChange.<span class="property">transaction</span>;</span><br><span class="line">        versionChange.<span class="property">oncomplete</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Object Store deleted successfully.&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        versionChange.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error deleting Object Store: &quot;</span> + versionChange.<span class="property">error</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘åœ¨ MDN ä¸­æœç´¢çš„æ—¶å€™ï¼Œæ²¡æœ‰å‘ç°è¿™ä¸ªæ–¹æ³•ï¼Œäºæ˜¯ google äº†ä¸€ä¸‹è¿™ä¸æ˜¯æ ‡å‡†æ–¹æ³•ã€‚</p><p><a href="https://stackoverflow.com/questions/9521689/getting-a-setversion-is-not-a-function-error-when-using-indexeddb">https://stackoverflow.com/questions/9521689/getting-a-setversion-is-not-a-function-error-when-using-indexeddb</a></p><p>MDN å®˜æ–¹ä¾‹å­å½“ä¸­ç¡®å®ä¹Ÿæ˜¯ç‰ˆæœ¬å˜æ›´çš„æ—¶å€™æ‰åˆ é™¤ <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/deleteObjectStore">https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/deleteObjectStore</a></p><p><code>versionchange</code></p><blockquote><p>The event is fired when a database structure change (upgradeneeded event send on an IDBOpenDBRequest or IDBFactory.deleteDatabase) was requested elsewhere (most probably in another window&#x2F;tab on the same computer). versionchange</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœå…¶ä»–é¡µé¢è§¦å‘å‡çº§, é‚£ä¹ˆè¿™ä¸ªé¡µé¢ä¹Ÿä¼šæ”¶åˆ°é€šçŸ¥.</p><h3 id="06-IDBDatabase-transaction-method"><a href="#06-IDBDatabase-transaction-method" class="headerlink" title="06. IDBDatabase: transaction() method"></a>06. IDBDatabase: transaction() method</h3><p>äº‹åŠ¡ï¼Œä»–å¯ä»¥åšä»€ä¹ˆï¼Ÿ</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/transaction">https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/transaction</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">transaction</span>(storeNames)</span><br><span class="line"><span class="title function_">transaction</span>(storeNames, mode)</span><br><span class="line"><span class="title function_">transaction</span>(storeNames, mode, options)</span><br></pre></td></tr></table></figure><p><code>mode</code></p><ol><li><code>readonly</code></li><li><code>readwrite</code></li><li><code>versionchange</code></li></ol><p>æ¨¡å¼3ç§ï¼Œ1,2 æ˜¯æ‰“å¼€äº‹åŠ¡ä»¥åï¼Œ è¯»å†™è¿˜æ˜¯åªè¯»ï¼Œè¿™é‡Œéœ€è¦è¯´ä¸€ä¸‹ï¼Œç†è®ºä¸Š <code>readwrite</code> å¯ä»¥å…¨è¦†ç›– <code>readonly</code>. ä½†æ˜¯åˆ«ä¸€ç›´ä½¿ç”¨ <code>readwrite</code></p><blockquote><p>ä¸€æ¬¡åªèƒ½æ‰“å¼€ä¸€ä¸ªè¯»å†™äº‹åŠ¡ï¼Œå®ƒä¼šé”å®šæ•°æ®åº“ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åŒæ—¶è®¿é—®ã€‚<br>å½“æœ‰è¯»å†™äº‹åŠ¡å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œåªè¯»äº‹åŠ¡å°†è¢«é˜»å¡ï¼Œç›´åˆ°è¯»å†™äº‹åŠ¡å®Œæˆã€‚</p></blockquote><p>ä¸ç®¡æ˜¯æ€§èƒ½ä¸Šï¼Œè¿˜æ˜¯é˜»å¡ä¸Šï¼Œå¦‚æœåªéœ€è¦è¯»å–ï¼Œéƒ½åº”è¯¥é€‰å– <code>readonly</code>.</p><p><code>versionchange</code> æ˜¯æˆ‘çœ‹æ–‡æ¡£ä¸æ˜ç™½çš„ä¸€ä¸ªç‚¹ï¼Œä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªæ¨¡å¼ï¼Ÿ è€Œä¸”å†™æµ‹è¯•ä»£ç æ²¡ç”¨</p><blockquote><p>è¿™ç§ç±»å‹çš„äº‹åŠ¡å…è®¸è¯»å–ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ã€‚ä¹Ÿèƒ½å¤Ÿåˆ›å»ºå’Œåˆ é™¤Storesï¼ˆæ•°æ®è¡¨ï¼‰å’Œç´¢å¼•ã€‚è¿™ç§ç±»å‹çš„äº‹åŠ¡ä¼šåœ¨ä¸€ä¸ªupgradeneededäº‹ä»¶è¢«è§¦å‘çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºï¼Œä¸èƒ½å¤Ÿæ‰‹åŠ¨åˆ›å»ºã€‚</p></blockquote><p>versionchange å¯ä»¥æ‰§è¡Œæ•°æ®åº“ç»“æ„çš„å‡çº§ã€åˆ›å»ºæ–°çš„å¯¹è±¡ä»“åº“ã€æ·»åŠ ç´¢å¼•ã€æ‰§è¡Œæ•°æ®è¿ç§»ç­‰æ“ä½œ</p><p>okï¼Œä¸Šä»£ç æµ‹è¯•ä¸€ä¸‹ã€‚</p><p>é¦–å…ˆæ˜¯ <code>readonly</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line"><span class="keyword">const</span> transaction = db.<span class="title function_">transaction</span>(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;readonly&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> objectStore = transaction.<span class="title function_">objectStore</span>(<span class="string">`user`</span>);</span><br><span class="line"><span class="keyword">const</span> results = objectStore.<span class="title function_">getAll</span>();</span><br><span class="line">results.<span class="property">onsuccess</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> r = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line">    <span class="keyword">if</span> (r &amp;&amp; r.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      r.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(item.<span class="property">name</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æ­£å¸¸çš„, åœ¨åªè¯»æƒ…å†µå°è¯•äº†ä¸€ä¸‹ <code>add</code>, ç›´æ¥æŠ¥é”™</p><blockquote><p>Uncaught DOMException: Failed to execute â€˜addâ€™ on â€˜IDBObjectStoreâ€™: The transaction is read-only.</p></blockquote><p>å¦å¤–ä¸€ä¸ªæ¨¡å¼, <code>readwrite</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line"><span class="keyword">const</span> transaction = db.<span class="title function_">transaction</span>(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;readwrite&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> objectStore = transaction.<span class="title function_">objectStore</span>(<span class="string">`user`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = &#123; <span class="attr">name</span>: <span class="string">&quot;tommy3&quot;</span>, <span class="attr">age</span>: <span class="string">&quot;18&quot;</span>, <span class="attr">sex</span>: <span class="number">1</span> &#125;;</span><br><span class="line">objectStore.<span class="title function_">add</span>(data);</span><br><span class="line">db.<span class="title function_">close</span>();</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ä»£ç , å¦‚æœç”¨åœ¨è¯»å†™ä¸Š. ok.</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore">IDBObjectStore - Web APIs | MDN (mozilla.org)</a></p><p>è¿™é‡ŒåŒ…å«äº†å…¶ä»–è¿˜èƒ½åšçš„æ“ä½œ, ä½ ä½¿ç”¨äº‹åŠ¡, æœ€ç»ˆè¿˜æ˜¯è¦è½åœ¨è¿™ä¸Šé¢.</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>readwrite</code> å…¶å®ä¹Ÿæ˜¯å¯ä»¥è¯»çš„, ä½†æ˜¯å»ºè®®åˆ†å¼€, åŸå› åˆšæ‰è¯´æ¸…æ¥šäº†.</p><p><code>versionchange</code> </p><blockquote><p>Allows any operation to be performed, including ones that delete and create object stores and indexes. Transactions of this mode cannot run concurrently with other transactions. Transactions in this mode are known as â€œupgrade transactions.â€</p><p>å…è®¸æ‰§è¡Œä»»ä½•æ“ä½œï¼ŒåŒ…æ‹¬åˆ é™¤å’Œåˆ›å»ºå¯¹è±¡å­˜å‚¨å’Œç´¢å¼•çš„æ“ä½œã€‚æ­¤æ¨¡å¼çš„äº‹åŠ¡ä¸èƒ½ä¸å…¶ä»–äº‹åŠ¡å¹¶å‘è¿è¡Œã€‚æ­¤æ¨¡å¼çš„äº‹åŠ¡ç§°ä¸ºâ€œå‡çº§äº‹åŠ¡â€ã€‚</p><p>There is also another type of transactions: . It can do anything, but you canâ€™t generate it manually.versionchange A transaction can be automatically created by IndexedDB while opening the database for the handler. After creating the transaction, it is necessary to add an item to the store as follows:</p><p>è¿˜æœ‰å¦ä¸€ç§ç±»å‹çš„äº¤æ˜“ï¼šã€‚å®ƒå¯ä»¥åšä»»ä½•äº‹æƒ…ï¼Œä½†ä½ ä¸èƒ½æ‰‹åŠ¨ç”Ÿæˆå®ƒã€‚versionchange</p><p>åœ¨ä¸ºå¤„ç†ç¨‹åºæ‰“å¼€æ•°æ®åº“æ—¶ï¼ŒIndexedDBå¯ä»¥è‡ªåŠ¨åˆ›å»ºäº‹åŠ¡ã€‚åˆ›å»ºäº‹åŠ¡åï¼Œéœ€è¦å‘å­˜å‚¨ä¸­æ·»åŠ ä¸€ä¸ªé¡¹ç›®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´åœ¨è§¦å‘æ•°æ®åº“å‡çº§çš„æ—¶å€™, è‡ªåŠ¨è§¦å‘è¿™ä¸ªäº‹åŠ¡.</p><p>æˆ‘æœ€å¼€å§‹æœ‰ä¸€ä¸ªè¯¯è§£ï¼Œ å°±æ˜¯ä¸åŒç‰ˆæœ¬çš„æ•°æ®åº“, æ„å‘³ç€æœ¬åœ°æœ‰å¤šä¸ªæ•°æ®åº“, ä½ å¯ä»¥è®¿é—® <strong>version: 1</strong>, ä¹Ÿå¯ä»¥è®¿é—® <strong>version:2</strong></p><p>æ‰€ä»¥ä¹‹å‰æ‰¾äº†å¾ˆä¹…å…³äºæ•°æ®åº“è¿ç§»çš„é—®é¢˜, åæ¥æ˜ç™½äº†å…¶å®åªèƒ½è®¿é—®æœ€æ–°ç‰ˆæœ¬, ä¹Ÿä¸å­˜åœ¨è¿ç§»æ•°æ®è¿™ç§åšæ³•(é™¤éä½ æ˜¯è¿ç§» ObjectStore).</p><p>ä¸‹é¢æ˜¯æˆ‘å†™çš„ä¸€ä¸ªåˆ—å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">onupgradeneeded</span>: <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line">  <span class="keyword">const</span> transaction = event.<span class="property">currentTarget</span>.<span class="property">transaction</span>;</span><br><span class="line">  <span class="keyword">const</span> roleObjectStore = db.<span class="title function_">createObjectStore</span>(<span class="string">&quot;role&quot;</span>, &#123; <span class="attr">keyPath</span>: <span class="string">&quot;id&quot;</span>, <span class="attr">autoIncrement</span>: <span class="literal">true</span>, &#125;);</span><br><span class="line">  roleObjectStore.<span class="title function_">add</span>(&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;admin&quot;</span>, <span class="attr">createTime</span>: <span class="string">&quot;2023-11-11&quot;</span> &#125;);</span><br><span class="line">  roleObjectStore.<span class="title function_">add</span>(&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;teacher&quot;</span>, <span class="attr">createTime</span>: <span class="string">&quot;2023-11-11&quot;</span> &#125;);</span><br><span class="line">  roleObjectStore.<span class="title function_">add</span>(&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;student&quot;</span>, <span class="attr">createTime</span>: <span class="string">&quot;2023-11-11&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> myStore = transaction.<span class="title function_">objectStore</span>(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">  myStore.<span class="title function_">openCursor</span>().<span class="property">onsuccess</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> cursor = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line">    <span class="keyword">if</span> (cursor) &#123;</span><br><span class="line">      <span class="keyword">const</span> updateData = cursor.<span class="property">value</span>;</span><br><span class="line">      updateData.<span class="property">phone</span> = <span class="string">`0000000`</span> + updateData.<span class="property">id</span>;</span><br><span class="line">      cursor.<span class="title function_">update</span>(updateData).<span class="property">onsuccess</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;updateData.name&#125;</span>æ›´æ–°äº†æ•°æ®`</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      cursor.<span class="title function_">continue</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Entries all displayed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ‰§è¡Œäº†è¿™ä¸ªä»£ç ä»¥å, è€ç‰ˆæœ¬çš„æ•°æ®åº“å°±æ— æ³•è®¿é—®äº†.</p><h3 id="07-IDBTransaction"><a href="#07-IDBTransaction" class="headerlink" title="07. IDBTransaction"></a>07. IDBTransaction</h3><p>ä¹Ÿå°±æ˜¯ <code>trans1</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> trans1 = db.<span class="title function_">transaction</span>(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;readwrite&quot;</span>);</span><br></pre></td></tr></table></figure><p>æœ‰5ä¸ªå±æ€§</p><ol><li><code>db IDBDatabase</code> å¯¹è±¡çš„å¼•ç”¨</li><li><code>durability</code> å®šä¹‰äº†äº‹åŠ¡çš„æŒä¹…åŒ–è¡Œä¸ºï¼Œå³äº‹åŠ¡å¯¹æ•°æ®åº“çŠ¶æ€çš„æŒä¹…æ€§å½±å“ï¼ˆä½†æ˜¯æ˜¯åªè¯»çš„ï¼Œå…¶å®æˆ‘ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨ï¼‰</li><li><code>error</code> å¦‚æœäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯ï¼Œ<code>error</code> å±æ€§ä¼šè¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥é”™è¯¯çš„ <code>DOMError</code> å¯¹è±¡ã€‚</li><li><code>mode</code> ä½ åˆ›å»ºäº‹åŠ¡çš„æ˜¯ <code>mode</code></li><li><code>objectStoreNames</code> åŒ…å«æ­¤äº‹åŠ¡ä¸­æ‰€æœ‰å¯¹è±¡ä»“åº“åç§°çš„æ•°ç»„ã€‚</li></ol><p>3ä¸ªæ–¹æ³•</p><ol><li>abort() å°±æ˜¯ç›´æ¥ä¸­æ–­äº‹åŠ¡ï¼Œ ç„¶åå›æ»šï¼Œç„¶åä¼šè§¦å‘ <code>abort</code> äº‹ä»¶</li><li>commit() æäº¤äº‹åŠ¡</li><li>objectStore() è¿”å› <code>IDBObjectStore</code> å¯¹è±¡</li></ol><p>commit æ˜¯æˆ‘æ¯”è¾ƒç–‘æƒ‘çš„ä¸€ä¸ªç‚¹ï¼Œå› ä¸ºä¹‹å‰æˆ‘ä»æ¥æ²¡æœ‰ä½¿ç”¨ commit ä½†æ˜¯ä¾ç„¶å¯ä»¥æ­£å¸¸æäº¤</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line"><span class="keyword">const</span> transaction = db.<span class="title function_">transaction</span>(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;readwrite&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> objectStore = transaction.<span class="title function_">objectStore</span>(<span class="string">`user`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = &#123; <span class="attr">name</span>: <span class="string">&quot;tommy3&quot;</span>, <span class="attr">age</span>: <span class="string">&quot;18&quot;</span>, <span class="attr">sex</span>: <span class="number">1</span> &#125;;</span><br><span class="line">objectStore.<span class="title function_">add</span>(data);</span><br><span class="line">db.<span class="title function_">close</span>();</span><br></pre></td></tr></table></figure><p>æˆ‘å¯ä»¥ä¸åœçš„æ·»åŠ ï¼Œä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰å†™ <code>transaction.commit()</code>ï¼Œ </p><blockquote><p>Note that commit() doesnâ€™t normally have to be called â€” a transaction will automatically commit when all outstanding requests have been satisfied and no new requests have been made. commit() can be used to start the commit process without waiting for events from outstanding requests to be dispatched.</p></blockquote><p>æ²¡å¿…è¦æ˜¾å¼è°ƒç”¨ã€‚</p><p><strong>ä¸‰ä¸ªäº‹ä»¶</strong></p><ol><li><code>abort</code> äº‹åŠ¡æŠ¥é”™å’Œå–æ¶ˆçš„æ—¶å€™è§¦å‘</li><li><code>complete</code> äº‹åŠ¡å®Œæˆä¹‹åè§¦å‘</li><li><code>error</code></li></ol><h3 id="08-IDBObjectStore"><a href="#08-IDBObjectStore" class="headerlink" title="08. IDBObjectStore"></a>08. IDBObjectStore</h3><p>æ“ä½œæ•°æ®çš„æ ¸å¿ƒæ¥å£, åŒ…å«ä¸€å †å±æ€§å’Œæ–¹æ³•</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore">https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore</a></p><p>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„, å…¶å®ä½ æŒ¨ä¸ªè¯•ä¸€è¯•å°±çŸ¥é“æ€ä¹ˆç”¨äº†. </p><p>å”¯ä¸€å€¼å¾—ä¸€è¯´çš„æ˜¯æ¸¸æ ‡. ç¡®å®åœ¨å¤§é‡æ•°æ®éå†çš„æ—¶å€™, è¿˜æ˜¯å»ºè®®ä½¿ç”¨ä¸€ä¸‹.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">openCursor</span>()</span><br><span class="line"><span class="title function_">openCursor</span>(query)</span><br><span class="line"><span class="title function_">openCursor</span>(query, direction)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯å…·ä½“æ¸¸æ ‡çš„è¿”å›, å¯ä»¥ç›´æ¥ç¼–è¾‘æˆ–è€…åˆ é™¤, è¯¦æƒ…çœ‹ä¸‹é¢çš„é“¾æ¥</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBCursor">https://developer.mozilla.org/en-US/docs/Web/API/IDBCursor</a></p><h3 id="09-æ€»ç»“"><a href="#09-æ€»ç»“" class="headerlink" title="09. æ€»ç»“"></a>09. æ€»ç»“</h3><p>å…¶å®åˆ°è¿™é‡Œ, åŸºæœ¬ä½¿ç”¨å°±åº”è¯¥æ²¡æœ‰é—®é¢˜. è¯¥çŸ¥é“çš„æ–¹æ³•å°±éƒ½è¯¥çŸ¥é“äº†.</p><p>å‰©ä¸‹å°±æ˜¯çµæ´»åº”ç”¨çš„é—®é¢˜äº†.</p><p>è‡ªå·±å†™ä¸€ä¸ªåº”ç”¨å§</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> indexDB </tag>
            
            <tag> æµè§ˆå™¨å­˜å‚¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript this æŒ‡å‘</title>
      <link href="/2023/09/03/%5BQ102%5Djavascript_this_link/"/>
      <url>/2023/09/03/%5BQ102%5Djavascript_this_link/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-this-æŒ‡å‘"><a href="#01-this-æŒ‡å‘" class="headerlink" title="01. this æŒ‡å‘"></a>01. this æŒ‡å‘</h3><p>é¦–å…ˆéƒ½çŸ¥é“çš„, function ä¸­ this æŒ‡å‘åŸºäºè°ƒç”¨è€…, è°è°ƒç”¨ä½  this æŒ‡å‘è°.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">a</span> = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">a</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>)</span><br></pre></td></tr></table></figure><p>åšä¸€ä¸ªæœ€ç®€å•çš„æµ‹è¯•, è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1</span><br></pre></td></tr></table></figure><h3 id="02-bind-call-apply-æ”¹å˜-this"><a href="#02-bind-call-apply-æ”¹å˜-this" class="headerlink" title="02. bind, call, apply æ”¹å˜ this"></a>02. bind, call, apply æ”¹å˜ this</h3><p>å¦‚æœå…¨æ˜¯æ­£å¸¸ fucntion é‚£ä¹ˆè‚¯å®š this å…¨éƒ¨æŒ‡å‘ window.</p><p>ä½†æ˜¯ä½ ä¸€é¢—ä½¿ç”¨ bind, call, apply æ”¹å˜ this æŒ‡å‘.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">a</span> = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">a</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = a.<span class="title function_">bind</span>(&#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">b</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = a.<span class="title function_">call</span>(&#123;&#125;, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d = a.<span class="title function_">apply</span>(&#123;&#125;, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>)</span><br></pre></td></tr></table></figure><p>è¯¦ç»†è¯­æ³•çœ‹ä¸‹é¢é“¾æ¥</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/bind">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/bind</a></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/apply">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/apply</a></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call</a></p><h3 id="03-new"><a href="#03-new" class="headerlink" title="03. new"></a>03. new</h3><p>new å…³é”®å­—, åˆ›å»ºä¸€ä¸ªå¯¹è±¡, å¹¶ä¸”è®©è¿™ä¸ªå¯¹è±¡ç»§æ‰¿æ„é€ å‡½æ•°çš„åŸå‹, è¯¦æƒ…å¯è§ <a href="/tblog/2023/07/03/js_new/">javascript new åšäº†ä»€ä¹ˆï¼Ÿ</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">d</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">d_v</span> = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> d1 = <span class="keyword">new</span> <span class="title function_">d</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`const d1 = new d();`</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;window this.d_v:&quot;</span>, <span class="variable language_">this</span>.<span class="property">d_v</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;window d1.d_v:&quot;</span>, d1.<span class="property">d_v</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_new</span>(<span class="params">func, ...params</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œå¹¶ä¸”æŠŠåŸå‹é“¾å‰¯æµ…æ‹·è´åˆ°æ–°çš„å¯¹è±¡ä¸­</span></span><br><span class="line">    <span class="comment">//func.prototype </span></span><br><span class="line">    <span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(func.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">    <span class="comment">//è°ƒç”¨ func, å¹¶ä¸”ä»¥ objä¸ºthis.</span></span><br><span class="line">    <span class="keyword">const</span> result = func.<span class="title function_">apply</span>(obj, params);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> o = result || obj;</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> d2 = <span class="title function_">_new</span>(d);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`const d2 = _new(d);`</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;window this.d_v:&quot;</span>, <span class="variable language_">this</span>.<span class="property">d_v</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;window d1.d_v:&quot;</span>, d1.<span class="property">d_v</span>);</span><br></pre></td></tr></table></figure><h3 id="04-åµŒå¥—-function"><a href="#04-åµŒå¥—-function" class="headerlink" title="04. åµŒå¥— function"></a>04. åµŒå¥— function</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">f_v</span> = <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">g</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">f</span>();</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">e</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">e_v</span> = <span class="number">7</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> h = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">h_v</span> = <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">e</span>();</span><br><span class="line">    <span class="title function_">h</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;g this.f_v:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">f_v</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;g this.e_v:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">e_v</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;g this.h_v:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">h_v</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> g1 = <span class="keyword">new</span> <span class="title function_">g</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;window this.f_v:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">f_v</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;window this.e_v:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">e_v</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;window this.h_v:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">h_v</span>);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">g this.f_v: undefined</span><br><span class="line">g this.e_v: 7</span><br><span class="line">g this.h_v: undefined</span><br><span class="line">window this.f_v: 5</span><br><span class="line">window this.e_v: undefined</span><br><span class="line">window this.h_v: 8</span><br></pre></td></tr></table></figure><ol><li>new g() å°† function g å†…éƒ¨ this åªæƒ³ g çš„åŸå‹é“¾</li><li>f() å†…éƒ¨ this æŒ‡å‘ window</li><li>e() ç®­å¤´å‡½æ•°æŒ‡å‘ g åŸå‹é“¾</li><li>h() å‡½æ•° this æŒ‡å‘ window</li></ol><p>ä¹Ÿå°±æ˜¯è¯´å‡½æ•°åµŒå¥—ä¸‹å±‚å‡½æ•° this æŒ‡å‘æ˜¯ window</p><h3 id="05-ç®­å¤´å‡½æ•°"><a href="#05-ç®­å¤´å‡½æ•°" class="headerlink" title="05. ç®­å¤´å‡½æ•°"></a>05. ç®­å¤´å‡½æ•°</h3><p>ä¸Šé¢çš„ä¾‹å­å·²ç»è¯´æ˜äº† this æŒ‡å‘çš„è§„åˆ™,</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">() =&gt; &#123;&#125;</span><br></pre></td></tr></table></figure><p>é‡Œé¢ this æŒ‡å‘ä¸Šå±‚.</p><h3 id="06-object"><a href="#06-object" class="headerlink" title="06. object"></a>06. object</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> i = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">getB</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`getB`</span>, <span class="variable language_">this</span>.<span class="property">b</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getA</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`getA`</span>, <span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getB</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getB1</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`getB1`</span>, <span class="variable language_">this</span>.<span class="property">b</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">i.<span class="title function_">getA</span>();</span><br><span class="line">i.<span class="title function_">getB1</span>();</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">undefined</span><br></pre></td></tr></table></figure><h3 id="07-ç®€å•æ€»ç»“"><a href="#07-ç®€å•æ€»ç»“" class="headerlink" title="07. ç®€å•æ€»ç»“."></a>07. ç®€å•æ€»ç»“.</h3><p>this ä½ ç”¨ function å¤§éƒ½æŒ‡å‘ window.</p><p>é™¤éä½ ä½¿ç”¨ object æˆ–è€… ä½¿ç”¨ apply, new ä¹‹ç±»çš„æ–¹å¼æ”¹å˜ this æŒ‡å‘.</p><p>ä½†æ˜¯å¦‚æœä½ æ”¹å˜æŒ‡å‘çš„ä¸‹å±‚, ä½ ç»§ç»­ä½¿ç”¨function ä»–è¿˜æ˜¯ä¼šæŒ‡å‘ window.</p><p>è¿™ä¸ªä½¿ç”¨ä½¿ç”¨ç®­å¤´å‡½æ•°, æŒ‡å‘ä¸Šå±‚.</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> this </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flex å±æ€§è¯¦è§£</title>
      <link href="/2023/09/01/%5BQ101%5DFlex_attr/"/>
      <url>/2023/09/01/%5BQ101%5DFlex_attr/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>å†™è¿™ä¸ªçš„ç›®çš„æ˜¯ä¸ºäº†è¯¦ç»†è§£é‡Šä¸€ä¸‹ flex æ¯ä¸ªå±æ€§çš„æ„ä¹‰å’Œç”¨æ³•, åŸå› æ˜¯å› ä¸ºçªç„¶å‘è§‰æˆ‘è‡ªå·±å¯¹äº flex ç»†èŠ‚å¹¶ä¸æ˜¯å®Œå…¨æ¸…æ¥š</p><h3 id="01-flex-direction"><a href="#01-flex-direction" class="headerlink" title="01. flex-direction"></a>01. flex-direction</h3><p>flex-direction å†³å®šä¸»è½´çš„æ–¹å‘ï¼ˆå³é¡¹ç›®çš„æ’åˆ—æ–¹å‘ï¼‰</p><p>é¦–å…ˆéœ€è¦æ³¨æ„çš„æ˜¯ä¸»è½´çš„æ–¹å‘, é»˜è®¤æ˜¯æ°´å¹³æ–¹å‘, å³ä»å·¦åˆ°å³, æ°´å¹³æ–¹å‘æ˜¯ä¸»è½´, å‚ç›´æ–¹å‘æ˜¯äº¤å‰è½´</p><p><a href="/img/bg2015071004.png" title="alt text" class="gallery-item" style="box-shadow: none;"> <img src="/img/bg2015071004.png" alt="alt text"></a></p><p>ä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­ main axis, äº¤å‰è½´æ˜¯ cross axis.</p><p>ä¸¤ä¸ªå¯ä»¥ç›¸äº’äº¤æ¢</p><p>ä¹Ÿå°±æ˜¯è¯´ main axis ä¸ºäº¤å‰è½´, cross axis ä¸ºä¸»è½´.</p><p>å…¶ä¸­ flex-direction å±æ€§æœ‰ 4 ä¸ªå–å€¼</p><ul><li>row-reverse </li><li>column-reverse</li><li>row</li><li>column</li></ul><p>é»˜è®¤å€¼æ˜¯ row, ä¹Ÿå°±æ˜¯æ™®é€šçš„æ°´å¹³æ’åˆ—, å¦‚æœ column å°±æ˜¯å‚ç›´æ’åˆ—.</p><p>å¦‚æœæ˜¯åè½¬ row-reverse, column-reverse .</p><p>row-reverse å°±æ˜¯ä»å³åˆ°å·¦, column-reverse å°±æ˜¯ä»ä¸‹åˆ°ä¸Š</p><p>åªæ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ row-reverse æ˜¯çœŸçš„å…¨éƒ¨ä»å³åˆ°å·¦, æ•´ä¸ªå¸ƒå±€éƒ½æ˜¯å³å¯¹é½äº†.</p><p>ä½†æ˜¯ column-reverse åªæ˜¯æ•°æ®ä»ä¸‹åˆ°ä¸Š, å¯¹é½æ–¹å¼è¿˜æ˜¯ä»ä¸Šåˆ°ä¸‹</p><h3 id="02-flex-wrap"><a href="#02-flex-wrap" class="headerlink" title="02. flex-wrap"></a>02. flex-wrap</h3><p>flex-wrap å†³å®šå¦‚æœä¸€è¡Œæ’ä¸ä¸‹, æ˜¯å¦æ¢è¡Œ.</p><p>flex-wrap å±æ€§æœ‰ 3 ä¸ªå–å€¼</p><ul><li>nowrap</li><li>wrap-reverse</li><li>wrap</li></ul><p>é»˜è®¤å€¼æ˜¯ nowrap, ä¹Ÿå°±æ˜¯ä¸æ¢è¡Œ.<br>wrap-reverse å°±æ˜¯ä»ä¸‹åˆ°ä¸Š, ä¹Ÿå°±æ˜¯ä»å·¦åˆ°å³<br>wrap-reverse æ¢è¡Œ, ä»ä¸Šåˆ°ä¸‹, ä»å·¦åˆ°å³.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">flex-direction</span>: row;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: black;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>:white</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å½“ <code>flex-warp: nowrap</code> æ—¶, ä¹Ÿå°±æ˜¯é»˜è®¤å€¼. ä¸ç®¡æˆ‘æœ‰å¤šå°‘ä¸ª <code>box</code>, éƒ½åªä¼šåœ¨ä¸€è¡Œæ˜¾ç¤º, ä»–åªä¼šæŒ‰æ¯”ä¾‹ç¼©å°æ¯ä¸€ä¸ª <code>box</code>.</p><p>å¦‚æœé‡‡ç”¨ <code>flex-warp: wrap</code>, ä¹Ÿå°±æ˜¯è‡ªåŠ¨æ¢è¡Œ. è¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºç°æ¢è¡Œçš„æƒ…å†µ. æ’ä¸ä¸‹äº†å°±è‡ªåŠ¨æ¢.</p><p><code>wrap-reverse</code> è‡ªåŠ¨æ¢è¡Œ, åªæ˜¯ç¬¬ä¸€è¡Œåœ¨å·¦ä¸‹æ–¹, ä¹Ÿæ˜¯ä»å·¦åˆ°å³.</p><h3 id="03-flex-flow"><a href="#03-flex-flow" class="headerlink" title="03. flex-flow"></a>03. flex-flow</h3><p>è¿™ä¸ªæ¯”è¾ƒç®€å•</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">flex-flow</span>: &lt;flex-direction&gt; || &lt;flex-wrap&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯å‰é¢ä¸¤ä¸ªçš„ç»“åˆ</p><h3 id="04-justify-content"><a href="#04-justify-content" class="headerlink" title="04. justify-content"></a>04. justify-content</h3><p>justify-content å±æ€§å®šä¹‰äº†é¡¹ç›®åœ¨ä¸»è½´ä¸Šçš„å¯¹é½æ–¹å¼.</p><p>åªæ˜¯ä¸»è½´çš„å¯¹é½æ–¹å¼, è¿™ä¸ªå’Œ flex-direction æœ‰å…³.</p><p>justify-content å±æ€§æœ‰ 6 ä¸ªå–å€¼,</p><ul><li>flex-start</li><li>flex-end</li><li>center</li><li>space-between</li><li>space-around</li><li>space-evenly</li></ul><p>é»˜è®¤å€¼æ˜¯ flex-start, ä¹Ÿå°±æ˜¯ä»å·¦åˆ°å³</p><p>flex-end å°±æ˜¯ä»å³åˆ°å·¦</p><p>center å°±æ˜¯å±…ä¸­</p><p>space-between å°±æ˜¯ä¸¤ç«¯å¯¹é½, ä¹Ÿå°±æ˜¯ä¸¤è¾¹ç•™ç™½, ä¸­é—´å¯¹é½</p><p>space-around å°±æ˜¯ä¸¤è¾¹ç•™ç™½, ä¸¤è¾¹å¯¹é½, ä¸­é—´å¯¹é½</p><p>space-evenly å°±æ˜¯ä¸¤è¾¹ç•™ç™½, ä¸¤è¾¹å¯¹é½, ä¸­é—´å¯¹é½</p><p><a href="/image/image.png" title="Alt text" class="gallery-item" style="box-shadow: none;"> <img src="/image/image.png" alt="Alt text"></a></p><h3 id="05-align-items"><a href="#05-align-items" class="headerlink" title="05. align-items"></a>05. align-items</h3><p><code>align-items</code> å±æ€§å®šä¹‰é¡¹ç›®åœ¨äº¤å‰è½´ä¸Šå¦‚ä½•å¯¹é½ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">align-items</span>: flex-start | flex-end | center | baseline | stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>flex-start äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½.</p><p>flex-end äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½.</p><p>center äº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½.</p><p>baseline é¡¹ç›®çš„ç¬¬ä¸€è¡Œæ–‡å­—çš„åŸºçº¿å¯¹é½.</p><p>stretch å¦‚æœé¡¹ç›®æœªè®¾ç½®é«˜åº¦æˆ–è®¾ä¸ºauto, å°†å æ»¡æ•´ä¸ªå®¹å™¨çš„é«˜åº¦.</p></blockquote><p><a href="/image/image01.png" title="Alt text" class="gallery-item" style="box-shadow: none;"> <img src="/image/image01.png" alt="Alt text"></a></p><p>è¿™é‡Œåªæ˜¯é’ˆå¯¹äº¤å‰è½´, éœ€è¦æ˜ç™½ä¹‹å‰é‚£å¼ å›¾,æ²¡æœ‰è®¾ç½®é«˜åº¦çš„æƒ…å†µä¸‹, é»˜è®¤æ˜¯å æ»¡æ•´ä¸ªå®¹å™¨çš„é«˜åº¦.</p><p>æ‰€ä»¥äº¤å‰è½´å°±æ˜¯åœ¨è¿™ä¸ªé«˜åº¦ä¸‹å»æµ®åŠ¨.</p><p>è¿™é‡Œ baseline æ¯”è¾ƒç‰¹æ®Š, ä»–æ˜¯æ ¹æ®æ–‡å­—çš„åŸºçº¿å»å¯¹é½.</p><p>è¿™ä¸ªåœ¨éœ€è¦æ–‡å­—,å›¾ç‰‡,icon å¯¹é½çš„æ—¶å€™å°±æœ‰ç”¨äº†.</p><blockquote><p>stretch å¦‚æœé¡¹ç›®æœªè®¾ç½®é«˜åº¦æˆ–è®¾ä¸ºauto, å°†å æ»¡æ•´ä¸ªå®¹å™¨çš„é«˜åº¦.</p></blockquote><p><code>stretch</code> æ˜¯é»˜è®¤å€¼, ä¸ç®¡ä½ æ˜¯å¦è®¾ç½® <code>align-items</code>, éƒ½ä¼šè§¦å‘.</p><p>ä¹Ÿå°±æ˜¯è¯´ <code>flex</code> å®¹å™¨å¦‚æœè®¾ç½®äº†é«˜åº¦, æ¯”å¦‚ <strong>600px</strong> , <code>flex</code> å®¹å™¨å†…å®¹æœ‰ä¸‰è¡Œ. é‚£ä¹ˆæ¯ä¸ªå®¹å™¨éƒ½æ˜¯ <strong>200px</strong> é«˜åº¦</p><h3 id="06-align-content"><a href="#06-align-content" class="headerlink" title="06. align-content"></a>06. align-content</h3><p>è¿™ä¸ªå…¶å®æ˜¯æˆ‘å½“æ—¶çš„ä¸€ä¸ªç–‘æƒ‘ç‚¹</p><blockquote><p>align-contentå±æ€§å®šä¹‰äº†å¤šæ ¹è½´çº¿çš„å¯¹é½æ–¹å¼ã€‚å¦‚æœé¡¹ç›®åªæœ‰ä¸€æ ¹è½´çº¿ï¼Œè¯¥å±æ€§ä¸èµ·ä½œç”¨ã€‚</p></blockquote><p>é¦–å…ˆä»€ä¹ˆäº‹å¤šä¸ªè½´çº¿? ä¸æ˜¯æœ‰å¤šä¸ªä¸»è½´æˆ–è€…å¤šä¸ªäº¤å‰è½´. è€Œæ˜¯å•è¡Œçš„æƒ…å†µ, å°±è®¤ä¸ºæ²¡æœ‰äº¤å‰è½´,ä¹Ÿå°±æ˜¯åªæœ‰ä¸»è½´.</p><p>æ‰€ä»¥ <code>align-content</code> æ¢å¥è¯è¯´,å°±æ˜¯å•è¡Œæƒ…å†µä¸‹ä¸ç”Ÿæ•ˆ. è‡³å°‘ä¸¤è¡Œæ‰èƒ½ç”Ÿæ•ˆ</p><p>é‚£ä¹ˆ <code>align-items</code> å’Œ <code>align-content</code> æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢?</p><p><code>align-items</code> æ˜¯é’ˆå¯¹å•ä¸ªå®¹å™¨å†…å®¹åœ¨äº¤å‰è½´çš„å¯¹é½æ–¹å¼.</p><p><code>align-content</code> çš„è®¾ç½®å¯¹è±¡æ˜¯æ‰€æœ‰è¡Œ.</p><blockquote><p>flex-startï¼šä¸äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ã€‚</p><p>flex-endï¼šä¸äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚</p><p>centerï¼šä¸äº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚</p><p>space-betweenï¼šä¸äº¤å‰è½´ä¸¤ç«¯å¯¹é½ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”å¹³å‡åˆ†å¸ƒã€‚</p><p>space-aroundï¼šæ¯æ ¹è½´çº¿ä¸¤ä¾§çš„é—´éš”éƒ½ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”æ¯”è½´çº¿ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚</p><p>stretchï¼ˆé»˜è®¤å€¼ï¼‰ï¼šè½´çº¿å æ»¡æ•´ä¸ªäº¤å‰è½´ã€‚</p></blockquote><p>å¯ä»¥çœ‹ä¸‹è¿™ä¸ªå›¾</p><p><a href="/img/image02.png" title="Alt text" class="gallery-item" style="box-shadow: none;"> <img src="/img/image02.png" alt="Alt text"></a></p><h3 id="07-å®¹å™¨æ€»ç»“"><a href="#07-å®¹å™¨æ€»ç»“" class="headerlink" title="07. å®¹å™¨æ€»ç»“"></a>07. å®¹å™¨æ€»ç»“</h3><p>ä¸Šé¢çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯åŸºäºå®¹å™¨çš„</p><ol><li><code>flex-direction</code> ä¸»è½´æ–¹å‘</li><li><code>flex-warp</code> å®¹å™¨æ˜¯å¦æ¢è¡Œå’Œæ¢è¡Œçš„æ–¹å¼</li><li><code>flex-flow</code> æ˜¯ä¸Šé¢ä¸¤ä¸ªå±æ€§çš„åˆå¹¶</li><li><code>justify-content</code> ä¸»è½´å¯¹é½æ–¹å¼</li><li><code>align-items</code> äº¤å‰è½´å¯¹é½æ–¹å¼</li><li><code>align-content</code> äº¤å‰è½´å¤šè¡Œå¯¹é½æ–¹å¼</li></ol><p>ä¸Šé¢å·²ç»èƒ½åšå¾ˆå¤šäº‹æƒ…äº†</p><p>æ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„å‚ç›´å±…ä¸­ï¼Œ å°±åªéœ€è¦ </p><p><code>justify-content</code> ä¸»è½´å¯¹é½æ–¹å¼<br><code>align-items</code> äº¤å‰è½´å¯¹é½æ–¹å¼</p><p>ä¸¤ä¸ªå¯¹é½å°±okäº†ã€‚</p><h3 id="08-order"><a href="#08-order" class="headerlink" title="08. order"></a>08. order</h3><p>è¿™ä¸ªå±æ€§æ˜¯æˆ‘ä¹‹å‰å®Œå…¨å¿½ç•¥çš„å±æ€§</p><blockquote><p>orderå±æ€§å®šä¹‰é¡¹ç›®çš„æ’åˆ—é¡ºåºã€‚æ•°å€¼è¶Šå°ï¼Œæ’åˆ—è¶Šé å‰ï¼Œé»˜è®¤ä¸º0ã€‚</p></blockquote><p>ç»è¿‡ä¸€ä¸ªç®€å•çš„æµ‹è¯• </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span> <span class="attr">style</span>=<span class="string">&quot;order:99&quot;</span>&gt;</span>5(order 99)<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span> <span class="attr">style</span>=<span class="string">&quot;order:100&quot;</span>&gt;</span>6(order 100)<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ <code>order</code> æ’åºè¶Šå°è¶Šåœ¨å‰é¢ï¼Œä½†æ˜¯å‰ææ˜¯åœ¨æœ‰orderè®¾ç½®é‡Œé¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘å°† order è®¾ç½®ä¸º0 æˆ–è€…ä¸è®¾ç½®ï¼Œé‚£ä¹ˆä»–ä»¬æ°¸è¿œæ˜¯æ ¹æ®domé¡ºåºæ¥ã€‚è®¾ç½® <code>order</code> åªèƒ½æ’åé¢</p><h3 id="09-flex-grow"><a href="#09-flex-grow" class="headerlink" title="09. flex-grow"></a>09. flex-grow</h3><p>flex-grow æ”¾å¤§æ¯”ä¾‹</p><blockquote><p>flex-growå±æ€§å®šä¹‰é¡¹ç›®çš„æ”¾å¤§æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º0ï¼Œå³å¦‚æœå­˜åœ¨å‰©ä½™ç©ºé—´ï¼Œä¹Ÿä¸æ”¾å¤§ã€‚</p></blockquote><p>è¿™ä¸ªå±æ€§æ˜¯é’ˆå¯¹å‰©ä½™ç©ºé—´çš„ï¼Œå¦‚æœç©ºé—´ä¸è¶³ï¼Œé‚£ä¹ˆå°±æŒ‰ç…§æ¯”ä¾‹åˆ†é…</p><p>äºæ˜¯æˆ‘æŒ‰ç…§è¿™ä¸ªæ€è·¯å†™äº†ä¸€ä¸ª</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.main</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">flex-direction</span>: row;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">800px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>:<span class="number">1px</span> solid black</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: black;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>:white;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">flex-grow</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span> <span class="attr">style</span>=<span class="string">&quot;flex-grow: 3&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>6<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>7<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç»“æœæˆ‘å‘ç°ä¸å¯¹ï¼Œ å› ä¸º3å¹¶æ²¡æœ‰å…¶ä»–çš„ä¸¤å€ï¼Œä½†æ˜¯ä¸‹é¢è¿™ä¸ªé“¾æ¥åˆæ˜¯okçš„</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/flex-grow">https://developer.mozilla.org/zh-CN/docs/Web/CSS/flex-grow</a></p><p>è¿™ç‚¹æˆ‘éå¸¸ç–‘æƒ‘ï¼Œåç»­å†ç ”ç©¶å§ã€‚</p><h3 id="10-flex-shrink"><a href="#10-flex-shrink" class="headerlink" title="10. flex-shrink"></a>10. flex-shrink</h3><blockquote><p>flex-shrinkå±æ€§å®šä¹‰äº†é¡¹ç›®çš„ç¼©å°æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º1ï¼Œå³å¦‚æœç©ºé—´ä¸è¶³ï¼Œè¯¥é¡¹ç›®å°†ç¼©å°ã€‚</p></blockquote><p>æ€ä¹ˆç†è§£å‘¢ï¼Ÿ</p><blockquote><p>å­å…ƒç´ å½“çˆ¶å…ƒç´ å®½åº¦ä¸å¤Ÿç”¨æ—¶ï¼Œè‡ªå·±è°ƒæ•´è‡ªå·±æ‰€å çš„å®½åº¦æ¯”ï¼Œè¿™ä¸ªflex-shrinkè®¾ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ‰€æœ‰å­å…ƒç´ å¤§å®¶åŒæ—¶ç¼©å°æ¥é€‚åº”æ€»å®½åº¦ã€‚å½“flex-shrinkè®¾ç½®ä¸º0æ—¶ï¼Œè¡¨ç¤ºå¤§å®¶éƒ½ä¸ç¼©å°é€‚åº”</p></blockquote><p>å’Œ <code>flex-grow</code> ç±»ä¼¼, åªæ˜¯æœ‰ä¸€ä¸ªå‰æ, å¦‚æœç©ºé—´ä¸å¤Ÿçš„è¯.</p><p>æ¯”å¦‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, .<span class="number">2</span>);</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: <span class="number">3px</span> solid <span class="number">#00f</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">flex-shrink</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span> <span class="attr">style</span>=<span class="string">&quot;flex-shrink:2&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿˜æœ‰å°±æ˜¯ä¹Ÿå‡ºç°äº†, å¹¶æ²¡æœ‰ç­‰æ¯”ç¼©å°. è¿™ä¸ªå…·ä½“è¿˜è¦åé¢å­¦ä¹ </p><h3 id="11-flex-basis"><a href="#11-flex-basis" class="headerlink" title="11. flex-basis"></a>11. flex-basis</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/flex-basis">https://developer.mozilla.org/zh-CN/docs/Web/CSS/flex-basis</a></p><blockquote><p>CSS å±æ€§ flex-basis æŒ‡å®šäº† flex å…ƒç´ åœ¨ä¸»è½´æ–¹å‘ä¸Šçš„åˆå§‹å¤§å°ã€‚å¦‚æœä¸ä½¿ç”¨ box-sizing æ”¹å˜ç›’æ¨¡å‹çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§å°±å†³å®šäº† flex å…ƒç´ çš„å†…å®¹ç›’ï¼ˆcontent-boxï¼‰çš„å°ºå¯¸ã€‚</p><p>å®ƒå¯ä»¥è®¾ä¸ºè·Ÿwidthæˆ–heightå±æ€§ä¸€æ ·çš„å€¼ï¼ˆæ¯”å¦‚350pxï¼‰ï¼Œåˆ™é¡¹ç›®å°†å æ®å›ºå®šç©º</p></blockquote><h3 id="12-flex"><a href="#12-flex" class="headerlink" title="12. flex"></a>12. flex</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flex</span>: none | [ &lt;<span class="string">&#x27;flex-grow&#x27;</span>&gt; &lt;<span class="string">&#x27;flex-shrink&#x27;</span>&gt;? || &lt;<span class="string">&#x27;flex-basis&#x27;</span>&gt; ]</span><br></pre></td></tr></table></figure><h3 id="13-align-self"><a href="#13-align-self" class="headerlink" title="13. align-self"></a>13. align-self</h3><blockquote><p>align-selfå±æ€§å…è®¸å•ä¸ªé¡¹ç›®æœ‰ä¸å…¶ä»–é¡¹ç›®ä¸ä¸€æ ·çš„å¯¹é½æ–¹å¼ï¼Œå¯è¦†ç›–align-itemså±æ€§ã€‚é»˜è®¤å€¼ä¸ºautoï¼Œè¡¨ç¤ºç»§æ‰¿çˆ¶å…ƒç´ çš„align-itemså±æ€§ï¼Œå¦‚æœæ²¡æœ‰çˆ¶å…ƒç´ ï¼Œåˆ™ç­‰åŒäºstretchã€‚</p></blockquote><p>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„, å¦‚æœä½ å‰é¢ç†è§£äº†åé¢ä¹Ÿç†è§£äº†.</p><h3 id="14-æ€»ç»“"><a href="#14-æ€»ç»“" class="headerlink" title="14. æ€»ç»“."></a>14. æ€»ç»“.</h3><p>flex åˆ†ä¸ºä¸»è½´å’Œäº¤å‰è½´, ä¸¤è€…å¯ç›¸äº’äº¤æ¢, å¯ä»¥ä½¿ç”¨ flex-dirction è¿›è¡Œæ§åˆ¶.</p><p>flex é»˜è®¤ä¸æ¢è¡Œ, ä½ å¯ä»¥ä½¿ç”¨ flex-wrap è¿›è¡Œæ¢è¡Œæ§åˆ¶.</p><p>flex-flow å¯¹ä¸Šé¢ä¸¤ä¸ªè¿›è¡Œç»„åˆ. flex-flow: flex-direction flex-wrap</p><p>justify-content æ§åˆ¶ä¸»è½´å¯¹é½æ–¹å¼.</p><p>align-items æ§åˆ¶äº¤å‰è½´å¯¹é½æ–¹å¼.</p><p>align-content æ§åˆ¶å¤šæ ¹è½´çº¿çš„å¯¹é½æ–¹å¼(ä¹Ÿå°±æ˜¯æ•´ä½“é¡¹ç›®, è€Œä¸æ˜¯å•ç‹¬æŸä¸ªbox)</p><p>ä¸Šé¢å°±æ˜¯ flex é¡¹ç›®æ•´ä½“çš„æ“ä½œ, æ¥ä¸‹æ¥æ˜¯æ¯ä¸ªå®¹å™¨æ“ä½œ</p><p>order å¯ä»¥è§„å®šå®¹å™¨æ˜¾ç¤ºé¡ºåº</p><p>flex-grow å¯ä»¥è§„å®šå®¹å™¨æ”¾å¤§æ¯”ä¾‹</p><p>flex-shrink å¯ä»¥è§„å®šå®¹å™¨ç¼©å°æ¯”ä¾‹</p><p>flex-basis å¯ä»¥è§„å®šå®¹å™¨åˆå§‹å¤§å°</p><p>flex å¯ä»¥è§„å®šå®¹å™¨æ”¾å¤§ç¼©å°æ¯”ä¾‹å’Œåˆå§‹å¤§å°</p><p>align-self å¯ä»¥è§„å®šå®¹å™¨å•ç‹¬äº¤å‰è½´å¯¹é½æ–¹å¼</p><p>å¤§æ¦‚å¾—è¯­æ³•å°±æ˜¯è¿™æ ·äº†, åç»­æˆ‘ä¼šåŸºäºæˆ‘çš„ç–‘æƒ‘ç‚¹åœ¨å­¦ä¹ </p><p><a href="https://www.cnblogs.com/cblx/p/12272729.htm">https://www.cnblogs.com/cblx/p/12272729.htm</a></p></div>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> flex </tag>
            
            <tag> html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾®ä¿¡å…¬ä¼—å·ç½‘é¡µè¸©å‘ï¼Ÿ</title>
      <link href="/2023/09/01/%5Bwechat%5Dwechat_website/"/>
      <url>/2023/09/01/%5Bwechat%5Dwechat_website/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-å¼€å‘è€…å·¥å…·æç¤ºæœªå…³æ³¨è¯¥æµ‹è¯•å·ï¼Ÿ"><a href="#01-å¼€å‘è€…å·¥å…·æç¤ºæœªå…³æ³¨è¯¥æµ‹è¯•å·ï¼Ÿ" class="headerlink" title="01. å¼€å‘è€…å·¥å…·æç¤ºæœªå…³æ³¨è¯¥æµ‹è¯•å·ï¼Ÿ"></a>01. å¼€å‘è€…å·¥å…·æç¤ºæœªå…³æ³¨è¯¥æµ‹è¯•å·ï¼Ÿ</h3><p><a href="https://learnku.com/laravel/t/7831/the-developer-tooltip-does-not-pay-attention-to-the-test-number">https://learnku.com/laravel/t/7831/the-developer-tooltip-does-not-pay-attention-to-the-test-number</a></p><p>è™½ç„¶æ˜¯äº”å¹´å‰çš„å›ç­”, ä½†æ˜¯èƒ½è§£å†³é—®é¢˜</p><p>æ‰«ç å…³æ³¨å³å¯.</p><h3 id="02-å¦‚æœè·å–-openId"><a href="#02-å¦‚æœè·å–-openId" class="headerlink" title="02. å¦‚æœè·å– openId"></a>02. å¦‚æœè·å– openId</h3><p>é¦–å…ˆä½ éœ€è¦çŸ¥é“ openId å’Œ unionid çš„åŒºåˆ«</p><p>ç½‘ä¸Šéšæ„ä¸€ç¯‡æ–‡ç« å°±èƒ½è§£é‡Šæ¸…æ¥š</p><p><a href="https://blog.csdn.net/naocan10211050/article/details/123865184">https://blog.csdn.net/naocan10211050/article/details/123865184</a></p><p>ä¸€ä¸ªå¤šåº”ç”¨å”¯ä¸€ï¼Œä¸€ä¸ªå•åº”ç”¨å”¯ä¸€ã€‚</p><p>å¦‚ä½•è·å–ï¼Œæµç¨‹å¤§è‡´æ˜¯</p><ol><li>ç”¨æˆ·å…³æ³¨å…¬ä¼—å·</li><li>ç”¨æˆ·ç‚¹å‡»ç½‘é¡µæˆæƒ</li><li>æœåŠ¡å™¨è·å–åˆ° code</li><li>æœåŠ¡å™¨é€šè¿‡ code è·å– openId</li></ol><p>è‡³äºå…·ä½“ä»£ç ï¼Œæœ‰å¾ˆå¤šsdkï¼Œä¸æƒ³è‡ªå·±å†™å°±ç”¨sdkå°±å¥½ã€‚</p><h3 id="03-æœ¬åœ°è°ƒè¯•"><a href="#03-æœ¬åœ°è°ƒè¯•" class="headerlink" title="03. æœ¬åœ°è°ƒè¯•"></a>03. æœ¬åœ°è°ƒè¯•</h3><p>é¦–å…ˆä½ éœ€è¦æœ‰ appId å’Œ appSecretï¼Œå…¶æ¬¡ä½ å…³æ³¨äº†æµ‹è¯•å·ï¼Œæ˜¯å¼€å‘è€…ã€‚</p><p>ç„¶ååœ¨</p><p><a href="/%5Cimg%5C528c7feafa5a997a4d00099ac5926804.png" title="Alt text" class="gallery-item" style="box-shadow: none;"> <img src="/%5Cimg%5C528c7feafa5a997a4d00099ac5926804.png" alt="Alt text"></a></p><p>è¿™ä¸ªä½ç½®è¾“å…¥ä½ çš„æµ‹è¯•åœ°å€ï¼Œå¯ä»¥æ˜¯æœ¬åœ°åœ°å€ï¼Œåœ¨æµ‹è¯•çš„æ—¶å€™ã€‚</p><p>å¦‚æœéœ€è¦è°ƒè¯•æœåŠ¡ç«¯ï¼Œæ¯”å¦‚ä½ å·²ç»éƒ¨ç½²ä¸Šå»äº†ï¼Œæƒ³è°ƒè¯•ï¼Œä½†æ˜¯æœåŠ¡åˆå¿…é¡»ç™»å½•ã€‚</p><p>å¯ä»¥æ”¹hostæˆ–è€…ä½¿ç”¨nginxã€‚</p><p>æˆ‘ä¸€èˆ¬ç”¨hostï¼Œç„¶ååœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­è°ƒè¯•ã€‚</p><h3 id="04-è¿”å›ã€‚"><a href="#04-è¿”å›ã€‚" class="headerlink" title="04. è¿”å›ã€‚"></a>04. è¿”å›ã€‚</h3><p>å¾ˆå¤šæ—¶å€™åšç½‘é¡µä¸Šçš„ä¸œè¥¿ï¼Œä¸è®¾ç½®è¿”å›ã€‚</p><p>ä½†æ˜¯æ‰‹æœºä¸Šå¿…é¡»è¦ï¼Œä¸ç®¡æ˜¯å°ç¨‹åºè¿˜æ˜¯ç½‘é¡µã€‚</p><p>ç»å¸¸æ‰¾ä¸åˆ°è¿”å›åªèƒ½é æ‰‹æœºçš„è¿”å›å¿«æ·é”®ï¼Œå¯¼è‡´å°ç¨‹åºæˆ–è€…ç½‘é¡µç›´æ¥é€€å‡ºã€‚</p><h3 id="05-æ€»ç»“"><a href="#05-æ€»ç»“" class="headerlink" title="05. æ€»ç»“"></a>05. æ€»ç»“</h3><p>ç›®å‰å¤§æ¦‚è¿™ä¹ˆå¤šï¼Œè¿™æ–¹é¢ç»éªŒä¸ç®—ä¸°å¯Œã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> å¾®ä¿¡ </tag>
            
            <tag> å…¬ä¼—å· </tag>
            
            <tag> ç¯å¢ƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows docker å®‰è£…é‡åˆ°çš„å‘</title>
      <link href="/2023/08/29/wsl_can_not_boot/"/>
      <url>/2023/08/29/wsl_can_not_boot/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>å…¬å¸ç”µè„‘ docker windows å®‰è£…å®Œæˆä»¥å, æ‰“å¼€dockeræŠ¥é”™, wslæŠ¥é”™</p><p>äºæ˜¯å‘½ä»¤è¡ŒæŸ¥çœ‹ wsl â€“list å‘ç°å®‰è£…äº† wsl, åªæ˜¯æ²¡æœ‰åˆ†å‘ç‰ˆæœ¬</p><p>é‚£å°±å®‰è£…å‘—, äºæ˜¯é‡åˆ°äº†ç¬¬ä¸€ä¸ªé—®é¢˜</p><p><strong>microsoft store æ‰“ä¸å¼€, ä¸€ç›´è½¬åœˆ</strong></p><p>äºæ˜¯å„ç§æŸ¥èµ„æ–™, æ¯”å¦‚æ”¹ dns, æ”¹ç½‘ç»œè®¾ç½®, æ”¹ä¸€ç³»åˆ—çš„, åŠ ä»£ç†ä¹Ÿä¸è¡Œ.</p><p>æçš„æ²‰é»˜äº†.</p><p>äºæ˜¯ç®—äº†ç›´æ¥å‘½ä»¤è¡Œå®‰è£…å§</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl -d Ubuntu-20.04</span><br></pre></td></tr></table></figure><p>èƒ½ä¸‹è½½, ä½†æ˜¯å®‰è£…æŠ¥é”™, è¿˜æ˜¯ WSL æŠ¥é”™, çœŸçš„æ²‰é»˜äº†.</p><p>äºæ˜¯ä¸ºäº†è§£å†³é—®é¢˜, ç»§ç»­æŸ¥ä¸ºä»€ä¹ˆ WSL ä¸è¡Œ, è¯•ä¸€è¯• </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --update</span><br></pre></td></tr></table></figure><p>ç»“æœæ— æ³•å¯åŠ¨, ä¸ºä»€ä¹ˆæ— æ³•å¯åŠ¨, googleä¸€æŸ¥, æ˜¯å› ä¸º windows update æ²¡æœ‰æ‰“å¼€.</p><p>ä»¥ä¸ºé—®é¢˜è§£å†³äº†, ç»“æœæ— æ³•æ‰“å¼€, å› ä¸ºæ²¡æœ‰æƒé™..</p><p>ç›´æ¥æ³¨å†Œè¡¨ä¹Ÿä¸è¡Œ </p><p><strong>HKEY_LOCAL_MACHINESYSTEMCurrentControlSetServicesWaaSMedicSvc</strong></p><p>æ²¡æœ‰ wuauserv å®Œå…¨æ§åˆ¶æƒé™ã€‚</p><p>æ ¹æºæ˜¯æƒé™æ¥æºä¸å¯¹ï¼Œæ”¹æˆå¯¹åº”æƒé™ç»„å°±okäº†</p><p>è¯¦æƒ…å¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç«  </p><p><a href="https://www.bilibili.com/read/cv11939860/">https://www.bilibili.com/read/cv11939860/</a></p><p>å…è®¸ update ä»¥åï¼Œ å•†åº—ä¹Ÿèƒ½æ‰“å¼€äº†ã€‚</p><p>è§£å†³</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> windows </tag>
            
            <tag> update </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue3 createVNode &amp; render</title>
      <link href="/2023/08/27/vue3_plugin/"/>
      <url>/2023/08/27/vue3_plugin/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>ä¹‹å‰ç”¨ Vue2.x å†™äº†ä¸€ä¸ª loadingï¼Œæ€è·¯æ˜¯</p><p>å†™ä¸€ä¸ª vue æ–‡ä»¶ &#x3D;&gt; ä½¿ç”¨ Vue.extend åˆ›å»ºè™šæ‹Ÿdom &#x3D;&gt; å†™ä¸€ä¸ª install æ’ä»¶ï¼Œæ’ä»¶ä¸­å†™æ–¹æ³•è°ƒç”¨ vue æ–‡ä»¶ä¸­çš„å¼€å…³ </p><p>ç„¶åå°±å¯ä»¥åœ¨ vue æˆ–è€…å…¶ä»–æ–‡ä»¶ä¸­ä½¿ç”¨äº†ã€‚</p><p>Vue3 åŒºåˆ«ä¸å¤§ï¼Œåªæ˜¯ API æœ‰å˜åŒ–</p><h3 id="01-CreateVnode-amp-render"><a href="#01-CreateVnode-amp-render" class="headerlink" title="01. CreateVnode &amp; render"></a>01. CreateVnode &amp; render</h3><p>Vue2.x extend æ²¡æœ‰äº†ï¼Œä»–çš„ä½œç”¨æ˜¯ç»§æ‰¿ï¼Œå¹¶ä¸”åˆ›å»ºå’Œå®£ä¼ äº†ç»„ä»¶ã€‚</p><p>åœ¨ Vue3.x ä¸­ä½¿ç”¨ <code>CreateVnode</code> &amp; <code>render</code> æ¥ä»£æ›¿</p><p><code>CreateVnode</code> åˆ›å»ºè™šæ‹Ÿdomï¼Œ<code>render</code> æ¸²æŸ“çœŸå®dom</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createVNode, render &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> loading <span class="keyword">from</span> <span class="string">&quot;./Index.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> o = <span class="title function_">createVNode</span>(loading);</span><br><span class="line"><span class="keyword">const</span> mountNode = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line"><span class="title function_">render</span>(o, mountNode);</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(mountNode);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>) &#123;</span><br><span class="line">    app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$loading</span> = &#123;</span><br><span class="line">      <span class="attr">show</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        o.<span class="property">component</span>.<span class="property">exposed</span>.<span class="property">enableFlg</span>.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">hide</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        o.<span class="property">component</span>.<span class="property">exposed</span>.<span class="property">enableFlg</span>.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±åˆ›å»ºäº†ã€‚</p><h3 id="02-exposed"><a href="#02-exposed" class="headerlink" title="02. exposed"></a>02. exposed</h3><p>ä¹‹å‰ <strong>Vue2.x</strong> æ˜¯ç›´æ¥å¯ä»¥è®¿é—®å±æ€§çš„ï¼Œä½†æ˜¯ <strong>Vue3.x</strong> æ˜¯ä¸è¡Œçš„ï¼Œéœ€è¦è®¾ç½® <code>defineExpose</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;test11111&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;enableFlg&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        test</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref, defineExpose &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> enableFlg = <span class="title function_">ref</span>(<span class="literal">true</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">defineExpose</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    enableFlg</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="03-app-config-globalProperties"><a href="#03-app-config-globalProperties" class="headerlink" title="03. app.config.globalProperties"></a>03. app.config.globalProperties</h3><p><a href="https://cn.vuejs.org/api/application.html#app-config-globalproperties">https://cn.vuejs.org/api/application.html#app-config-globalproperties</a></p><blockquote><p>è¿™æ˜¯å¯¹ Vue 2 ä¸­ Vue.prototype ä½¿ç”¨æ–¹å¼çš„ä¸€ç§æ›¿ä»£ï¼Œæ­¤å†™æ³•åœ¨ Vue 3 å·²ç»ä¸å­˜åœ¨äº†ã€‚ä¸ä»»ä½•å…¨å±€çš„ä¸œè¥¿ä¸€æ ·ï¼Œåº”è¯¥è°¨æ…ä½¿ç”¨ã€‚</p><p>å¦‚æœå…¨å±€å±æ€§ä¸ç»„ä»¶è‡ªå·±çš„å±æ€§å†²çªï¼Œç»„ä»¶è‡ªå·±çš„å±æ€§å°†å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hello&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;show&quot;</span>&gt;</span>æ‰“å¼€<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;close&quot;</span>&gt;</span>å…³é—­<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; getCurrentInstance &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> instance = <span class="title function_">getCurrentInstance</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> show = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  instance.<span class="property">proxy</span>.<span class="property">$loading</span>.<span class="title function_">show</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> close = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  instance.<span class="property">proxy</span>.<span class="property">$loading</span>.<span class="title function_">hide</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> æ’ä»¶ </tag>
            
            <tag> createVNode </tag>
            
            <tag> render </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ºä»€ä¹ˆ npm install éœ€è¦ sudo</title>
      <link href="/2023/08/27/sudo_npm_install/"/>
      <url>/2023/08/27/sudo_npm_install/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>å…¶å®ä»¥å‰æˆ‘åœ¨linxuä¸‹å¼€å‘éƒ½æ˜¯ç›´æ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æœ‰æ—¶å€™ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨è¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start </span><br></pre></td></tr></table></figure><p>æˆ–è€…å…¶ä»–å‘½ä»¤çš„æ—¶å€™ä¼šé‡åˆ° <code>permission</code> é—®é¢˜, è¿™ä¸ªæ—¶å€™æˆ‘ä¸€èˆ¬é€‰ç”¨ä¸¤ç§è§£å†³åŠæ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install</span><br><span class="line">sudo chmod -R 755 /path/to/your/project/node_modules</span><br></pre></td></tr></table></figure><p>é—®é¢˜è§£å†³ã€‚</p><p>ä½†æ˜¯è¿™æ¬¡æˆ‘æƒ³çŸ¥é“æ˜¯ä¸ºä»€ä¹ˆï¼Œè¿™äº›é—®é¢˜åŸå› éƒ½æ˜¯å› ä¸ºæˆ‘å¿…é¡» <code>sudo npm install</code> å¯¼è‡´çš„, é‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦ <code>sudo</code></p><h3 id="01-ä¸ºä»€ä¹ˆéœ€è¦-sudo"><a href="#01-ä¸ºä»€ä¹ˆéœ€è¦-sudo" class="headerlink" title="01. ä¸ºä»€ä¹ˆéœ€è¦ sudo"></a>01. ä¸ºä»€ä¹ˆéœ€è¦ sudo</h3><p>æ­£å¸¸åªæ˜¯è®¿é—®ï¼Œå®‰è£…å½“å‰é¡¹ç›®æ˜¯ä¸éœ€è¦ sudo çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªä¸œè¥¿æ˜¯å…¨å±€çš„ï¼Œå°±æ˜¯å…¨å±€å®‰è£…çš„ä¸œè¥¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install xxx -g</span><br></pre></td></tr></table></figure><p>ä½ é¡¹ç›®ä¸­å¯èƒ½æœ‰ä¸€äº›ä¾èµ–ï¼Œä¸€äº›å…±äº«çš„ä¸œè¥¿ï¼Œåœ¨å®‰è£…è¿‡ç¨‹ä¸­å°±é‡è§äº†ã€‚</p><p>ç„¶è€Œå…¨å±€å®‰è£…ä¸€èˆ¬å®‰è£…åœ°å€æ˜¯åœ¨ <code>/usr/local</code> è¿™ç§ç³»ç»Ÿç›®å½•ä¸‹ï¼Œæ‰€ä»¥éœ€è¦ <code>sudo</code></p><h3 id="02-è§£å†³åŠæ³•"><a href="#02-è§£å†³åŠæ³•" class="headerlink" title="02. è§£å†³åŠæ³•"></a>02. è§£å†³åŠæ³•</h3><p>å°±æ˜¯ç§»åŠ¨å…¨å±€å®‰è£…åŒ…çš„ä½ç½®</p><p><a href="https://blog.csdn.net/m0_59757074/article/details/130893787">https://blog.csdn.net/m0_59757074/article/details/130893787</a></p><p>æˆ‘æŸ¥çœ‹äº†è¿™ç¯‡æ–‡ç« </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/.npm-global</span><br><span class="line">npm config set prefix &#x27;~/.npm-global&#x27;</span><br><span class="line">export PATH=~/.npm-global/bin:$PATH</span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure><p>æå®šã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®­å¤´å‡½æ•°æœ‰prototypeå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</title>
      <link href="/2023/08/20/%5BQ001%5DArrowFunctionvsFunction/"/>
      <url>/2023/08/20/%5BQ001%5DArrowFunctionvsFunction/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-x3D-gt-æœ‰æ²¡æœ‰åŸå‹é“¾"><a href="#01-x3D-gt-æœ‰æ²¡æœ‰åŸå‹é“¾" class="headerlink" title="01. () &#x3D;&gt; æœ‰æ²¡æœ‰åŸå‹é“¾"></a>01. () &#x3D;&gt; æœ‰æ²¡æœ‰åŸå‹é“¾</h3><p>è¿™ä¸ªæˆ‘å±…ç„¶çœŸä¸çŸ¥é“ï¼ŒçœŸæ²¡æœ‰æ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜</p><p>é¦–å…ˆæˆ‘çŸ¥é“ç®­å¤´å‡½æ•°æ˜¯ç›´æ¥ç»‘å®šçˆ¶çº§åˆ« this çš„, ä¹Ÿå°±ç±»ä¼¼äº</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _this = <span class="variable language_">this</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">    _this.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä»–ç¡®å®æ²¡åŸå‹é“¾</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">a</span> = (<span class="params"></span>) =&gt; &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> b = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">//undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">//&#123;constructor: Æ’&#125;</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºthisæŒ‡å‘ä¸Šå±‚çš„åŸå› , æ‰€ä»¥ä»–ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°</p><ul><li>ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ thisï¼Œè€Œæ˜¯ç»§æ‰¿çˆ¶ä½œç”¨åŸŸçš„ this</li><li>ä¸æ”¯æŒ call bindï¼Œæ”¹å˜ this æŒ‡å‘ã€‚</li><li>ä¸ç»‘å®š arguments</li><li>æ²¡æœ‰ prototype å±æ€§</li></ul><h3 id="02-ä¸ºä»€ä¹ˆä¸èƒ½-new"><a href="#02-ä¸ºä»€ä¹ˆä¸èƒ½-new" class="headerlink" title="02. ä¸ºä»€ä¹ˆä¸èƒ½ new"></a>02. ä¸ºä»€ä¹ˆä¸èƒ½ new</h3><p>é¦–å…ˆéœ€è¦çŸ¥é“ new åšäº†ä»€ä¹ˆ, <a href="/tblog/2023/07/03/js_new/">new åšäº†ä»€ä¹ˆï¼Ÿ</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_new</span>(<span class="params">func, ...params</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œå¹¶ä¸”æŠŠåŸå‹é“¾å‰¯æµ…æ‹·è´åˆ°æ–°çš„å¯¹è±¡ä¸­</span></span><br><span class="line"><span class="comment">//func.prototype </span></span><br><span class="line"><span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(func.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="comment">//è°ƒç”¨ func, å¹¶ä¸”ä»¥ objä¸ºthis.</span></span><br><span class="line"><span class="keyword">const</span> result = func.<span class="title function_">apply</span>(obj, params);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> o = result || obj;</span><br><span class="line"><span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ new å…¶å®å°±æ˜¯å¤åˆ¶åŸå‹é“¾ï¼Œåˆ°funcå½“ä¸­æ‰§è¡Œï¼Œç„¶åè¿”å›é‚£ä¸ªå¯¹è±¡ã€‚</p><p>ä½†æ˜¯ä½  ç®­å¤´å‡½æ•°ï¼Œæ²¡æœ‰ prototypeï¼Œä½ æ€ä¹ˆå¤åˆ¶ï¼Ÿ</p><p>å¦‚æœä½ è¦å¼ºè¡Œ new ä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œè‡ªå·±å†™ new å‡½æ•°ï¼Œä»¥ä½œç”¨åŸŸå½“åŸå‹é“¾..</p><p>åªæ˜¯æ²¡ä»€ä¹ˆæ„ä¹‰</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue2.extend</title>
      <link href="/2023/08/19/Vue_extends/"/>
      <url>/2023/08/19/Vue_extends/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-ä»€ä¹ˆæ˜¯-Vue-extend"><a href="#01-ä»€ä¹ˆæ˜¯-Vue-extend" class="headerlink" title="01. ä»€ä¹ˆæ˜¯ Vue.extend"></a>01. ä»€ä¹ˆæ˜¯ Vue.extend</h3><blockquote><p>Vue.extend è¿”å›çš„æ˜¯ä¸€ä¸ªæ‰©å±•å®ä¾‹æ„é€ å™¨ï¼Œä¹Ÿå°±æ˜¯é¢„è®¾äº†éƒ¨åˆ†é€‰é¡¹çš„Vueå®ä¾‹æ„é€ å™¨</p></blockquote><p>åœ¨å®é™…çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å°è¯•äº†ä½¿ç”¨ <code>Vue.extend</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyComponent</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;&#123;&#123; message &#125;&#125;&lt;/div&gt;&#x27;</span>,</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;Hello, Vue!&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vm1 = <span class="keyword">new</span> <span class="title class_">MyComponent</span>();</span><br><span class="line">vm1.$mount(<span class="string">&#x27;#app1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vm2 = <span class="keyword">new</span> <span class="title class_">MyComponent</span>();</span><br><span class="line">vm2.$mount(<span class="string">&#x27;#app2&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ç»™ä»–ä¸€ä¸ª options è¿”å›ä½ ä¸€ä¸ªç»„ä»¶ï¼Œä½ å¯ä»¥ä»»æ„ä½¿ç”¨ï¼Œæ¯”å¦‚æ³¨å†Œä¸ºç»„ä»¶</p><p>è¿™é‡Œçš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿä½ å¯ä»¥åŠ¨æ€åˆ›å»ºç»„ä»¶ï¼Œæ¯”å¦‚ä½¿ç”¨æ’ä»¶</p><p>æ¯”å¦‚æˆ‘æƒ³å†™ä¸€ä¸ªå…¨å±€ loading å‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘éœ€è¦å…ˆå†™ä¸€ä¸ªç»„ä»¶ï¼Œç„¶åé€šè¿‡ $mount ç»‘å®šåˆ°èŠ‚ç‚¹ã€‚</p><p>å…¶ä¸­ä¸€ç§åŠæ³•å°±æ˜¯ä½¿ç”¨ Vue.extend åˆ›å»ºç»„ä»¶ï¼Œç„¶å $mount.</p><p>ç„¶åé€šè¿‡ä¸€ä¸ªjså»è°ƒç”¨ä»–ï¼Œä¸Šé¢é‚£ä¸ªå°±æ˜¯ä¸€ä¸ªç®€å•çš„ç»‘å®šçš„ä¾‹å­ã€‚</p><h3 id="02-Vue2-å†™ä¸€ä¸ªloading"><a href="#02-Vue2-å†™ä¸€ä¸ªloading" class="headerlink" title="02. Vue2 å†™ä¸€ä¸ªloading"></a>02. Vue2 å†™ä¸€ä¸ªloading</h3><p>é¦–å…ˆå†™ä¸€ä¸ªloading</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;centered-div&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; loadingMessage &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">name</span>: <span class="string">&quot;loading-components&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">loadingMessage</span>: <span class="string">&#x27;.&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">t</span>: <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">flag</span>: <span class="literal">false</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">const</span> max = <span class="number">10</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">t</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">loadingMessage</span>.<span class="property">length</span> &gt;= max)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">this</span>.<span class="property">loadingMessage</span> = <span class="string">&#x27;.&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">this</span>.<span class="property">loadingMessage</span> += <span class="string">&#x27;.&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;, <span class="number">1000</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">destroyed</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">t</span> !== <span class="literal">null</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">t</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="variable language_">this</span>.<span class="property">t</span> = <span class="literal">null</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.container</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="attribute">position</span>: relative;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.centered-div</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="attribute">position</span>: absolute;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="attribute">top</span>: <span class="number">50%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="attribute">left</span>: <span class="number">50%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="attribute">text-align</span>: center;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>ç„¶åé‡ç‚¹æ¥äº†ã€‚</p><p>ä½¿ç”¨  Vue.extend(loading), ç„¶å new &amp; mountï¼Œ æœ€å append åˆ° body ä¸Šã€‚</p><p>ç„¶åæ³¨å†Œæ’ä»¶å³å¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> loading <span class="keyword">from</span> <span class="string">&#x27;./loading-components.vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(loading)</span><br><span class="line"><span class="keyword">const</span> myLoading = <span class="keyword">new</span> <span class="title function_">app</span>().$mount(<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>))</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(myLoading.<span class="property">$el</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">install</span>(<span class="params">vm</span>) &#123;</span><br><span class="line">        vm.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$loading</span> = &#123;</span><br><span class="line">            <span class="attr">show</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                loading.<span class="property">flag</span> = <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">hide</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                loading.<span class="property">flag</span> = <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ mian.js ä¸­ Vue.use(â€¦)</p><p>å°±å¯ä»¥è°ƒç”¨äº†ã€‚</p><h3 id="Vue-extend"><a href="#Vue-extend" class="headerlink" title="Vue.extend"></a>Vue.extend</h3><p><strong>src\core\global-api\extend.ts</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">  <span class="title class_">Vue</span>.<span class="property">extend</span> = <span class="keyword">function</span> (<span class="params">extendOptions: <span class="built_in">any</span></span>): <span class="keyword">typeof</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    extendOptions = extendOptions || &#123;&#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Super</span> = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">SuperId</span> = <span class="title class_">Super</span>.<span class="property">cid</span></span><br><span class="line">    <span class="keyword">const</span> cachedCtors = extendOptions.<span class="property">_Ctor</span> || (extendOptions.<span class="property">_Ctor</span> = &#123;&#125;)</span><br><span class="line">    <span class="keyword">if</span> (cachedCtors[<span class="title class_">SuperId</span>]) &#123;</span><br><span class="line">      <span class="keyword">return</span> cachedCtors[<span class="title class_">SuperId</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> name =</span><br><span class="line">      <span class="title function_">getComponentName</span>(extendOptions) || <span class="title function_">getComponentName</span>(<span class="title class_">Super</span>.<span class="property">options</span>)</span><br><span class="line">    <span class="keyword">if</span> (__DEV__ &amp;&amp; name) &#123;</span><br><span class="line">      <span class="title function_">validateComponentName</span>(name)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Sub</span> = <span class="keyword">function</span> <span class="title function_">VueComponent</span>(<span class="params"><span class="variable language_">this</span>: <span class="built_in">any</span>, options: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">_init</span>(options)</span><br><span class="line">    &#125; <span class="keyword">as</span> <span class="built_in">unknown</span> <span class="keyword">as</span> <span class="keyword">typeof</span> <span class="title class_">Component</span></span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Super</span>.<span class="property"><span class="keyword">prototype</span></span>)</span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Sub</span></span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">cid</span> = cid++</span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">options</span> = <span class="title function_">mergeOptions</span>(<span class="title class_">Super</span>.<span class="property">options</span>, extendOptions)</span><br><span class="line">    <span class="title class_">Sub</span>[<span class="string">&#x27;super&#x27;</span>] = <span class="title class_">Super</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// For props and computed properties, we define the proxy getters on</span></span><br><span class="line">    <span class="comment">// the Vue instances at extension time, on the extended prototype. This</span></span><br><span class="line">    <span class="comment">// avoids Object.defineProperty calls for each instance created.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Sub</span>.<span class="property">options</span>.<span class="property">props</span>) &#123;</span><br><span class="line">      <span class="title function_">initProps</span>(<span class="title class_">Sub</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Sub</span>.<span class="property">options</span>.<span class="property">computed</span>) &#123;</span><br><span class="line">      <span class="title function_">initComputed</span>(<span class="title class_">Sub</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// allow further extension/mixin/plugin usage</span></span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">extend</span> = <span class="title class_">Super</span>.<span class="property">extend</span></span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">mixin</span> = <span class="title class_">Super</span>.<span class="property">mixin</span></span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">use</span> = <span class="title class_">Super</span>.<span class="property">use</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// create asset registers, so extended classes</span></span><br><span class="line">    <span class="comment">// can have their private assets too.</span></span><br><span class="line">    <span class="variable constant_">ASSET_TYPES</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params"><span class="keyword">type</span></span>) &#123;</span><br><span class="line">      <span class="title class_">Sub</span>[<span class="keyword">type</span>] = <span class="title class_">Super</span>[<span class="keyword">type</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// enable recursive self-lookup</span></span><br><span class="line">    <span class="keyword">if</span> (name) &#123;</span><br><span class="line">      <span class="title class_">Sub</span>.<span class="property">options</span>.<span class="property">components</span>[name] = <span class="title class_">Sub</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// keep a reference to the super options at extension time.</span></span><br><span class="line">    <span class="comment">// later at instantiation we can check if Super&#x27;s options have</span></span><br><span class="line">    <span class="comment">// been updated.</span></span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">superOptions</span> = <span class="title class_">Super</span>.<span class="property">options</span></span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">extendOptions</span> = extendOptions</span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">sealedOptions</span> = <span class="title function_">extend</span>(&#123;&#125;, <span class="title class_">Sub</span>.<span class="property">options</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cache constructor</span></span><br><span class="line">    cachedCtors[<span class="title class_">SuperId</span>] = <span class="title class_">Sub</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Sub</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹å®Œå…¶å®å°±æ˜¯ä¸€ä¸ªç»§æ‰¿</p><p>æ ¹æ®ä½ ä¼ å…¥çš„ç»„ä»¶ï¼Œç„¶åæ–°å»ºä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç„¶åæŠŠçˆ¶ç»„ä»¶çš„å±æ€§éƒ½ç»§æ‰¿ç»™ä½ ã€‚</p><p>æœ€åä½  new è¿”å›çš„å€¼ï¼Œ ä»–ä¼šè°ƒç”¨ this._init</p><p><strong>src\core\instance\init.ts</strong></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¼€å§‹äº†ç»„ä»¶åˆ›å»ºçš„æµç¨‹</p><h3 id="04-æ€»ç»“"><a href="#04-æ€»ç»“" class="headerlink" title="04. æ€»ç»“"></a>04. æ€»ç»“</h3><p>å› ä¸ºåœ¨å†™ Vue3 ä»£ç çš„æ—¶å€™ï¼Œæƒ³è¦åˆ›å»ºä¸€ä¸ªå…¨å±€ loadingï¼Œåœ¨ http è¯·æ±‚çš„æ—¶å€™è°ƒç”¨ã€‚</p><p>çªç„¶æƒ³å¦‚æœæ˜¯ Vue2 ä¼šæ€ä¹ˆå†™ï¼Œäºæ˜¯å°±é¡ºä¾¿çœ‹äº†ä¸‹ Vue.extend æºç ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> æ’ä»¶ </tag>
            
            <tag> vue2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue3 setup</title>
      <link href="/2023/07/31/vue3_setup/"/>
      <url>/2023/07/31/vue3_setup/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>æ€ä¹ˆå®ç°çš„ï¼Ÿ</h3><p>ä¹‹å‰åœ¨ <a href="/tblog/2023/06/20/vue_setup_created_before_created/">beforeCreate, created vs setup</a> å½“ä¸­è¯´è¿‡ setup å‡½æ•°ã€‚</p><p>åœ¨ <strong>packages&#x2F;runtime-core&#x2F;src&#x2F;renderer.ts</strong> mountComponent å‡½æ•°ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å¿«é€Ÿè¿‡ä¸€ä¸‹ä»–æ€ä¹ˆå®ç°çš„ã€‚</p><p>é¦–å…ˆä¸ºä»€ä¹ˆä¼šè°ƒç”¨ <strong>mountComponent</strong> , è¿™ä¸ªå…¶å®ä¸ç®¡æ˜¯ Vue2 è¿˜æ˜¯ Vue3, éƒ½æ˜¯é€šè¿‡ patch çš„è°ƒç”¨ï¼Œå¯¹æ¯”ä¹‹åéœ€è¦åˆ›å»ºç»„ä»¶ï¼Œæ‰ä¼šè°ƒç”¨ã€‚</p><p><strong>mountComponent</strong> åšäº†ä»€ä¹ˆ?</p><ol><li>è·å–ç»„ä»¶å®ä¾‹ instance</li><li>å¦‚æœæ˜¯ keepalive ç»„ä»¶çš„è¯ï¼Œå°†é»˜è®¤çš„æ¸²æŸ“æ–¹æ³•ï¼ŒåŠ å…¥åˆ° KeepAliveContext å½“ç„¶çš„ render å½“ä¸­</li><li>setupComponent æ‰§è¡Œ, è§£æ solt, props ç„¶åæ‰§è¡Œ setup å‡½æ•°ï¼Œå¤„ç†è¿”å›å€¼ï¼Œå¼‚æ­¥ï¼Œfunction, æˆ–è€…ç›´æ¥è¿”å›ã€‚ ç„¶åå¤„ç†è¿”å›å€¼ï¼Œå¦‚æœæ˜¯ function çš„è¯ï¼Œå°±ä¼šæ›¿æ¢é»˜è®¤ renderã€‚</li><li>è°ƒç”¨ setupRenderEffect æ¸²æŸ“èŠ‚ç‚¹</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ <code>setupComponent</code> è°ƒç”¨, <code>setupRenderEffect</code> æ¸²æŸ“.</p><p>setupRenderEffect åšäº†äº›äº‹æƒ…ã€‚</p><p>åˆ›å»ºä¸€ä¸ª componentUpdateFn å‡½æ•°ï¼Œé€šè¿‡ effect å‡½æ•°ï¼Œç”¨æ¥è°ƒåº¦ componentUpdateFn, è°ƒåº¦çš„æºç åˆ†æåœ¨ <a href="/tblog/2023/07/08/Vue3_queue/">vue3 ä»»åŠ¡è°ƒåº¦æºç è§£æ</a>ã€‚ </p><p>ç®€å•ç†è§£å°±æ˜¯ï¼Œé€šè¿‡ proxy åŠ«æŒ set &#x3D;&gt; è§¦å‘åˆ° scheduler ä¹Ÿå°±æ˜¯</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> effect = (instance.<span class="property">effect</span> = <span class="keyword">new</span> <span class="title class_">ReactiveEffect</span>(</span><br><span class="line">      componentUpdateFn,</span><br><span class="line">      <span class="function">() =&gt;</span> <span class="title function_">queueJob</span>(update),</span><br><span class="line">      instance.<span class="property">scope</span> <span class="comment">// track it in component&#x27;s effect scope</span></span><br><span class="line">    ))</span><br></pre></td></tr></table></figure><p>ä¸­çš„ <code>() =&gt; queueJob(update)</code> ç„¶åç»Ÿä¸€è°ƒåº¦ <code>componentUpdateFn</code></p><p>componentUpdateFn å…¶å®æœ¬è´¨ä¸Šæ˜¯ä½¿ç”¨ patch å»å¯¹æ¯”ï¼Œä¸è¿‡åŒºåˆ†äº†æ˜¯å¦æœ‰ <code>instance.isMounted</code>, ä»è€Œè§¦å‘ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!instance.<span class="property">isMounted</span>) &#123;</span><br><span class="line">   <span class="keyword">const</span> &#123; bm, m, parent &#125; = instance;</span><br><span class="line">   <span class="comment">// beforeMount hook</span></span><br><span class="line">   <span class="keyword">if</span> (bm) &#123;</span><br><span class="line">       <span class="title function_">invokeArrayFns</span>(bm)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">   <span class="title function_">patch</span>(</span><br><span class="line">       <span class="literal">null</span>,</span><br><span class="line">       subTree,</span><br><span class="line">       container,</span><br><span class="line">       anchor,</span><br><span class="line">       instance,</span><br><span class="line">       parentSuspense,</span><br><span class="line">       isSVG</span><br><span class="line">   )</span><br><span class="line"></span><br><span class="line">   <span class="comment">//..</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// mounted hook</span></span><br><span class="line">   <span class="keyword">if</span> (m) &#123;</span><br><span class="line">       <span class="title function_">queuePostRenderEffect</span>(m, parentSuspense)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="keyword">let</span> &#123; next, bu, u, parent, vnode &#125; = instance</span><br><span class="line"></span><br><span class="line">   <span class="comment">// beforeUpdate hook</span></span><br><span class="line">   <span class="keyword">if</span> (bu) &#123;</span><br><span class="line">       <span class="title function_">invokeArrayFns</span>(bu)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="title function_">patch</span>(</span><br><span class="line">       prevTree,</span><br><span class="line">       nextTree,</span><br><span class="line">       <span class="comment">// parent may have changed if it&#x27;s in a teleport</span></span><br><span class="line">       <span class="title function_">hostParentNode</span>(prevTree.<span class="property">el</span>!)!,</span><br><span class="line">       <span class="comment">// anchor may have changed if it&#x27;s in a fragment</span></span><br><span class="line">       <span class="title function_">getNextHostNode</span>(prevTree),</span><br><span class="line">       instance,</span><br><span class="line">       parentSuspense,</span><br><span class="line">       isSVG</span><br><span class="line">   )</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (u) &#123;</span><br><span class="line">       <span class="title function_">queuePostRenderEffect</span>(u, parentSuspense)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ¶‰åŠä¸€ä¸ªçŸ¥è¯†ç‚¹. <code>queuePostRenderEffect</code> å¹¶ä¸æ˜¯ç«‹åˆ»æ‰§è¡Œçš„ï¼Œ è€Œæ˜¯ä¸€ä¸ªä¼šåŠ å…¥é˜Ÿåˆ—ï¼Œç„¶åæœ€åè°ƒç”¨ï¼Œå…ˆè¿›å…ˆå‡ºã€‚</p><p>æ‰€ä»¥ updated æˆ–è€… mounted æœ€åæ˜¯è¿™ç§ç»“æœ</p><p>ç»„ä»¶1 beforeMounted, å­ç»„ä»¶1 beforeMounted &#x3D;&gt; å­ç»„ä»¶1 mounted &#x3D;&gt; ç»„ä»¶1 mountedã€‚</p><p>è¿™å¤§æ¦‚å°±æ˜¯ setup çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p><p>å¹¶ä¸”åœ¨éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè‡ªå®šä¹‰äº† render , é‚£ä¹ˆæ¯æ¬¡æ›´æ–°éƒ½ä¼šè°ƒç”¨ã€‚ setup å‡½æ•°åªä¼šåœ¨ mountComponent çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ã€‚</p><p>å¤§æ¦‚æ˜¯è¿™æ ·.</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> æºç  </tag>
            
            <tag> setup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uni-app ç™»å½•</title>
      <link href="/2023/07/19/uniapp_login/"/>
      <url>/2023/07/19/uniapp_login/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>æ€»æ˜¯è¦ç™»å½•çš„ï¼Œæ¯ä¸ªå¹³å°çš„ç™»å½•æ–¹å¼éƒ½ä¸ä¸€æ ·ã€‚</p><p>h5, app åªéœ€è¦ token å°±å¯ä»¥äº†ï¼Œå…¶ä»–å°ç¨‹åºï¼Œæ¯”å¦‚wxå°ç¨‹åºï¼Œå°±æ˜¯ç”±ä»–è‡ªå·±çš„æµç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚ä½•å»ç»Ÿä¸€ä¸åŒçš„ç™»å½•æ–¹å¼ï¼Ÿ</p><p>å¦‚ä½•æ•´åˆï¼Œæ¯”å¦‚æˆ‘æ˜¯å°ç¨‹åºå’Œappéƒ½åœ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆæ‰‹æœºå·å°±æ˜¯å¾ˆé‡è¦çš„ç‚¹ï¼Œä½†æ˜¯å°´å°¬çš„æ˜¯ï¼Œæˆ‘å¹¶æ²¡æœ‰è´­ä¹°çŸ­ä¿¡å‘é€æœåŠ¡ï¼Œåªæ˜¯ä¼¼ä¹å¯ä»¥éƒ½ä¸ç”¨çŸ­ä¿¡ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡å¹³å°è·å–æ‰‹æœºå·(é™¤äº†h5)</p><h3 id="01-è·å–æ‰‹æœºå·"><a href="#01-è·å–æ‰‹æœºå·" class="headerlink" title="01. è·å–æ‰‹æœºå·"></a>01. è·å–æ‰‹æœºå·</h3><p>uniapp ä¸€é”®ç™»å½• <a href="https://ask.dcloud.net.cn/article/37965">https://ask.dcloud.net.cn/article/37965</a></p><p>å•æ¬¡æ”¶è´¹ 0.02</p><p>å¾®ä¿¡å°ç¨‹åº <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/getPhoneNumber.html">https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/getPhoneNumber.html</a></p><blockquote><p>ç›®å‰è¯¥æ¥å£é’ˆå¯¹éä¸ªäººå¼€å‘è€…ï¼Œä¸”å®Œæˆäº†è®¤è¯çš„å°ç¨‹åºå¼€æ”¾ï¼ˆä¸åŒ…å«æµ·å¤–ä¸»ä½“ï¼‰ï¼›<br>è¯¥èƒ½åŠ›ä½¿ç”¨æ—¶ï¼Œç”¨æˆ·å¯é€‰æ‹©ç»‘å®šå·ç ï¼Œæˆ–è‡ªä¸»æ·»åŠ å·ç ã€‚å¹³å°ä¼šåŸºäºä¸­å›½ä¸‰å¤§è¿è¥å•†æä¾›çš„çŸ­ä¿¡ç­‰åº•å±‚èƒ½åŠ›å¯¹å·ç è¿›è¡ŒéªŒè¯ï¼Œä½†ä¸ä¿è¯æ˜¯å®æ—¶éªŒè¯ï¼›<br>è¯·å¼€å‘è€…æ ¹æ®ä¸šåŠ¡åœºæ™¯éœ€è¦è‡ªè¡Œåˆ¤æ–­å¹¶é€‰æ‹©æ˜¯å¦ä½¿ç”¨ï¼Œå¿…è¦æ—¶å¯è€ƒè™‘å¢åŠ å…¶ä»–å®‰å…¨éªŒè¯æ‰‹æ®µã€‚<br>å¼€å‘è€…éœ€åˆç†ä½¿ç”¨ï¼Œè‹¥è¢«å‘ç°æˆ–ç”¨æˆ·ä¸¾æŠ¥å¼€å‘è€…ä¸åˆç†åœ°è¦æ±‚ç”¨æˆ·æä¾›æ‰‹æœºå·ç­‰ä¸ªäººä¿¡æ¯ï¼Œä¸­æ–­äº†æ­£å¸¸çš„ä½¿ç”¨æµç¨‹ï¼Œå½±å“äº†ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒï¼Œå¾®ä¿¡æœ‰æƒä¾æ®ã€Šå¾®ä¿¡å°ç¨‹åºå¹³å°è¿è¥ç®¡ç†è§„èŒƒã€‹å¯¹è¯¥å°ç¨‹åºè¿›è¡Œå¤„ç†ã€‚å¸¸è§è¿è§„äº‹ä¾‹å’Œå…·ä½“è§£æï¼›</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ä¸ªäººå¼€å‘è€…æ˜¯æ— æ³•è·å–åˆ°æ‰‹æœºå·çš„ï¼Œè€Œä¸”å¿…é¡»è®¤è¯.</p><p>è€Œä¸”è¦æ”¶è´¹ï¼Œå•æ¬¡ 0.03</p><p>æ”¯ä»˜å®å°ç¨‹åº <a href="https://opendocs.alipay.com/mini/api/getphonenumber">https://opendocs.alipay.com/mini/api/getphonenumber</a></p><blockquote><p>ç›®å‰åªæ”¯æŒå•†å®¶ä¼šå‘˜å¡åŠŸèƒ½çš„ alipay.user.info.shareï¼ˆæ”¯ä»˜å®ä¼šå‘˜æˆæƒä¿¡æ¯æŸ¥è¯¢æ¥å£ï¼‰å’Œå°ç¨‹åºè·å–ä¼šå‘˜æ‰‹æœºå·åŠŸèƒ½çš„ getPhoneNumber è·å–ç”¨æˆ·æ‰‹æœºå·ï¼Œå…¶ä»–åº”ç”¨åŠŸèƒ½æš‚æ— æ³•è·å–æ•æ„Ÿä¿¡æ¯ï¼Œè¯¦è§ ç”¨æˆ·ä¿¡æ¯ç”³è¯·æµç¨‹ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my.<span class="title function_">getPhoneNumber</span>(<span class="title class_">Object</span> object)</span><br></pre></td></tr></table></figure><p>æŠ–éŸ³å°ç¨‹åº <a href="https://developer.open-douyin.com/docs/resource/zh-CN/mini-app/develop/guide/open-capabilities/acquire-phone-number-acquire/">https://developer.open-douyin.com/docs/resource/zh-CN/mini-app/develop/guide/open-capabilities/acquire-phone-number-acquire/</a></p><p>å’Œå¾®ä¿¡ä¸€ä¸ªè·¯å­ï¼Œä¸å…è®¸ä¸ªäººå¼€å‘è€…ä½¿ç”¨ï¼Œåªå…è®¸ä¼ä¸šå¼€å‘è€…ï¼Œå¹¶ä¸”é€šè¿‡äº†è®¤è¯çš„å¼€å‘è€…</p><p>çœ‹åˆ°è¿™é‡Œï¼Œå…¶å®ä¸ªäººå¼€å‘è€…é€šè¿‡æ‰‹æœºå·æ”¯æŒå…¨å¹³å°çš„è·¯å­å·²ç»å¾ˆéº»çƒ¦äº†ï¼Œä½ éœ€è¦å»æ‰¾æ²¡æœ‰å°ç¨‹åºæœ‰ä¼ä¸šçš„æœ‹å‹æˆ–è€…è‡ªå·±æä¸€ä¸ªä¼ä¸š(è™½ç„¶ä¸è´µï¼Œä½†æ˜¯å¾ˆéº»çƒ¦)ï¼Œè€Œä¸”å¾®ä¿¡å’ŒUNIAPPå¹³å°è¿˜è¦æ”¶è´¹ã€‚</p><p>æ‰€ä»¥è¿™ä¸ªæ‰‹æœºå·ç™»å½•æµç¨‹æš‚æ—¶æ”¾å¼ƒäº†ã€‚</p><h3 id="02-é‚®ç®±ç™»å½•"><a href="#02-é‚®ç®±ç™»å½•" class="headerlink" title="02. é‚®ç®±ç™»å½•"></a>02. é‚®ç®±ç™»å½•</h3><p>å‘é€é‚®ä»¶æ˜¯å…è´¹çš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸ªäººçš„é‚®ç®±æœåŠ¡æ¥å‘é€é‚®ä»¶ï¼Œæ‹¿ outlook ä¸¾ä¾‹</p><p><a href="https://support.microsoft.com/zh-cn/office/%E4%BB%A5-outlook-com-%E5%8F%91%E9%80%81%E9%99%90%E5%88%B6-279ee200-594c-40f0-9ec8-bb6af7735c2e">https://support.microsoft.com/zh-cn/office/%E4%BB%A5-outlook-com-%E5%8F%91%E9%80%81%E9%99%90%E5%88%B6-279ee200-594c-40f0-9ec8-bb6af7735c2e</a></p><p>æ¯æ—¥ä¸Šé™æ˜¯ 5000 å°é‚®ä»¶ï¼Œè™½ç„¶ç”¨æˆ·ä¼šéº»çƒ¦ä¸€äº›ï¼Œä½†æ˜¯å¯ä»¥åœ¨åšå•†ä¸šç¨‹åºçš„æ—¶å€™ï¼Œå†ä¸€ä¸ªä¸€ä¸ªæ‰“é€šé€šé“ã€‚</p><p>ä¹Ÿå°±æ˜¯ï¼Œå°ç¨‹åºç”¨æˆ·ä¸éœ€è¦ç™»å½•ï¼Œåªæ˜¯éœ€è¦è·å–å¹³å°çš„å”¯ä¸€ID. å½“æœ‰æ•´åˆéœ€æ±‚ï¼Œæ¯”å¦‚åŒæ—¶å¼€å§‹ä½¿ç”¨ app æˆ–è€…å…¶ä»–å°ç¨‹åºå¹³å°ç™»å½•ï¼Œé‚£ä¹ˆå°±éœ€è¦é‚®ç®±éªŒè¯ï¼Œæˆ–è€…é€šè¿‡ APP ç”Ÿæˆtokençš„æ–¹å¼æ•´åˆã€‚</p><h3 id="03-å¾®ä¿¡ç™»å½•"><a href="#03-å¾®ä¿¡ç™»å½•" class="headerlink" title="03. å¾®ä¿¡ç™»å½•"></a>03. å¾®ä¿¡ç™»å½•</h3><p>è¿™ç§æ–¹å¼å°±æ˜¯æš‚æ—¶ä¸è€ƒè™‘å…¶ä»–å°ç¨‹åºå¹³å°ï¼Œä½†æ˜¯å…¼å®¹äº†APPï¼Œå¾®ä¿¡å°ç¨‹åº</p><h3 id="03-ç™»å½•"><a href="#03-ç™»å½•" class="headerlink" title="03. ç™»å½•"></a>03. ç™»å½•</h3><p><a href="https://zh.uniapp.dcloud.io/api/plugins/login.html#">https://zh.uniapp.dcloud.io/api/plugins/login.html#</a></p><p><a href="https://zh.uniapp.dcloud.io/api/plugins/provider.html">https://zh.uniapp.dcloud.io/api/plugins/provider.html</a></p><p>é¦–å…ˆçœ‹è¿™ä¸ªï¼Œè¿™ä¸ªæ˜¯æ ¹æ®ç¨‹åºé…ç½®æ¥ç¡®å®šã€‚</p><p>æ¯”å¦‚åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ï¼Œåªæ”¯æŒ weixin ç™»å½•</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">provider<span class="punctuation">:</span> <span class="punctuation">[</span>&#x27;weixin&#x27;<span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>åœ¨ app å½“ä¸­ï¼Œä¸ä»…ä»…å¯ä»¥æ”¯æŒ weixin ç™»å½•ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–ç™»å½•æ–¹å¼ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">provider<span class="punctuation">:</span> <span class="punctuation">[</span>`qq`<span class="punctuation">,</span> `sinaweibo`<span class="punctuation">,</span> `xiaomi`<span class="punctuation">,</span> `univerify`<span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">getProvider</span>(&#123;</span><br><span class="line">    <span class="attr">service</span>: <span class="string">&#x27;oauth&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123; &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä»£ç æ˜¯ä¸ºäº†è·å–ï¼Œå½“å‰æ”¯æŒå“ªäº›ç™»å½•æ–¹å¼ã€‚</p><p>é—®é¢˜åœ¨äºæ¯ä¸ªå¹³å°ï¼Œæ¯ä¸ªç™»å½•æ–¹å¼éƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥éœ€è¦å†™å¾ˆå¤šä¸ä¸€æ ·çš„ä»£ç , æ‰€ä»¥éœ€è¦å…¼å®¹æ€§å¤„ç†ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ç°åœ¨çš„ä»£ç ç›®å‰æ‰“ç®—å®Œå…¨ä»¥å¾®ä¿¡ç™»å½•ä¸ºåŸºå‡†ï¼Œå…¼å®¹å°ç¨‹åºï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¹‹ä¸Šæˆ‘éœ€è¦åšä»€ä¹ˆï¼Ÿ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">getProvider</span>(&#123;</span><br><span class="line">    <span class="attr">service</span>: <span class="string">&#x27;oauth&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">provider</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;weixin&#x27;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">//è¿™é‡Œæˆ‘ç¡®è®¤ï¼Œæ”¯æŒå¾®ä¿¡</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">fail</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fail&quot;</span>, res)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯å¾ˆå¥‡æ€ªçš„é—®é¢˜äº†</p><p><a href="https://uniapp.dcloud.net.cn/tutorial/app-oauth-weixin.html">https://uniapp.dcloud.net.cn/tutorial/app-oauth-weixin.html</a></p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html">https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html</a></p><p>æ ¹æ®æ–‡æ¡£ä»–ä»¬ä¸¤éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªä¸´æ—¶codeï¼Œç„¶åé€šè¿‡æœåŠ¡å™¨å‘å¾®ä¿¡æœåŠ¡å™¨é‰´æƒï¼Œä½†æ˜¯æˆ‘åœ¨æµ‹è¯•çš„æ—¶å€™ç›´æ¥æ‹¿åˆ°äº†æ•°æ®</p><p>appç«¯ é€šè¿‡å¾®ä¿¡ç™»å½•è¿”å›æ•°æ®ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;authResult&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;access_token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;expires_in&quot;</span><span class="punctuation">:</span> <span class="number">7200</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;refresh_token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;openid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;scope&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;unionid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;errMsg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;login:ok&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œç›´æ¥æ‹¿åˆ°äº† unionidï¼Œéš¾é“æ˜¯å› ä¸ºæµ‹è¯•åŸºåº§çš„é—®é¢˜ï¼Ÿè¿™ç‚¹ç°åœ¨ä¸å¾—è€ŒçŸ¥ï¼Œé‚£ä¹ˆå…ˆå®ç°ä»¥ä¸‹ä»£ç ã€‚</p><p>é¦–å…ˆæˆ‘æœ‰ä¸€ä¸ªç”¨äºå¾®ä¿¡ç™»å½•çš„æ¥å£ <strong>&#x2F;users&#x2F;login&#x2F;wx&#x2F;dsadas</strong></p><p>ç„¶åè¿™ä¸ªæ—¶å€™å°±éœ€è¦ http è¯·æ±‚çš„æ¥å£äº†ã€‚</p><h3 id="httpè¯·æ±‚"><a href="#httpè¯·æ±‚" class="headerlink" title="httpè¯·æ±‚"></a>httpè¯·æ±‚</h3><p><strong>uniapp</strong> æœ¬èº«æœ‰ <code>http.request</code>, æ–‡æ¡£åœ¨è¿™é‡Œ <a href="https://uniapp.dcloud.net.cn/api/request/request.html#">https://uniapp.dcloud.net.cn/api/request/request.html#</a></p><p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–è¯·æ±‚æ¡†æ¶ï¼Œæ¯”å¦‚ <code>axios</code>.</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> whiteList <span class="keyword">from</span> <span class="string">&#x27;./whiteList&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ajaxTimes = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> timeout = <span class="number">10000</span>;</span><br><span class="line"><span class="keyword">const</span> baseUrl = <span class="string">&#x27;http://localhost:3000&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> requestOptions &#123;</span><br><span class="line">url : <span class="built_in">string</span>;</span><br><span class="line">header? : <span class="built_in">any</span>;</span><br><span class="line">method : <span class="string">&quot;POST&quot;</span> | <span class="string">&quot;GET&quot;</span> | <span class="string">&quot;PUT&quot;</span> | <span class="string">&quot;DELET&quot;</span>,</span><br><span class="line">data? : <span class="built_in">any</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myRequest = (options : requestOptions) : <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt; =&gt; &#123;</span><br><span class="line"><span class="keyword">let</span> header = &#123; ...options.<span class="property">header</span> &#125;;</span><br><span class="line"><span class="keyword">if</span> (whiteList.<span class="title function_">indexOf</span>(options.<span class="property">url</span>) === -<span class="number">1</span>) &#123;</span><br><span class="line">header[<span class="string">&quot;token&quot;</span>] = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ajaxTimes++;</span><br><span class="line">uni.<span class="title function_">showLoading</span>(&#123;</span><br><span class="line"><span class="attr">title</span>: <span class="string">&quot;åŠ è½½ä¸­..&quot;</span>,</span><br><span class="line"><span class="attr">mask</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">uni.<span class="title function_">request</span>(&#123;</span><br><span class="line"><span class="attr">url</span>: baseUrl + options.<span class="property">url</span>,</span><br><span class="line"><span class="attr">method</span>: options.<span class="property">method</span> || <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line"><span class="attr">data</span>: options.<span class="property">data</span> || &#123;&#125;,</span><br><span class="line"><span class="attr">timeout</span>: timeout,</span><br><span class="line">header,</span><br><span class="line"><span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">resolve</span>(res)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">reject</span>(err)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">complete</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">ajaxTimes--;</span><br><span class="line"><span class="keyword">if</span> (ajaxTimes === <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">//  å…³é—­æ­£åœ¨ç­‰å¾…çš„å›¾æ ‡</span></span><br><span class="line">uni.<span class="title function_">hideLoading</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> myRequest</span><br></pre></td></tr></table></figure><p><a href="https://uniapp.dcloud.net.cn/api/plugins/login.html#getuserinfo">https://uniapp.dcloud.net.cn/api/plugins/login.html#getuserinfo</a></p><p><a href="https://uniapp.dcloud.net.cn/api/plugins/login.html#getuserprofile">https://uniapp.dcloud.net.cn/api/plugins/login.html#getuserprofile</a></p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> å¤šç«¯ </tag>
            
            <tag> uniapp </tag>
            
            <tag> login </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nestjs ç™»å½•å’Œä»»åŠ¡</title>
      <link href="/2023/07/19/uniapp_nest_login_list/"/>
      <url>/2023/07/19/uniapp_nest_login_list/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="å¢åŠ login"><a href="#å¢åŠ login" class="headerlink" title="å¢åŠ login"></a>å¢åŠ login</h3><p>å› ä¸ºç°åœ¨æ²¡æœ‰Httpsè¯ä¹¦ï¼Œåœ¨ç”³è¯·å½“ä¸­ï¼Œæ‰€ä»¥æ— æ³•é€šè¿‡ wx ç™»å½•è¿›è¡Œæµ‹è¯•ï¼Œæ‰€ä»¥å…ˆå†™ä¸€ä¸ªä¸´æ—¶çš„æ¥å£</p><p>äºæ˜¯æˆ‘æ–°å»ºäº†ä¸€ä¸ª <strong>Controller</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡å¾®ä¿¡IDç™»å½•æˆ–è€…åˆ›å»ºç”¨æˆ·</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> wxId String</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> <span class="variable">UserReturn</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Post</span>()</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">loginWxUserByUnionid</span>(<span class="meta">@Body</span>(<span class="string">&#x27;wxId&#x27;</span>) <span class="attr">wxId</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">UserReturn</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> existUser = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">userService</span>.<span class="title function_">findUserByWxId</span>(wxId);</span><br><span class="line">  <span class="keyword">if</span> (!!existUser) &#123;</span><br><span class="line">    <span class="comment">//æ›´æ–°ç”¨æˆ·æ¿€æ´»æ—¶é—´</span></span><br><span class="line">    existUser.<span class="property">activeTime</span> = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">userService</span>.<span class="title function_">updateUser</span>(existUser.<span class="property">id</span>, existUser);</span><br><span class="line">    <span class="comment">//ç›´æ¥æ‹¿token, è¿”å›ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">const</span> timex = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>().<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">const</span> token = <span class="variable language_">this</span>.<span class="property">jwtService</span>.<span class="title function_">generateToken</span>(existUser.<span class="property">id</span> + timex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">userName</span>: existUser.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">token</span>: token,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> newUser = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">  newUser.<span class="property">wxId</span> = wxId;</span><br><span class="line">  newUser.<span class="property">name</span> = <span class="variable language_">this</span>.<span class="title function_">generateRandomName</span>(); <span class="comment">// ç”Ÿæˆéšæœºåç§°</span></span><br><span class="line">  newUser.<span class="property">createTime</span> = <span class="keyword">new</span> <span class="title class_">Date</span>(); <span class="comment">// è‡ªåŠ¨å¡«å†™åˆ›å»ºæ—¶é—´</span></span><br><span class="line">  newUser.<span class="property">activeTime</span> = <span class="keyword">new</span> <span class="title class_">Date</span>(); <span class="comment">// æš‚æœªæ¿€æ´»ï¼Œè®¾ç½®ä¸º null</span></span><br><span class="line">  newUser.<span class="property">status</span> = <span class="title class_">UserStatus</span>.<span class="property">wxUser</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> u = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">userService</span>.<span class="title function_">createUser</span>(newUser);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> timex = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>().<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">const</span> token = <span class="variable language_">this</span>.<span class="property">jwtService</span>.<span class="title function_">generateToken</span>(u.<span class="property">id</span> + timex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">userName</span>: u.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">token</span>: token,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ex) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">generateRandomName</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> prefix = <span class="string">&#x27;User&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> randomSuffix = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">100000</span>).<span class="title function_">toString</span>();</span><br><span class="line">  <span class="keyword">const</span> username = prefix + randomSuffix.<span class="title function_">padStart</span>(<span class="number">5</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> username;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„ä»£ç åªè¦æœ‰å¾®ä¿¡idæ¥ï¼Œå°±å¯ä»¥ç™»å½•æˆ–è€…åˆ›å»ºä¸€ä¸ªç”¨æˆ·, ç„¶åé€šè¿‡postmanæµ‹è¯•ä¸€æ‹¨ï¼Œæ²¡é—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;userName&quot;: &quot;User09292&quot;,</span><br><span class="line">    &quot;token&quot;: &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxMTY5MDA5Njk2OTIzMyIsImlhdCI6MTY5MDA5Njk3MSwiZXhwIjoxNjkwMTAwNTcxfQ.cm_G-jCmMdlmQqDvB0QAA5aFY6Uq8V6tLQzktv9_8lg&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="02-é€šè¿‡-jwt-è·å–ç”¨æˆ·"><a href="#02-é€šè¿‡-jwt-è·å–ç”¨æˆ·" class="headerlink" title="02. é€šè¿‡ jwt è·å–ç”¨æˆ·"></a>02. é€šè¿‡ jwt è·å–ç”¨æˆ·</h3><p>é¦–å…ˆè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬éœ€è¦éªŒè¯ jwt, éªŒè¯token okã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span>, <span class="title class_">CanActivate</span>, <span class="title class_">ExecutionContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">JwtCommonService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../auth/jwt.common.service&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">JwtAuthGuard</span> <span class="keyword">implements</span> <span class="title class_">CanActivate</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> jwtCommonService: JwtCommonService</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">canActivate</span>(<span class="attr">context</span>: <span class="title class_">ExecutionContext</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> request = context.<span class="title function_">switchToHttp</span>().<span class="title function_">getRequest</span>();</span><br><span class="line">    <span class="keyword">const</span> token = request.<span class="property">headers</span>.<span class="property">authorization</span>?.<span class="title function_">replace</span>(<span class="string">&#x27;Bearer &#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!token || !<span class="variable language_">this</span>.<span class="property">jwtCommonService</span>.<span class="title function_">verifyToken</span>(token)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ªå®ˆå«ï¼Œå› ä¸º list.controller.ts å…¨éƒ¨éƒ½éœ€è¦éªŒè¯ï¼Œæ‰€ä»¥åœ¨ controller ä¸­åŠ å…¥å®ˆå«</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(<span class="string">&#x27;lists&#x27;</span>)</span><br><span class="line"><span class="meta">@UseGuards</span>(<span class="title class_">JwtAuthGuard</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ListController</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> listService: ListService</span>) &#123;&#125;</span><br><span class="line">  <span class="comment">//...</span></span><br></pre></td></tr></table></figure><p>åœ¨åŠ å…¥å®ˆå«ä»¥åï¼Œæˆ‘ä»¬éœ€è¦è·å–ç”¨æˆ· Userï¼Œé€šè¿‡ tokenï¼Œä½¿ç”¨ <code>jwtService.decode</code> å°±okäº†, åªæ˜¯æˆ‘ä¸æƒ³æ¯ä¸ªé¡µé¢éƒ½å†™ï¼Œæ‰€ä»¥ç”¨æ‹¦æˆªå™¨å§ã€‚</p><p>å…·ä½“æ–‡æ¡£çœ‹è¿™é‡Œ <a href="https://docs.nestjs.cn/9/interceptors">https://docs.nestjs.cn/9/interceptors</a></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">Injectable</span>,</span><br><span class="line">  <span class="title class_">NestInterceptor</span>,</span><br><span class="line">  <span class="title class_">ExecutionContext</span>,</span><br><span class="line">  <span class="title class_">CallHandler</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">JwtService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/jwt&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Observable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">JwtInterceptor</span> <span class="keyword">implements</span> <span class="title class_">NestInterceptor</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> jwtService: JwtService</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">intercept</span>(<span class="attr">context</span>: <span class="title class_">ExecutionContext</span>, <span class="attr">next</span>: <span class="title class_">CallHandler</span>): <span class="title class_">Observable</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> request = context.<span class="title function_">switchToHttp</span>().<span class="title function_">getRequest</span>();</span><br><span class="line">    <span class="keyword">const</span> token = request.<span class="property">headers</span>.<span class="property">authorization</span>?.<span class="title function_">replace</span>(<span class="string">&#x27;Bearer &#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      <span class="keyword">const</span> decodedToken = <span class="variable language_">this</span>.<span class="property">jwtService</span>.<span class="title function_">decode</span>(token);</span><br><span class="line">      <span class="keyword">if</span> (decodedToken) &#123;</span><br><span class="line">        request.<span class="property">user</span> = decodedToken[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> next.<span class="title function_">handle</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºä»–ä¸æ˜¯å…¨éƒ¨éƒ½éœ€è¦ä½¿ç”¨ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¯ä¸ª controller è‡ªå·±é€‰æ‹©ä½¿ç”¨</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>()</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">create</span>(<span class="meta">@Req</span>() request): <span class="title class_">Promise</span>&lt;<span class="title class_">List</span>&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(request.<span class="property">user</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼Œå¯åŠ¨é¡¹ç›®ï¼Œæ‰“å¼€PostMan, æµ‹è¯•ä¸€ä¸‹ä»¥åæˆ‘ä¿®æ”¹äº†ä»£ç </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">Injectable</span>,</span><br><span class="line">  <span class="title class_">NestInterceptor</span>,</span><br><span class="line">  <span class="title class_">ExecutionContext</span>,</span><br><span class="line">  <span class="title class_">CallHandler</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">JwtService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/jwt&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Observable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">JwtInterceptor</span> <span class="keyword">implements</span> <span class="title class_">NestInterceptor</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> jwtService: JwtService</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">intercept</span>(<span class="attr">context</span>: <span class="title class_">ExecutionContext</span>, <span class="attr">next</span>: <span class="title class_">CallHandler</span>): <span class="title class_">Observable</span>&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> request = context.<span class="title function_">switchToHttp</span>().<span class="title function_">getRequest</span>();</span><br><span class="line">    <span class="keyword">if</span> (!!request.<span class="property">userId</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> next.<span class="title function_">handle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> token = request.<span class="property">headers</span>.<span class="property">authorization</span>?.<span class="title function_">replace</span>(<span class="string">&#x27;Bearer &#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      <span class="keyword">const</span> decodedToken = <span class="variable language_">this</span>.<span class="property">jwtService</span>.<span class="title function_">decode</span>(token);</span><br><span class="line">      <span class="keyword">if</span> (decodedToken) &#123;</span><br><span class="line">        request.<span class="property">userId</span> = decodedToken[<span class="string">&#x27;userId&#x27;</span>];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> next.<span class="title function_">handle</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åªèƒ½è¿”å› userIdï¼Œæ‰€ä»¥æˆ‘è¦ä¿®æ”¹ä¸€ä¸‹ token ç”Ÿæˆçš„æ–¹æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">generateToken</span>(<span class="attr">user</span>: <span class="title class_">User</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> payload = &#123; user &#125;;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="variable language_">this</span>.<span class="property">jwtService</span>.<span class="title function_">sign</span>(payload);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">logger</span>.<span class="title function_">log</span>(<span class="string">`Generated token for user <span class="subst">$&#123;user.id&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> token;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠå…¶ä»–å…³è”çš„æ¥å£ä¿®æ”¹ä¸€ä¸‹, ç„¶åé ä¸‹é¢çš„æ–¹æ³•å°±èƒ½è·å– user äº†</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>(<span class="string">&#x27;create&#x27;</span>)</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">create</span>(<span class="meta">@Req</span>() request): <span class="title class_">Promise</span>&lt;<span class="title class_">List</span>&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(request.<span class="property">user</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="03-æ·»åŠ ä»»åŠ¡"><a href="#03-æ·»åŠ ä»»åŠ¡" class="headerlink" title="03. æ·»åŠ ä»»åŠ¡"></a>03. æ·»åŠ ä»»åŠ¡</h3><p>åœ¨æå®šäº†ç”¨æˆ·ç™»å½•å’Œè·å–ä»¥åï¼Œç°åœ¨éœ€è¦æ·»åŠ ä»»åŠ¡ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦éªŒè¯ä¸€ä¸‹å‚æ•°ã€‚</p><p><a href="https://docs.nestjs.com/techniques/validation">https://docs.nestjs.com/techniques/validation</a> æ–‡æ¡£åœ¨è¿™é‡Œ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">useGlobalPipes</span>(<span class="keyword">new</span> <span class="title class_">ValidationPipe</span>());</span><br></pre></td></tr></table></figure><p>ç„¶åæ–°å»ºä¸€ä¸ª <strong>create.task.dto.ts</strong> å› ä¸º taskï¼Œä¸æ˜¯æ‰€æœ‰å­—æ®µéƒ½è¦æ£€æŸ¥ï¼Œå’Œ entity åŒºåˆ†ä¸€ä¸‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Entity</span>, <span class="title class_">Column</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;typeorm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">IsNotEmpty</span>,</span><br><span class="line">  <span class="title class_">IsString</span>,</span><br><span class="line">  <span class="title class_">Length</span>,</span><br><span class="line">  <span class="title class_">IsDate</span>,</span><br><span class="line">  <span class="title class_">IsOptional</span>,</span><br><span class="line">  <span class="title class_">MinDate</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;class-validator&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>(<span class="string">&#x27;list&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">List</span> &#123;</span><br><span class="line">  <span class="meta">@Column</span>()</span><br><span class="line">  <span class="meta">@IsNotEmpty</span>()</span><br><span class="line">  <span class="meta">@IsString</span>()</span><br><span class="line">  <span class="meta">@Length</span>(<span class="number">5</span>, <span class="number">30</span>)</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Column</span>()</span><br><span class="line">  <span class="meta">@IsNotEmpty</span>()</span><br><span class="line">  <span class="meta">@IsDate</span>()</span><br><span class="line">  <span class="attr">curDay</span>: <span class="title class_">Date</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Column</span>()</span><br><span class="line">  <span class="meta">@IsNotEmpty</span>()</span><br><span class="line">  <span class="meta">@IsDate</span>()</span><br><span class="line">  <span class="meta">@MinDate</span>(<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line">  <span class="attr">taskTime</span>: <span class="title class_">Date</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Column</span>(&#123; <span class="attr">nullable</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  <span class="meta">@IsOptional</span>()</span><br><span class="line">  <span class="meta">@IsString</span>()</span><br><span class="line">  <span class="meta">@Length</span>(<span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">  <span class="attr">description</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åéšæ„å†™ä¸€ä¸ªæ·»åŠ taskçš„serviceï¼Œå¼•ç”¨, åå­—æ²¡å–å¥½ï¼Œä½†æ˜¯æ‡’å¾—æ”¹äº†ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>(<span class="string">&#x27;create&#x27;</span>)</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">create</span>(<span class="meta">@Body</span>() <span class="attr">task</span>: <span class="title class_">TaskDto</span>, <span class="meta">@Req</span>() request): <span class="title class_">Promise</span>&lt;<span class="title class_">List</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> list = <span class="keyword">new</span> <span class="title class_">List</span>();</span><br><span class="line">  list.<span class="property">title</span> = task.<span class="property">title</span>;</span><br><span class="line">  list.<span class="property">curDay</span> = task.<span class="property">curDay</span>;</span><br><span class="line">  list.<span class="property">description</span> = task.<span class="property">description</span>;</span><br><span class="line">  list.<span class="property">taskTime</span> = task.<span class="property">taskTime</span>;</span><br><span class="line">  list.<span class="property">userId</span> = request.<span class="property">user</span>.<span class="property">id</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">listService</span>.<span class="title function_">create</span>(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>jwt éªŒè¯æˆ‘å†™äº†ä¸€ä¸ªå®ˆå«</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span>, <span class="title class_">CanActivate</span>, <span class="title class_">ExecutionContext</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">JwtCommonService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../auth/jwt.common.service&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">JwtAuthGuard</span> <span class="keyword">implements</span> <span class="title class_">CanActivate</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> jwtCommonService: JwtCommonService</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">canActivate</span>(<span class="attr">context</span>: <span class="title class_">ExecutionContext</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> request = context.<span class="title function_">switchToHttp</span>().<span class="title function_">getRequest</span>();</span><br><span class="line">    <span class="keyword">const</span> token = request.<span class="property">headers</span>.<span class="property">authorization</span>?.<span class="title function_">replace</span>(<span class="string">&#x27;Bearer &#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!token || !<span class="variable language_">this</span>.<span class="property">jwtCommonService</span>.<span class="title function_">verifyToken</span>(token)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åpostman æµ‹è¯•ä¸€ä¸‹, æ·»åŠ æˆåŠŸ</p><h3 id="04-ç¼–è¾‘ä»»åŠ¡"><a href="#04-ç¼–è¾‘ä»»åŠ¡" class="headerlink" title="04. ç¼–è¾‘ä»»åŠ¡"></a>04. ç¼–è¾‘ä»»åŠ¡</h3><p>ç±»ä¼¼æ·»åŠ çš„æ€è·¯</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Put</span>(<span class="string">&#x27;:id&#x27;</span>)</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">update</span>(</span><br><span class="line">  <span class="meta">@Param</span>(<span class="string">&#x27;id&#x27;</span>) <span class="attr">id</span>: <span class="built_in">number</span>,</span><br><span class="line">  <span class="meta">@Body</span>() <span class="attr">list</span>: <span class="title class_">TaskDto</span>,</span><br><span class="line">  <span class="meta">@Req</span>() request,</span><br><span class="line">): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> task = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">listService</span>.<span class="title function_">findOne</span>(id);</span><br><span class="line">  <span class="keyword">if</span> (task === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (task.<span class="property">userId</span> !== request.<span class="property">user</span>.<span class="property">id</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">HttpException</span>(<span class="string">&#x27;Forbidden&#x27;</span>, <span class="title class_">HttpStatus</span>.<span class="property">NOT_FOUND</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> entity = <span class="keyword">new</span> <span class="title class_">List</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> list) &#123;</span><br><span class="line">    entity[key] = list[key];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">listService</span>.<span class="title function_">update</span>(id, entity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="05-è·å–"><a href="#05-è·å–" class="headerlink" title="05. è·å–"></a>05. è·å–</h3><p>å•ä¸ªè·å–ï¼Œå°±ç›´æ¥éªŒè¯ tokenï¼ŒéªŒè¯ userIdï¼Œç„¶åæ‹¿å–</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">&#x27;:id&#x27;</span>)</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">findOne</span>(<span class="meta">@Param</span>(<span class="string">&#x27;id&#x27;</span>) <span class="attr">id</span>: <span class="built_in">number</span>, <span class="meta">@Req</span>() request): <span class="title class_">Promise</span>&lt;<span class="title class_">List</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">listService</span>.<span class="title function_">findOne</span>(id);</span><br><span class="line">  <span class="keyword">if</span> (result === <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">HttpException</span>(<span class="string">&#x27;404&#x27;</span>, <span class="title class_">HttpStatus</span>.<span class="property">NOT_FOUND</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (result.<span class="property">userId</span> !== request.<span class="property">user</span>.<span class="property">id</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">HttpException</span>(<span class="string">&#x27;Forbidden&#x27;</span>, <span class="title class_">HttpStatus</span>.<span class="property">NOT_FOUND</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å–æ‰€æœ‰ï¼Œè¿™é‡Œå…¶å®æœ‰ä¸€ä¸ªç–‘é—®ï¼Œå°±æ˜¯ todolist è¿™ç§ç±»å‹çš„åº”ç”¨æ˜¯å¦éœ€è¦åˆ†é¡µè·å–ï¼Œåæ¥æƒ³äº†ä¸€ä¸‹ï¼Œå°±å½“å‰ç«¯ç»ƒä¹ ä¸€ä¸‹å§ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">&#x27;/all/:page&#x27;</span>)</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">findAll</span>(<span class="meta">@Param</span>(<span class="string">&#x27;page&#x27;</span>) <span class="attr">page</span>: <span class="built_in">number</span>, <span class="meta">@Req</span>() request): <span class="title class_">Promise</span>&lt;<span class="title class_">List</span>[]&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> userId = request.<span class="property">user</span>.<span class="property">id</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">listService</span>.<span class="title function_">findAll</span>(userId, &#123;</span><br><span class="line">    page,</span><br><span class="line">    <span class="attr">pageSize</span>: <span class="number">25</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">findAll</span>(<span class="attr">userId</span>: <span class="built_in">number</span>, <span class="attr">options</span>: <span class="title class_">IPage</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">List</span>[]&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">listRepository</span>.<span class="title function_">find</span>(&#123;</span><br><span class="line">    <span class="attr">where</span>: &#123;</span><br><span class="line">      userId,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">skip</span>: (options.<span class="property">page</span> - <span class="number">1</span>) * options.<span class="property">pageSize</span>,</span><br><span class="line">    <span class="attr">take</span>: options.<span class="property">pageSize</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹æ²¡é—®é¢˜</p><h3 id="06-åˆ é™¤"><a href="#06-åˆ é™¤" class="headerlink" title="06. åˆ é™¤"></a>06. åˆ é™¤</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Delete</span>(<span class="string">&#x27;:id&#x27;</span>)</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">remove</span>(<span class="meta">@Param</span>(<span class="string">&#x27;id&#x27;</span>) <span class="attr">id</span>: <span class="built_in">number</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">listService</span>.<span class="title function_">remove</span>(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="07-æé†’å’Œè¿‡æœŸ"><a href="#07-æé†’å’Œè¿‡æœŸ" class="headerlink" title="07. æé†’å’Œè¿‡æœŸ"></a>07. æé†’å’Œè¿‡æœŸ</h3><p>éœ€è¦ç»´æŠ¤ä¸€ä¸ªè½®è¯¢ï¼Œä¹Ÿå°±æ˜¯è¯´åˆ©ç”¨ linux corn è¿™ç§æœºåˆ¶ï¼Œç„¶åå®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰éœ€è¦æé†’çš„ä»»åŠ¡ã€‚</p><p>ä¸ä»…ä»…å¦‚æ­¤ï¼Œé€šçŸ¥æœ‰å¤šç§æ–¹å¼ï¼Œæ¯”å¦‚é‚®ä»¶ï¼Œæ¯”å¦‚å¾®ä¿¡æé†’ï¼Œæ¯”å¦‚appé€šçŸ¥ï¼Œæ¯”å¦‚çŸ­ä¿¡ï¼Œæ‰€ä»¥éœ€è¦å°è£…ä¸€ä¸ªæŠ½è±¡ç±»æˆ–è€…æ¥å£ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save @nestjs/schedule cron</span><br></pre></td></tr></table></figure><p>ç„¶åå†™ä¸€ä¸ª service</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Cron</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/schedule&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TaskCronService</span> &#123;</span><br><span class="line">  <span class="meta">@Cron</span>(<span class="string">&#x27;0 * * * * *&#x27;</span>)</span><br><span class="line">  <span class="title function_">handleCron</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Cron Job executed!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸»ç¨‹åºæ³¨å†Œ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">imports</span>: [</span><br><span class="line">  <span class="title class_">ScheduleModule</span>.<span class="title function_">forRoot</span>(),</span><br><span class="line">],</span><br><span class="line"><span class="attr">providers</span>:[<span class="title class_">TaskCronService</span>],</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥å¼€å§‹æ‰§è¡Œäº†ï¼Œç°åœ¨éœ€è¦å¼•å…¥å…¶ä»–service, æ¯”å¦‚mailServiceä¹‹ç±»çš„ï¼Œä¸‹é¢å°±æ˜¯ä»£ç çš„æˆå“</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Cron</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/schedule&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ListService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;src/list/list.service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UserService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;src/user/user.service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MailService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;src/common/mail.service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> moment <span class="keyword">from</span> <span class="string">&#x27;moment&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emailContent = <span class="string">`</span></span><br><span class="line"><span class="string">&lt;h1&gt;ä»»åŠ¡æé†’&lt;/h1&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;å°Šæ•¬çš„ç”¨æˆ·ï¼Œæ‚¨è®¾ç½®çš„ä»»åŠ¡å·²ç»åˆ°äº†é¢„å®šçš„æ—¶é—´ï¼š&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;&lt;strong&gt;ä»»åŠ¡åç§°ï¼š&lt;/strong&gt; &#123;taskName&#125;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;&lt;strong&gt;ä»»åŠ¡æ—¶é—´ï¼š&lt;/strong&gt; &#123;taskTime&#125;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;&lt;strong&gt;ä»»åŠ¡æè¿°ï¼š&lt;/strong&gt; &#123;description&#125;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;è¯·åŠæ—¶å®Œæˆæ‚¨çš„ä»»åŠ¡ã€‚&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;æ„Ÿè°¢æ‚¨ä½¿ç”¨æˆ‘ä»¬çš„æœåŠ¡ï¼&lt;/p&gt;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TaskCronService</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> <span class="keyword">readonly</span> listService: ListService,</span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> <span class="keyword">readonly</span> userService: UserService,</span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> <span class="keyword">readonly</span> mailService: MailService,</span></span><br><span class="line"><span class="params">  </span>) &#123;&#125;</span><br><span class="line">  <span class="meta">@Cron</span>(<span class="string">&#x27;0 * * * * *&#x27;</span>)</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">handleCron</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ‰§è¡Œäº†ä»»åŠ¡&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> currentTime = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line">    <span class="keyword">const</span> maxDiff = <span class="number">59</span>; <span class="comment">//ç§’</span></span><br><span class="line">    <span class="keyword">const</span> tasks = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">listService</span>.<span class="title function_">findAllNormalTask</span>();</span><br><span class="line">    <span class="keyword">const</span> filteredTasks = tasks.<span class="title function_">filter</span>(<span class="function">(<span class="params">task</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> taskTime = task.<span class="property">taskTime</span>;</span><br><span class="line">      <span class="keyword">const</span> timeDifference = <span class="title class_">Math</span>.<span class="title function_">abs</span>(taskTime.<span class="title function_">getTime</span>() - currentTime) / <span class="number">1000</span>; <span class="comment">// è½¬æ¢ä¸ºç§’</span></span><br><span class="line">      <span class="keyword">return</span> timeDifference &lt;= maxDiff;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç›®å‰éœ€è¦æ”¯æŒå››ç§æé†’æ–¹å¼</span></span><br><span class="line">    <span class="comment">//1. é‚®ç®±</span></span><br><span class="line">    <span class="comment">//2. appé€šçŸ¥</span></span><br><span class="line">    <span class="comment">//3. å¾®ä¿¡é€šçŸ¥</span></span><br><span class="line">    <span class="comment">//4. çŸ­ä¿¡é€šçŸ¥</span></span><br><span class="line">    <span class="comment">//ä¸ºäº†æ€§èƒ½ï¼Œæœ€å¥½å‘é€éƒ½æ˜¯è°ƒç”¨å…¶ä»–æœåŠ¡</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; filteredTasks.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> task = filteredTasks[i];</span><br><span class="line">      <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">userService</span>.<span class="title function_">findUserById</span>(task.<span class="property">userId</span>);</span><br><span class="line">      <span class="keyword">if</span> (user !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!!user.<span class="property">email</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">mailService</span>.<span class="title function_">sendEmail</span>(</span><br><span class="line">            user.<span class="property">email</span>,</span><br><span class="line">            task.<span class="property">title</span>,</span><br><span class="line">            emailContent</span><br><span class="line">              .<span class="title function_">replace</span>(<span class="string">&#x27;&#123;taskName&#125;&#x27;</span>, task.<span class="property">title</span>)</span><br><span class="line">              .<span class="title function_">replace</span>(</span><br><span class="line">                <span class="string">&#x27;&#123;taskTime&#125;&#x27;</span>,</span><br><span class="line">                <span class="title function_">moment</span>(task.<span class="property">taskTime</span>).<span class="title function_">format</span>(<span class="string">&#x27;YYYY-MM-DD HH:mm&#x27;</span>),</span><br><span class="line">              )</span><br><span class="line">              .<span class="title function_">replace</span>(<span class="string">&#x27;description&#x27;</span>, task.<span class="property">description</span>),</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!!user.<span class="property">phone</span> &amp;&amp; !!user.<span class="property">phoneCode</span>) &#123;</span><br><span class="line">          <span class="comment">//todo..</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…¶ä»–çš„éœ€è¦åšåˆ°äº†å†å†™</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mailService æˆ‘ä½¿ç”¨äº† nodemailerï¼Œä¸‹é¢æ˜¯ä»£ç </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ConfigService</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@nestjs/config&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> nodemailer <span class="keyword">from</span> <span class="string">&#x27;nodemailer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MailService</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="attr">transporter</span>: nodemailer.<span class="property">Transporter</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> <span class="keyword">readonly</span> configService: ConfigService</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> mailConfig = &#123;</span><br><span class="line">      <span class="attr">host</span>: <span class="variable language_">this</span>.<span class="property">configService</span>.<span class="property">get</span>&lt;<span class="built_in">string</span>&gt;(<span class="string">&#x27;MAIL_HOST&#x27;</span>),</span><br><span class="line">      <span class="attr">port</span>: <span class="variable language_">this</span>.<span class="property">configService</span>.<span class="property">get</span>&lt;<span class="built_in">number</span>&gt;(<span class="string">&#x27;MAIL_PORT&#x27;</span>),</span><br><span class="line">      <span class="attr">secure</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">auth</span>: &#123;</span><br><span class="line">        <span class="attr">user</span>: <span class="variable language_">this</span>.<span class="property">configService</span>.<span class="property">get</span>&lt;<span class="built_in">string</span>&gt;(<span class="string">&#x27;MAIL_USER&#x27;</span>),</span><br><span class="line">        <span class="attr">pass</span>: <span class="variable language_">this</span>.<span class="property">configService</span>.<span class="property">get</span>&lt;<span class="built_in">string</span>&gt;(<span class="string">&#x27;MAIL_PASS&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">transporter</span> = nodemailer.<span class="title function_">createTransport</span>(mailConfig);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">sendEmail</span>(<span class="attr">to</span>: <span class="built_in">string</span>, <span class="attr">subject</span>: <span class="built_in">string</span>, <span class="attr">content</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> mailOptions = &#123;</span><br><span class="line">      <span class="attr">from</span>: <span class="variable language_">this</span>.<span class="property">configService</span>.<span class="property">get</span>&lt;<span class="built_in">string</span>&gt;(<span class="string">&#x27;MAIL_FROM&#x27;</span>),</span><br><span class="line">      to,</span><br><span class="line">      subject,</span><br><span class="line">      <span class="attr">text</span>: content,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">transporter</span>.<span class="title function_">sendMail</span>(mailOptions);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="08-æ€»ç»“"><a href="#08-æ€»ç»“" class="headerlink" title="08. æ€»ç»“"></a>08. æ€»ç»“</h3><p>è¿™æ ·çš„è¯ï¼Œä¸€ä¸ªåŸºæœ¬çš„appçš„apiå°±å¯ä»¥æœ‰äº†ï¼Œè™½ç„¶åŠŸèƒ½å¾ˆç®€é™‹ï¼Œåç»­åŠŸèƒ½åç»­å†è¡¥ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> nestjs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uni-app å¼•å¯¼å›¾å’Œå¹¿å‘Š</title>
      <link href="/2023/07/18/uniapp_guird/"/>
      <url>/2023/07/18/uniapp_guird/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-ç¼“å­˜"><a href="#01-ç¼“å­˜" class="headerlink" title="01. ç¼“å­˜"></a>01. ç¼“å­˜</h3><p><a href="https://uniapp.dcloud.net.cn/api/storage/storage.html#clearstorage">https://uniapp.dcloud.net.cn/api/storage/storage.html#clearstorage</a></p><blockquote><p>H5ç«¯ä¸ºlocalStorageï¼Œæµè§ˆå™¨é™åˆ¶5Må¤§å°ï¼Œæ˜¯ç¼“å­˜æ¦‚å¿µï¼Œå¯èƒ½ä¼šè¢«æ¸…ç†<br>Appç«¯ä¸ºåŸç”Ÿçš„plus.storageï¼Œæ— å¤§å°é™åˆ¶ï¼Œä¸æ˜¯ç¼“å­˜ï¼Œæ˜¯æŒä¹…åŒ–çš„<br>å„ä¸ªå°ç¨‹åºç«¯ä¸ºå…¶è‡ªå¸¦çš„storage apiï¼Œæ•°æ®å­˜å‚¨ç”Ÿå‘½å‘¨æœŸè·Ÿå°ç¨‹åºæœ¬èº«ä¸€è‡´ï¼Œå³é™¤ç”¨æˆ·ä¸»åŠ¨åˆ é™¤æˆ–è¶…è¿‡ä¸€å®šæ—¶é—´è¢«è‡ªåŠ¨æ¸…ç†ï¼Œå¦åˆ™æ•°æ®éƒ½ä¸€ç›´å¯ç”¨ã€‚<br>å¾®ä¿¡å°ç¨‹åºå•ä¸ª key å…è®¸å­˜å‚¨çš„æœ€å¤§æ•°æ®é•¿åº¦ä¸º 1MBï¼Œæ‰€æœ‰æ•°æ®å­˜å‚¨ä¸Šé™ä¸º 10MBã€‚<br>æ”¯ä»˜å®å°ç¨‹åºå•æ¡æ•°æ®è½¬æ¢æˆå­—ç¬¦ä¸²åï¼Œå­—ç¬¦ä¸²é•¿åº¦æœ€å¤§200*1024ã€‚åŒä¸€ä¸ªæ”¯ä»˜å®ç”¨æˆ·ï¼ŒåŒä¸€ä¸ªå°ç¨‹åºç¼“å­˜æ€»ä¸Šé™ä¸º10MBã€‚<br>ç™¾åº¦å°ç¨‹åºç­–ç•¥è¯¦è§ã€æŠ–éŸ³å°ç¨‹åºç­–ç•¥è¯¦è§<br>éAppå¹³å°æ¸…ç©ºStorageä¼šå¯¼è‡´uni.getSystemInfoè·å–åˆ°çš„deviceIdæ”¹å˜</p></blockquote><p>åœ¨ h5 ç«¯ï¼Œæ¯ä¸ªå…¶å®ä¸ä¸€æ ·ï¼Œåæ­£ä¸èƒ½å­˜å¤§ä¸œè¥¿, å¦‚æœæƒ³è¦å¤šç«¯å…¼å®¹ï¼Œå»ºè®®è¿˜æ˜¯æœ‰æœåŠ¡å™¨ï¼Œåˆ«åœ¨è¿™é‡Œå­˜ä¸œè¥¿ã€‚</p><ul><li>uni.setStorage</li><li>uni.setStorageSync</li><li>uni.getStorage</li><li>uni.getStorageSync</li><li>uni.getStorageInfo</li><li>uni.getStorageInfoSync</li><li>uni.removeStorage</li><li>uni.removeStorageSync</li><li>uni.clearStorage</li><li>uni.clearStorageSync</li></ul><p>å…·ä½“çš„è‡ªå·±çœ‹æ–‡æ¡£.</p><p>ä¸ºä»€ä¹ˆè¦çŸ¥é“è¿™ä¸ªï¼Ÿå¼•å¯¼é¡µé¢æˆ–è€…å¼€åœºçš„å¹¿å‘Šéœ€è¦åˆ¤æ–­æ˜¾ç¤ºï¼Œæ˜¯å¦éœ€è¦æ¯æ¬¡éƒ½æ˜¾ç¤ºï¼Œå¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡æ€ä¹ˆæ˜¾ç¤ºä¹‹ç±»çš„ã€‚</p><h3 id="02-æœ‰å“ªäº›è®¾ç½®é¡¹ï¼Ÿ"><a href="#02-æœ‰å“ªäº›è®¾ç½®é¡¹ï¼Ÿ" class="headerlink" title="02. æœ‰å“ªäº›è®¾ç½®é¡¹ï¼Ÿ"></a>02. æœ‰å“ªäº›è®¾ç½®é¡¹ï¼Ÿ</h3><p>manifest.json ä¸­ï¼Œç¬¬ä¸€ä¸ª <strong>ç­‰å¾…é¦–é¡µæ¸²æŸ“å®Œæ¯•åå†å…³é—­Splashå›¾</strong></p><p><a href="https://uniapp.dcloud.net.cn/tutorial/app-splashscreen.html#">https://uniapp.dcloud.net.cn/tutorial/app-splashscreen.html#</a></p><blockquote><p>å‹¾é€‰â€œç­‰å¾…é¦–é¡µæ¸²æŸ“å®Œæ¯•åå†å…³é—­Splashå›¾â€ï¼Œè¡¨ç¤ºéœ€è¦ç­‰å¾…é¦–é¡µæ¸²æŸ“å®Œæˆåå†å…³é—­å¯åŠ¨ç•Œé¢<br>ä¸å‹¾é€‰â€œç­‰å¾…é¦–é¡µæ¸²æŸ“å®Œæ¯•åå†å…³é—­Splashå›¾â€ï¼Œåˆ™è¡¨ç¤ºé¦–é¡µåŠ è½½å®Œæˆåå°±ä¼šå…³é—­å¯åŠ¨ç•Œé¢ï¼Œæ­¤æ—¶é¦–é¡µå¯èƒ½æ²¡æœ‰å®Œæˆæ¸²æŸ“ï¼Œåœ¨éƒ¨åˆ†è®¾å¤‡å¯èƒ½&gt;ä¼šé—ªä¸€ä¸‹ç™½å±ï¼Œä¸æ¨èä½¿ç”¨ã€‚</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;splashscreen&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>               <span class="comment">//å¯é€‰ï¼ŒJSONå¯¹è±¡ï¼Œsplashç•Œé¢é…ç½®</span></span><br><span class="line">    <span class="attr">&quot;alwaysShowBeforeRender&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>     <span class="comment">//å¯é€‰ï¼ŒBooleanç±»å‹ï¼Œæ˜¯å¦ç­‰å¾…é¦–é¡µæ¸²æŸ“å®Œæ¯•åå†å…³é—­å¯åŠ¨ç•Œé¢</span></span><br><span class="line">    <span class="attr">&quot;autoclose&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                  <span class="comment">//å¯é€‰ï¼ŒBooleanç±»å‹ï¼Œæ˜¯å¦è‡ªåŠ¨å…³é—­å¯åŠ¨ç•Œé¢</span></span><br><span class="line">    <span class="attr">&quot;waiting&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                    <span class="comment">//å¯é€‰ï¼ŒBooleanç±»å‹ï¼Œæ˜¯å¦åœ¨ç¨‹åºå¯åŠ¨ç•Œé¢æ˜¾ç¤ºç­‰å¾…é›ªèŠ±</span></span><br><span class="line">    <span class="attr">&quot;event&quot;</span><span class="punctuation">:</span> <span class="string">&quot;loaded&quot;</span><span class="punctuation">,</span>                  <span class="comment">//å¯é€‰ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œå¯å–å€¼titleUpdateã€renderingã€loadedï¼Œuni-appé¡¹ç›®å·²åºŸå¼ƒ</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;defalt&quot;</span><span class="punctuation">,</span>                 <span class="comment">//å¯é€‰ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œå¯å–å€¼defaultã€secondï¼Œuni-appé¡¹ç›®å·²åºŸå¼ƒ</span></span><br><span class="line">    <span class="attr">&quot;dealy&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span>                         <span class="comment">//å¯é€‰ï¼Œæ•°å­—ç±»å‹ï¼Œå»¶è¿Ÿè‡ªåŠ¨å…³é—­å¯åŠ¨æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼Œuni-appé¡¹ç›®å·²åºŸå¼ƒ</span></span><br><span class="line">    <span class="attr">&quot;ads&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>                            <span class="comment">//å¯é€‰ï¼ŒJSONå¯¹è±¡ï¼Œå¼€å±å¹¿å‘Šé…ç½®</span></span><br><span class="line">        <span class="attr">&quot;backaground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#RRGGBB&quot;</span><span class="punctuation">,</span>               <span class="comment">//å¯é€‰ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œæ ¼å¼ä¸º#RRGGBBï¼Œå¼€å±å¹¿å‘ŠèƒŒæ™¯é¢œè‰²</span></span><br><span class="line">        <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span>                             <span class="comment">//å¯é€‰ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œåº•éƒ¨å›¾ç‰‡åœ°å€ï¼Œç›¸å¯¹åº”ç”¨èµ„æºç›®å½•è·¯å¾„</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;androidTranslucent&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span>         <span class="comment">//å¯é€‰ï¼ŒBooleanç±»å‹ï¼Œä½¿ç”¨â€œè‡ªå®šä¹‰å¯åŠ¨å›¾â€å¯åŠ¨ç•Œé¢æ—¶æ˜¯å¦æ˜¾ç¤ºé€æ˜è¿‡æ¸¡ç•Œé¢ï¼Œå¯è§£å†³ç‚¹å‡»æ¡Œé¢å›¾æ ‡å»¶æ—¶å¯åŠ¨åº”ç”¨çš„æ•ˆæœ</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;app-plus&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;splashscreen&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>               <span class="comment">//å¯é€‰ï¼ŒJSONå¯¹è±¡ï¼Œsplashç•Œé¢é…ç½®</span></span><br><span class="line">        <span class="attr">&quot;alwaysShowBeforeRender&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>     <span class="comment">//å¯é€‰ï¼ŒBooleanç±»å‹ï¼Œæ˜¯å¦ç­‰å¾…é¦–é¡µæ¸²æŸ“å®Œæ¯•åå†å…³é—­å¯åŠ¨ç•Œé¢</span></span><br><span class="line">        <span class="attr">&quot;autoclose&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                  <span class="comment">//å¯é€‰ï¼ŒBooleanç±»å‹ï¼Œæ˜¯å¦è‡ªåŠ¨å…³é—­å¯åŠ¨ç•Œé¢</span></span><br><span class="line">        <span class="attr">&quot;waiting&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                    <span class="comment">//å¯é€‰ï¼ŒBooleanç±»å‹ï¼Œæ˜¯å¦åœ¨ç¨‹åºå¯åŠ¨ç•Œé¢æ˜¾ç¤ºç­‰å¾…é›ªèŠ±</span></span><br><span class="line">        <span class="attr">&quot;event&quot;</span><span class="punctuation">:</span> <span class="string">&quot;loaded&quot;</span><span class="punctuation">,</span>                  <span class="comment">//å¯é€‰ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œå¯å–å€¼titleUpdateã€renderingã€loadedï¼Œuni-appé¡¹ç›®å·²åºŸå¼ƒ</span></span><br><span class="line">        <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;defalt&quot;</span><span class="punctuation">,</span>                 <span class="comment">//å¯é€‰ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œå¯å–å€¼defaultã€secondï¼Œuni-appé¡¹ç›®å·²åºŸå¼ƒ</span></span><br><span class="line">        <span class="attr">&quot;dealy&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span>                         <span class="comment">//å¯é€‰ï¼Œæ•°å­—ç±»å‹ï¼Œå»¶è¿Ÿè‡ªåŠ¨å…³é—­å¯åŠ¨æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼Œuni-appé¡¹ç›®å·²åºŸå¼ƒ</span></span><br><span class="line">        <span class="attr">&quot;ads&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>                            <span class="comment">//å¯é€‰ï¼ŒJSONå¯¹è±¡ï¼Œå¼€å±å¹¿å‘Šé…ç½®</span></span><br><span class="line">            <span class="attr">&quot;backaground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#RRGGBB&quot;</span><span class="punctuation">,</span>               <span class="comment">//å¯é€‰ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œæ ¼å¼ä¸º#RRGGBBï¼Œå¼€å±å¹¿å‘ŠèƒŒæ™¯é¢œè‰²</span></span><br><span class="line">            <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span>                             <span class="comment">//å¯é€‰ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œåº•éƒ¨å›¾ç‰‡åœ°å€ï¼Œç›¸å¯¹åº”ç”¨èµ„æºç›®å½•è·¯å¾„</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;androidTranslucent&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span>         <span class="comment">//å¯é€‰ï¼ŒBooleanç±»å‹ï¼Œä½¿ç”¨â€œè‡ªå®šä¹‰å¯åŠ¨å›¾â€å¯åŠ¨ç•Œé¢æ—¶æ˜¯å¦æ˜¾ç¤ºé€æ˜è¿‡æ¸¡ç•Œé¢ï¼Œå¯è§£å†³ç‚¹å‡»æ¡Œé¢å›¾æ ‡å»¶æ—¶å¯åŠ¨åº”ç”¨çš„æ•ˆæœ</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="03-swiper"><a href="#03-swiper" class="headerlink" title="03. swiper"></a>03. swiper</h3><p><a href="https://uniapp.dcloud.net.cn/component/swiper.html">https://uniapp.dcloud.net.cn/component/swiper.html</a></p><blockquote><p>ä¸€èˆ¬ç”¨äºå·¦å³æ»‘åŠ¨æˆ–ä¸Šä¸‹æ»‘åŠ¨ï¼Œæ¯”å¦‚bannerè½®æ’­å›¾ã€‚</p><p>æ³¨æ„æ»‘åŠ¨åˆ‡æ¢å’Œæ»šåŠ¨çš„åŒºåˆ«ï¼Œæ»‘åŠ¨åˆ‡æ¢æ˜¯ä¸€å±ä¸€å±çš„åˆ‡æ¢ã€‚swiperä¸‹çš„æ¯ä¸ªswiper-itemæ˜¯ä¸€ä¸ªæ»‘åŠ¨åˆ‡æ¢åŒºåŸŸï¼Œä¸èƒ½åœç•™åœ¨2ä¸ªæ»‘åŠ¨åŒºåŸŸä¹‹é—´ã€‚</p></blockquote><h3 id="04-å¼•å¯¼å›¾"><a href="#04-å¼•å¯¼å›¾" class="headerlink" title="04. å¼•å¯¼å›¾"></a>04. å¼•å¯¼å›¾</h3><p>é¦–å…ˆéœ€è¦æ˜ç™½ï¼Œå¦‚æœè¦å…¼å®¹å°ç¨‹åºï¼Œä¸èƒ½æœ‰è¶…è¿‡200kçš„é™æ€èµ„æºï¼Œå¦‚æœéœ€è¦å°±æ™ºèƒ½ç¬¬ä¸‰æ–¹æˆ–è€…base64æ˜¾ç¤ºã€‚</p><p><a href="https://blog.csdn.net/ITold/article/details/124660256">https://blog.csdn.net/ITold/article/details/124660256</a></p><p>base64 åˆå¯èƒ½é€ æˆæ–‡ä»¶è¿‡å¤§çš„é—®é¢˜ï¼Œæ‰€ä»¥è¿˜æ˜¯è‡ªå·±æœåŠ¡å™¨æˆ–è€…å›¾åºŠæœ€ç†æƒ³ã€‚</p><p>æ‰€ä»¥æˆ‘ä½¿ç”¨ docker å®‰è£…äº†ä¸€ä¸ªå›¾åºŠ <a href="https://hub.docker.com/r/halcyonazure/lsky-pro-docker">https://hub.docker.com/r/halcyonazure/lsky-pro-docker</a></p><p>äºæ˜¯æœ‰äº†è¿™5å¼ å›¾ç‰‡</p><p><a href="http://60.205.227.108:8089/i/2023/07/18/64b65e55b284e.jpg">http://60.205.227.108:8089/i/2023/07/18/64b65e55b284e.jpg</a><br><a href="http://60.205.227.108:8089/i/2023/07/18/64b65e5652a1a.jpg">http://60.205.227.108:8089/i/2023/07/18/64b65e5652a1a.jpg</a><br><a href="http://60.205.227.108:8089/i/2023/07/18/64b65e56d5b91.jpg">http://60.205.227.108:8089/i/2023/07/18/64b65e56d5b91.jpg</a><br><a href="http://60.205.227.108:8089/i/2023/07/18/64b65e576749e.jpg">http://60.205.227.108:8089/i/2023/07/18/64b65e576749e.jpg</a><br><a href="http://60.205.227.108:8089/i/2023/07/18/64b65e58a16df.jpg">http://60.205.227.108:8089/i/2023/07/18/64b65e58a16df.jpg</a></p><p>ç°åœ¨å¯ä»¥å¼€å§‹å¼•å¯¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 100%;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">swiper</span> <span class="attr">class</span>=<span class="string">&quot;swiper&quot;</span> <span class="attr">circular</span></span></span><br><span class="line"><span class="tag"><span class="attr">:duration</span>=<span class="string">&quot;duration&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;skipButton&quot;</span>&gt;</span>è·³è¿‡<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦é“ºæ»¡ï¼Œæ‰€ä»¥åŠ å…¥æ ·å¼</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.swiper</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0px</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0px</span>;</span><br><span class="line">    <span class="attribute">z-index</span>:<span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.swiper</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>button å³ä¸Šè§’</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.skipButton</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="comment">/* å°† bottom æ”¹ä¸º top */</span></span><br><span class="line">    <span class="attribute">right</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#888</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">999</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ å…¥è½®æ’­çš„æŒ‡ç¤º</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">indicator-dots=&quot;true&quot;</span><br></pre></td></tr></table></figure><p>å¢åŠ ç‚¹å‡»è·³è¿‡çš„äº‹ä»¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">        <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;skipButton&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;skip&quot;</span>&gt;</span>è·³è¿‡<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> skip = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">uni.<span class="title function_">redirectTo</span>(&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">url</span>: <span class="string">&#x27;/pages/index/index&#x27;</span></span></span><br><span class="line"><span class="language-javascript">&#125;);</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å½“ç”¨æˆ·åˆ’è¿‡ç¬¬ä¸‰å¼ å›¾ç‰‡çš„æ—¶å€™ï¼Œä¹Ÿè¦è·³è¿‡ï¼Œæ‰€ä»¥éœ€è¦ç»‘å®šäº‹ä»¶</p><p><a href="https://uniapp.dcloud.net.cn/component/swiper.html">https://uniapp.dcloud.net.cn/component/swiper.html</a></p><p>æœ¬æ¥æƒ³å®ç°ä¸€ä¸ªå³æ»‘è¿›å…¥çš„ï¼Œä½†æ˜¯æœ‰ç‚¹éº»çƒ¦ï¼Œè™½ç„¶æœ‰æ€è·¯ï¼Œä½†æ˜¯éº»çƒ¦ï¼Œæ‰€ä»¥åˆ’åˆ°ç¬¬ä¸‰å¼ å›¾ç‰‡1ç§’åï¼Œè‡ªåŠ¨è·³è½¬ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@change=<span class="string">&quot;swiperChange&quot;</span></span><br><span class="line"><span class="keyword">const</span> swiperChange = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(event.<span class="property">detail</span>.<span class="property">current</span> === <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">skip</span>();</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå¼•å¯¼é¡µé¢å°±okäº†ï¼Œå›åˆ°é¦–é¡µ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;launchFlag&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (value) &#123;</span><br><span class="line">    <span class="comment">// å¦‚ä½•å·²ç»æœ‰ï¼Œç›´æ¥å»homeé¦–é¡µ</span></span><br><span class="line">    uni.<span class="title function_">switchTab</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/pages/index/index&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰å€¼ï¼Œè·³åˆ°å¼•å¯¼é¡µï¼Œå¹¶å­˜å‚¨ï¼Œä¸‹æ¬¡æ‰“å¼€å°±ä¸ä¼šè¿›å»å¼•å¯¼é¡µ</span></span><br><span class="line">    uni.<span class="title function_">setStorage</span>(&#123;</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;launchFlag&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    uni.<span class="title function_">redirectTo</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/pages/index/guide&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä»£ç æ”¾åœ¨ <code>onLoad</code> å½“ä¸­ï¼Œå°±æˆå‹äº†ã€‚</p><h3 id="05-å¹¿å‘Š"><a href="#05-å¹¿å‘Š" class="headerlink" title="05. å¹¿å‘Š"></a>05. å¹¿å‘Š</h3><p>å¹¿å‘Šå°±æ˜¯åŒæ ·çš„æ€è·¯ï¼Œåªæ˜¯å¾ˆå¤šå¹¿å‘Šä¸éœ€è¦å¤šå¼ å›¾ï¼Œæ‰€ä»¥ä¸éœ€è¦ <code>swiper</code></p><p>æ‰€ä»¥éœ€è¦çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ä¸€å¼ å›¾ç‰‡å¸¦æœ‰è¿æ¥å’ŒæŒ‰é’®</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;coverAd&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 100%;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;...&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;skipButton&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;skip&quot;</span>&gt;</span>è·³è¿‡(&#123;&#123;timeCount&#125;&#125;)<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;</span></span><br><span class="line"><span class="language-javascript">ref</span></span><br><span class="line"><span class="language-javascript">&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> timeCount = <span class="title function_">ref</span>(<span class="number">5</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">to</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">uni.<span class="title function_">redirectTo</span>(&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">url</span>: <span class="string">&#x27;/pages/index/index&#x27;</span></span></span><br><span class="line"><span class="language-javascript">&#125;);</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">skip</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">if</span> (!!t) &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="built_in">clearInterval</span>(t);</span></span><br><span class="line"><span class="language-javascript">t = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;t:&#x27;</span>, t)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"><span class="title function_">to</span>();</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">let</span> t = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">if</span> (timeCount.<span class="property">value</span> &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">timeCount.<span class="property">value</span>--;</span></span><br><span class="line"><span class="language-javascript">&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="title function_">skip</span>();</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">if</span> (!!t) &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="built_in">clearInterval</span>(t);</span></span><br><span class="line"><span class="language-javascript"><span class="title function_">to</span>();</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;, <span class="number">7000</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.coverAd</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css"><span class="attribute">top</span>: <span class="number">0px</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">bottom</span>: <span class="number">0px</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">z-index</span>: <span class="number">10</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.coverAd</span> <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.skipButton</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">position</span>: fixed;</span></span><br><span class="line"><span class="language-css"><span class="attribute">top</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css"><span class="comment">/* å°† bottom æ”¹ä¸º top */</span></span></span><br><span class="line"><span class="language-css"><span class="attribute">right</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">background-color</span>: <span class="number">#888</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css"><span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css"><span class="attribute">z-index</span>: <span class="number">999</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æš‚æ—¶æ²¡æœ‰è¿æ¥ï¼Œä½†æ˜¯æˆ‘å¸Œæœ›è¿™å¼ å›¾èƒ½åŠ¨ä¸€ä¸‹ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> scaleIn &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.animate-scale</span> &#123;</span><br><span class="line">    <span class="attribute">animation</span>: scaleIn <span class="number">6s</span> infinite alternate;</span><br><span class="line">    <span class="attribute">transform-origin</span>: center center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="06-å…¶ä»–çš„ä¿®æ­£"><a href="#06-å…¶ä»–çš„ä¿®æ­£" class="headerlink" title="06. å…¶ä»–çš„ä¿®æ­£"></a>06. å…¶ä»–çš„ä¿®æ­£</h3><p>å¼•å¯¼è½®æ’­å›¾ä¹Ÿéœ€è¦åŠ å…¥å€’è®¡æ—¶ï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘ä»£ç å¦‚ä½•å¤ç”¨ã€‚</p><p>æ–°å»ºä¸€ä¸ªç»„ä»¶ï¼Œå°è£…ä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;button class=&quot;skipButton&quot; @click=&quot;skip&quot;&gt;&#123;&#123;txtName&#125;&#125;(&#123;&#123;timeCount&#125;&#125;)&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123;</span><br><span class="line">ref,</span><br><span class="line">defineProps</span><br><span class="line">&#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">delay: &#123;</span><br><span class="line">type: Number,</span><br><span class="line">required: false, </span><br><span class="line">default: 5, </span><br><span class="line">&#125;,</span><br><span class="line">jump: &#123;</span><br><span class="line">type: String,</span><br><span class="line">required: true, </span><br><span class="line">&#125;,</span><br><span class="line">txtName: &#123;</span><br><span class="line">type: String,</span><br><span class="line">required: false, </span><br><span class="line">default: &quot;è·³è¿‡&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const &#123;</span><br><span class="line">delay,</span><br><span class="line">jump,</span><br><span class="line">txtName</span><br><span class="line">&#125; = props;</span><br><span class="line"></span><br><span class="line">const timeCount = ref(delay);</span><br><span class="line"></span><br><span class="line">const to = () =&gt; &#123;</span><br><span class="line">uni.redirectTo(&#123;</span><br><span class="line">url: jump</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const skip = () =&gt; &#123;</span><br><span class="line">if (!!t) &#123;</span><br><span class="line">clearInterval(t);</span><br><span class="line">t = null;</span><br><span class="line">console.log(&#x27;t:&#x27;, t)</span><br><span class="line">&#125;</span><br><span class="line">to();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let t = setInterval(() =&gt; &#123;</span><br><span class="line">if (timeCount.value &gt; 0) &#123;</span><br><span class="line">timeCount.value--;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">skip();</span><br><span class="line">&#125;</span><br><span class="line">&#125;, 1000)</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">if (!!t) &#123;</span><br><span class="line">clearInterval(t);</span><br><span class="line">to();</span><br><span class="line">&#125;</span><br><span class="line">&#125;, 7000);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.skipButton &#123;</span><br><span class="line">position: fixed;</span><br><span class="line">top: 20px;</span><br><span class="line">/* å°† bottom æ”¹ä¸º top */</span><br><span class="line">right: 20px;</span><br><span class="line">padding: 10px 20px;</span><br><span class="line">background-color: #888;</span><br><span class="line">color: #fff;</span><br><span class="line">border: none;</span><br><span class="line">border-radius: 5px;</span><br><span class="line">font-size: 16px;</span><br><span class="line">cursor: pointer;</span><br><span class="line">z-index: 999;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸ªå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœé¡µé¢è‡ªè¡Œè·³è½¬ï¼Œæ¯”å¦‚å¼•å¯¼é¡µï¼Œé‚£ä¹ˆä¸­é—´æ˜¯æ²¡æœ‰åœæ­¢å‚æ•°çš„ï¼Œé‚£ä¹ˆè¿˜éœ€è¦å’Œç»„ä»¶è¿›è¡Œé€šä¿¡ã€‚</p><p>vue ç»„ä»¶é€šä¿¡æœ‰å¾ˆå¤šæ–¹æ³•, åæ­£å°±æ˜¯é€šä¿¡åœæ­¢æˆ–è€…å¤–éƒ¨ä¸è¦è·³è½¬ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> å¤šç«¯ </tag>
            
            <tag> uniapp </tag>
            
            <tag> guid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uni-app è°ƒè¯•</title>
      <link href="/2023/07/18/uniapp_tiaoshi/"/>
      <url>/2023/07/18/uniapp_tiaoshi/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>ä½ æ€ä¹ˆçŸ¥é“ä½ çš„ä»£ç åœ¨å…¶ä»–å¹³å° ok å‘¢ï¼Ÿæ‰€ä»¥éœ€è¦è°ƒè¯•</p><p>è¿è¡Œ &#x3D;&gt; å¯ä»¥è¿è¡Œå„ç§æ¨¡æ‹Ÿè°ƒè¯•çš„æ–¹å¼</p><h3 id="å¾®ä¿¡å°ç¨‹åºè°ƒè¯•"><a href="#å¾®ä¿¡å°ç¨‹åºè°ƒè¯•" class="headerlink" title="å¾®ä¿¡å°ç¨‹åºè°ƒè¯•"></a>å¾®ä¿¡å°ç¨‹åºè°ƒè¯•</h3><p>é¦–å…ˆä½ å¾—ä¸‹è½½å¾®ä¿¡å°ç¨‹åºçš„å¼€å‘å·¥å…·ã€‚</p><p>åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œè°ƒç”¨ è¿è¡Œ &#x3D;&gt; è¿è¡Œåˆ°å°ç¨‹åºæ¨¡æ‹Ÿå™¨ &#x3D;&gt; é€‰æ‹©.</p><p>ç„¶åè®©ä½ é€‰æ‹©å°ç¨‹åºè·¯å¾„ï¼Œç„¶åå¼€å§‹è°ƒè¯•ã€‚</p><p>æœç„¶æˆ‘å°±å‘ç°äº†è‡ªå·±çš„ä¸€ä¸ªé—®é¢˜ï¼Œåˆšæ‰åšçš„å¼•å¯¼å›¾å’Œå¹¿å‘Šå½“ä¸­å‘ç°äº†é—®é¢˜ï¼Œå›¾ç‰‡åœ¨å°ç¨‹åºä¸­æ²¡æœ‰æ’‘æ»¡ã€‚</p><p>ä½¿ç”¨å°ç¨‹åºçš„è°ƒè¯•å™¨è°ƒäº†ä¸€ä¸‹, å‘ç°å°ç¨‹åºç»„ä»¶åå­—ä¸ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;coverAd&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height:100%&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;animate-scale&quot;</span> <span class="attr">src</span>=<span class="string">&quot; ...</span></span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ css</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.coverAd img &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤±æ•ˆäº†..</p><p>ç®€å•æ”¹å°±æ˜¯å¢åŠ ä¸€ä¸ªæ ·å¼ image å°±å¯ä»¥äº†ï¼ŒæŸ¥äº†æ–‡æ¡£ä»¥åå‘ç°å…¶å®è¿˜æ˜¯éœ€è¦ä½¿ç”¨ç»„ä»¶ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ img</p><p><a href="https://zh.uniapp.dcloud.io/component/image.html">https://zh.uniapp.dcloud.io/component/image.html</a></p><p>è°ƒè¯•ï¼Œç›´æ¥ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·å°±å¯ä»¥è°ƒè¯•äº†ã€‚</p><h3 id="02-å®‰å“è°ƒè¯•"><a href="#02-å®‰å“è°ƒè¯•" class="headerlink" title="02. å®‰å“è°ƒè¯•"></a>02. å®‰å“è°ƒè¯•</h3><p>è¿˜æ˜¯ä¸€æ ·çš„æ“ä½œï¼Œåªæ˜¯è¿™æ¬¡æ˜¯è¿æ¥æ‰‹æœºï¼Œä½ éœ€è¦æŠŠå¼€å‘è€…æ¨¡å¼ï¼Œusbè°ƒè¯•æ¨¡å¼æ‰“å¼€ï¼Œæ¯ä¸ªæ‰‹æœºæ–¹æ³•ä¸åŒï¼Œè¿™ä¸ªæš‚ä¸èµ˜è¿°ã€‚</p><p>åªæ˜¯æˆ‘é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜</p><blockquote><p>åŒæ­¥èµ„æºå¤±è´¥ï¼Œæœªå¾—åˆ°åŒæ­¥èµ„æºçš„æˆæƒï¼Œè¯·åœæ­¢è¿è¡Œåé‡æ–°è¿è¡Œï¼Œå¹¶æ³¨æ„æ‰‹æœºä¸Šçš„æˆæƒæç¤º</p></blockquote><p>è¿™ä¸ªé—®é¢˜æŠ˜è…¾äº†æˆ‘åŠå¤©ï¼Œç½‘ä¸Šæœ‰å„ç§å„æ ·çš„åŠæ³•ï¼Œéƒ½ä¸è¡Œï¼Œæœ€åæˆ‘å‘ç°å…¶å®æˆ‘æ²¡æœ‰å®‰è£… hbuilder è¿™ä¸ªappï¼Œæ‰€ä»¥ç›´æ¥æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬appï¼Œç„¶åç›´æ¥æ‹·è´åˆ°æ‰‹æœºä¸­å®‰è£…ï¼Œè¿æ¥æˆåŠŸã€‚</p><p>ç›®å‰ console.log æ—¥å¿—ä¼šåœ¨æ§åˆ¶å°æ‰“å‡ºæ¥ï¼Œä»…æ­¤è€Œå·²ã€‚ã€‚</p><p>è¿œç¨‹è°ƒè¯• <a href="https://blog.csdn.net/weixin_42089228/article/details/124362840">https://blog.csdn.net/weixin_42089228/article/details/124362840</a></p><h3 id="03-ios"><a href="#03-ios" class="headerlink" title="03 ios"></a>03 ios</h3><p>æ²¡æœ‰è‹¹æœæ‰‹æœºï¼Œæš‚æ— ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> å¤šç«¯ </tag>
            
            <tag> uniapp </tag>
            
            <tag> è°ƒè¯• </tag>
            
            <tag> å°ç¨‹åº </tag>
            
            <tag> app </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uni-app ç®€ä»‹</title>
      <link href="/2023/07/18/uniapp_base/"/>
      <url>/2023/07/18/uniapp_base/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="è¿‡æ–‡æ¡£"><a href="#è¿‡æ–‡æ¡£" class="headerlink" title="è¿‡æ–‡æ¡£"></a>è¿‡æ–‡æ¡£</h3><p><a href="https://uniapp.dcloud.net.cn/tutorial/page.html#%E8%B7%AF%E7%94%B1%E8%B7%B3%E8%BD%AC">é¡µé¢ç®€ä»‹</a> ä¸»è¦ä»‹ç»äº†</p><ul><li>é¡µé¢ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…å« <strong>uni-app</strong> ç”Ÿå‘½å‘¨æœŸå’Œ <strong>Vue</strong> ç”Ÿå‘½å‘¨æœŸ</li><li>é¡µé¢è°ƒç”¨æ¥å£ ä¸»è¦è·å–é¡µé¢å®ä¾‹</li><li>é¡µé¢é€šè®¯ ä¸»è¦æ˜¯é€šè¿‡äº‹ä»¶é€šä¿¡</li><li>è·¯ç”±è·³è½¬çš„æ–¹æ³•</li></ul><p>åœ¨æœ€åè¯´äº†ä¸€ä¸‹ <strong>nvue å¼€å‘ä¸ vue å¼€å‘çš„å¸¸è§åŒºåˆ«</strong></p><p><a href="https://uniapp.dcloud.net.cn/tutorial/nvue-outline.html">https://uniapp.dcloud.net.cn/tutorial/nvue-outline.html</a><br><a href="https://www.zhihu.com/question/405786306">https://www.zhihu.com/question/405786306</a></p><p><a href="https://uniapp.dcloud.net.cn/tutorial/page-component.html">å¼•ç”¨</a></p><p>è¿™ä¸€ç« èŠ‚ä¸»è¦å‘Šè¯‰ä½ å¦‚ä½•å¼•ç”¨ç»„ä»¶ï¼Œjsï¼Œcssï¼Œä»¥åŠæ’ä»¶ï¼Œå»ºè®®æŒ‰ç…§åŸç”Ÿæ–¹å¼å»å†™ã€‚</p><p><a href="https://uniapp.dcloud.net.cn/tutorial/syntax-js.html">js è¯­æ³•</a> </p><p>å¯ä»¥ç†è§£ä¸ºæ”¯æŒ ES6 æ ‡å‡†</p><p><a href="https://uniapp.dcloud.net.cn/tutorial/syntax-css.html">CSS æ”¯æŒ</a> </p><p><a href="https://uniapp.dcloud.net.cn/tutorial/syntax-uts.html">UTSä»‹ç»</a> </p><p>è¿™ä¸ªè¿˜ä¸äº†è§£ï¼Œå¤§æ„æ˜¯ uts å¯ä»¥ç¼–è¯‘æˆåŸç”Ÿçš„appæºç ï¼Œæ¯”å¦‚è¯´å®‰å“ Kotlinï¼Œiso swiftï¼Œæ•ˆç‡é«˜</p><p><a href="https://uniapp.dcloud.net.cn/tutorial/compiler.html">ç¼–è¯‘å™¨</a></p><p>ç¼–è¯‘å™¨ä¸»è¦æ˜¯æƒ³è¦è®²ï¼Œå¦‚æœæ ¹æ®ç¯å¢ƒå˜é‡ï¼Œä»¥åŠ <strong>#ifdef</strong> æ¥æœ‰æ¡ä»¶çš„å˜å¼‚ï¼Œæ¥æ”¯æŒæŸäº›å¹³å°çš„ç‰¹æ€§ã€‚</p><p><a href="https://uniapp.dcloud.net.cn/tutorial/CORS.html">è·¨åŸŸ</a></p><p><a href="https://uniapp.dcloud.net.cn/tutorial/adapt.html">å®½å±é€‚é…</a></p><blockquote><p>ä»¥ç›®å‰æ‰‹æœºå±å¹•ä¸ºä¸»windowï¼Œåœ¨å·¦å³ä¸Šï¼Œå¯æ–°æ‰©å±• leftWindowã€rightWindowã€topWindowï¼Œè¿™äº›åŒºåŸŸå¯è®¾å®šåœ¨ä¸€å®šå±å¹•å®½åº¦èŒƒå›´è‡ªåŠ¨å‡ºç°æˆ–æ¶ˆå¤±ã€‚è¿™äº›åŒºåŸŸå„è‡ªç‹¬ç«‹ï¼Œåˆ‡æ¢é¡µé¢æ”¯æŒåœ¨å„è‡ªçš„windowå†…åˆ·æ–°ï¼Œè€Œä¸æ˜¯æ•´å±åˆ·æ–°ã€‚</p></blockquote><p>è¿™ä¸ªè¿˜ä¸æ˜¯å¾ˆæ˜ç™½</p><p><a href="https://uniapp.dcloud.net.cn/collocation/pages.html">pages.json é¡µé¢è·¯ç”±</a></p><blockquote><p>pages.json æ–‡ä»¶ç”¨æ¥å¯¹ uni-app è¿›è¡Œå…¨å±€é…ç½®ï¼Œå†³å®šé¡µé¢æ–‡ä»¶çš„è·¯å¾„ã€çª—å£æ ·å¼ã€åŸç”Ÿçš„å¯¼èˆªæ ã€åº•éƒ¨çš„åŸç”Ÿtabbar ç­‰ã€‚</p></blockquote><p><a href="https://uniapp.dcloud.net.cn/collocation/manifest.html#">manifest.json åº”ç”¨é…ç½®</a></p><p>å…¶ä»–ç”¨åˆ°å†çœ‹ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> å¤šç«¯ </tag>
            
            <tag> uniapp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uni-app å¼•ç”¨æ’ä»¶</title>
      <link href="/2023/07/18/uniapp_plus/"/>
      <url>/2023/07/18/uniapp_plus/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>ä¸»è¦æ˜¯éœ€è¦ä¸€ä¸ªUIç»„ä»¶ï¼Œé€‰æ‹©ä½¿ç”¨è¿™ä¸ª <a href="https://github.com/FirstUI/FirstUI%EF%BC%8C%E6%8F%92%E4%BB%B6%E7%9A%84%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F%E4%B9%9F%E5%9C%A8%E4%B8%8A%E9%9D%A2">https://github.com/FirstUI/FirstUIï¼Œæ’ä»¶çš„å®‰è£…æ–¹å¼ä¹Ÿåœ¨ä¸Šé¢</a></p><p>å®‰è£…ä»¥åæµ‹è¯•ä¸€ä¸‹</p><p><a href="https://uniapp.dcloud.net.cn/collocation/pages.html#style">https://uniapp.dcloud.net.cn/collocation/pages.html#style</a><br><a href="https://doc.firstui.cn/docs/started.html">https://doc.firstui.cn/docs/started.html</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸‹è½½å®‰è£…æ—¶easycomé…ç½®</span></span><br><span class="line"><span class="string">&quot;easycom&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;autoscan&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">&quot;custom&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;fui-(.*)&quot;</span>: <span class="string">&quot;@/components/firstui/fui-$1/fui-$1.vue&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨npmå®‰è£…æ—¶easycomé…ç½®ï¼ˆé…ç½®å®Œæˆåé‡æ–°ç¼–è¯‘è¿è¡Œï¼‰</span></span><br><span class="line"><span class="string">&quot;easycom&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;autoscan&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">&quot;custom&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;fui-(.*)&quot;</span>: <span class="string">&quot;firstui-uni/firstui/fui-$1/fui-$1.vue&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åå¼•ç”¨æˆåŠŸ</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> æ’ä»¶ </tag>
            
            <tag> vue </tag>
            
            <tag> å¤šç«¯ </tag>
            
            <tag> uniapp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€å•çš„todoList</title>
      <link href="/2023/07/14/ss_simple_todo/"/>
      <url>/2023/07/14/ss_simple_todo/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-ç®€å•ç‰ˆæœ¬"><a href="#01-ç®€å•ç‰ˆæœ¬" class="headerlink" title="01. ç®€å•ç‰ˆæœ¬"></a>01. ç®€å•ç‰ˆæœ¬</h3><p><strong>wsml</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;input-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;input-text&quot;</span> <span class="attr">bindinput</span>=<span class="string">&quot;inputChange&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¾“å…¥ä»»åŠ¡&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;inputValue&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;add-button&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;addTask&quot;</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;task-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;taskList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;task-item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;task-item-text&quot;</span>&gt;</span>&#123;&#123;item.task&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;task-item-time&quot;</span>&gt;</span>&#123;&#123;item.time&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>wxss</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.input-container</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.input-text</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.add-button</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#007AFF</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.task-list</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">15px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.task-item</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f7f7f7</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.task-item-text</span> &#123;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">word-break</span>: break-all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.task-item-time</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>wxs</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">inputValue</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">taskList</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">inputChange</span>: <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">inputValue</span>: e.<span class="property">detail</span>.<span class="property">value</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">addTask</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> task = &#123;</span><br><span class="line">      <span class="attr">task</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">inputValue</span>,</span><br><span class="line">      <span class="attr">time</span>: <span class="variable language_">this</span>.<span class="title function_">getRemindTime</span>()</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> newList = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">taskList</span>.<span class="title function_">concat</span>(task);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">taskList</span>: newList,</span><br><span class="line">      <span class="attr">inputValue</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">getRemindTime</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> currentTime = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="keyword">var</span> remindTime = <span class="keyword">new</span> <span class="title class_">Date</span>(currentTime.<span class="title function_">getTime</span>() + <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span>); <span class="comment">// 5åˆ†é’Ÿåæé†’</span></span><br><span class="line">    <span class="keyword">return</span> remindTime.<span class="title function_">toLocaleTimeString</span>(<span class="string">&#x27;en-US&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç®€å•è§£é‡Šä¸€ä¸‹ï¼Œç°åœ¨å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ·»åŠ æ–‡å­—ï¼Œåˆ°åˆ—è¡¨çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚</p><p>ç°åœ¨åŒ…å«äº†å½“å‰æ—¶é—´å’Œæé†’æ—¶é—´ï¼Œä»¥åŠæ–‡å­—ä¸¤ä¸ªå­—æ®µã€‚</p><p>æ•ˆæœå¤§æ¦‚å°±æ˜¯ä¸‹å›¾è¿™æ ·</p><p><a href="/%5Cimg%5C2023-07-11-211057.png" title="alt text" class="gallery-item" style="box-shadow: none;"> <img src="/%5Cimg%5C2023-07-11-211057.png" alt="alt text"></a></p><h3 id="02-æœ¬åœ°åŒ–å­˜å‚¨"><a href="#02-æœ¬åœ°åŒ–å­˜å‚¨" class="headerlink" title="02. æœ¬åœ°åŒ–å­˜å‚¨"></a>02. æœ¬åœ°åŒ–å­˜å‚¨</h3><p>å…ˆé™åˆ¶ä¸€ä¸‹è¾“å…¥ï¼Œå°äº3ä¸ªå­—ç¬¦ï¼Œæˆ–è€…å¤šä½™40ä¸ªå­—ç¬¦ï¼Œéƒ½ä¸å…è®¸è¾“å…¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> txt = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">inputValue</span>.<span class="title function_">trim</span>();</span><br><span class="line"><span class="keyword">if</span> (txt.<span class="property">length</span> &gt; <span class="number">40</span> || txt.<span class="property">length</span> &lt; <span class="number">3</span>) &#123;</span><br><span class="line">  wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line"><span class="attr">title</span>: <span class="string">&#x27;ä»»åŠ¡é•¿åº¦ä¸æ­£ç¡®&#x27;</span>,</span><br><span class="line"><span class="attr">icon</span>: <span class="string">&#x27;error&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°ç”Ÿå‘½å‘¨æœŸçš„é¡µé¢ï¼Œå‘ç° onload è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæœ€é€‚åˆ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// é¡µé¢åŠ è½½æ—¶è¯»å–æœ¬åœ°å­˜å‚¨çš„ä»»åŠ¡åˆ—è¡¨æ•°æ®</span></span><br><span class="line">wx.<span class="title function_">getStorage</span>(&#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;taskList&#x27;</span>,</span><br><span class="line">  <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">  <span class="attr">taskList</span>: res.<span class="property">data</span></span><br><span class="line">&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ä¿å­˜çš„åœ°æ–¹åŠ å…¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿å­˜æ›´æ–°åçš„ä»»åŠ¡åˆ—è¡¨æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨</span></span><br><span class="line">wx.<span class="title function_">setStorage</span>(&#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;taskList&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: newList</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æœ€åæŠŠ key å®šä¹‰ä¸ºå¸¸äº®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> key = <span class="string">&#x27;taskList&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="03-åˆ é™¤ã€‚"><a href="#03-åˆ é™¤ã€‚" class="headerlink" title="03. åˆ é™¤ã€‚"></a>03. åˆ é™¤ã€‚</h3><p><a href="/%5Cimg%5C2023-07-11-211057.png" title="alt text" class="gallery-item" style="box-shadow: none;"> <img src="/%5Cimg%5C2023-07-11-211057.png" alt="alt text"></a></p><p>æˆ‘æƒ³å®ç°å¡ç‰‡å¼åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯é‚£ç§å·¦æ»‘åˆ é™¤ã€‚é‚£ä¹ˆæ€è·¯æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform">https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform-function/translateX">https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform-function/translateX</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">10px</span>); <span class="comment">/* ç­‰åŒäº translate(10px) */</span></span><br></pre></td></tr></table></figure><p>å³è¾¹çœ‹ä¸è§çš„åœ°æ–¹éšè—èœå•, ç„¶åå°±å½“æ•è·åˆ°äº‹ä»¶ï¼Œå°±å¯ä»¥æ˜¾ç¤ºèœå•ã€‚</p><p>åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆä¿®æ”¹ä¸€ä¸‹æ ·å¼ï¼Œæ¯•ç«Ÿåœ†æ»šæ»šç°è‰²èƒŒæ™¯ä¸å¤ªèˆ’æœã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.task-item</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid gray;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.task-item-text</span> &#123;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden; <span class="comment">/* éšè—æº¢å‡ºå†…å®¹ */</span></span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis; <span class="comment">/* ä½¿ç”¨çœç•¥å·ä»£è¡¨è¢«æˆªæ–­çš„æ–‡æœ¬ */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒåŠ å…¥äº†ä¸€ä¸ªç™½åº•ç°è¾¹ï¼Œç„¶åå¦‚æœè¶…å‡ºæ–‡å­—çœç•¥å· **â€¦**ï¼Œ ç„¶åå¼€å§‹åˆ›å»ºåˆ é™¤</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;task-item&quot;</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;task-item-container&quot;</span> <span class="attr">data-index</span>=<span class="string">&#x27;&#123;&#123;index&#125;&#125;&#x27;</span> <span class="attr">bindtouchstart</span>=<span class="string">&#x27;touchstart&#x27;</span> <span class="attr">bindtouchmove</span>=<span class="string">&#x27;touchmove&#x27;</span> <span class="attr">bindtouchend</span>=<span class="string">&#x27;touchend&#x27;</span> <span class="attr">style</span>=<span class="string">&quot;transform:translateX(-&#123;&#123;item.distance&#125;&#125;px);&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;task-item-text&quot;</span>&gt;</span>&#123;&#123;item.task&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;task-item-time&quot;</span>&gt;</span>&#123;&#123;item.time&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;delete&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨å¤–é¢å¥—äº†ä¸€å±‚ task-item-container ï¼Œå¹¶ä¸”åŠ å…¥äº†äº‹ä»¶å’Œ <code>transform:translateX(-&#123;&#123;item.distance&#125;&#125;px);</code> ä»¥åŠæ–°å¢ä¸€ä¸ªåˆ é™¤æŒ‰é’®ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.task-item-container</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.delete</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">20px</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">color</span>: gray;</span><br><span class="line">  <span class="attribute">background-color</span>: white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨äº‹ä»¶ä¸­åŠ å…¥ï¼Œè®¾ç½®çš„ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">touchstart</span>: <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">    <span class="attr">_start</span>: e.<span class="property">changedTouches</span>[<span class="number">0</span>].<span class="property">pageX</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å¼€å§‹çš„æ—¶å€™é›†å½•èµ·å§‹ä½ç½®ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">touchmove</span>: <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> d = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">_start</span> - e.<span class="property">changedTouches</span>[<span class="number">0</span>].<span class="property">pageX</span>;</span><br><span class="line">  <span class="keyword">const</span> newTaskList = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">taskList</span>;</span><br><span class="line">  d = d &gt; maxX ? maxX : d;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (d &gt; minDistance) &#123;</span><br><span class="line">    newTaskList[e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">index</span>].<span class="property">distance</span> = d;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">taskList</span>: newTaskList</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    newTaskList[e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">index</span>].<span class="property">distance</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">taskList</span>: newTaskList</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>ç§»åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œè®¾ç½®æœ€æ–°ä½ç½®ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">touchend</span>: <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`start1:<span class="subst">$&#123;<span class="variable language_">this</span>.data._start&#125;</span>`</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`pageX:<span class="subst">$&#123;e.changedTouches[<span class="number">0</span>].pageX&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">let</span> d = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">_start</span> - e.<span class="property">changedTouches</span>[<span class="number">0</span>].<span class="property">pageX</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> newTaskList = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">taskList</span>;</span><br><span class="line">  d = d &gt; maxX ? maxX : d;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(d);</span><br><span class="line">  <span class="keyword">if</span> (d &gt; minDistance) &#123;</span><br><span class="line">    newTaskList[e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">index</span>].<span class="property">distance</span> = d;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">_start</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">taskList</span>: newTaskList</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    newTaskList[e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">index</span>].<span class="property">distance</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">_start</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">taskList</span>: newTaskList</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æŸä»£ç å·®ä¸å¤šï¼Œåªæ˜¯é‡ç½®å¼€å§‹ä½ç½®ã€‚</p><p>åŸºæœ¬okä»¥åï¼Œéœ€è¦å¼•å…¥ iconfont. æ€»å¾—åŠ ç‚¹å›¾æ ‡æ‰å¥½çœ‹ï¼Œæˆ‘ä» iconfont.com å¼•å…¥ï¼Œå¾®ä¿¡å°ç¨‹åºæ— æ³•å…±äº«æŸäº›cssï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ª page éƒ½æ˜¯å®Œå…¨å•ç‹¬çš„æ ·å¼ï¼Œå°±ç®—ä½¿ç”¨</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;...&#x27;</span></span><br></pre></td></tr></table></figure><p>ç„¶ååŠ å…¥ css</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;delete icon iconfont icon-icon-delete-fill&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>çœ‹ä¸‹æ•ˆæœ</p><p><a href="/%5Cimg%5C2023-07-12-150046.png" title="alt text" class="gallery-item" style="box-shadow: none;"> <img src="/%5Cimg%5C2023-07-12-150046.png" alt="alt text"></a></p><p>è¿‡ç¨‹å°±æ˜¯è¿™æ ·ï¼Œæ¥ä¸‹æ¥åˆ é™¤, é¦–å…ˆæ–°å¢ä¸€ä¸ªåˆ é™¤æ–¹æ³•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deleteTaskItem</span>: <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> index = e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">index</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(index);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">taskList</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    wx.<span class="title function_">setStorage</span>(&#123;</span><br><span class="line">      <span class="attr">key</span>: key,</span><br><span class="line">      <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">taskList</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">taskList</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">taskList</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;åˆ é™¤å¤±è´¥&#x27;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;error&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ·»åŠ åˆ°äº‹ä»¶ä¸­å³å¯ï¼Œå†åŠ ä¸€ä¸ªæç¤ºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wx.<span class="title function_">showModal</span>(&#123;</span><br><span class="line">  <span class="attr">content</span>: <span class="string">&#x27;ç¡®è®¤åˆ é™¤ï¼Ÿåˆ é™¤ä¹‹åä¸å¯æ¢å¤&#x27;</span>,</span><br><span class="line">  <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">confirm</span>) &#123;</span><br><span class="line">      <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ok, å°±è¿™æ ·ï¼Œåˆ é™¤ä¹Ÿæœ‰äº†ã€‚</p><h3 id="04-æ–°å¢æ·»åŠ é¡µé¢"><a href="#04-æ–°å¢æ·»åŠ é¡µé¢" class="headerlink" title="04. æ–°å¢æ·»åŠ é¡µé¢"></a>04. æ–°å¢æ·»åŠ é¡µé¢</h3><p>ç°åœ¨åªè¾“å…¥äº†åå­—è¿™ä¸ªæ•°æ®ï¼Œæ‰€ä»¥è¦å¢åŠ ä¸€äº›æ•°æ®ã€‚</p><ul><li>æ ‡é¢˜</li><li>æ·»åŠ æ—¶é—´</li><li>æé†’æ—¶é—´</li><li>æè¿°</li></ul><p>ç®€å•å°±å…ˆç”¨è¿™ä¸ªï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„é¡µé¢ï¼Œå¹¶ä¸”éœ€è¦è·¯ç”±ä»¥åŠ <code>form</code>, ä»¥åŠé¡µé¢ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Ÿ</p><ul><li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/route.html">é¡µé¢è·¯ç”±</a></li><li><a href="https://developers.weixin.qq.com/miniprogram/dev/component/navigator.html">navigator</a></li></ul><blockquote><p>æ¡†æ¶ä»¥æ ˆçš„å½¢å¼ç»´æŠ¤äº†å½“å‰çš„æ‰€æœ‰é¡µé¢</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="string">&quot;pages/index/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;pages/add/index&quot;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆå¢åŠ è¿æ¥ï¼Œç„¶åæ ¹æ®æŒ‡å—å½“ä¸­åœ¨ index ä¸­å¢åŠ ä¸€ä¸ªé“¾æ¥ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;navigator url=<span class="string">&quot;/pages/add/index&quot;</span>&gt;åˆ°æ·»åŠ é¡µé¢å»&lt;/navigator&gt;</span><br></pre></td></tr></table></figure><p>ç„¶å <code>form</code> ï¼Œè¿™ä¸ªæ—¶å€™çªç„¶æƒ³åˆ°ï¼Œå…¶å®è¿˜å¯ä»¥ä½¿ç”¨æ¡†æ¶ï¼Œä¸ç”¨å…¨éƒ¨è‡ªå·±å†™â€¦, äºæ˜¯ç›´æ¥ç”¨å®˜æ–¹çš„ <code>weui</code> å§.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;weui-form&quot;</span> <span class="attr">bindsubmit</span>=<span class="string">&quot;formSubmit&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-form__bd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-form__text-area&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cells__title&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;weui-form__title&quot;</span>&gt;</span>æ·»åŠ ä»»åŠ¡<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-form__control-area&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cells__group weui-cells__group_form&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cells&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;title-input&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell weui-cell_active&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell__hd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;weui-label&quot;</span>&gt;</span>æ ‡é¢˜<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell__bd&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;title-input&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weui-input&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;ä»»åŠ¡æ ‡é¢˜&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;title&#125;&#125;&quot;</span> <span class="attr">bindinput</span>=<span class="string">&quot;handleInput&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;curDay&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell weui-cell_active&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell__hd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;weui-label&quot;</span>&gt;</span>åˆ›å»ºæ—¶é—´<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell__bd&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;curDay&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weui-input&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;curDay&#125;&#125;&quot;</span> <span class="attr">disabled</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">picker</span> <span class="attr">mode</span>=<span class="string">&quot;date&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;taskDay&#125;&#125;&quot;</span> <span class="attr">bindchange</span>=<span class="string">&quot;bindTaskDay&quot;</span> <span class="attr">start</span>=<span class="string">&quot;&#123;&#123;curDay&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell weui-cell_active weui-cell_select&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell__bd&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-select&quot;</span>&gt;</span>ä»»åŠ¡æ—¥æœŸ: &#123;&#123;taskDay&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">picker</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">picker</span> <span class="attr">mode</span>=<span class="string">&quot;time&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;taskTime&#125;&#125;&quot;</span> <span class="attr">bindchange</span>=<span class="string">&quot;bindTaskTime&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell weui-cell_active weui-cell_select&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell__bd&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-select&quot;</span>&gt;</span>ä»»åŠ¡æ—¶é—´: &#123;&#123;taskTime&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">picker</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;description-input&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell weui-cell_active&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell__hd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;weui-label&quot;</span>&gt;</span>æè¿°<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell__bd&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;description-input&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weui-input&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;description&#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æè¿°ï¼ˆé€‰å¡«ï¼‰&quot;</span> <span class="attr">bindinput</span>=<span class="string">&quot;handleDescription&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-form__ft weui-bottom-fixed-opr-page__tool&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-form__opr-area&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;weui-btn weui-btn_primary&quot;</span> <span class="attr">formType</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>æäº¤<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘æ²¡æœ‰åŠ å…¥è¡¨å•éªŒè¯ç»„ä»¶ï¼Œæ‡’å¾—å»çœ‹å…¶ä»–ç»„ä»¶äº†ï¼Œç”Ÿæˆäº†ä¸€äº›åˆ¤æ–­.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dateHelper = <span class="built_in">require</span>(<span class="string">&#x27;../js/common&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> key = <span class="string">&#x27;taskList&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">curDay</span>: dateHelper.<span class="title function_">formatDate</span>(<span class="keyword">new</span> <span class="title class_">Date</span>()),</span><br><span class="line">    <span class="attr">taskDay</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">taskTime</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">description</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">map</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">bindTaskDay</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">    detail: &#123;</span></span><br><span class="line"><span class="params">      value</span></span><br><span class="line"><span class="params">    &#125;</span></span><br><span class="line"><span class="params">  &#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">taskDay</span>: value</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">bindTaskTime</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">    detail: &#123;</span></span><br><span class="line"><span class="params">      value</span></span><br><span class="line"><span class="params">    &#125;</span></span><br><span class="line"><span class="params">  &#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">taskTime</span>: value</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">handleInput</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">    detail: &#123;</span></span><br><span class="line"><span class="params">      value</span></span><br><span class="line"><span class="params">    &#125;</span></span><br><span class="line"><span class="params">  &#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: value</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">handleDescription</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">    detail: &#123;</span></span><br><span class="line"><span class="params">      value</span></span><br><span class="line"><span class="params">    &#125;</span></span><br><span class="line"><span class="params">  &#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">description</span>: value</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">formSubmit</span>(<span class="params">e</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result = &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">title</span>,</span><br><span class="line">      <span class="attr">curDay</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">curDay</span>,</span><br><span class="line">      <span class="attr">taskDay</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">taskDay</span>,</span><br><span class="line">      <span class="attr">taskTime</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">taskTime</span>,</span><br><span class="line">      <span class="attr">description</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">description</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¡éªŒ title</span></span><br><span class="line">    <span class="keyword">if</span> (!result.<span class="property">title</span> || result.<span class="property">title</span>.<span class="title function_">trim</span>().<span class="property">length</span> &lt; <span class="number">3</span> || result.<span class="property">title</span>.<span class="title function_">trim</span>().<span class="property">length</span> &gt; <span class="number">40</span>) &#123;</span><br><span class="line">      wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;æ ‡é¢˜é•¿åº¦åº”åœ¨3åˆ°40ä¸ªå­—ç¬¦ä¹‹é—´&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¡éªŒä»»åŠ¡æ—¥æœŸ</span></span><br><span class="line">    <span class="keyword">if</span> (!result.<span class="property">taskDay</span>) &#123;</span><br><span class="line">      wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;è¯·å¡«å†™ä»»åŠ¡æ—¥æœŸ&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¡éªŒä»»åŠ¡æ—¶é—´</span></span><br><span class="line">    <span class="keyword">if</span> (!result.<span class="property">taskTime</span>) &#123;</span><br><span class="line">      wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;è¯·å¡«å†™ä»»åŠ¡æ—¶é—´&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¡éªŒæè¿°é•¿åº¦</span></span><br><span class="line">    <span class="keyword">if</span> (result.<span class="property">description</span> &amp;&amp; result.<span class="property">description</span>.<span class="title function_">trim</span>().<span class="property">length</span> &gt; <span class="number">100</span>) &#123;</span><br><span class="line">      wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;æè¿°é•¿åº¦ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦&#x27;</span>,</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> taskList = wx.<span class="title function_">getStorageSync</span>(key);</span><br><span class="line">    <span class="keyword">if</span> (!taskList) taskList = [];</span><br><span class="line">    taskList.<span class="title function_">push</span>(result);</span><br><span class="line"></span><br><span class="line">    wx.<span class="title function_">setStorage</span>(&#123;</span><br><span class="line">      <span class="attr">key</span>: key,</span><br><span class="line">      <span class="attr">data</span>: taskList</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¸…ç©ºè¡¨å•æ•°æ®</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">curDay</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">taskDay</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">taskTime</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;æäº¤æˆåŠŸ&#x27;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><a href="/%5Cimg%5C2023-07-13-112344.png" title="alt text" class="gallery-item" style="box-shadow: none;"> <img src="/%5Cimg%5C2023-07-13-112344.png" alt="alt text"></a></p><p>çœ‹åˆ°è¿™é‡Œ title é—´è·è¿‡é«˜ï¼Œæ—¥æœŸé€‰æ‹©ä»¥åæ—¶é—´é—´è·ä¹Ÿæœ‰é—®é¢˜ï¼Œä¿®æ”¹ä¸€ä¸‹ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;weui-form&quot;</span> <span class="attr">bindsubmit</span>=<span class="string">&quot;formSubmit&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding-top: 0px;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">picker</span> <span class="attr">mode</span>=<span class="string">&quot;date&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;taskDay&#125;&#125;&quot;</span> <span class="attr">bindchange</span>=<span class="string">&quot;bindTaskDay&quot;</span> <span class="attr">start</span>=<span class="string">&quot;&#123;&#123;curDay&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;taskDay&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell weui-cell_active&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell__hd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;weui-label&quot;</span>&gt;</span>ä»»åŠ¡æ—¥æœŸ<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell__bd&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;taskDay&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">picker</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€åï¼Œå¢åŠ ä¸€ä¸ªè·³è½¬åœ¨æ·»åŠ æˆåŠŸä»¥å</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wx.<span class="title function_">navigateBack</span>();</span><br></pre></td></tr></table></figure><h3 id="05-æ›´æ–°åˆ—è¡¨é¡µé¢"><a href="#05-æ›´æ–°åˆ—è¡¨é¡µé¢" class="headerlink" title="05. æ›´æ–°åˆ—è¡¨é¡µé¢"></a>05. æ›´æ–°åˆ—è¡¨é¡µé¢</h3><p>å½“æˆ‘å‡†å¤‡æ”¹é€ çš„æ—¶å€™ï¼Œå‘ç° <a href="https://weui.io/#list">https://weui.io/#list</a> å·²ç»å®ç°äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä¹‹å‰è¿˜è‡ªå·±å†™ã€‚ã€‚</p><p>äºæ˜¯æˆ‘å€ŸåŠ©ä»–çš„æ ·å¼ï¼Œæ”¹äº†ä¸€ä¸‹ã€‚</p><p><a href="/%5Cimg%5C2023-07-13-163917.png" class="gallery-item" style="box-shadow: none;"> <img src="/%5Cimg%5C2023-07-13-163917.png"></a></p><p>å¹¶ä¸”åŠ å…¥äº†å¯¼èˆª</p><p><a href="/%5Cimg%5C2023-07-13-164021.png" class="gallery-item" style="box-shadow: none;"> <img src="/%5Cimg%5C2023-07-13-164021.png"></a></p><p>ä¸ºäº†è§£å†³æ¥å›åˆ‡æ¢ï¼Œåˆ—è¡¨ä¸åˆ·æ–°çš„é—®é¢˜ï¼Œå°†åŸæœ¬çš„ <code>onload</code> æ”¹ä¸º <code>onshow</code>.</p><p>åŸºæœ¬ä¸Šå¼€å§‹æœ‰ç‚¹æ ·å­äº†ã€‚</p><p>ç„¶åå°†æ—¶é—´ï¼Œå†™ä¸€ä¸ªæ–¹æ³•ï¼Œè½¬æ¢ä¸º åˆšåˆšï¼Œå°æ—¶å‰è¿™ç§æ¨¡å¼ï¼Œä¸è¦åŠ¨ä¸åŠ¨å°±æ˜¯ <strong>2023-09-20</strong> ä¹‹ç±»çš„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getTimeRemaining</span>(<span class="params">endTime</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> currentTime = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  <span class="keyword">const</span> targetTime = <span class="keyword">new</span> <span class="title class_">Date</span>(endTime);</span><br><span class="line">  <span class="keyword">const</span> timeDifference = targetTime - currentTime;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (timeDifference &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;å·²è¿‡æœŸ&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> oneMinute = <span class="number">60</span> * <span class="number">1000</span>; <span class="comment">// 1åˆ†é’Ÿçš„æ¯«ç§’æ•°</span></span><br><span class="line">  <span class="keyword">const</span> oneHour = oneMinute * <span class="number">60</span>; <span class="comment">// 1å°æ—¶çš„æ¯«ç§’æ•°</span></span><br><span class="line">  <span class="keyword">const</span> oneDay = oneHour * <span class="number">24</span>; <span class="comment">// 1å¤©çš„æ¯«ç§’æ•°</span></span><br><span class="line">  <span class="keyword">const</span> oneMonth = oneDay * <span class="number">30.436875</span>; <span class="comment">// 1ä¸ªæœˆçš„æ¯«ç§’æ•°ï¼ŒæŒ‰å¹³å‡æ¯æœˆ30.436875å¤©è®¡ç®—</span></span><br><span class="line">  <span class="keyword">const</span> oneYear = oneMonth * <span class="number">12</span>; <span class="comment">// 1å¹´çš„æ¯«ç§’æ•°</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> years = <span class="title class_">Math</span>.<span class="title function_">floor</span>(timeDifference / oneYear);</span><br><span class="line">  <span class="keyword">const</span> months = <span class="title class_">Math</span>.<span class="title function_">floor</span>((timeDifference % oneYear) / oneMonth);</span><br><span class="line">  <span class="keyword">const</span> days = <span class="title class_">Math</span>.<span class="title function_">floor</span>((timeDifference % oneMonth) / oneDay);</span><br><span class="line">  <span class="keyword">const</span> hours = <span class="title class_">Math</span>.<span class="title function_">floor</span>((timeDifference % oneDay) / oneHour);</span><br><span class="line">  <span class="keyword">const</span> minutes = <span class="title class_">Math</span>.<span class="title function_">floor</span>((timeDifference % oneHour) / oneMinute);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> remainingTime = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (years &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    remainingTime += <span class="string">`<span class="subst">$&#123;years&#125;</span>å¹´ `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (months &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    remainingTime += <span class="string">`<span class="subst">$&#123;months&#125;</span>ä¸ªæœˆ `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (days &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    remainingTime += <span class="string">`<span class="subst">$&#123;days&#125;</span>å¤© `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (hours &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    remainingTime += <span class="string">`<span class="subst">$&#123;hours&#125;</span>å°æ—¶ `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (minutes &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    remainingTime += <span class="string">`<span class="subst">$&#123;minutes&#125;</span>åˆ†é’Ÿ`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> remainingTime.<span class="title function_">trim</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘æƒ³åˆ°äº†ï¼Œæ—¢ç„¶è¿™ä¹ˆåƒ Vueï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯æœ‰å¯èƒ½æ€§ï¼Œä»–ä¹Ÿæœ‰æŒ‡ä»¤ã€‚</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/database/query.html">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/database/query.html</a></p><p>æŸ¥äº†ä¸€ä¸‹å‘ç°ï¼Œä»–ä¼¼ä¹æ²¡æœ‰è¿™æ ·çš„ä¸œè¥¿ï¼Œåªèƒ½é€šè¿‡åŸç”Ÿçš„æŒ‡ä»¤å»è§£å†³é—®é¢˜ï¼Œæˆ–è€…ç»„ä»¶ä½¿ç”¨ slot, ä»è€Œå®ç°å°è£…ï¼Œæœ‰ç‚¹æ¶å¿ƒ</p><p>ç„¶åç»§ç»­æµ‹è¯•å‘ç°ä¸èƒ½ç›´æ¥åœ¨ <code>&#123;&#123;func&#125;&#125;</code> è¿™æ ·ç›´æ¥ä½¿ç”¨æ–¹æ³•ï¼Œæœ€åæŸ¥åˆ°äº†</p><p><a href="https://blog.csdn.net/weixin_39015132/article/details/82767312">https://blog.csdn.net/weixin_39015132/article/details/82767312</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">wxs</span> <span class="attr">module</span>=<span class="string">&quot;filter&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./numberToFixed.wxs&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">wxs</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªçœŸçš„æ²‰é»˜äº†ï¼Œå¤ªåˆ«æ‰­äº†ï¼Œè¿™è¾¹äº§ç”Ÿäº†ä¸€ä¸ªç–‘é—®ï¼Œæ¯”å¦‚åŒæ ·ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ‘åœ¨ <code>&#123;&#123;&#125;&#125;</code> å’Œ js ä¸­éƒ½éœ€è¦ä½¿ç”¨ï¼Œé‚£æ˜¯ä¸æ˜¯è¦åŒºåˆ† wxs, æœç„¶è¦åŒºåˆ†ï¼Œå› ä¸ºã€‚</p><blockquote><p>å› ä¸º WXS ä¸­ä¸èƒ½è°ƒç”¨ javascript ä¸­å®šä¹‰çš„å‡½æ•°æˆ–è€…å˜é‡ï¼Œä¹Ÿä¸èƒ½è°ƒç”¨å°ç¨‹åºæä¾›çš„, APIï¼Œä»–çš„è¿è¡Œç¯å¢ƒå’Œ javascript æ˜¯éš”ç¦»çš„ã€‚</p></blockquote><p><a href="https://blog.csdn.net/Umbrella_Um/article/details/107253834">https://blog.csdn.net/Umbrella_Um/article/details/107253834</a> çœŸçš„æ·±æ·±çš„å«Œå¼ƒ</p><p>ç”¨ getDate è§£å†³äº†é—®é¢˜ï¼Œç°åœ¨æ˜¯è¿™æ ·</p><p><a href="/%5Cimg%5C2023-07-13-233949.png" class="gallery-item" style="box-shadow: none;"> <img src="/%5Cimg%5C2023-07-13-233949.png"></a></p><h3 id="06-ç¼–è¾‘"><a href="#06-ç¼–è¾‘" class="headerlink" title="06. ç¼–è¾‘"></a>06. ç¼–è¾‘</h3><p>å¢åŠ ç¼–è¾‘æŒ‰é’®ï¼ŒåŠ å…¥è·³è½¬äº‹ä»¶</p><p>ä¼ å€¼çš„æ–¹æ³• <a href="https://www.cnblogs.com/bushui/p/11633766.html%EF%BC%8C%E4%B8%8D%E8%BF%87%E4%BE%8B%E5%AD%90%E4%B8%AD%E6%B2%A1%E6%9C%89%E5%91%8A%E8%AF%89%E4%BD%A0%E5%A6%82%E4%BD%95%E6%8E%A5%E6%94%B6%E3%80%82">https://www.cnblogs.com/bushui/p/11633766.htmlï¼Œä¸è¿‡ä¾‹å­ä¸­æ²¡æœ‰å‘Šè¯‰ä½ å¦‚ä½•æ¥æ”¶ã€‚</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell__ft&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-swiped-btn weui-btn_primary&quot;</span>  <span class="attr">data-index</span>=<span class="string">&#x27;&#123;&#123;index&#125;&#125;&#x27;</span> <span class="attr">aria-role</span>=<span class="string">&quot;button&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;editTaskItem&quot;</span> <span class="attr">url</span>=<span class="string">&quot;javascript:&quot;</span>&gt;</span>ç¼–è¾‘<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-swiped-btn weui-swiped-btn_warn&quot;</span> <span class="attr">data-index</span>=<span class="string">&#x27;&#123;&#123;index&#125;&#125;&#x27;</span> <span class="attr">aria-role</span>=<span class="string">&quot;button&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;deleteTaskItem&quot;</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">editTaskItem</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> index = e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">index</span>;</span><br><span class="line">  wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/pages/add/index?index=&#x27;</span> + index,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ add å¢åŠ  onLoad</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onLoad</span>(<span class="params">option</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> index = option.<span class="property">index</span>;</span><br><span class="line">  <span class="keyword">if</span> (!!index) &#123;</span><br><span class="line">    index = <span class="title class_">Number</span>.<span class="built_in">parseInt</span>(index);</span><br><span class="line">    wx.<span class="title function_">getStorage</span>(&#123;</span><br><span class="line">      <span class="attr">key</span>: key,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> d = res.<span class="property">data</span>[index];</span><br><span class="line">        <span class="keyword">if</span> (!!d) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: d.<span class="property">title</span>,</span><br><span class="line">            <span class="attr">curDay</span>: d.<span class="property">curDay</span>,</span><br><span class="line">            <span class="attr">taskDay</span>: d.<span class="property">taskDay</span>,</span><br><span class="line">            <span class="attr">taskTime</span>: d.<span class="property">taskTime</span>,</span><br><span class="line">            <span class="attr">description</span>: d.<span class="property">description</span>,</span><br><span class="line">            <span class="attr">map</span>: d.<span class="property">map</span>,</span><br><span class="line">            <span class="attr">index</span>: index</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨æ·»åŠ çš„ä½ç½®</span></span><br><span class="line"><span class="keyword">let</span> taskList = wx.<span class="title function_">getStorageSync</span>(key);</span><br><span class="line"><span class="keyword">if</span> (!taskList) taskList = [];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">index</span> === -<span class="number">1</span>) &#123;</span><br><span class="line">  taskList.<span class="title function_">push</span>(result);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  taskList[<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">index</span>] = result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æå®šã€‚</p><h3 id="07-æé†’"><a href="#07-æé†’" class="headerlink" title="07. æé†’"></a>07. æé†’</h3><p>è¿™é‡Œä¼¼ä¹å°±æœ‰éº»çƒ¦äº†ï¼Œå› ä¸ºå¾®ä¿¡åˆ‡åˆ°åå°ä»¥åï¼Œåªé©»ç•™5åˆ†é’Ÿï¼Œå¦‚æœå†…å­˜ç´§å¼ ï¼Œ5åˆ†é’Ÿéƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥åœ¨å¾®ä¿¡é‡Œå†™ä¸€ä¸ª</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setInterval</span>(<span class="variable language_">this</span>.<span class="property">timerTask</span>, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>ä¼¼ä¹æ˜¯ä¸ç§‘å­¦çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿˜æ˜¯éœ€è¦ä¸€ä¸ªæœåŠ¡ç«¯ï¼Œæ•°æ®ä¸Šä¼ ï¼Œå†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œç„¶åå’Œå¾®ä¿¡å…³è”é€šçŸ¥ï¼Œè¿˜éœ€è¦å†æ‰“å¼€çš„æ—¶å€™ä¸€æ¬¡æ€§é€šçŸ¥ç”¨æˆ·ã€‚</p><p><a href="https://www.zhihu.com/question/52719661">https://www.zhihu.com/question/52719661</a> è¿™ç¯‡æ–‡ç« è¯´äº†ä¸€ä¸ªæ¸…æ¥šã€‚</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html">https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html</a></p><p>å¦‚æœæƒ³è¦é•¿æœŸè®¢é˜… <a href="https://developers.weixin.qq.com/community/develop/doc/00008a8a7d8310b6bf4975b635a401">https://developers.weixin.qq.com/community/develop/doc/00008a8a7d8310b6bf4975b635a401</a></p><p>todolist ç®—æ˜¯æ°‘ç”Ÿå—ï¼Ÿã€‚</p><p>å¦å¤–å°±ç®—éœ€è¦ä¸€ä¸ªæœ‰æœåŠ¡å™¨ä»¥åŠåŸŸåï¼Œå¹¶ä¸”æ”¯æŒ https. æˆ–è€…ç›´æ¥ä½¿ç”¨å¾®ä¿¡çš„äº‘æœåŠ¡ã€‚</p><p>è¿™ä¸ªå°±åé¢æ¥äº†ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> å¾®ä¿¡å°ç¨‹åº </tag>
            
            <tag> todolist </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾®ä¿¡å°ç¨‹åºå…¥é—¨</title>
      <link href="/2023/07/13/ss_baisc/"/>
      <url>/2023/07/13/ss_baisc/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>å°ç¨‹åºå…¥é—¨ã€‚</p><h3 id="çœŸå…¥é—¨"><a href="#çœŸå…¥é—¨" class="headerlink" title="çœŸå…¥é—¨"></a>çœŸå…¥é—¨</h3><p>å°ç¨‹åº <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/quickstart/">å¼€å‘æ–‡æ¡£</a> ï¼Œ<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html">å·¥å…·ä¸‹è½½åœ°å€</a></p><p>æœ€å¥½è¿˜æ˜¯è·Ÿç€ä»–çš„å·¥å…·æ¥ã€‚</p><p><a href="/%5Cimg%5C2023-07-10-164309.png" title="alt text" class="gallery-item" style="box-shadow: none;"> <img src="/%5Cimg%5C2023-07-10-164309.png" alt="alt text"></a></p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html">å…¨å±€é…ç½® app.json</a>ï¼Œ<br><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/sitemap.html">sitemap</a></p><p>jsï¼Œwxmlï¼Œwxssï¼Œjsonã€‚ä»–ä¸»è¦çš„å››ä¸ªæ–‡ä»¶ã€‚</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/wxs/">wxsæ–‡æ¡£</a><br><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/wxml/">WXML è¯­æ³•å‚è€ƒ </a><br>[å°ç¨‹åºæ¡†æ¶ &#x2F;è§†å›¾å±‚ &#x2F;WXML]<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/">https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/</a>)</p><p>å¾ˆç–‘æƒ‘, æœ‰ç‚¹ç±»ä¼¼äº Vue æ¨¡ç‰ˆè¯­æ³•ï¼Œä½†æ˜¯ä»‹ç»çš„åˆå¾ˆä¸å…¨ã€‚</p><p>æ¯”å¦‚æˆ‘æƒ³å†™ä¸€ä¸ªæ ‡é¢˜ï¼Œh1. è¯•äº†ä¸‹ä¼¼ä¹æ²¡æœ‰æ•ˆæœã€‚</p><p>åœ¨çœ‹æ–‡æ¡£çš„è¿‡ç¨‹ä¸­ </p><blockquote><p>å¾€å¾€å†™ HTML çš„æ—¶å€™ï¼Œç»å¸¸ä¼šç”¨åˆ°çš„æ ‡ç­¾æ˜¯ div, p, spanï¼Œå¼€å‘è€…åœ¨å†™ä¸€ä¸ªé¡µé¢çš„æ—¶å€™å¯ä»¥æ ¹æ®è¿™äº›åŸºç¡€çš„æ ‡ç­¾ç»„åˆå‡ºä¸ä¸€æ ·çš„ç»„ä»¶ï¼Œä¾‹å¦‚æ—¥å†ã€å¼¹çª—ç­‰ç­‰ã€‚æ¢ä¸ªæ€è·¯ï¼Œæ—¢ç„¶å¤§å®¶éƒ½éœ€è¦è¿™äº›ç»„ä»¶ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½æŠŠè¿™äº›å¸¸ç”¨çš„ç»„ä»¶åŒ…è£…èµ·æ¥ï¼Œå¤§å¤§æé«˜æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚</p></blockquote><p>ä¸çŸ¥é“æˆ‘æ˜¯å¦å¯ä»¥ç†è§£ä¸ºï¼Œä»–ä»¬è¿™äº›éƒ½ä½œä¸ºç»„ä»¶æä¾›ï¼Ÿåé¢è¯•äº†ä¸€è¯•å¤§æ¦‚æ˜¯è¿™æ ·ã€‚</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/wxs/">https://developers.weixin.qq.com/miniprogram/dev/reference/wxs/</a></p><p>è„šæœ¬ä»‹ç»ä¹Ÿä¸æ˜¯å¾ˆå…¨ï¼ŒæŸ¥è¯¢äº†ä¸€ä¸‹ï¼Œä»–å…¶å®åªæ”¯æŒes5ï¼Œèƒ½å†™es6ï¼Œå› ä¸ºç”¨ babel  è½¬äº†ã€‚</p><p>æœ€å¼€å§‹çœ‹çš„æ—¶å€™ï¼Œæˆ‘è¿ä»–æ˜¯å¦æ”¯æŒ settimeout éƒ½ä¸çŸ¥é“ã€‚</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/config.html">é…ç½®</a></p><ul><li>å…¨å±€é…ç½® å°ç¨‹åºæ ¹ç›®å½•ä¸‹çš„ app.json æ–‡ä»¶ç”¨æ¥å¯¹å¾®ä¿¡å°ç¨‹åºè¿›è¡Œå…¨å±€é…ç½®ï¼Œå†³å®šé¡µé¢æ–‡ä»¶çš„è·¯å¾„ã€çª—å£è¡¨ç°ã€è®¾ç½®ç½‘ç»œè¶…æ—¶æ—¶é—´ã€è®¾ç½®å¤š tab ç­‰ã€‚</li><li>é¡µé¢é…ç½® æ¯ä¸€ä¸ªå°ç¨‹åºé¡µé¢ä¹Ÿå¯ä»¥ä½¿ç”¨åŒå .json æ–‡ä»¶æ¥å¯¹æœ¬é¡µé¢çš„çª—å£è¡¨ç°è¿›è¡Œé…ç½®ï¼Œé¡µé¢ä¸­é…ç½®é¡¹ä¼šè¦†ç›– app.json çš„ window ä¸­ç›¸åŒçš„é…ç½®é¡¹ã€‚</li><li>sitemap é…ç½®</li></ul><p>sitemap é…ç½®ç±»ä¼¼äºä»¥å‰ç½‘é¡µseoç”¨çš„ä¸œè¥¿</p><h3 id="02-åŒå‘ç»‘å®šï¼Ÿ"><a href="#02-åŒå‘ç»‘å®šï¼Ÿ" class="headerlink" title="02. åŒå‘ç»‘å®šï¼Ÿ"></a>02. åŒå‘ç»‘å®šï¼Ÿ</h3><p>åœ¨ä»‹ç»é‡Œé¢è¯´äº†ä¸€ä¸ªä¸œè¥¿, <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/MINA.html">ä»‹ç»</a></p><blockquote><p>æ¡†æ¶çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªå“åº”çš„æ•°æ®ç»‘å®šç³»ç»Ÿï¼Œå¯ä»¥è®©æ•°æ®ä¸è§†å›¾éå¸¸ç®€å•åœ°ä¿æŒåŒæ­¥ã€‚å½“åšæ•°æ®ä¿®æ”¹çš„æ—¶å€™ï¼Œåªéœ€è¦åœ¨é€»è¾‘å±‚ä¿®æ”¹æ•°æ®ï¼Œè§†å›¾å±‚å°±ä¼šåšç›¸åº”çš„æ›´æ–°ã€‚</p></blockquote><p>è¿™é‡Œæˆ‘å°±å¼€å§‹å¥½å¥‡äº†ï¼Œä»–çš„åˆ†å±‚æ˜¯ç›´æ¥ä» webview &#x3D;&gt; (é€»è¾‘å±‚ï¼Œè§†å›¾å±‚)ï¼Ÿ è¿˜æ˜¯ä¸­é—´è¿˜æœ‰ä¸€å±‚ï¼Ÿæ˜¯åŸç”Ÿå°±å®ç°äº†ï¼Ÿ</p><p>ä¹Ÿå°±æ˜¯è¯´ <strong>å¾®ä¿¡å°ç¨‹åºæ˜¯å¦‚ä½•å®ç°åŒå‘ç»‘å®šçš„?</strong></p><p>æˆ‘æŸ¥äº†åŠå¤©ä¹Ÿæ²¡æœ‰æŸ¥åˆ°å°ç¨‹åºæ¡†æ¶æºç åœ¨å“ªé‡Œï¼Œæœ‰åˆ†æçš„ä¹Ÿæ˜¯é€†å‘å‡ºæ¥çš„, è¿™ä¸ªä¹Ÿå¤ªéº»çƒ¦äº†ã€‚</p><h3 id="03-åœºæ™¯å€¼"><a href="#03-åœºæ™¯å€¼" class="headerlink" title="03. åœºæ™¯å€¼"></a>03. åœºæ™¯å€¼</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/scene-list.html">https://developers.weixin.qq.com/miniprogram/dev/reference/scene-list.html</a></p><p>åœ¨é¡µé¢ä¸­ä½ èƒ½æ‹¿åˆ°çš„ä¸œè¥¿</p><blockquote><p>åœºæ™¯å€¼ç”¨æ¥æè¿°ç”¨æˆ·è¿›å…¥å°ç¨‹åºçš„è·¯å¾„</p></blockquote><h3 id="04-é€»è¾‘å±‚"><a href="#04-é€»è¾‘å±‚" class="headerlink" title="04. é€»è¾‘å±‚"></a>04. é€»è¾‘å±‚</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/">https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/</a></p><p>å¾®ä¿¡ä»£ç åˆ†ä¸ºè§†å›¾å±‚å’Œé€»è¾‘å±‚ã€‚</p><blockquote><p>é€»è¾‘å±‚å°†æ•°æ®è¿›è¡Œå¤„ç†åå‘é€ç»™è§†å›¾å±‚ï¼ŒåŒæ—¶æ¥å—è§†å›¾å±‚çš„äº‹ä»¶åé¦ˆã€‚</p><p>å¼€å‘è€…å†™çš„æ‰€æœ‰ä»£ç æœ€ç»ˆå°†ä¼šæ‰“åŒ…æˆä¸€ä»½ JavaScript æ–‡ä»¶ï¼Œå¹¶åœ¨å°ç¨‹åºå¯åŠ¨çš„æ—¶å€™è¿è¡Œï¼Œç›´åˆ°å°ç¨‹åºé”€æ¯ã€‚è¿™ä¸€è¡Œä¸ºç±»ä¼¼ ServiceWorkerï¼Œæ‰€ä»¥é€»è¾‘å±‚ä¹Ÿç§°ä¹‹ä¸º App Serviceã€‚</p></blockquote><p>ä»–è¿™é‡Œè®²äº†å¾ˆå¤šå…³äºç”Ÿå‘½å‘¨æœŸä¸Šçš„ä¸œè¥¿ã€‚</p><p><a href="/%5Cimg%5Cpage-lifecycle.2e646c86.png" title="alt text" class="gallery-item" style="box-shadow: none;"> <img src="/%5Cimg%5Cpage-lifecycle.2e646c86.png" alt="alt text"></a></p><ul><li><a href="https://developers.weixin.qq.com/miniprogram/dev/api/">api</a></li><li><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/App.html">app é’©å­</a></li><li><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html">page é’©å­</a></li><li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/route.html">è·¯ç”±</a></li></ul><h3 id="05-è§†å›¾å±‚-View"><a href="#05-è§†å›¾å±‚-View" class="headerlink" title="05. è§†å›¾å±‚ View"></a>05. è§†å›¾å±‚ View</h3><blockquote><p>æ¡†æ¶çš„è§†å›¾å±‚ç”± WXML ä¸ WXSS ç¼–å†™ï¼Œç”±ç»„ä»¶æ¥è¿›è¡Œå±•ç¤ºã€‚<br>å°†é€»è¾‘å±‚çš„æ•°æ®åæ˜ æˆè§†å›¾ï¼ŒåŒæ—¶å°†è§†å›¾å±‚çš„äº‹ä»¶å‘é€ç»™é€»è¾‘å±‚ã€‚<br>WXML(WeiXin Markup language) ç”¨äºæè¿°é¡µé¢çš„ç»“æ„ã€‚<br>WXS(WeiXin Script) æ˜¯å°ç¨‹åºçš„ä¸€å¥—è„šæœ¬è¯­è¨€ï¼Œç»“åˆ WXMLï¼Œå¯ä»¥æ„å»ºå‡ºé¡µé¢çš„ç»“æ„ã€‚<br>WXSS(WeiXin Style Sheet) ç”¨äºæè¿°é¡µé¢çš„æ ·å¼ã€‚<br>ç»„ä»¶(Component)æ˜¯è§†å›¾çš„åŸºæœ¬ç»„æˆå•å…ƒã€‚</p></blockquote><p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/wxml/">WXMLåŸºæœ¬è¯­æ³•</a><br><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html">WXSSåŸºæœ¬è¯­æ³•</a><br><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxs/">WXSåŸºæœ¬è¯­æ³•</a></p><p><strong>WXSS</strong> ä¸­æåˆ°äº†ä¸€ä¸ªæ¦‚å¿µï¼Œæ˜¯åšç§»åŠ¨ç«¯å¼€å‘å¿…é¡»è¦çŸ¥é“çš„ã€‚</p><blockquote><p>rpxï¼ˆresponsive pixelï¼‰: å¯ä»¥æ ¹æ®å±å¹•å®½åº¦è¿›è¡Œè‡ªé€‚åº”ã€‚è§„å®šå±å¹•å®½ä¸º750rpxã€‚å¦‚åœ¨ iPhone6 ä¸Šï¼Œå±å¹•å®½åº¦ä¸º375pxï¼Œå…±æœ‰750ä¸ªç‰©ç†åƒç´ ï¼Œåˆ™750rpx &#x3D; 375px &#x3D; 750ç‰©ç†åƒç´ ï¼Œ1rpx &#x3D; 0.5px &#x3D; 1ç‰©ç†åƒç´ ã€‚</p></blockquote><p>æˆ‘æ¯”è¾ƒå°‘å‚ä¸ç§»åŠ¨ç«¯å¼€å‘ï¼Œå¯¹äºè¿™ä¸ªçš„ç†è§£å°±æ˜¯ã€‚</p><p>å±å¹•çš„å¤§å°ä»¥åŠåˆ†è¾¨ç‡ï¼Œä¸åŒè®¾å¤‡æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚å±å¹•å¤§åƒç´ å°ï¼Œå±å¹•å°åƒç´ å¤§ï¼Œéƒ½å¯èƒ½é€ æˆæç«¯æƒ…å†µã€‚æ‰€ä»¥è¿™ä¸ªæ˜¯éœ€è¦åšè‡ªé€‚åº”å¤„ç†çš„ã€‚</p><p>ä½†æ˜¯å¹³æ¿å’Œæ‰‹æœºï¼Œæˆ–è€…è¯´ç”µè„‘ç«¯å·®å¼‚è¿‡å¤§ï¼Œç®€å•çš„ä½¿ç”¨ç™¾åˆ†æ¯”è‡ªé€‚åº”å¯èƒ½ä¸èƒ½è¾¾åˆ°ç†æƒ³çš„æ•ˆæœï¼Œè¿˜æ˜¯éœ€è¦æ›´ç‰¹æ®Šçš„å¤„ç†ã€‚</p><p>æ¯”å¦‚ä¸åŒåˆ†è¾¨ç‡ä¸‹çš„å®Œå…¨ä¸åŒçš„æ ·å¼ï¼Œbç«™åœ¨å¹³æ¿å°±æ¨å‡ºäº†å®Œå…¨ä¸åŒçš„å®¢æˆ·ç«¯æ¥è§£å†³é—®é¢˜ã€‚</p><p>å½“ç„¶ å¾®ä¿¡å°ç¨‹åºå¯èƒ½ä½¿ç”¨åœºæ™¯å¤§éƒ½åœ¨æ‰‹æœºç«¯ï¼Œæ˜¯å¦è¦è€ƒè™‘æŠ˜å å±ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p><p>å…¶ä»–çš„å’Œcsså·®ä¸å¤šï¼Œå¯¼å…¥ï¼Œå†…è”ï¼Œclassä¹‹ç±»ï¼Œåªæ˜¯å¸Œæœ›ä»–ä¼˜å…ˆçº§è¿˜æœ‰ä¸€äº›å…¶ä»–ä¸œè¥¿å·®å¼‚ä¸è¦å¤ªå¤§ã€‚</p><p><strong>wxs</strong> å°±æ˜¯è¡Œå†…è„šæœ¬</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;wxs <span class="variable language_">module</span>=<span class="string">&quot;m1&quot;</span>&gt;</span><br><span class="line"><span class="keyword">var</span> msg = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">message</span> = msg;</span><br><span class="line">&lt;/wxs&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span> &#123;&#123;m1.message&#125;&#125; <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html">äº‹ä»¶ç³»ç»Ÿ</a></p><p>è¯´äº†ä¸€å¤§å †ï¼Œå…¶å®è¯´äº†5ä»¶äº‹</p><ol><li>bindtap ç»‘å®šæ–¹æ³•</li><li>bindtap å¯ä»¥åŠ¨æ€ç»‘å®šæ–¹æ³• </li><li>äº‹ä»¶å¾ªç¯å’Œæµè§ˆå™¨ç±»ä¼¼ï¼Œå¯ä»¥æ”¯æŒå†’æ³¡å’Œæ•è·(æˆ‘æ²¡æœ‰æµ‹è¯•æœ‰æ²¡æœ‰è‡ªèº«é‚£ä¸ªé˜¶æ®µï¼Œåº”è¯¥æœ‰å§ã€‚ã€‚)</li><li>æ”¯æŒäº‹ä»¶ç±»å‹ï¼Œä»¥åŠäº‹ä»¶ä¸­æœ‰å“ªäº›å‚æ•°ï¼Œå‚æ•°å…·ä½“ä½œç”¨ã€‚</li><li>datasetï¼Œmark(æ•°æ®å†’æ³¡ï¼Œè¿™ä¸ªè·å–çˆ¶èŠ‚ç‚¹)</li></ol><p><a href="https://developers.weixin.qq.com/miniprogram/dev/component/">ç»„ä»¶</a></p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/resizable.html">å“åº”æ˜¾ç¤ºåŒºåŸŸå˜åŒ–</a></p><p>è¿™é‡Œæåˆ°äº†æ—‹è½¬è¿™ä¸ªæ¦‚å¿µï¼Œè¿™ä¸ªæ˜¯éœ€è¦è€ƒè™‘çš„ï¼Œå¹¶ä¸”æä¾› Media Query è¿™ä¸ªè§£å†³æ–¹æ¡ˆæ¥è§£å†³è‡ªé€‚åº”é—®é¢˜ï¼Œå°±æ˜¯cssä¸­ <code>@media</code>. ä»¥åŠå±å¹•æ—‹è½¬çš„é’©å­äº‹ä»¶ã€‚</p><p>æ‰‹æœºä¸­çš„å±å¹•å¤§å°é—®é¢˜ï¼Œæˆ‘æƒ³äº†ä¸€ä¸‹å­˜åœ¨3ä¸ªæ–¹é¢</p><ol><li>å±å¹•æ—‹è½¬</li><li>åŒå±åˆ‡æ¢ï¼Œæ¯”å¦‚æŠ˜å æœºã€‚</li><li>å°çª—æ˜¾ç¤º(è¿™ä¸ªè¦çœ‹å¾®ä¿¡æ˜¯å¦æ”¯æŒ)</li></ol><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/frameset.html">åˆ†æ æ¨¡å¼</a></p><p>è¿™é‡Œå®Œå…¨ä¸æ‡‚ï¼Œéœ€è¦æµ‹è¯•ï¼Œå½“ç„¶å‰æœŸå¯ä»¥å®Œå…¨ä¸ç®¡ï¼Œæˆ‘å¤§æ¦‚çŸ¥é“ä»–ä»€ä¹ˆæ„æ€ã€‚ç±»ä¼¼äºæ‰‹æœºç›´çš„æ—¶å€™ï¼Œä¸€ç§æ˜¾ç¤ºï¼Œæ—‹è½¬ä»¥åå¦ä¸€ç§æ˜¾ç¤ºæ¨¡å¼ã€‚åªæ˜¯è¿™ç§æ˜¯åœ¨ä»£ç å±‚é¢ï¼Œç„¶è€Œä¸ºä»€ä¹ˆåœ¨ä»–çš„æè¿°ä¸­ä¼¼ä¹åªè¦è®¾ç½®å°±å¯ä»¥äº†ã€‚</p><h3 id="06-è¿è¡Œæ—¶ç¯å¢ƒ"><a href="#06-è¿è¡Œæ—¶ç¯å¢ƒ" class="headerlink" title="06. è¿è¡Œæ—¶ç¯å¢ƒ"></a>06. è¿è¡Œæ—¶ç¯å¢ƒ</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/env.html">è¿è¡Œæ—¶ç¯å¢ƒ</a><br><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/js-support.html">JavaScript æ”¯æŒæƒ…å†µ</a><br><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/operating-mechanism.html">å°ç¨‹åºè¿è¡Œæœºåˆ¶</a></p><p>è¿™é‡Œè¯´è¯´äº†å‡ ç‚¹</p><ol><li>è¿è¡Œæ—¶ç©¶ç«Ÿåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹è¿è¡Œä»£ç </li><li>javascript å¯èƒ½æœ‰å“ªäº›é—®é¢˜ï¼Œæ¯”å¦‚è¯´ promise æ—¶åºé—®é¢˜ï¼Œä»¥åŠæŸäº›å¯èƒ½ä¸èƒ½ä½¿ç”¨çš„è¯­æ³•</li><li>ä»€ä¹ˆæ˜¯å†·å¯åŠ¨ï¼Œä»€ä¹ˆæ˜¯çƒ­å¯åŠ¨ï¼Œä»¥åŠå°ç¨‹åºé”€æ¯çš„æœºåˆ¶</li></ol><h3 id="07-Skyline-æ¸²æŸ“å¼•æ“"><a href="#07-Skyline-æ¸²æŸ“å¼•æ“" class="headerlink" title="07. Skyline æ¸²æŸ“å¼•æ“"></a>07. Skyline æ¸²æŸ“å¼•æ“</h3><p><a href="https://www.zhihu.com/question/546709238">https://www.zhihu.com/question/546709238</a></p><p>è¿™ä¸ªå¯ä»¥åé¢çœ‹ï¼Œä¸»è¦å‘Šè¯‰ä½ ä½¿ç”¨è¿™ä¸ªå¼•æ“ä»¥åå¯¹äºç»„ä»¶ï¼Œwxssæ”¯æŒã€‚</p><p>è¯¦æƒ…å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªçŸ¥ä¹å›ç­”</p><p><a href="https://www.zhihu.com/question/546709238">å¦‚ä½•è¯„ä»·å¾®ä¿¡å°ç¨‹åºæ–°æ¸²æŸ“å¼•æ“skyline?</a></p><blockquote><p>å°ç¨‹åºåŸºäº Webview çš„æ¸²æŸ“æ¶æ„</p><p>ä¼˜ç‚¹:<br>å¤§é‡å¤ç”¨ Web åŸºå»ºï¼ŒåŒ…æ‹¬ DOM ã€CSS ç­‰ã€‚</p><p>ç¼ºç‚¹æ˜¯ï¼š<br>å†…å­˜å ç”¨å¤§ï¼šæ¯ä¸ª Page() å®ä¾‹å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„ Webview ï¼ˆç›¸å½“äº MPAï¼‰ï¼Œé‚£ä¹ˆç”¨æˆ·æ‰“å¼€çš„æ¯ä¸ªå°ç¨‹åºéƒ½å¯¹åº” n+1 ä¸ª Webviewã€‚<br>æ¸²æŸ“åˆå§‹åŒ–æµæ°´çº¿é•¿ï¼šéœ€è¦åŠ è½½ä¸€ä¸ª page-frame.html ï¼Œè¯¥ page-frame.html åŒ…å«æ‰€åœ¨ bundle çš„æ‰€æœ‰ app + page + component çš„æ¸²æŸ“å‡½æ•°ã€æ ·å¼ã€WXSï¼Œç”šè‡³å¯èƒ½ä¼šè¾¾åˆ° MB çº§åˆ«ã€‚<br>åŸç”Ÿç»„ä»¶èåˆå›°éš¾ï¼šé€šè¿‡æ‰€è°“ â€œåŒå±‚æ¸²æŸ“â€ çš„ hack æ‰‹æ®µå°è¯•è§£å†³åŸç”Ÿç»„ä»¶çš„æ¸²æŸ“èåˆé—®é¢˜ï¼Œä½† bug å·¨å¤šï¼Œç¨³å®šæ€§å·®ã€‚<br>æ— æ³•åœ¨é¡µé¢ä¹‹é—´å…±äº«å…ƒç´ ï¼šéƒ½æ˜¯ä¸åŒçš„æ¸²æŸ“å®ä¾‹äº†ï¼Œé‚£å½“ç„¶å…±äº«å…ƒç´ å°±åšä¸äº†ã€‚<br>é¡µé¢è·³è½¬å‘†æ¿ï¼šåŠå±æ¸²æŸ“ä¸å¥½åšï¼Œå¯¼èˆªåŠ¨ç”»æ¯”è¾ƒæ­»æ¿ã€‚<br>jsbridge ä¼ é€’æ•°æ®æ•ˆç‡ä½ã€‚</p></blockquote><blockquote><p>Skyline<br>å¥½å¤„æ˜¯ï¼š</p><p>èŠ‚çº¦å†…å­˜å ç”¨ã€‚<br>flutter æ¸²æŸ“æµæ°´çº¿æ¯”è¾ƒç²¾ç®€å’Œå¯æ§ï¼Œå¯ä»¥å¾ˆå¥½è§£å†³å±€éƒ¨æ¸²æŸ“ã€åŸç”Ÿç»„ä»¶èåˆç­‰é—®é¢˜ã€‚<br>å¯ä»¥åœ¨é¡µé¢é—´å…±äº«æ˜¾ç¤ºå…ƒç´ ã€‚<br>å¯ä»¥çµæ´»æ§åˆ¶é¡µé¢å¯¼èˆªè¡Œä¸ºå’ŒåŠ¨ç”»ã€‚<br>context ä¹‹é—´å¯ä»¥é€šè¿‡ç»“æ„åŒ–å…‹éš†äº¤æ¢æ•°æ®ï¼Œæ€§èƒ½æ¯” jsbridge é«˜ã€‚<br>ç¼ºç‚¹æ˜¯ï¼š</p><p>éœ€è¦è‡ªå·±å®ç° CSS å­é›†ï¼Œå…¼å®¹æ€§è¾ƒå·®ã€‚<br>flutter æ§ä»¶ä¸ Webview æ§ä»¶çš„è¡Œä¸ºå·®å¼‚ã€‚<br>æ¡†æ¶å¤±æ§é£é™©ï¼š<br>å¾®ä¿¡å°ç¨‹åºæ¡†æ¶æœ¬æ¥å°±æ˜¯è¡¥ä¸ä¹‹ä¸Šæ‰“è¡¥ä¸ï¼Œä¸æˆä½“ç³»ä¸” BUG å·¨å¤šã€‚<br>ç°åœ¨åˆæ–°å¢ä¸€ä¸ªæ¸²æŸ“ä¸Šä¸‹æ–‡å’Œæ¸²æŸ“å±‚ï¼Œä¾µå…¥ä¸šåŠ¡ä»£ç å’Œ BUG è†¨èƒ€æ˜¯ä¸å¯é¿å…çš„ã€‚<br>å¾®ä¿¡èƒ½å¦ä¿è¯åœ¨æ–°æ—§æ¶æ„ä¸‹å„åŠŸèƒ½çš„å…¼å®¹æ€§å’Œä½“éªŒï¼Ÿä¸ªäººè¡¨ç¤ºæ€€ç–‘ã€‚å¾ˆæœ‰å¯èƒ½å¼€å‘è€…ä¸å¾—ä¸åŒæ—¶ä½¿ç”¨ Webview &#x2F; Skyline ï¼Œå¹¶ä¸”åŒæ—¶åº”å¯¹æ¥è‡ªä¸¤ç§æ¶æ„çš„ BUG ã€‚</p></blockquote><p>å¹¶ä¸”ä»‹ç»äº†æ”¯æŒå“ªäº›ç»„ä»¶ï¼Œå“ªäº›cssã€‚</p><p>ä»¥åŠ Skyline ä¸€äº›æ–°ç‰¹æ€§ï¼Œè‡ªå®šä¹‰è·¯ç”±ï¼ŒWorklet åŠ¨ç”»ï¼Œæ‰‹åŠ¿ï¼Œå…±äº«å…ƒç´ åŠ¨ç”»ã€‚</p><h3 id="08-è‡ªå®šä¹‰ç»„ä»¶"><a href="#08-è‡ªå®šä¹‰ç»„ä»¶" class="headerlink" title="08. è‡ªå®šä¹‰ç»„ä»¶"></a>08. è‡ªå®šä¹‰ç»„ä»¶</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html">ç»„ä»¶åŸºç¡€</a></p><p>åŒ…å«äº†æ€ä¹ˆå†™ç»„ä»¶ï¼Œæ•°æ®å¦‚ä½•ç»‘å®šï¼Œsoltï¼Œæ ·å¼éš”ç¦»ï¼Œå¦‚ä½•å¼•å…¥å¤–éƒ¨æ ·å¼ï¼Œå¦‚ä½•å¼•å…¥å¤–éƒ¨æ ·å¼ï¼Œè™šåŒ–ç»„ä»¶â€¦</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/events.html">ç»„ä»¶é—´é€šä¿¡ä¸äº‹ä»¶</a></p><p>è®²äº†ç»„ä»¶å¦‚ä½•é€šè¿‡äº‹ä»¶è§¦å‘å’Œpageçš„é€šä¿¡ï¼Œåº”è¯¥ä¹Ÿèƒ½å’Œçˆ¶ç»„ä»¶çš„é€šä¿¡ï¼Œå¦‚ä½•è·å–ç»„ä»¶å®ä¾‹</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/lifetimes.html">ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ</a></p><p>è¿™é‡Œéœ€è¦çŸ¥é“ï¼Œ<code>lifetimes</code> æ˜¯ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œ<code>pageLifetimes</code> æ˜¯é¡µé¢ç”Ÿå‘½å‘¨æœŸ</p><p><strong>ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ</strong></p><p><a href="/%5Cimg%5C2023-07-11-155309.png" title="alt text" class="gallery-item" style="box-shadow: none;"> <img src="/%5Cimg%5C2023-07-11-155309.png" alt="alt text"></a></p><p><strong>å’Œç»„ä»¶ç›¸å…³çš„ page ç”Ÿå‘½å‘¨æœŸ</strong></p><p><a href="/%5Cimg%5C2023-07-11-155339.png" title="alt text" class="gallery-item" style="box-shadow: none;"> <img src="/%5Cimg%5C2023-07-11-155339.png" alt="alt text"></a></p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/behaviors.html">behaviors</a></p><p>å…¶å®å°±æ˜¯ mixins, ç®—æ˜¯ä¸€ç§ç»§æ‰¿çš„æ–¹æ³•</p><blockquote><p>my-behavior ç»“æ„ä¸ºï¼š<br>å±æ€§ï¼šmyBehaviorProperty<br>æ•°æ®å­—æ®µï¼šmyBehaviorData<br>æ–¹æ³•ï¼šmyBehaviorMethod<br>ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼šattachedã€createdã€ready</p></blockquote><p>è¦†ç›–è§„åˆ™å’ŒVueæ²¡åŒºåˆ«ï¼Œåªæ˜¯æœ‰ <a href="https://developers.weixin.qq.com/miniprogram/dev/component/form.html#wx-form-field">å†…ç½®behavior</a></p><p>å…¶å®ä»–è¿˜æ˜¯æ²¡ç»™æºç â€¦ </p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/relations.html">relations</a></p><blockquote><p>å®šä¹‰å’Œä½¿ç”¨ç»„ä»¶é—´å…³ç³»</p></blockquote><p>è¿™ä¸ªä¸å»ºè®®ä½¿ç”¨ï¼Œå¼ºå…³è”äº†.. é™¤éçœŸçš„æ˜¯å¼ºå…³è”ã€‚</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/observer.html">æ•°æ®ç›‘å¬å™¨</a> å½“ this.setData ä»¥åè§¦å‘ observers</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/pure-data.html">çº¯æ•°æ®å­—æ®µ</a> æä¾›ä¸€ç§ä¸èƒ½è¢«æ¸²æŸ“åªæ˜¯ç”¨äº flag ä¹‹ç±»çš„æ•°æ®ã€‚</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/generics.html">æŠ½è±¡ç»„ä»¶</a> çœ‹å¾—æˆ‘å¤´ç–¼ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ–‡æ¡£æˆ‘æ²¡æœ‰å®Œå…¨çœ‹å®Œï¼Œåç»­è¿˜æœ‰æ’ä»¶ï¼ŒåŸŸåç®¡ç†(åªèƒ½å‘å®¡æ ¸è¿‡çš„åŸŸåå‘èµ·è¯·æ±‚)ï¼Œworkerï¼Œå­˜å‚¨ï¼Œæ–‡ä»¶ç³»ç»Ÿï¼Œæ¶ˆæ¯æ¨é€ç­‰ç­‰ï¼Œä¸è¿‡å…ˆäº†è§£è¿™äº›æš‚æ—¶ä¸å½±å“æˆ‘è¿›è¡Œæˆ‘çš„ç¬¬ä¸€æ¬¡å¼€å‘äº†ã€‚</p><p>æ‰«å®Œæ•´ä¸ªæ–‡æ¡£ï¼Œç»™æˆ‘ä¸€ç§æ„Ÿè§‰ï¼Œä¸èˆ’æœã€‚</p><p>æ•´ä¸ªæ–‡æ¡£æ²¡æœ‰å»ºè®®çš„å¼€å‘æ–¹å¼ï¼Œè¿™ä¸ªokï¼Œä½†æ˜¯è¦ç»™æºç å•Šã€‚ã€‚ã€‚</p><p>ä¸çŸ¥é“ä½ å¤§æ¦‚å®ç°ï¼Œä½ æ€ä¹ˆç©çš„ï¼Œæ€ä¹ˆå»å¥½å¥½å¼€å‘å‘¢ï¼Ÿ</p><p>è€Œä¸”æ–‡æ¡£ä¾‹å­ä¸å¤Ÿå¤šï¼Œåªèƒ½è‡ªå·±æŸ¥èµ„æ–™ï¼Œè‡ªå·±è¯•ï¼Œå®Œå…¨æ˜¯ä½“åŠ›æ´»ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> å¾®ä¿¡å°ç¨‹åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javascript Array</title>
      <link href="/2023/07/12/es6_array/"/>
      <url>/2023/07/12/es6_array/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>é‡æ–°å¤ä¹ ä¸€ä¸‹</p><h3 id="1-æ„é€ å‡½æ•°"><a href="#1-æ„é€ å‡½æ•°" class="headerlink" title="1. æ„é€ å‡½æ•°"></a>1. æ„é€ å‡½æ•°</h3><blockquote><p>Array() æ„é€ å‡½æ•°ç”¨äºåˆ›å»º Array å¯¹è±¡ã€‚</p><p>è°ƒç”¨ Array() æ—¶å¯ä»¥ä½¿ç”¨æˆ–ä¸ä½¿ç”¨ newã€‚ä¸¤è€…éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Array å®ä¾‹ã€‚</p></blockquote><p><strong>elementN</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) <span class="comment">//[1,2,3,4]</span></span><br></pre></td></tr></table></figure><p><strong>arrayLength</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; Array(5) //[undefined,undefined,undefined]undefined,undefined</span><br></pre></td></tr></table></figure><h3 id="2-Array-species"><a href="#2-Array-species" class="headerlink" title="2. Array[@@species]"></a>2. Array[@@species]</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>[<span class="title class_">Symbol</span>.<span class="property">species</span>]</span><br></pre></td></tr></table></figure><p><code>Symbol.specie</code> </p><blockquote><p>species è®¿é—®å™¨å±æ€§å…è®¸å­ç±»è¦†ç›–å¯¹è±¡çš„é»˜è®¤æ„é€ å‡½æ•°ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Array1</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Array</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> get [<span class="title class_">Symbol</span>.<span class="property">species</span>]() &#123; <span class="keyword">return</span> <span class="title class_">Array</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> <span class="title class_">Array1</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">const</span> mapped = a.<span class="title function_">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> x * x);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mapped <span class="keyword">instanceof</span> <span class="title class_">Array1</span>);</span><br><span class="line"><span class="comment">// Expected output: false</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mapped <span class="keyword">instanceof</span> <span class="title class_">Array</span>);</span><br><span class="line"><span class="comment">// Expected output: true</span></span><br></pre></td></tr></table></figure><h3 id="3-Array-prototype-unscopables"><a href="#3-Array-prototype-unscopables" class="headerlink" title="3. Array.prototype[@@unscopables]"></a>3. Array.prototype[@@unscopables]</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>[@@unscopables]</span><br></pre></td></tr></table></figure><p>å…¶å®ä¹Ÿå°±æ˜¯ <code>Symbol.unscopables</code>, </p><blockquote><p>Symbol.unscopables å±æ€§é€šå¸¸åœ¨å¯¹è±¡çš„åŸå‹é“¾ä¸Šå®šä¹‰ï¼Œç”¨äºæ§åˆ¶åœ¨ä½œç”¨åŸŸç»‘å®šä¸­åº”è¯¥è¢«å¿½ç•¥çš„å±æ€§ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡çš„å±æ€§åå­˜åœ¨äº Symbol.unscopables å±æ€§ä¸­ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨ with è¯­å¥æ—¶ï¼Œè¯¥å±æ€§å°†è¢«å¿½ç•¥ï¼Œä¸ä¼šè¢«å½“ä½œå±€éƒ¨å˜é‡å¼•å…¥ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯å®šä¹‰å“ªäº› with ä¸­æ— æ³•ä½¿ç”¨ï¼Œè¿™ä¸ªå¯ä»¥å¿½ç•¥ï¼Œå› ä¸º with æ˜¯ä¸€ç§é—®é¢˜å¾ˆå¤§çš„å†™æ³•ã€‚</p><blockquote><p>å¯è¯»æ€§å’Œç»´æŠ¤æ€§å·®ï¼šwith è¯­å¥å¯ä»¥å¼•å…¥é¢å¤–çš„ä½œç”¨åŸŸç»‘å®šï¼Œä»è€Œå¯¼è‡´ä»£ç çš„å¯è¯»æ€§ä¸‹é™ã€‚åœ¨ä¸€ä¸ªè¾ƒå¤§çš„ä»£ç å—ä¸­ï¼Œéš¾ä»¥å‡†ç¡®åˆ¤æ–­å˜é‡çš„æ¥æºï¼Œå¢åŠ äº†ä»£ç çš„ç»´æŠ¤éš¾åº¦ã€‚</p><p>ä½œç”¨åŸŸæ³„æ¼ï¼šwith è¯­å¥ä¼šå°†å¯¹è±¡æ·»åŠ åˆ°ä½œç”¨åŸŸé“¾çš„å‰ç«¯ï¼Œè¿™å¯èƒ½å¯¼è‡´æ„å¤–çš„å˜é‡å£°æ˜ã€‚å¦‚æœåœ¨ with è¯­å¥å†…éƒ¨ä½¿ç”¨äº†æœªå£°æ˜çš„å˜é‡ï¼Œè¯¥å˜é‡ä¼šè¢«æ·»åŠ åˆ°å…¨å±€ä½œç”¨åŸŸä¸­ï¼Œå¯èƒ½å¼•å‘å‘½åå†²çªæˆ–æ„å¤–çš„è¡Œä¸ºã€‚</p><p>æ€§èƒ½é—®é¢˜ï¼šwith è¯­å¥ä¼šå½±å“ä»£ç çš„æ€§èƒ½ã€‚ç”±äºå¼•å…¥é¢å¤–çš„ä½œç”¨åŸŸç»‘å®šï¼ŒJavaScript å¼•æ“åœ¨æŸ¥æ‰¾å˜é‡æ—¶éœ€è¦éå†æ›´é•¿çš„ä½œç”¨åŸŸé“¾ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œé€Ÿåº¦å˜æ…¢ã€‚</p><p>ä¸å®‰å…¨çš„å±æ€§è®¿é—®ï¼šä½¿ç”¨ with è¯­å¥å¯ä»¥ç›´æ¥è®¿é—®å¯¹è±¡çš„å±æ€§ï¼Œä½†å¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨å°†å…¶è®¤ä¸ºæ˜¯å…¨å±€å˜é‡ã€‚è¿™ç§éšå¼çš„å±æ€§è®¿é—®ä¼šä½¿ä»£ç æ›´åŠ è„†å¼±ï¼Œå®¹æ˜“å‡ºç°é”™è¯¯ã€‚</p><p>ä¸¥æ ¼æ¨¡å¼ä¸æ”¯æŒï¼šwith è¯­å¥åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹æ˜¯è¢«ç¦æ­¢çš„ï¼Œå¦‚æœä½ çš„ä»£ç è¦æ±‚ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œå°±ä¸èƒ½ä½¿ç”¨ with è¯­å¥ã€‚</p></blockquote><p>æ‰€ä»¥éƒ½åˆ«ç”¨ã€‚</p><h3 id="4-length"><a href="#4-length" class="headerlink" title="4. length"></a>4. length</h3><blockquote><p>length æ˜¯ Array çš„å®ä¾‹å±æ€§ï¼Œè¡¨ç¤ºè¯¥æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚è¯¥å€¼æ˜¯ä¸€ä¸ªæ— ç¬¦å· 32 ä½æ•´æ•°ï¼Œå¹¶ä¸”å…¶æ•°å€¼æ€»æ˜¯å¤§äºæ•°ç»„æœ€å¤§ç´¢å¼•ã€‚</p></blockquote><p>ä¸€èˆ¬ä½¿ç”¨çš„è¯ï¼Œä¼šç›´æ¥è¿”å›æ•°ç»„çš„é•¿åº¦, å¯ä»¥åˆ¤æ–­é•¿åº¦ï¼Œéå†ç­‰æ“ä½œã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ length æ˜¯å¯å†™çš„ï¼Œå®ƒå¯ä»¥åšå‡ ä»¶äº‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [];</span><br><span class="line">arr.<span class="property">length</span> = <span class="number">200</span>; <span class="comment">//[undefined * 200]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line">arr1.<span class="property">length</span> = <span class="number">3</span>; <span class="comment">//[1,2,3]</span></span><br></pre></td></tr></table></figure><p>å†™ length å¯ä»¥åšåˆ°ï¼Œè£å‡ arrï¼Œå¯ä»¥åˆ›å»ºæ•°ç»„ã€‚</p><h3 id="5-Array-prototype-iterator"><a href="#5-Array-prototype-iterator" class="headerlink" title="5. Array.prototype@@iterator"></a>5. Array.prototype<a href="">@@iterator</a></h3><p><code>Symbol.iterator</code> </p><blockquote><p>Symbol.iterator æ˜¯ JavaScript ä¸­çš„ä¸€ä¸ªå†…ç½®ç¬¦å·ï¼ˆSymbolï¼‰ï¼Œå®ƒç”¨äºå®šä¹‰ä¸€ä¸ªå¯¹è±¡çš„é»˜è®¤è¿­ä»£å™¨æ–¹æ³•ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myObject = &#123;</span><br><span class="line">  <span class="attr">data</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]() &#123;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="variable language_">this</span>.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; data.<span class="property">length</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">value</span>: data[index++],</span><br><span class="line">            <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">          &#125;;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">done</span>: <span class="literal">true</span></span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥æ”¯æŒ <code>for of</code> å¾ªç¯ã€‚</p><h3 id="6-at"><a href="#6-at" class="headerlink" title="6. at"></a>6. at</h3><blockquote><p>at() æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ•´æ•°å€¼å¹¶è¿”å›è¯¥ç´¢å¼•å¯¹åº”çš„å…ƒç´ ï¼Œå…è®¸æ­£æ•°å’Œè´Ÿæ•°ã€‚è´Ÿæ•´æ•°ä»æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ å¼€å§‹å€’æ•°ã€‚</p></blockquote><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ­£æ•´æ•°å»ä½¿ç”¨çš„è¯å’Œç›´æ¥ <code>array[index]</code> æ˜¯æ²¡æœ‰åŒºåˆ«çš„.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line">o[<span class="number">0</span>] <span class="comment">//1;</span></span><br><span class="line">o.<span class="title function_">at</span>(<span class="number">0</span>) <span class="comment">//1;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æœ‰äº›ä¸ä¸€æ ·</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line">o[o.<span class="property">length</span> - <span class="number">1</span>] <span class="comment">//5;</span></span><br><span class="line">o.<span class="title function_">at</span>(-<span class="number">1</span>) <span class="comment">//5;</span></span><br></pre></td></tr></table></figure><p>ä»–ä¼šç®€åŒ–æ“ä½œã€‚</p><h3 id="7-concat"><a href="#7-concat" class="headerlink" title="7. concat"></a>7. concat</h3><blockquote><p>concat() æ–¹æ³•ç”¨äºåˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªæ•°ç»„ã€‚æ­¤æ–¹æ³•ä¸ä¼šæ›´æ”¹ç°æœ‰æ•°ç»„ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">concat</span>(...item);</span><br></pre></td></tr></table></figure><p>å°±æ˜¯åˆå¹¶ï¼Œä¸ä¼šå»é‡ï¼Œå¹¶ä¸”æ˜¯æµ…æ‹·è´</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> num1 = [[<span class="number">1</span>]];</span><br><span class="line"><span class="keyword">const</span> num2 = [<span class="number">2</span>, [<span class="number">3</span>]];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> numbers = num1.<span class="title function_">concat</span>(num2);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(numbers);</span><br><span class="line"><span class="comment">// [[1], 2, [3]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿®æ”¹ num1 çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">num1[<span class="number">0</span>].<span class="title function_">push</span>(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(numbers);</span><br><span class="line"><span class="comment">// [[1, 4], 2, [3]]</span></span><br></pre></td></tr></table></figure><p>è¿˜æœ‰å°±æ˜¯ <strong>Symbol.isConcatSpreadable</strong></p><blockquote><p>å†…ç½®çš„<strong>Symbol.isConcatSpreadable</strong>ç¬¦å·ç”¨äºé…ç½®æŸå¯¹è±¡ä½œä¸ºArray.prototype.concat()æ–¹æ³•çš„å‚æ•°æ—¶æ˜¯å¦å±•å¼€å…¶æ•°ç»„å…ƒç´ ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> arr1 = [<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line">arr[<span class="title class_">Symbol</span>.<span class="property">isConcatSpreadable</span>] = <span class="literal">false</span>;</span><br><span class="line">arr.<span class="title function_">concat</span>(arr1); <span class="comment">//[[1, 2, 3, 4, 5], 6,7,8]</span></span><br></pre></td></tr></table></figure><p>ä¼šæ”¹å˜é»˜è®¤è¡Œä¸º.</p><p>å¦‚æœæ˜¯ Array-like, å°±ä¼šç›´æ¥æ”¯æŒ <code>concat</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj2 = &#123; <span class="number">0</span>: <span class="number">1</span>, <span class="number">1</span>: <span class="number">2</span>, <span class="number">2</span>: <span class="number">3</span>, <span class="attr">length</span>: <span class="number">3</span>, [<span class="title class_">Symbol</span>.<span class="property">isConcatSpreadable</span>]: <span class="literal">true</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>];</span><br><span class="line">arr.<span class="title function_">concat</span>(obj2) <span class="comment">//[1,2,3,5,6,7,8]</span></span><br></pre></td></tr></table></figure><h3 id="8-copyWithin"><a href="#8-copyWithin" class="headerlink" title="8. copyWithin"></a>8. copyWithin</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">copyWithin</span>(target)</span><br><span class="line"><span class="title function_">copyWithin</span>(target, start)</span><br><span class="line"><span class="title function_">copyWithin</span>(target, start, end)</span><br></pre></td></tr></table></figure><blockquote><p>copyWithin æ˜¯æ•°ç»„çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå°†æ•°ç»„ä¸­çš„ä¸€éƒ¨åˆ†å…ƒç´ å¤åˆ¶åˆ°æ•°ç»„çš„æŒ‡å®šä½ç½®ã€‚å®ƒä¿®æ”¹åŸå§‹æ•°ç»„ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„æ•°ç»„å‰¯æœ¬ã€‚</p></blockquote><p>ç®€å•çš„æ–¹æ³•å´æœ‰å¾ˆå¤šä¸œè¥¿.</p><ul><li>æ‰€æœ‰å‚æ•°éƒ½æ”¯æŒè´Ÿæ•°ï¼Œ å¦‚æœ param &lt; 0ï¼Œåˆ™å®é™…æ˜¯ param + array.lengthã€‚</li><li>æ‰€æœ‰å‚æ•°éƒ½ä¼šè½¬ä¸ºæ•´æ•°, å¦‚æœä¸æ˜¯æ•´æ•°ï¼Œæ¯”å¦‚æ˜¯ <code>abcd</code> ä¹‹ç±»çš„ï¼Œä¼šè¢«è½¬ä¸º 0</li><li>å¦‚æœ param &lt; -arr.length, ä½¿ç”¨ 0</li><li>å¦‚æœ (target or start) &gt;&#x3D; arr.length, ä¸ä¼šæ‹·è´ </li><li>å¦‚æœ çœç•¥end æˆ–è€… end &gt;&#x3D; arr.length, æœ«å°¾æ‰€æœ‰å…ƒç´ éƒ½è¢«å¤åˆ¶ã€‚</li><li>å¦‚æœ å¦‚æœ end ä½äº start ä¹‹å‰ï¼Œåˆ™ä¸ä¼šæ‹·è´ä»»ä½•å†…å®¹ã€‚</li><li>end å¦‚æœ end ä½äº start ä¹‹å‰ï¼Œåˆ™ä¸ä¼šæ‹·è´ä»»ä½•å†…å®¹ã€‚</li></ul><p>å¯¹äºå‚æ•°æ¥è¯´ä»–å®åœ¨æ˜¯å¤ªèƒ½å…¼å®¹äº†ï¼ŒçœŸçš„ä¸å¤ªæƒ³ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><h3 id="9-Array-prototype-entries"><a href="#9-Array-prototype-entries" class="headerlink" title="9. Array.prototype.entries()"></a>9. Array.prototype.entries()</h3><blockquote><p>entries() æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„è¿­ä»£å™¨ (en-US)å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«æ•°ç»„ä¸­æ¯ä¸ªç´¢å¼•çš„é”®&#x2F;å€¼å¯¹ã€‚</p></blockquote><p>é¦–å…ˆéœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯è¿­ä»£å™¨, æ˜¯å®ç°äº†ä¸€ä¸ªè¿­ä»£å™¨åè®®</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Iteration_protocols#%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%8D%8F%E8%AE%AE">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Iteration_protocols#%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%8D%8F%E8%AE%AE</a></p><p>åè®®æ˜¯ä¸Šé¢é‚£ä¸ªé“¾æ¥</p><p>éœ€è¦å®ç° next æ–¹æ³•ï¼Œå¹¶ä¸”è¿”å› IteratorResultæ¥å£å¯¹è±¡ã€‚</p><p>æ¥å£åŒ…å« </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">done: boolean,</span><br><span class="line">value: string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸å½“äºè¿”å›ä¸€ä¸ªè¿™æ ·çš„æ¥å£å¯¹è±¡ã€‚</p><h3 id="10-Array-prototype-every"><a href="#10-Array-prototype-every" class="headerlink" title="10. Array.prototype.every()"></a>10. Array.prototype.every()</h3><blockquote><p>every() æ–¹æ³•æµ‹è¯•ä¸€ä¸ªæ•°ç»„å†…çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦éƒ½èƒ½é€šè¿‡æŒ‡å®šå‡½æ•°çš„æµ‹è¯•ã€‚å®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.<span class="title function_">every</span>(callbackFn, arg);</span><br></pre></td></tr></table></figure><p>callbackFn è¡¨ç¤ºå›è°ƒï¼Œ argè¡¨ç¤º this æŒ‡å‘ï¼Œå¯é€‰ã€‚</p><p>every ä¼šéå†æ‰€æœ‰çš„æ•°ç»„å…ƒç´ ï¼Œå¦‚æœ callbackFn ä¸­è¿”å›å‡å€¼ï¼Œä¼šç«‹åˆ»åœæ­¢éå†ï¼Œå¹¶ä¸”è¿”å› false.</p><p>å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œevery ä¸ä¼šéå†ç¨€ç–æ•°ç»„ä¸­çš„ç©º, è¿™é‡Œæ˜¯æˆ‘ä¹‹å‰ä¸çŸ¥é“çš„ä¸€ä¸ªæ¦‚å¿µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1, undefined, 1].every(v =&gt; v === 1) //false</span><br><span class="line">[1, , 1].every(v =&gt; v === 1) //true</span><br></pre></td></tr></table></figure><p>[1,,1]æ˜¯ç¨€ç–æ•°ç»„ï¼Œä½†æ˜¯[1, undefined, 1]ä¸æ˜¯ã€‚</p><h3 id="11-Array-prototype-fill"><a href="#11-Array-prototype-fill" class="headerlink" title="11. Array.prototype.fill()"></a>11. Array.prototype.fill()</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fill</span>(value)</span><br><span class="line"><span class="title function_">fill</span>(value, start)</span><br><span class="line"><span class="title function_">fill</span>(value, start, end)</span><br></pre></td></tr></table></figure><p>åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯å¡«å……æ•°ç»„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>(<span class="number">5</span>).<span class="title function_">fill</span>(<span class="number">0</span>) <span class="comment">// [0, 0, 0, 0, 0]</span></span><br></pre></td></tr></table></figure><p>ä¸»è¦å† start å’Œ end, å’Œ copyWithin ä¸€æ ·ã€‚</p><ul><li>æ‰€æœ‰å‚æ•°ï¼ŒåŸºäºé›¶çš„ç´¢å¼•ï¼Œä»æ­¤å¼€å§‹å¡«å……ï¼Œè½¬æ¢ä¸ºæ•´æ•°ã€‚</li><li>å¦‚æœ start ä¸ºç©ºï¼Œå°±å…¨éƒ¨å¡«å……ï¼Œ å¦‚æœ start ä¸ä¸ºç©ºï¼Œ endä¸ºç©ºï¼Œé‚£ä¹ˆä»startå¼€å§‹å¡«å……ï¼Œç›´åˆ°æœ«å°¾ã€‚</li><li>å¦‚æœ å‚æ•° &lt; -array.length æˆ– å‚æ•° è¢«çœç•¥ï¼Œåˆ™ä½¿ç”¨ 0ã€‚</li><li>å¦‚æœ start &gt;&#x3D; array.length</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ç®¡æ˜¯ every è¿˜æ˜¯ fillï¼Œ endå€¼éƒ½ä¸æ˜¯é€šè¿‡ start è®¡ç®—ï¼Œè€Œæ˜¯ç‹¬ç«‹è®¡ç®—ã€‚</p><h3 id="12-Array-prototype-filter"><a href="#12-Array-prototype-filter" class="headerlink" title="12. Array.prototype.filter()"></a>12. Array.prototype.filter()</h3><p>å¾ˆå¸¸ç”¨çš„æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">filter</span>(callbackFn)</span><br><span class="line"><span class="title function_">filter</span>(callbackFn, thisArg)</span><br><span class="line"><span class="title function_">callbackFn</span>(element, index, array)</span><br></pre></td></tr></table></figure><p>thisArg æ˜¯æ›¿æ¢ callbackFn ä¸­ this æŒ‡å‘ã€‚</p><p>è¿”å›æ•°ç»„ï¼Œä¸è¿‡æ˜¯æµ…æ‹·è´,åŒæ ·ä¼šå‡ºç°ç¨€ç–æ•°ç»„çš„é—®é¢˜ï¼Œä¼šè·³è¿‡ã€‚</p><h3 id="13-Array-prototype-find-Array-prototype-findIndex-Array-prototype-findLast-Array-prototype-findLastIndex"><a href="#13-Array-prototype-find-Array-prototype-findIndex-Array-prototype-findLast-Array-prototype-findLastIndex" class="headerlink" title="13. Array.prototype.find, Array.prototype.findIndex, Array.prototype.findLast, Array.prototype.findLastIndex"></a>13. Array.prototype.find, Array.prototype.findIndex, Array.prototype.findLast, Array.prototype.findLastIndex</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">find</span>(callbackFn);</span><br><span class="line"><span class="title function_">find</span>(callbackFn, thisArg);</span><br><span class="line"><span class="title function_">callbackFn</span>(element, index. arr);</span><br></pre></td></tr></table></figure><p>find å’Œä¹‹å‰çœ‹è¿‡çš„ every, filter ä¸ä¸€æ ·ï¼Œæ˜¯èƒ½å¤Ÿè®¿é—®ç¨€ç–æ•°ç»„çš„ï¼Œä¹Ÿå°±æ˜¯ä¸º undefined.</p><p>find å‡åºè¿­ä»£æ•°ç»„ã€‚è¿”å›true, è¿”å›å½“å‰ index çš„ item.<br>å…¶ä»–æ€»ä½“ç±»ä¼¼ï¼Œåªæ˜¯é¡ºåºå’Œè¿”å›å€¼å·®åˆ«ã€‚</p><h3 id="14-Array-prototype-flat"><a href="#14-Array-prototype-flat" class="headerlink" title="14. Array.prototype.flat"></a>14. Array.prototype.flat</h3><blockquote><p>flat() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå¹¶æ ¹æ®æŒ‡å®šæ·±åº¦é€’å½’åœ°å°†æ‰€æœ‰å­æ•°ç»„å…ƒç´ æ‹¼æ¥åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚</p></blockquote><p>ç®€å•è¯´å°±æ˜¯ï¼Œå°†å¤šç»´æ•°ç»„ç®€åŒ–æˆæ›´ä½ç»´åº¦çš„æ•°ç»„ï¼Œä¸ä¸€å®šæ˜¯ä¸€ç»´æ•°ç»„ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿”å›çš„æ˜¯æµ…æ‹·è´ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">flat</span>()</span><br><span class="line"><span class="title function_">flat</span>(depth)</span><br></pre></td></tr></table></figure><blockquote><p>æŒ‡å®šè¦æå–åµŒå¥—æ•°ç»„çš„ç»“æ„æ·±åº¦ï¼Œé»˜è®¤å€¼ä¸º 1ã€‚</p></blockquote><p>ä¸œè¥¿æ¯”è¾ƒç®€å•ï¼Œä¸€ä¸ªç®€å•ä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">//flat</span><br><span class="line">console.log(`---------------flat start---------------`);</span><br><span class="line">const flatTest1 = [1, 2, 3, 4, [5, 6, [7, 8, [9, 10, [11, 12]]]]];</span><br><span class="line">console.log(&quot;empty flatTest1:&quot;, flatTest1.flat());</span><br><span class="line">console.log(`1 flatTest1:`, flatTest1.flat(1));</span><br><span class="line">console.log(`2 flatTest1:`, flatTest1.flat(2));</span><br><span class="line">console.log(`3 flatTest1`, flatTest1.flat(3));</span><br><span class="line">console.log(`4 flatTest1`, flatTest1.flat(4));</span><br><span class="line">console.log(&quot;Infinity flatTest1&quot;, flatTest1.flat(Infinity));</span><br><span class="line"></span><br><span class="line">const flatTest2 = [</span><br><span class="line">1,</span><br><span class="line">2,</span><br><span class="line">,</span><br><span class="line">3,</span><br><span class="line">4,</span><br><span class="line">[5, , 6, [7, , 8, [9, , 10, [11, , 12]]]],</span><br><span class="line">];</span><br><span class="line">console.log(&quot;empty flatTest2:&quot;, flatTest2.flat());</span><br><span class="line">console.log(`1 flatTest2:`, flatTest2.flat(1));</span><br><span class="line">console.log(`2 flatTest2:`, flatTest2.flat(2));</span><br><span class="line">console.log(`3 flatTest2`, flatTest2.flat(3));</span><br><span class="line">console.log(`4 flatTest2`, flatTest2.flat(4));</span><br><span class="line">console.log(&quot;Infinity flatTest2&quot;, flatTest2.flat(Infinity));</span><br><span class="line">console.log(`---------------flat end---------------`);</span><br><span class="line"></span><br><span class="line">index.html:13 ---------------flat start---------------</span><br><span class="line">index.html:15 empty flatTest1: (7)Â [1, 2, 3, 4, 5, 6, Array(3)]</span><br><span class="line">index.html:16 1 flatTest1: (7)Â [1, 2, 3, 4, 5, 6, Array(3)]</span><br><span class="line">index.html:17 2 flatTest1: (9)Â [1, 2, 3, 4, 5, 6, 7, 8, Array(3)]</span><br><span class="line">index.html:18 3 flatTest1 (11)Â [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, Array(2)]</span><br><span class="line">index.html:19 4 flatTest1 (12)Â [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]</span><br><span class="line">index.html:20 Infinity flatTest1 (12)Â [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]</span><br><span class="line">index.html:30 empty flatTest2: (7)Â [1, 2, 3, 4, 5, 6, Array(4)]</span><br><span class="line">index.html:31 1 flatTest2: (7)Â [1, 2, 3, 4, 5, 6, Array(4)]</span><br><span class="line">index.html:32 2 flatTest2: (9)Â [1, 2, 3, 4, 5, 6, 7, 8, Array(4)]</span><br><span class="line">index.html:33 3 flatTest2 (11)Â [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, Array(3)]0: 11: 22: 33: 44: 55: 66: 77: 88: 99: 1010: (3)Â [11, ç©º, 12]length: 11[[Prototype]]: Array(0)</span><br><span class="line">index.html:34 4 flatTest2 (12)Â [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]</span><br><span class="line">index.html:35 Infinity flatTest2 (12)Â [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]</span><br><span class="line">index.html:36 ---------------flat end---------------</span><br></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œæµ‹è¯•äº†å¤šç»´æ•°ç»„å’Œç¨€ç–æ•°ç»„çš„æƒ…å†µï¼ŒåŸºæœ¬å¯ä»¥è¯´æ¸…æ¥šäº†ã€‚</p><h3 id="15-Array-prototype-flatMap"><a href="#15-Array-prototype-flatMap" class="headerlink" title="15. Array.prototype.flatMap"></a>15. Array.prototype.flatMap</h3><blockquote><p>flatMap() æ–¹æ³•å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ åº”ç”¨ç»™å®šçš„å›è°ƒå‡½æ•°ï¼Œç„¶åå°†ç»“æœå±•å¼€ä¸€çº§ï¼Œè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ã€‚å®ƒç­‰ä»·äºåœ¨è°ƒç”¨ map() æ–¹æ³•åå†è°ƒç”¨æ·±åº¦ä¸º 1 çš„ flat() æ–¹æ³•ï¼ˆarr.map(â€¦args).flat()ï¼‰ï¼Œä½†æ¯”åˆ†åˆ«è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ç¨å¾®æ›´é«˜æ•ˆä¸€äº›ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">flatMap</span>(callbackFn)</span><br><span class="line"><span class="title function_">flatMap</span>(callbackFn, thisArg)</span><br></pre></td></tr></table></figure><p>ç®€å•è¯´å°±æ˜¯è°ƒç”¨ Array.prototype.map ä¹‹åå†è°ƒç”¨ flat(1);</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//flatMap</span><br><span class="line">console.log(`---------------flatMap start---------------`);</span><br><span class="line">const flatMapest1 = [1, 2, 3, 4, [5, 6, [7, 8, [9, 10, [11, 12]]]]];</span><br><span class="line">console.log(`flatMapest1:`, flatMapest1.flatMap((n) =&gt; &#123;</span><br><span class="line">console.log(n);</span><br><span class="line">return n;</span><br><span class="line">&#125;));</span><br><span class="line">console.log(`---------------flatMap end---------------`);</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­ï¼Œå°±è¯´æ˜æƒ…å†µäº†ã€‚</p><h3 id="16-Array-prototype-forEach"><a href="#16-Array-prototype-forEach" class="headerlink" title="16. Array.prototype.forEach"></a>16. Array.prototype.forEach</h3><p>å¸¸ç”¨çš„ä¸€ç§éå†æ–¹å¼ï¼Œä»–æœ‰å‡ ä¸ªç»†èŠ‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">forEach</span>(callbackFn)</span><br><span class="line"><span class="title function_">forEach</span>(callbackFn, thisArg)</span><br></pre></td></tr></table></figure><ol><li>å®ƒæŒ‰ç´¢å¼•å‡åºåœ°ä¸ºæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è°ƒç”¨ä¸€æ¬¡æä¾›çš„ callbackFn å‡½æ•°</li><li>æ€»æ˜¯è¿”å› undefined</li><li>å½“è°ƒç”¨ forEach() æ—¶ï¼ŒcallbackFn ä¸ä¼šè®¿é—®è¶…å‡ºæ•°ç»„åˆå§‹é•¿åº¦çš„ä»»ä½•å…ƒç´ ã€‚</li><li>å·²ç»è®¿é—®è¿‡çš„ç´¢å¼•çš„æ›´æ”¹ä¸ä¼šå¯¼è‡´ callbackFn å†æ¬¡è°ƒç”¨å®ƒä»¬ã€‚</li><li>å¦‚æœ callbackFn æ›´æ”¹äº†æ•°ç»„ä¸­å·²ç»å­˜åœ¨ä½†å°šæœªè®¿é—®çš„å…ƒç´ ï¼Œåˆ™ä¼ é€’ç»™ callbackFn çš„å€¼å°†æ˜¯åœ¨è®¿é—®è¯¥å…ƒç´ æ—¶çš„å€¼ã€‚å·²ç»è¢«åˆ é™¤çš„å…ƒç´ ä¸ä¼šè¢«è®¿é—®ã€‚</li><li>é™¤äº† throw error ä¸èƒ½ä¸­æ–­ forEach</li><li>ä¸ä¼šè®¿é—®ç¨€ç–æ•°ç»„</li></ol><h3 id="17-Array-from"><a href="#17-Array-from" class="headerlink" title="17. Array.from()"></a>17. Array.from()</h3><blockquote><p>æƒ³è¦è½¬æ¢æˆæ•°ç»„çš„ç±»æ•°ç»„æˆ–å¯è¿­ä»£å¯¹è±¡ã€‚</p></blockquote><p>è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªæ•°ç»„çš„é™æ€æ–¹æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„å®ä¾‹ã€‚</p><p>è¿™é‡Œéœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯ç±»æ•°ç»„ï¼Œ</p><ul><li>ç´¢å¼•ï¼šç±»æ•°ç»„å¯¹è±¡ä½¿ç”¨æ•°å­—ç´¢å¼•æ¥è®¿é—®å…ƒç´ ï¼Œå°±åƒæ•°ç»„ä¸€æ ·ã€‚</li><li>é•¿åº¦ï¼šç±»æ•°ç»„å¯¹è±¡å…·æœ‰ length å±æ€§ï¼Œè¡¨ç¤ºå®ƒåŒ…å«çš„å…ƒç´ æ•°é‡ã€‚</li><li>è¿­ä»£ï¼šç±»æ•°ç»„å¯¹è±¡å¯ä»¥é€šè¿‡ for å¾ªç¯æˆ–å…¶ä»–è¿­ä»£æ–¹æ³•è¿›è¡Œéå†ï¼Œå°±åƒéå†æ•°ç»„ä¸€æ ·ã€‚</li><li>ä¸‹æ ‡è®¿é—®ï¼šç±»æ•°ç»„å¯¹è±¡å¯ä»¥é€šè¿‡ç´¢å¼•ç›´æ¥è®¿é—®å…ƒç´ ï¼Œä¾‹å¦‚ obj[0]ã€‚</li></ul><p>è¿˜æœ‰å°±æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼ŒSymbol.iteratorã€‚</p><h3 id="18-Array-fromAsync-å®éªŒæ€§è´¨"><a href="#18-Array-fromAsync-å®éªŒæ€§è´¨" class="headerlink" title="18. Array.fromAsync() å®éªŒæ€§è´¨"></a>18. Array.fromAsync() å®éªŒæ€§è´¨</h3><p>æˆ‘æµ‹è¯•äº†ä¸€ä¸‹ï¼Œæœ€æ–°ç‰ˆæœ¬çš„ edge æ˜¯ä¸æ”¯æŒçš„ã€‚</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/fromAsync">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/fromAsync</a></p><p>è¯¦æƒ…çœ‹è¿™ä¸ªå§ï¼Œä¸ä½¿ç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½ å…ˆæ‹¿åˆ°åœ¨ Array.from.</p><h3 id="19-Array-prototype-group-å®éªŒæ€§è´¨"><a href="#19-Array-prototype-group-å®éªŒæ€§è´¨" class="headerlink" title="19. Array.prototype.group() å®éªŒæ€§è´¨"></a>19. Array.prototype.group() å®éªŒæ€§è´¨</h3><p>çœ‹åå­—å°±çŸ¥é“æ˜¯ä¸€ç§æ•°ç»„çš„åˆ†ç»„æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">group</span>(callbackFn)</span><br><span class="line"><span class="title function_">group</span>(callbackFn, thisArg)</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myCallback</span>(<span class="params">&#123; quantity &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> quantity &gt; <span class="number">5</span> ? <span class="string">&quot;ok&quot;</span> : <span class="string">&quot;restock&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result2 = inventory.<span class="title function_">group</span>(myCallback);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ç»“æœæ˜¯ï¼š</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  restock: [</span></span><br><span class="line"><span class="comment">    &#123; name: &quot;asparagus&quot;, type: &quot;vegetables&quot;, quantity: 5 &#125;,</span></span><br><span class="line"><span class="comment">    &#123; name: &quot;bananas&quot;, type: &quot;fruit&quot;, quantity: 0 &#125;,</span></span><br><span class="line"><span class="comment">    &#123; name: &quot;cherries&quot;, type: &quot;fruit&quot;, quantity: 5 &#125;</span></span><br><span class="line"><span class="comment">  ],</span></span><br><span class="line"><span class="comment">  ok: [</span></span><br><span class="line"><span class="comment">    &#123; name: &quot;goat&quot;, type: &quot;meat&quot;, quantity: 23 &#125;,</span></span><br><span class="line"><span class="comment">    &#123; name: &quot;fish&quot;, type: &quot;meat&quot;, quantity: 22 &#125;</span></span><br><span class="line"><span class="comment">  ]</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥éšæ„å‘½ååˆ†ç»„ï¼Œåœ¨ callbackFn ä¸­è¿›è¡Œåˆ¤æ–­ï¼Œæ ¹æ®è¿”å›å€¼æ¥å‘½åç»„çš„åå­—ã€‚</p><p>éœ€è¦å€¼ä»¥çš„æ˜¯ï¼Œå‘½åå¿…é¡»æ˜¯ String or Symbol, å¦‚æœä¸æ˜¯ä¼šè¢«è½¬ä¸º String</p><h3 id="20-Array-prototype-groupToMap-å®éªŒæ€§è´¨"><a href="#20-Array-prototype-groupToMap-å®éªŒæ€§è´¨" class="headerlink" title="20. Array.prototype.groupToMap() å®éªŒæ€§è´¨"></a>20. Array.prototype.groupToMap() å®éªŒæ€§è´¨</h3><p>å’Œ 19 ä¸­ï¼Œ group ä¸€æ ·ï¼Œåªæ˜¯è¿”å›å€¼æ˜¯ä¸€ä¸ª Mapï¼Œé‚£ä¹ˆ key å°±çµæ´»äº†ã€‚</p><h3 id="21-Array-prototype-includes"><a href="#21-Array-prototype-includes" class="headerlink" title="21. Array.prototype.includes()"></a>21. Array.prototype.includes()</h3><blockquote><p>includes() æ–¹æ³•ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼Œæ ¹æ®æƒ…å†µï¼Œå¦‚æœåŒ…å«åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">includes</span>(searchElement)</span><br><span class="line"><span class="title function_">includes</span>(searchElement, fromIndex)</span><br></pre></td></tr></table></figure><ul><li>fromIndex å¯ä»¥æ”¯æŒè´Ÿæ•°ï¼ŒfromIndex + array.lengthï¼Œ </li><li>å¦‚æœ fromIndex &gt; array.length return false.</li><li>å¦‚æœ fromIndex &lt; -array.length fromIndex &#x3D; 0</li></ul><h3 id="22-Array-prototype-indexOf-ï¼ŒArray-prototype-lastIndexOf"><a href="#22-Array-prototype-indexOf-ï¼ŒArray-prototype-lastIndexOf" class="headerlink" title="22. Array.prototype.indexOf()ï¼ŒArray.prototype.lastIndexOf()"></a>22. Array.prototype.indexOf()ï¼ŒArray.prototype.lastIndexOf()</h3><p>å…¶å® includesï¼Œfindï¼Œ indexOf ç±»ä¼¼ï¼Œåªæ˜¯ indexOf æ˜¯è¿”å›ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯Index</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">indexOf</span>(searchElement)</span><br><span class="line"><span class="title function_">indexOf</span>(searchElement, fromIndex)</span><br></pre></td></tr></table></figure><ul><li>fromIndex å¯ä»¥æ”¯æŒè´Ÿæ•°ï¼ŒfromIndex + array.lengthï¼Œ </li><li>å¦‚æœ fromIndex &gt; array.length return -1.</li><li>å¦‚æœ fromIndex &lt; -array.length fromIndex &#x3D; 0</li></ul><p>é‚£ä¹ˆlastIndexOf å·®åˆ«å°±åœ¨äºé¡ºåºï¼Œéƒ½çŸ¥é“ indexOf æ˜¯ç¬¬ä¸€ä¸ªå‡ºç°å°±è¿”å›ï¼Œé‚£ä¹ˆ indexOf æ˜¯å‡åºï¼ŒlastIndexOf æ˜¯é™åºã€‚</p><h3 id="23-Array-isArray"><a href="#23-Array-isArray" class="headerlink" title="23. Array.isArray()"></a>23. Array.isArray()</h3><h3 id="24-Array-prototype-join"><a href="#24-Array-prototype-join" class="headerlink" title="24. Array.prototype.join()"></a>24. Array.prototype.join()</h3><p>æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œæ²¡ä»€ä¹ˆå¥½è®²çš„ã€‚</p><h3 id="25-Array-prototype-keys"><a href="#25-Array-prototype-keys" class="headerlink" title="25. Array.prototype.keys()"></a>25. Array.prototype.keys()</h3><blockquote><p>keys() æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„è¿­ä»£å™¨ (en-US)å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æ•°ç»„ä¸­æ¯ä¸ªç´¢å¼•çš„é”®ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="string">&quot;a&quot;</span>, , <span class="string">&quot;c&quot;</span>];</span><br><span class="line"><span class="keyword">const</span> sparseKeys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(arr);</span><br><span class="line"><span class="keyword">const</span> denseKeys = [...arr.<span class="title function_">keys</span>()];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sparseKeys); <span class="comment">// [&#x27;0&#x27;, &#x27;2&#x27;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(denseKeys); <span class="comment">// [0, 1, 2]</span></span><br></pre></td></tr></table></figure><p>å·®åˆ«å°±åœ¨ç¨€ç–æ•°ç»„ã€‚</p><h3 id="26-Array-prototype-map"><a href="#26-Array-prototype-map" class="headerlink" title="26. Array.prototype.map()"></a>26. Array.prototype.map()</h3><blockquote><p>map() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œè¿™ä¸ªæ–°æ•°ç»„ç”±åŸæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½è°ƒç”¨ä¸€æ¬¡æä¾›çš„å‡½æ•°åçš„è¿”å›å€¼ç»„æˆã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">map</span>(callbackFn)</span><br><span class="line"><span class="title function_">map</span>(callbackFn, thisArg)</span><br><span class="line"><span class="title function_">callbackFn</span>(element, index, arr)</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯æ ¹æ®ç°æœ‰æ•°ç»„ï¼Œæ¯æ¬¡éå†è°ƒç”¨ callbackFn è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ã€‚</p><p>å¥½ç©çš„æ˜¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>,,<span class="number">3</span>].<span class="title function_">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> x + <span class="string">&quot;1&quot;</span>) <span class="comment">//[&#x27;11&#x27;, undefined, &#x27;31&#x27;];</span></span><br></pre></td></tr></table></figure><p>ç„¶è€ŒåŠ ä¸Šè¾“å‡º</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>,,<span class="number">3</span>].<span class="title function_">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line"><span class="keyword">return</span> x + <span class="string">&quot;1&quot;</span>;</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line"><span class="comment">//1</span></span><br><span class="line"><span class="comment">//3</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯ä¸ä¼šéå†åˆ°ï¼Œä½†æ˜¯ä¼šè¾“å‡º..</p><h3 id="27-Array-of"><a href="#27-Array-of" class="headerlink" title="27. Array.of"></a>27. Array.of</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="title function_">of</span>()</span><br><span class="line"><span class="title class_">Array</span>.<span class="title function_">of</span>(element0)</span><br><span class="line"><span class="title class_">Array</span>.<span class="title function_">of</span>(element0, element1)</span><br><span class="line"><span class="title class_">Array</span>.<span class="title function_">of</span>(element0, element1, <span class="comment">/* â€¦ ,*/</span> elementN)</span><br></pre></td></tr></table></figure><p>å”¯ä¸€çš„å·®åˆ«</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="title function_">of</span>(<span class="number">7</span>); <span class="comment">// [7]</span></span><br><span class="line"><span class="title class_">Array</span>(<span class="number">7</span>); <span class="comment">// ç”± 7 ä¸ªç©ºæ§½ç»„æˆçš„æ•°ç»„</span></span><br></pre></td></tr></table></figure><h3 id="28-Array-prototype-pop-Array-prototype-shift-Array-prototype-unshift-ï¼ŒArray-prototype-push"><a href="#28-Array-prototype-pop-Array-prototype-shift-Array-prototype-unshift-ï¼ŒArray-prototype-push" class="headerlink" title="28. Array.prototype.pop(), Array.prototype.shift(), Array.prototype.unshift()ï¼ŒArray.prototype.push()"></a>28. Array.prototype.pop(), Array.prototype.shift(), Array.prototype.unshift()ï¼ŒArray.prototype.push()</h3><p>pop åˆ é™¤æœ€åä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”è¿”å›å€¼ã€‚</p><p>push æ–¹æ³•å°†æŒ‡å®šçš„å…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œå¹¶è¿”å›æ–°çš„æ•°ç»„é•¿åº¦ã€‚</p><p>shift åˆ é™¤æœ€æ–°çš„å€¼ï¼Œå¹¶ä¸”è¿”å›å€¼</p><p>unshift æ–¹æ³•å°†æŒ‡å®šå…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„å¼€å¤´ï¼Œå¹¶è¿”å›æ•°ç»„çš„æ–°é•¿åº¦ã€‚</p><h3 id="29-Array-prototype-reduce-ï¼ŒArray-prototype-reduceRight"><a href="#29-Array-prototype-reduce-ï¼ŒArray-prototype-reduceRight" class="headerlink" title="29. Array.prototype.reduce()ï¼ŒArray.prototype.reduceRight()"></a>29. Array.prototype.reduce()ï¼ŒArray.prototype.reduceRight()</h3><blockquote><p>reduce() æ–¹æ³•å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æŒ‰åºæ‰§è¡Œä¸€ä¸ªæä¾›çš„ reducer å‡½æ•°ï¼Œæ¯ä¸€æ¬¡è¿è¡Œ reducer ä¼šå°†å…ˆå‰å…ƒç´ çš„è®¡ç®—ç»“æœä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œæœ€åå°†å…¶ç»“æœæ±‡æ€»ä¸ºå•ä¸ªè¿”å›å€¼ã€‚</p></blockquote><p>çœ‹äº†è¿™ä¸ªæè¿°å°±åº”è¯¥çŸ¥é“è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ç›®çš„ï¼Œçƒå’Œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">reduce</span>(callbackFn)</span><br><span class="line"><span class="title function_">reduce</span>(callbackFn, initialValue)</span><br><span class="line"><span class="title function_">callbackFn</span>(accumulator,currentValue,currentIndex)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªæ¦‚å¿µ</p><blockquote><p>æ¯ä¸€æ¬¡è¿è¡Œ reducer ä¼šå°†å…ˆå‰å…ƒç´ çš„è®¡ç®—ç»“æœä½œä¸ºå‚æ•°ä¼ å…¥</p></blockquote><p>é‚£ä¹ˆç¬¬ä¸€æ¬¡è¿è¡Œæ˜æ˜¾æ²¡æœ‰åˆå§‹å€¼ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰ä¼ å…¥ initialValue ï¼Œç´¢å¼•0,å°±æ˜¯åˆå§‹å€¼ã€‚</p><p>å¦‚æœä¼ å…¥ï¼Œé‚£ä¹ˆ initalValue å°±æ˜¯åˆå§‹å€¼ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ä¸œè¥¿ï¼Œå°±æ˜¯ reduce å¦‚æœæ•°ç»„é•¿åº¦æ˜¯1, é‚£ä¹ˆä¸ä¼šè°ƒç”¨ callbackFnï¼Œå¦‚æœæœ‰ initalValue, æ•°ç»„æ²¡æœ‰é•¿åº¦ï¼ŒåŒä¸Šã€‚</p><p>reduce æ˜¯ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œå› ä¸ºä»–ä¼šç®—å‡ºä¸Šä¸€æ¬¡çš„ç»“æœï¼Œæ±‚å’Œå¯¹ä»–æ¥è¯´æ˜¯æœ€ç®€å•çš„å·¥ä½œï¼Œä»–å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œå› ä¸ºä»–ä¼šä¼ å…¥ä¸Šä¸€æ¬¡çš„ç»“æœï¼Œæ‰€ä»¥ä½ å¯ä»¥ä¸ç”¨åœ¨å¤–éƒ¨æ–°å»ºä¸€ä¸ªå‚æ•°ï¼Œå°±å¯ä»¥ç›´æ¥åšå¾ˆå¤šäº‹æƒ…ï¼Œè€Œä¸ç”¨è‡ªå·±å»å†™ä¸€ä¸ªå¿…åŒ…æˆ–è€…æ–¹æ³•ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘è¦æŠŠä¸€ä¸ªæ•°ç»„é‡Œé¢çš„å¥‡æ•°å’Œå¶æ•°åˆ†å¼€ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [];</span><br><span class="line"><span class="keyword">let</span> arr1 = [];</span><br><span class="line">array.<span class="title function_">forEach</span>(<span class="function"><span class="params">v</span> =&gt;</span> &#123; v % <span class="number">2</span> === <span class="number">0</span> ? arr.<span class="title function_">push</span>(): <span class="attr">arr1</span>:<span class="title function_">push</span>() &#125;);</span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨ reduce</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>].<span class="title function_">reduce</span>(<span class="function">(<span class="params">a,b,i</span>) =&gt;</span> &#123;</span><br><span class="line">    b % <span class="number">2</span> === <span class="number">0</span> ? a[<span class="number">0</span>].<span class="title function_">push</span>(b) : a[<span class="number">1</span>].<span class="title function_">push</span>(b);</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;, [[],[]])</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚æ˜¯è¿™ä¸ªæ„æ€ã€‚</p><p>reduceRight å°±æ˜¯ä»å³åˆ°å·¦ã€‚</p><h3 id="30-Array-prototype-reverse-ï¼ŒArray-prototype-toReversed"><a href="#30-Array-prototype-reverse-ï¼ŒArray-prototype-toReversed" class="headerlink" title="30. Array.prototype.reverse()ï¼ŒArray.prototype.toReversed()"></a>30. Array.prototype.reverse()ï¼ŒArray.prototype.toReversed()</h3><p>åè½¬æ•°ç»„ï¼Œæ²¡æœ‰å…¶ä»–å‚æ•°ã€‚</p><blockquote><p>reverse() æ–¹æ³•å°±åœ°åè½¬æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå¹¶è¿”å›åŒä¸€æ•°ç»„çš„å¼•ç”¨ã€‚æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¼šå˜æˆæœ€åä¸€ä¸ªï¼Œæ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ å˜æˆç¬¬ä¸€ä¸ªã€‚æ¢å¥è¯è¯´ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ é¡ºåºå°†è¢«ç¿»è½¬ï¼Œå˜ä¸ºä¸ä¹‹å‰ç›¸åçš„æ–¹å‘ã€‚</p></blockquote><p>toReversed äº§ç”Ÿæ–°æ•°ç»„ï¼Œæµ…æ‹·è´ã€‚</p><h3 id="31-Array-prototype-slice"><a href="#31-Array-prototype-slice" class="headerlink" title="31. Array.prototype.slice()"></a>31. Array.prototype.slice()</h3><blockquote><p>slice() æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡ï¼Œè¿™ä¸€å¯¹è±¡æ˜¯ä¸€ä¸ªç”± start å’Œ end å†³å®šçš„åŸæ•°ç»„çš„æµ…æ‹·è´ï¼ˆåŒ…æ‹¬ startï¼Œä¸åŒ…æ‹¬ endï¼‰ï¼Œå…¶ä¸­ start å’Œ end ä»£è¡¨äº†æ•°ç»„å…ƒç´ çš„ç´¢å¼•ã€‚åŸå§‹æ•°ç»„ä¸ä¼šè¢«æ”¹å˜ã€‚</p></blockquote><p>ç±»ä¼¼äº <code>String.prototype.sub</code>. æˆªå–ä¸€æ®µ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">slice</span>()</span><br><span class="line"><span class="title function_">slice</span>(start)</span><br><span class="line"><span class="title function_">slice</span>(start, end)</span><br></pre></td></tr></table></figure><p>start &amp; end, å°±æ˜¯å¼€å§‹å’Œç»“æŸï¼Œç»“æŸå¹¶ä¸æ˜¯é•¿åº¦ã€‚</p><p>ç„¶å start å’Œ end éœ€è¦è·Ÿå…¶ä»–çš„æ•°ç»„å†…å®¹ä¸€æ ·ï¼Œ</p><ul><li>å…è®¸è´Ÿæ•°ï¼Œparam + array.length</li><li>param &lt; -array.length &#x3D; 0</li><li>start &gt;&#x3D; array.lengthï¼Œ ä¸æˆªå–</li><li>end &gt;&#x3D; array.length, æå–åˆ°æœ«å°¾çš„æ‰€æœ‰</li><li>end &lt; start, ä¸æå–</li></ul><h3 id="32-Array-prototype-some"><a href="#32-Array-prototype-some" class="headerlink" title="32. Array.prototype.some()"></a>32. Array.prototype.some()</h3><blockquote><p>some() æ–¹æ³•æµ‹è¯•æ•°ç»„ä¸­æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ é€šè¿‡äº†ç”±æä¾›çš„å‡½æ•°å®ç°çš„æµ‹è¯•ã€‚å¦‚æœåœ¨æ•°ç»„ä¸­æ‰¾åˆ°ä¸€ä¸ªå…ƒç´ ä½¿å¾—æä¾›çš„å‡½æ•°è¿”å› trueï¼Œåˆ™è¿”å› trueï¼›å¦åˆ™è¿”å› falseã€‚å®ƒä¸ä¼šä¿®æ”¹æ•°ç»„ã€‚</p></blockquote><p>some åªè¦ä¸€ä¸ªç¬¦åˆæ¡ä»¶ï¼Œå°±è¿”å› true, å…¨éƒ¨ falseï¼Œæ‰è¿”å› false.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">some</span>(callbackFn)</span><br><span class="line"><span class="title function_">some</span>(callbackFn, thisArg)</span><br></pre></td></tr></table></figure><p>some() ä¸ä¼šåœ¨ç©ºæ§½ä¸Šè¿è¡Œå®ƒçš„æ–­è¨€å‡½æ•°, åæ­£ä¸ç®¡ç©ºæ§½ï¼Œä¹Ÿå°±æ˜¯ä¸ç®¡ç¨€ç–æ•°ç»„ã€‚</p><h3 id="33-Array-prototype-sort"><a href="#33-Array-prototype-sort" class="headerlink" title="33. Array.prototype.sort()"></a>33. Array.prototype.sort()</h3><blockquote><p>sort() æ–¹æ³•å°±åœ°å¯¹æ•°ç»„çš„å…ƒç´ è¿›è¡Œæ’åºï¼Œå¹¶è¿”å›å¯¹ç›¸åŒæ•°ç»„çš„å¼•ç”¨ã€‚é»˜è®¤æ’åºæ˜¯å°†å…ƒç´ è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åæŒ‰ç…§å®ƒä»¬çš„ UTF-16 ç å…ƒå€¼å‡åºæ’åºã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">sort</span>()</span><br><span class="line"><span class="title function_">sort</span>(compareFn)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰2ç§æƒ…å†µ</p><blockquote><p>å¦‚æœæ²¡æœ‰æä¾› compareFnï¼Œæ‰€æœ‰é undefined çš„æ•°ç»„å…ƒç´ éƒ½ä¼šè¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶æŒ‰ç…§ UTF-16 ç å…ƒé¡ºåºæ¯”è¾ƒå­—ç¬¦ä¸²è¿›è¡Œæ’åº</p></blockquote><p>å…·ä½“ç å¯ä»¥å‚è€ƒè¿™ä¸ªé“¾æ¥ <a href="https://www.toolhelper.cn/Encoding/UTF16">https://www.toolhelper.cn/Encoding/UTF16</a></p><p>æ‰€æœ‰çš„ undefined å…ƒç´ éƒ½ä¼šè¢«æ’åºåˆ°æ•°ç»„çš„æœ«å°¾ï¼Œsort() æ–¹æ³•ä¿ç•™ç©ºæ§½ã€‚å¦‚æœæºæ•°ç»„æ˜¯ç¨€ç–çš„ï¼Œåˆ™ç©ºæ§½ä¼šè¢«ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œå¹¶å§‹ç»ˆæ’åœ¨æ‰€æœ‰ undefined å…ƒç´ çš„åé¢ã€‚</p><p>è¿™å°±æ˜¯ sort çš„é€»è¾‘ã€‚</p><p>ç¬¬äºŒç§æƒ…å†µï¼Œé€šè¿‡ callbackFn æ¥è¿›è¡Œå¯¹æ¯”</p><blockquote><p>å¦‚æœæä¾›äº† compareFnï¼Œæ‰€æœ‰é undefined çš„æ•°ç»„å…ƒç´ éƒ½ä¼šæŒ‰ç…§æ¯”è¾ƒå‡½æ•°çš„è¿”å›å€¼è¿›è¡Œæ’åºï¼ˆæ‰€æœ‰çš„ undefined å…ƒç´ éƒ½ä¼šè¢«æ’åºåˆ°æ•°ç»„çš„æœ«å°¾ï¼Œå¹¶ä¸”ä¸è°ƒç”¨ compareFnï¼‰ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; 0a åœ¨ b åï¼Œå¦‚ [b, a]</span><br><span class="line">&lt; 0a åœ¨ b å‰ï¼Œå¦‚ [a, b]</span><br><span class="line">=== 0ä¿æŒ a å’Œ b åŸæ¥çš„é¡ºåº</span><br></pre></td></tr></table></figure><p>okï¼Œåœ¨çŸ¥é“äº†è¿™ä¸ªæ¡ä»¶ä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æ’åºäº†, æ¯”å¦‚æˆ‘ä»¬éœ€è¦ä»ä½åˆ°é«˜æ’åº</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sortArr = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">19</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">7</span>];</span><br><span class="line">sortArr.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> a &gt; b ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sortArr);</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚æ˜¯è¿™æ ·ã€‚</p><p>åœ¨å¤§é‡ä¸”æ€§èƒ½è¦æ±‚é«˜çš„åœ°æ–¹éœ€è¦çŸ¥é“ç©¶ç«Ÿæ˜¯æ€ä¹ˆç®—çš„ï¼Œè¯¦æƒ…çœ‹è¿™é‡Œ <a href="https://segmentfault.com/a/1190000010648740">https://segmentfault.com/a/1190000010648740</a> ï¼Œå¤šçœ‹çœ‹ç®—æ³•å’Œæºç ã€‚</p><h3 id="34-Array-prototype-toSorted"><a href="#34-Array-prototype-toSorted" class="headerlink" title="34. Array.prototype.toSorted()"></a>34. Array.prototype.toSorted()</h3><blockquote><p>Array å®ä¾‹çš„ toSorted() æ–¹æ³•æ˜¯ sort() æ–¹æ³•çš„å¤åˆ¶æ–¹æ³•ç‰ˆæœ¬ã€‚å®ƒè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶å…ƒç´ æŒ‰å‡åºæ’åˆ—ã€‚</p></blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¾ç„¶æ˜¯æµ…æ‹·è´ã€‚</p><h3 id="35-Array-prototype-splice"><a href="#35-Array-prototype-splice" class="headerlink" title="35. Array.prototype.splice()"></a>35. Array.prototype.splice()</h3><blockquote><p>splice() æ–¹æ³•é€šè¿‡ç§»é™¤æˆ–è€…æ›¿æ¢å·²å­˜åœ¨çš„å…ƒç´ å’Œ&#x2F;æˆ–æ·»åŠ æ–°å…ƒç´ å°±åœ°æ”¹å˜ä¸€ä¸ªæ•°ç»„çš„å†…å®¹ã€‚</p></blockquote><p>slice æ˜¯æˆªå–ï¼Œsplice æ˜¯ç§»é™¤æˆ–è€…æ›¿æ¢</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">splice</span>(start)</span><br><span class="line"><span class="title function_">splice</span>(start, deleteCount)</span><br><span class="line"><span class="title function_">splice</span>(start, deleteCount, item1)</span><br><span class="line"><span class="title function_">splice</span>(start, deleteCount, item1, item2, itemN)</span><br></pre></td></tr></table></figure><p>startï¼Œéµå¾ªä¹‹å‰çš„å…¶ä»–æ•°ç»„çš„è§„åˆ™ã€‚</p><ul><li>å…è®¸è´Ÿæ•°ï¼Œparam + array.length</li><li>param &lt; -array.length &#x3D; 0</li><li>start &gt;&#x3D; array.lengthï¼Œ ä¸æˆªå–</li></ul><p>deleteCountï¼Œ0 æˆ–è€…ä¸ä¼ å…¥å°±ä¸åˆ é™¤ï¼Œç±»ä¼¼äºæ’å…¥ï¼Œå¦‚æœä¼ å…¥ï¼Œå°±ä»startå¼€å§‹è®¡ç®—ï¼ŒdeleteCountçš„å‡ ä½ã€‚</p><p>æœ€åå°±æ˜¯æ›¿æ¢æˆ–è€…æ’å…¥å¤šå°‘ä¸ª, å†™å‡ ä¸ªä¾‹å­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([<span class="number">1</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">19</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">7</span>]);</span><br><span class="line"><span class="keyword">const</span> spliceArr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">19</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">7</span>];</span><br><span class="line">spliceArr.<span class="title function_">splice</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`åˆ é™¤`</span>, spliceArr);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> splice1Arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">19</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">7</span>];</span><br><span class="line">spliceArr.<span class="title function_">splice</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`æ’å…¥`</span>, spliceArr);</span><br></pre></td></tr></table></figure><p>æ›¿æ¢å°±æ˜¯åˆ é™¤+æ’å…¥ã€‚</p><h3 id="36-Array-prototype-toSpliced"><a href="#36-Array-prototype-toSpliced" class="headerlink" title="36. Array.prototype.toSpliced()"></a>36. Array.prototype.toSpliced()</h3><blockquote><p>Array å®ä¾‹çš„ toSpliced() æ–¹æ³•æ˜¯ splice() æ–¹æ³•çš„å¤åˆ¶ç‰ˆæœ¬ã€‚å®ƒè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå¹¶åœ¨ç»™å®šçš„ç´¢å¼•å¤„åˆ é™¤å’Œ&#x2F;æˆ–æ›¿æ¢äº†ä¸€äº›å…ƒç´ ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">toSpliced</span>(start)</span><br><span class="line"><span class="title function_">toSpliced</span>(start, deleteCount)</span><br><span class="line"><span class="title function_">toSpliced</span>(start, deleteCount, item1)</span><br><span class="line"><span class="title function_">toSpliced</span>(start, deleteCount, item1, item2, itemN)</span><br></pre></td></tr></table></figure><p>è€è§„çŸ©ï¼Œæµ…æ‹·è´ã€‚</p><h3 id="37-Array-prototype-toLocaleString-Array-prototype-toString"><a href="#37-Array-prototype-toLocaleString-Array-prototype-toString" class="headerlink" title="37. Array.prototype.toLocaleString(), Array.prototype.toString()"></a>37. Array.prototype.toLocaleString(), Array.prototype.toString()</h3><blockquote><p>toLocaleString() æ–¹æ³•è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚æ¯ä¸ªå…ƒç´ é€šè¿‡è°ƒç”¨å®ƒä»¬è‡ªå·±çš„ toLocaleString æ–¹æ³•è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ä½¿ç”¨ç‰¹å®šäºè¯­è¨€ç¯å¢ƒçš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚é€—å·â€œ,â€ï¼‰åˆ†éš”å¼€ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">toLocaleString</span>()</span><br><span class="line"><span class="title function_">toLocaleString</span>(locales)</span><br><span class="line"><span class="title function_">toLocaleString</span>(locales, options)</span><br></pre></td></tr></table></figure><p>locales </p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Intl#locales_%E5%8F%82%E6%95%B0">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Intl#locales_%E5%8F%82%E6%95%B0</a></p><p><a href="https://juejin.cn/post/6844903863556767758">https://juejin.cn/post/6844903863556767758</a></p><blockquote><p>BCP 47ï¼ˆBest Current Practice 47ï¼‰æ˜¯ä¸€ä¸ªæ ‡å‡†ï¼Œç”¨äºè¡¨ç¤ºè¯­è¨€æ ‡ç­¾ï¼Œå®ƒè§„å®šäº†ä¸€ç§è¯­è¨€æ ‡è®°çš„æ ¼å¼å’Œç»“æ„ã€‚BCP 47 æœ€åˆç”±IETFï¼ˆInternet Engineering Task Forceï¼‰å‘å¸ƒï¼Œå¹¶è¢«å¹¿æ³›ç”¨äºæ ‡è¯†è¯­è¨€ã€åœ°åŒºå’Œæ–‡åŒ–ç›¸å…³çš„ä¿¡æ¯ï¼Œå¦‚è¯­è¨€ä»£ç ã€åœ°åŒºä»£ç å’ŒåŒºåŸŸè®¾ç½®ç­‰</p></blockquote><p>toString ä¸€æ ·ï¼Œåˆ†åˆ«è°ƒç”¨æ¯ä¸ª item çš„ toString().</p><p>è¿˜æœ‰ï¼Œä¸¤ä½éƒ½è®¤ç¨€ç–æ•°ç»„ã€‚</p><h3 id="38-Array-prototype-values"><a href="#38-Array-prototype-values" class="headerlink" title="38. Array.prototype.values()"></a>38. Array.prototype.values()</h3><blockquote><p>values() æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„è¿­ä»£å™¨ (en-US)å¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¿­ä»£æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„å€¼ã€‚</p></blockquote><p>ä¹‹å‰è®²äº† Array.prototype.keys, è¿”å›äº†ç´¢å¼•ï¼Œ values å°±æ˜¯è¿”å›å€¼</p><h3 id="39-Array-prototype-with"><a href="#39-Array-prototype-with" class="headerlink" title="39. Array.prototype.with()"></a>39. Array.prototype.with()</h3><blockquote><p>Array å®ä¾‹çš„ with() æ–¹æ³•æ˜¯ä½¿ç”¨æ–¹æ‹¬å·è¡¨ç¤ºæ³•ä¿®æ”¹æŒ‡å®šç´¢å¼•å€¼çš„å¤åˆ¶æ–¹æ³•ç‰ˆæœ¬ã€‚å®ƒä¼šè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶æŒ‡å®šç´¢å¼•å¤„çš„å€¼ä¼šè¢«æ–°å€¼æ›¿æ¢ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array.<span class="title function_">with</span>(index, value)</span><br></pre></td></tr></table></figure><p>å…¶å®å’Œ splice å¾ˆåƒï¼Œä¸è¿‡ splice åŠŸèƒ½æ›´å…¨</p><blockquote><p>with() æ–¹æ³•æ€»ä¼šåˆ›å»ºä¸€ä¸ªå¯†é›†æ•°ç»„ã€‚</p></blockquote><h3 id="link"><a href="#link" class="headerlink" title="link"></a>link</h3><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Symbol/isConcatSpreadable">Symbol.isConcatSpreadable</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Iterator">Iterator</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Iteration_protocols">è¿­ä»£åè®®</a></li><li><a href="https://segmentfault.com/a/1190000010648740">æ·±å…¥æµ…å‡º JavaScript çš„ Array.prototype.sort æ’åºç®—æ³•</a></li><li><a href="https://www.toolhelper.cn/Encoding/UTF16">UTF-16 ç¼–ç è¡¨</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Intl#locales_%E5%8F%82%E6%95%B0">locales å‚æ•°</a></li><li><a href="https://juejin.cn/post/6844903863556767758">locales å‚æ•° BCP 47 è¯­è¨€æ ‡è®° è§£æ</a></li></ul></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
            <tag> array </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨äº‹ä»¶æµ</title>
      <link href="/2023/07/09/browser_event/"/>
      <url>/2023/07/09/browser_event/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-dom-äº‹ä»¶çº§åˆ«"><a href="#01-dom-äº‹ä»¶çº§åˆ«" class="headerlink" title="01. dom äº‹ä»¶çº§åˆ«"></a>01. dom äº‹ä»¶çº§åˆ«</h3><blockquote><p>DOM 0çº§äº‹ä»¶å¤„ç†ï¼ŒDOM 2çº§äº‹ä»¶å¤„ç†å’ŒDOM 3çº§äº‹ä»¶å¤„ç†</p></blockquote><p>DOM 0 </p><blockquote><p>ç”¨äºå¤„ç†åŸºæœ¬çš„ç”¨æˆ·äº¤äº’ï¼Œå¦‚é¼ æ ‡ç‚¹å‡»ã€é”®ç›˜è¾“å…¥å’Œè¡¨å•æäº¤ç­‰ã€‚ä¸€äº›å¸¸è§çš„ç¬¬ä¸€çº§äº‹ä»¶åŒ…æ‹¬clickã€keydownã€submitç­‰ã€‚</p></blockquote><p>DOM 2</p><blockquote><p>ä¾‹å¦‚ï¼Œmouseenterå’Œmouseleaveäº‹ä»¶åœ¨ç¬¬äºŒçº§äº‹ä»¶ä¸­å¼•å…¥ï¼Œç”¨äºæ£€æµ‹é¼ æ ‡è¿›å…¥å’Œç¦»å¼€å…ƒç´ çš„åŒºåŸŸ, addEventListener</p></blockquote><p>DOM 3</p><blockquote><p>UIäº‹ä»¶ï¼Œå½“ç”¨æˆ·ä¸é¡µé¢ä¸Šçš„å…ƒç´ äº¤äº’æ—¶è§¦å‘ï¼Œå¦‚ï¼šloadã€scroll<br>ç„¦ç‚¹äº‹ä»¶ï¼Œå½“å…ƒç´ è·å¾—æˆ–å¤±å»ç„¦ç‚¹æ—¶è§¦å‘ï¼Œå¦‚ï¼šblurã€focus<br>é¼ æ ‡äº‹ä»¶ï¼Œå½“ç”¨æˆ·é€šè¿‡é¼ æ ‡åœ¨é¡µé¢æ‰§è¡Œæ“ä½œæ—¶è§¦å‘å¦‚ï¼šdblclickã€mouseup<br>æ»šè½®äº‹ä»¶ï¼Œå½“ä½¿ç”¨é¼ æ ‡æ»šè½®æˆ–ç±»ä¼¼è®¾å¤‡æ—¶è§¦å‘ï¼Œå¦‚ï¼šmousewheel<br>æ–‡æœ¬äº‹ä»¶ï¼Œå½“åœ¨æ–‡æ¡£ä¸­è¾“å…¥æ–‡æœ¬æ—¶è§¦å‘ï¼Œå¦‚ï¼štextInput<br>é”®ç›˜äº‹ä»¶ï¼Œå½“ç”¨æˆ·é€šè¿‡é”®ç›˜åœ¨é¡µé¢ä¸Šæ‰§è¡Œæ“ä½œæ—¶è§¦å‘ï¼Œå¦‚ï¼škeydownã€keypress<br>åˆæˆäº‹ä»¶ï¼Œå½“ä¸ºIMEï¼ˆè¾“å…¥æ³•ç¼–è¾‘å™¨ï¼‰è¾“å…¥å­—ç¬¦æ—¶è§¦å‘ï¼Œå¦‚ï¼šcompositionstart<br>å˜åŠ¨äº‹ä»¶ï¼Œå½“åº•å±‚DOMç»“æ„å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘ï¼Œå¦‚ï¼šDOMsubtreeModified<br>åŒæ—¶DOM3çº§äº‹ä»¶ä¹Ÿå…è®¸ä½¿ç”¨è€…è‡ªå®šä¹‰ä¸€äº›äº‹ä»¶ã€‚</p></blockquote><p>ä¸ºä»€ä¹ˆè¦è¿™æ ·åŒºåˆ†å‘¢ï¼Ÿ</p><p>å…¶å®å°±æ˜¯ä¸€ä¸ªä¸æ–­æ¼”è¿›çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ä¸ç”¨çº ç»“è¿™ä¸ªåŒºåˆ†ï¼Œç±»ä¼¼äºï¼Œ ES4ï¼ŒES5ï¼ŒES6ï¼ŒES7ä¸€æ ·ï¼Œç°åœ¨æ€•æ˜¯æ²¡æœ‰åªæ”¯æŒ DOM0 çš„æµè§ˆå™¨äº†ã€‚</p><h3 id="02-ä»€ä¹ˆæ˜¯äº‹ä»¶å†’æ³¡å’Œæ•è·"><a href="#02-ä»€ä¹ˆæ˜¯äº‹ä»¶å†’æ³¡å’Œæ•è·" class="headerlink" title="02. ä»€ä¹ˆæ˜¯äº‹ä»¶å†’æ³¡å’Œæ•è·"></a>02. ä»€ä¹ˆæ˜¯äº‹ä»¶å†’æ³¡å’Œæ•è·</h3><blockquote><p>äº‹ä»¶å†’æ³¡ï¼ˆEvent Bubblingï¼‰æ˜¯æŒ‡åœ¨DOMä¸­ï¼Œå½“ä¸€ä¸ªå…ƒç´ ä¸Šçš„äº‹ä»¶è¢«è§¦å‘åï¼Œäº‹ä»¶å°†å‘çˆ¶å…ƒç´ é€çº§ä¼ æ’­ï¼Œç›´è‡³ä¼ æ’­åˆ°DOMæ ‘çš„æ ¹èŠ‚ç‚¹æˆ–è¢«é˜»æ­¢</p><p>äº‹ä»¶æ•è·ï¼ˆEvent Capturingï¼‰æ˜¯æŒ‡åœ¨DOMä¸­ï¼Œå½“ä¸€ä¸ªå…ƒç´ ä¸Šçš„äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œäº‹ä»¶å°†ä»DOMæ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€çº§å‘ä¸‹ä¼ æ’­è‡³ç›®æ ‡å…ƒç´ ã€‚æ¢å¥è¯è¯´ï¼Œäº‹ä»¶ä»æœ€å¤–å±‚çš„å…ƒç´ å¼€å§‹ä¼ æ’­ï¼Œä¾æ¬¡ç»è¿‡çˆ¶å…ƒç´ ã€å­å…ƒç´ ï¼Œç›´åˆ°ä¼ æ’­åˆ°ç›®æ ‡å…ƒç´ ã€‚</p></blockquote><p>åœ¨äº‹ä»¶æµé‡Œé¢ï¼Œå…¶å®å°±æ˜¯ <strong>æ•è· &#x3D;&gt; è‡ªèº« &#x3D;&gt; å†’æ³¡</strong></p><p>è¿™é‡Œå†™äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä»£ç åœ¨ <a href="https://codesandbox.io/s/hardcore-glitter-h9v8kq?file=/browser_event.html">https://codesandbox.io/s/hardcore-glitter-h9v8kq?file=/browser_event.html</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>å¤šå±‚åµŒå¥—çš„äº‹ä»¶æ•è·å’Œå†’æ³¡ç¤ºä¾‹<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-id">#outer</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">350px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">350px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: black;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-id">#middle</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: blue;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-id">#inner</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">250px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">250px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: yellow;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;outer&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;middle&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;inner&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// è·å–å…ƒç´ </span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> outer = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;outer&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> middle = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;middle&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> inner = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;inner&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;btn&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">f</span>(<span class="params">name</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(</span></span><br><span class="line"><span class="language-javascript">            <span class="string">`<span class="subst">$&#123;event.target.id&#125;</span> è§¦å‘äº†, ç°åœ¨å¤„äºçš„é˜¶æ®µæ˜¯ <span class="subst">$&#123;event.eventPhase&#125;</span>, åœ¨ä¼ é€’åˆ°äº†<span class="subst">$&#123;name&#125;</span>`</span></span></span><br><span class="line"><span class="language-javascript">          );</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// æ·»åŠ äº‹ä»¶å¤„ç†ç¨‹åº</span></span></span><br><span class="line"><span class="language-javascript">      outer.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="title function_">f</span>(<span class="string">`outer`</span>), <span class="literal">true</span>); <span class="comment">// äº‹ä»¶æ•è·é˜¶æ®µ</span></span></span><br><span class="line"><span class="language-javascript">      middle.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="title function_">f</span>(<span class="string">`middle`</span>), <span class="literal">true</span>); <span class="comment">// äº‹ä»¶æ•è·é˜¶æ®µ</span></span></span><br><span class="line"><span class="language-javascript">      inner.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="title function_">f</span>(<span class="string">`inner`</span>), <span class="literal">true</span>); <span class="comment">// äº‹ä»¶æ•è·é˜¶æ®µ</span></span></span><br><span class="line"><span class="language-javascript">      btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="title function_">f</span>(<span class="string">`btn`</span>), <span class="literal">true</span>); <span class="comment">// äº‹ä»¶æ•è·é˜¶æ®µ</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      outer.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="title function_">f</span>(<span class="string">`outer`</span>), <span class="literal">false</span>); <span class="comment">// äº‹ä»¶å†’æ³¡é˜¶æ®µ</span></span></span><br><span class="line"><span class="language-javascript">      middle.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="title function_">f</span>(<span class="string">`middle`</span>), <span class="literal">false</span>); <span class="comment">// äº‹ä»¶å†’æ³¡é˜¶æ®µ</span></span></span><br><span class="line"><span class="language-javascript">      inner.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="title function_">f</span>(<span class="string">`inner`</span>), <span class="literal">false</span>); <span class="comment">// äº‹ä»¶å†’æ³¡é˜¶æ®µ</span></span></span><br><span class="line"><span class="language-javascript">      btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="title function_">f</span>(<span class="string">`btn`</span>), <span class="literal">false</span>); <span class="comment">// äº‹ä»¶å†’æ³¡é˜¶æ®µ</span></span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>browser_event.html:50 btn è§¦å‘äº†, ç°åœ¨å¤„äºçš„é˜¶æ®µæ˜¯ 1, åœ¨ä¼ é€’åˆ°äº†outer</li><li>browser_event.html:50 btn è§¦å‘äº†, ç°åœ¨å¤„äºçš„é˜¶æ®µæ˜¯ 1, åœ¨ä¼ é€’åˆ°äº†middle</li><li>browser_event.html:50 btn è§¦å‘äº†, ç°åœ¨å¤„äºçš„é˜¶æ®µæ˜¯ 1, åœ¨ä¼ é€’åˆ°äº†inner</li><li>browser_event.html:50 btn è§¦å‘äº†, ç°åœ¨å¤„äºçš„é˜¶æ®µæ˜¯ 2, åœ¨ä¼ é€’åˆ°äº†btn</li><li>browser_event.html:50 btn è§¦å‘äº†, ç°åœ¨å¤„äºçš„é˜¶æ®µæ˜¯ 2, åœ¨ä¼ é€’åˆ°äº†btn</li><li>browser_event.html:50 btn è§¦å‘äº†, ç°åœ¨å¤„äºçš„é˜¶æ®µæ˜¯ 3, åœ¨ä¼ é€’åˆ°äº†inner</li><li>browser_event.html:50 btn è§¦å‘äº†, ç°åœ¨å¤„äºçš„é˜¶æ®µæ˜¯ 3, åœ¨ä¼ é€’åˆ°äº†middle</li><li>browser_event.html:50 btn è§¦å‘äº†, ç°åœ¨å¤„äºçš„é˜¶æ®µæ˜¯ 3, åœ¨ä¼ é€’åˆ°äº†outer</li></ul><p>é¦–å…ˆä¸ä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œæˆ‘è¿™é‡Œæ˜¯æ•è·äº†2æ¬¡ã€‚ </p><p>event.eventPhase è¡¨ç¤ºå†’æ³¡æ‰§è¡Œçš„é˜¶æ®µï¼Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Event/eventPhase">https://developer.mozilla.org/zh-CN/docs/Web/API/Event/eventPhase</a></p><ul><li>Event.CAPTURING_PHASE (1)ï¼šè¡¨ç¤ºäº‹ä»¶å¤„äºæ•è·é˜¶æ®µã€‚</li><li>Event.AT_TARGET (2)ï¼šè¡¨ç¤ºäº‹ä»¶å¤„äºç›®æ ‡å…ƒç´ é˜¶æ®µã€‚</li><li>Event.BUBBLING_PHASE (3)ï¼šè¡¨ç¤ºäº‹ä»¶å¤„äºå†’æ³¡é˜¶æ®µã€‚</li></ul><p>è¿™é‡Œå°±éªŒè¯äº†è¿™ä¸ªæµ <strong>æ•è· &#x3D;&gt; è‡ªèº« &#x3D;&gt; å†’æ³¡</strong></p><h3 id="03-addEventListener"><a href="#03-addEventListener" class="headerlink" title="03. addEventListener"></a>03. addEventListener</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener">https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">addEventListener</span>(type, listener); <span class="comment">//ä¸ä¼ é»˜è®¤ä¸ºfalse, ä¹Ÿå°±æ˜¯å†’æ³¡</span></span><br><span class="line"><span class="title function_">addEventListener</span>(type, listener, options);</span><br><span class="line"><span class="title function_">addEventListener</span>(type, listener, useCapture);</span><br></pre></td></tr></table></figure><p>ä¸»è¦è¿˜æ˜¯è¦è¯´ä¸€è¯´ <code>options</code></p><ul><li>capture å¯é€‰, ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤º listener ä¼šåœ¨è¯¥ç±»å‹çš„äº‹ä»¶æ•è·é˜¶æ®µä¼ æ’­åˆ°è¯¥ EventTarget æ—¶è§¦å‘ã€‚</li><li>once å¯é€‰, ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤º listener åœ¨æ·»åŠ ä¹‹åæœ€å¤šåªè°ƒç”¨ä¸€æ¬¡ã€‚å¦‚æœä¸º trueï¼Œlistener ä¼šåœ¨å…¶è¢«è°ƒç”¨ä¹‹åè‡ªåŠ¨ç§»é™¤ã€‚</li><li>passive å¯é€‰, ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè®¾ç½®ä¸º true æ—¶ï¼Œè¡¨ç¤º listener æ°¸è¿œä¸ä¼šè°ƒç”¨ preventDefault()ã€‚å¦‚æœ listener ä»ç„¶è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œå®¢æˆ·ç«¯å°†ä¼šå¿½ç•¥å®ƒå¹¶æŠ›å‡ºä¸€ä¸ªæ§åˆ¶å°è­¦å‘Šã€‚æŸ¥çœ‹ä½¿ç”¨ passive æ”¹å–„æ»šå±æ€§èƒ½ä»¥äº†è§£æ›´å¤šã€‚</li><li>signal å¯é€‰,  AbortSignalï¼Œè¯¥ AbortSignal çš„ abort() æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œç›‘å¬å™¨ä¼šè¢«ç§»é™¤ã€‚</li></ul><p>å‰ä¸¤ä¸ªå¾ˆå¥½ç†è§£ã€‚</p><p>preventDefault <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Event/preventDefault">https://developer.mozilla.org/zh-CN/docs/Web/API/Event/preventDefault</a> å–æ¶ˆé»˜è®¤è¡Œä¸º.</p><p>signal </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"><span class="keyword">const</span> signal = controller.<span class="property">signal</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">eventListener</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;äº‹ä»¶è¢«è§¦å‘&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, eventListener, &#123; signal &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æŸä¸ªæ¡ä»¶æ»¡è¶³æ—¶ä¸­æ­¢äº‹ä»¶ç›‘å¬å™¨</span></span><br><span class="line">controller.<span class="title function_">abort</span>();</span><br></pre></td></tr></table></figure><h3 id="04-onclick"><a href="#04-onclick" class="headerlink" title="04. onclick"></a>04. onclick</h3><p>åªèƒ½å†’æ³¡ï¼Œä¸èƒ½æ•è·ã€‚</p><p>åªèƒ½ä¸€æ¬¡ï¼Œä¸èƒ½åƒ addEventListener å¤šæ¬¡ï¼Œä¹Ÿä¸èƒ½å–æ¶ˆã€‚</p><h3 id="05-ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦çŸ¥é“äº‹ä»¶å†’æ³¡å’Œäº‹ä»¶å§”æ‰˜ï¼Ÿ"><a href="#05-ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦çŸ¥é“äº‹ä»¶å†’æ³¡å’Œäº‹ä»¶å§”æ‰˜ï¼Ÿ" class="headerlink" title="05. ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦çŸ¥é“äº‹ä»¶å†’æ³¡å’Œäº‹ä»¶å§”æ‰˜ï¼Ÿ"></a>05. ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦çŸ¥é“äº‹ä»¶å†’æ³¡å’Œäº‹ä»¶å§”æ‰˜ï¼Ÿ</h3><p>è¿™å°±æ˜¯ä¸€ä¸ªæ€§èƒ½é—®é¢˜.</p><p>å½“ä½ æœ‰ä¸€ä¸ªè¿™æ ·çš„åˆ—è¡¨</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> * 100ï¼Œ </span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½ éœ€è¦æ¯ä¸€ä¸ª li éƒ½æœ‰äº‹ä»¶ï¼Œå¦‚æœæ¯ä¸€ä¸ª li éƒ½ç»‘å®šäº‹ä»¶ï¼Œé‚£ä¹ˆæ€§èƒ½å¤§æ‰“æŠ˜æ‰£ï¼Œå¦‚æœåˆ©ç”¨äº‹ä»¶å†’æ³¡ï¼Œåªéœ€è¦åœ¨ ul ä¸­ç»‘å®šäº‹ä»¶ï¼Œå°±å¯ä»¥è§£å†³ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
            <tag> event </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨å¤åˆ¶</title>
      <link href="/2023/07/08/clipboard/"/>
      <url>/2023/07/08/clipboard/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>å®ç°åŸç† Clipboard Api</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Clipboard_API">https://developer.mozilla.org/zh-CN/docs/Web/API/Clipboard_API</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navigator.<span class="property">clipboard</span>.<span class="title function_">readText</span>().<span class="title function_">then</span>(<span class="function"><span class="params">clipText</span> =&gt;</span> <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.editor&quot;</span>).<span class="property">innerText</span> += clipText);</span><br></pre></td></tr></table></figure><p>ä»¥å‰çš„åšæ³•æ˜¯ <code>document.execCommand</code></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/execCommand">https://developer.mozilla.org/zh-CN/docs/Web/API/Document/execCommand</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bool = <span class="variable language_">document</span>.<span class="title function_">execCommand</span>(aCommandName, aShowDefaultUI, aValueArgument)</span><br></pre></td></tr></table></figure><p>ç°åœ¨å·²ç»åºŸå¼ƒäº†ï¼Œå°±çœ‹ä½ æ˜¯å¦è¦å…¼å®¹è€æµè§ˆå™¨ã€‚</p><p>è¿™é‡Œæ˜¯ç»„ä»¶çš„ clipboard-copy çš„æºç </p><p><a href="https://github.com/feross/clipboard-copy/blob/master/index.js">https://github.com/feross/clipboard-copy/blob/master/index.js</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*! clipboard-copy. MIT License. Feross Aboukhadijeh &lt;https://feross.org/opensource&gt; */</span></span><br><span class="line"><span class="comment">/* global DOMException */</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = clipboardCopy</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">makeError</span> () &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DOMException</span>(<span class="string">&#x27;The request is not allowed&#x27;</span>, <span class="string">&#x27;NotAllowedError&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">copyClipboardApi</span> (text) &#123;</span><br><span class="line">  <span class="comment">// Use the Async Clipboard API when available. Requires a secure browsing</span></span><br><span class="line">  <span class="comment">// context (i.e. HTTPS)</span></span><br><span class="line">  <span class="keyword">if</span> (!navigator.<span class="property">clipboard</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="title function_">makeError</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> navigator.<span class="property">clipboard</span>.<span class="title function_">writeText</span>(text)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">copyExecCommand</span> (text) &#123;</span><br><span class="line">  <span class="comment">// Put the text to copy into a &lt;span&gt;</span></span><br><span class="line">  <span class="keyword">const</span> span = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;span&#x27;</span>)</span><br><span class="line">  span.<span class="property">textContent</span> = text</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Preserve consecutive spaces and newlines</span></span><br><span class="line">  span.<span class="property">style</span>.<span class="property">whiteSpace</span> = <span class="string">&#x27;pre&#x27;</span></span><br><span class="line">  span.<span class="property">style</span>.<span class="property">webkitUserSelect</span> = <span class="string">&#x27;auto&#x27;</span></span><br><span class="line">  span.<span class="property">style</span>.<span class="property">userSelect</span> = <span class="string">&#x27;all&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add the &lt;span&gt; to the page</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(span)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Make a selection object representing the range of text selected by the user</span></span><br><span class="line">  <span class="keyword">const</span> selection = <span class="variable language_">window</span>.<span class="title function_">getSelection</span>()</span><br><span class="line">  <span class="keyword">const</span> range = <span class="variable language_">window</span>.<span class="property">document</span>.<span class="title function_">createRange</span>()</span><br><span class="line">  selection.<span class="title function_">removeAllRanges</span>()</span><br><span class="line">  range.<span class="title function_">selectNode</span>(span)</span><br><span class="line">  selection.<span class="title function_">addRange</span>(range)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Copy text to the clipboard</span></span><br><span class="line">  <span class="keyword">let</span> success = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    success = <span class="variable language_">window</span>.<span class="property">document</span>.<span class="title function_">execCommand</span>(<span class="string">&#x27;copy&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// Cleanup</span></span><br><span class="line">    selection.<span class="title function_">removeAllRanges</span>()</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(span)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!success) <span class="keyword">throw</span> <span class="title function_">makeError</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">clipboardCopy</span> (text) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">copyClipboardApi</span>(text)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="comment">// ...Otherwise, use document.execCommand() fallback</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">copyExecCommand</span>(text)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err2) &#123;</span><br><span class="line">      <span class="keyword">throw</span> (err2 || err || <span class="title function_">makeError</span>())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯ä¸¤ä¸ªåšæ³•çš„ç»“åˆçš„å°è£…</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
            <tag> å‰ªåˆ‡æ¿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css å¦‚ä½•å®ç°å·¦ä¾§å›ºå®š 300pxï¼Œå³ä¾§è‡ªé€‚åº”çš„å¸ƒå±€</title>
      <link href="/2023/07/08/%5BQ017%5DHow_does_css_achieve_a_fixed_300px_on_the_left_and_an_daptive_layout_on_the_right/"/>
      <url>/2023/07/08/%5BQ017%5DHow_does_css_achieve_a_fixed_300px_on_the_left_and_an_daptive_layout_on_the_right/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-flex"><a href="#01-flex" class="headerlink" title="01. flex"></a>01. flex</h3><p>ä¸»è¦åˆ©ç”¨ flex ç‰¹æ€§, å¦‚æœåªæœ‰ä¸€ä¸ª flex: 1 æ’‘æ»¡</p><p><a href="https://codesandbox.io/s/frosty-haze-wqmm8l">https://codesandbox.io/s/frosty-haze-wqmm8l</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.main</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.one</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: red;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.two</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">flex</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: blue;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;one&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;two&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="02-float"><a href="#02-float" class="headerlink" title="02. float"></a>02. float</h3><p><a href="https://codesandbox.io/s/fancy-dream-nktwvm?file=/%5BQ017%5DHow_does_css_achieve_a_fixed_300px_on_the_left_and_an_daptive_layout_on_the_right_two.html">https://codesandbox.io/s/fancy-dream-nktwvm?file=/%5BQ017%5DHow_does_css_achieve_a_fixed_300px_on_the_left_and_an_daptive_layout_on_the_right_two.html</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.one</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: red;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.two</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: blue;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">300px</span>);</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> åšé¢˜ </tag>
            
            <tag> html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue3 nextTick</title>
      <link href="/2023/07/08/nextTick/"/>
      <url>/2023/07/08/nextTick/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-ä»€ä¹ˆæ˜¯-nextTick"><a href="#01-ä»€ä¹ˆæ˜¯-nextTick" class="headerlink" title="01. ä»€ä¹ˆæ˜¯ nextTick"></a>01. ä»€ä¹ˆæ˜¯ nextTick</h3><p>é¦–å…ˆè¦çŸ¥é“ä»€ä¹ˆæ˜¯ nextTick</p><blockquote><p>ç­‰å¾…ä¸‹ä¸€æ¬¡ DOM æ›´æ–°åˆ·æ–°çš„å·¥å…·æ–¹æ³•ã€‚</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">nextTick</span>(<span class="params">callback?: () =&gt; <span class="built_in">void</span></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¯´äº†è¯­æ³•å’Œå®šä¹‰ï¼Œä¸‹é¢è¿™ä¸ªä¾‹å­ä¼šä¼šè¯´æ˜ï¼Œä¸ºä»€ä¹ˆéœ€è¦ nextTick</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref, nextTick &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">    count.<span class="property">value</span>++</span><br><span class="line"></span><br><span class="line">    <span class="comment">// DOM è¿˜æœªæ›´æ–°</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;counter&#x27;</span>).<span class="property">textContent</span>) <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">nextTick</span>()</span><br><span class="line">    <span class="comment">// DOM æ­¤æ—¶å·²ç»æ›´æ–°</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;counter&#x27;</span>).<span class="property">textContent</span>) <span class="comment">// 1</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>nextTick ä¾‹å­1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;counter&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;increment&quot;</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå±•ç¤ºä¸€ä¸‹ç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0 index.vue:14 </span><br><span class="line">1 index.vue:10 </span><br><span class="line">1 index.vue:14 </span><br><span class="line">2 index.vue:14 </span><br></pre></td></tr></table></figure><p>å°±æ˜¯è¯´ï¼Œå½“ <code>count.value++</code> å˜é‡å‘ç”Ÿå˜åŒ–ï¼Œä»–ä¸ä¼šç«‹åˆ»æ›´æ–°ï¼Œè€Œæ˜¯è§¦å‘è°ƒåº¦ã€‚</p><p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ</p><p>å¦‚æœæˆ‘å†™ä¸€ä¸ªå¾ªç¯</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">1000</span>;i++) &#123;</span><br><span class="line">    count.<span class="property">value</span> = i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œ<strong>vue</strong> æ˜¯ä¸æ˜¯éœ€è¦æ›´æ–° <strong>1000</strong> æ¬¡ï¼Ÿå¾ˆæ˜æ˜¾ä¸æ˜¯ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸­é—´æœ‰ä¸€ä¸ªè°ƒåº¦</p><p>é‚£ä¹ˆ <code>nextTick</code> å°±æ˜¯ç­‰å¾…æ›´æ–°å®Œæˆä»¥åï¼Œä¼šè°ƒç”¨çš„å›è°ƒï¼Œä»–å¯ä»¥ä½¿ç”¨ <code>await</code>, ä¹Ÿå¯ä»¥ä½¿ç”¨å›è°ƒã€‚</p><h3 id="02-è°ƒåº¦è¿‡ç¨‹"><a href="#02-è°ƒåº¦è¿‡ç¨‹" class="headerlink" title="02. è°ƒåº¦è¿‡ç¨‹"></a>02. è°ƒåº¦è¿‡ç¨‹</h3><p>æˆ‘åœ¨çœ‹ nextTick ä¹‹å‰ï¼Œä¸“é—¨å­¦ä¹ äº†ä¸€ä¸‹ä»»åŠ¡è°ƒåº¦çš„æºç ï¼Œåœ°å€åœ¨è¿™é‡Œ <a href="/tblog/2023/07/08/Vue3_queue/">ä»»åŠ¡è°ƒåº¦æºç è§£æ</a>ã€‚</p><p>è¿™é‡Œå¯ä»¥è§£é‡Š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">1000</span>;i++) &#123;</span><br><span class="line">    count.<span class="property">value</span> = i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä¸ä¼šä¸€ç›´æ›´æ–°ã€‚</p><h3 id="03-nextTick-æºç "><a href="#03-nextTick-æºç " class="headerlink" title="03. nextTick æºç "></a>03. nextTick æºç </h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resolvedPromise = <span class="comment">/*#__PURE__*/</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>() <span class="keyword">as</span> <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> nextTick&lt;T = <span class="built_in">void</span>&gt;(</span><br><span class="line">  <span class="attr">this</span>: T,</span><br><span class="line">  fn?: <span class="function">(<span class="params"><span class="variable language_">this</span>: T</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> p = currentFlushPromise || resolvedPromise</span><br><span class="line">  <span class="keyword">return</span> fn ? p.<span class="title function_">then</span>(<span class="variable language_">this</span> ? fn.<span class="title function_">bind</span>(<span class="variable language_">this</span>) : fn) : p</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>currentFlushPromise</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">queueFlush</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!isFlushing &amp;&amp; !isFlushPending) &#123;</span><br><span class="line">    isFlushPending = <span class="literal">true</span></span><br><span class="line">    currentFlushPromise = resolvedPromise.<span class="title function_">then</span>(flushJobs)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ flushJobs æ‰§è¡Œå®Œæˆæ‰€æœ‰å½“å‰ Job ä»¥åçš„ finally ä¸­</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">currentFlushPromise = <span class="literal">null</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™ä¸ªè¿™ä¸ªåŸç†å°±å¾ˆæ¸…æ¥šäº†</p><p>å½“ä½ ä¿®æ”¹äº†å±æ€§ï¼Œç„¶ååé¢è®¾ç½®äº† nextTick. å°±ä¼šåœ¨æ‰§è¡Œ flushJobs(ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ›´æ–°çš„å¾ªç¯) ä»¥åï¼Œæ‰§è¡Œ nextTickã€‚</p><p>å¦‚æœä½ æ²¡æœ‰ä¿®æ”¹ä»»ä½•å±æ€§ï¼Œé‚£ä¹ˆ nextTick å°±æ˜¯ä¸€ä¸ªå•çº¯çš„å¼‚æ­¥ï¼Œä¸€ä¸ªå¾®ä»»åŠ¡ã€‚</p><h3 id="04-æ€»ç»“"><a href="#04-æ€»ç»“" class="headerlink" title="04. æ€»ç»“"></a>04. æ€»ç»“</h3><p>è¿™ä¸ªå¤Ÿæ¸…æ™°äº†ï¼Œä¸ç”¨æ€»ç»“äº†â€¦</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> ä»»åŠ¡è°ƒåº¦ </tag>
            
            <tag> Vue3 </tag>
            
            <tag> nextTick </tag>
            
            <tag> æºç è§£æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue3 ä»»åŠ¡è°ƒåº¦æºç è§£æ</title>
      <link href="/2023/07/08/Vue3_queue/"/>
      <url>/2023/07/08/Vue3_queue/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-queueJob"><a href="#01-queueJob" class="headerlink" title="01. queueJob"></a>01. queueJob</h3><p>é¦–å…ˆéœ€è¦çŸ¥é“è¿™ä¸ªæ¥å£çš„å®šä¹‰ï¼Œä»–å°±æ˜¯ä»»åŠ¡è°ƒåº¦çš„ <strong>job</strong> å®šä¹‰</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">SchedulerJob</span> <span class="keyword">extends</span> <span class="title class_">Function</span> &#123;</span><br><span class="line">  id?: <span class="built_in">number</span> <span class="comment">//å”¯ä¸€ID</span></span><br><span class="line">  pre?: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦æ˜¯é¢„å¤„ç†</span></span><br><span class="line">  active?: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦æ¿€æ´»</span></span><br><span class="line">  computed?: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦æ˜¯è®¡ç®—ä»»åŠ¡</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è¡¨ç¤ºæ˜¯å¦å…è®¸è¯¥æ•ˆæœè‡ªè¡Œé€’å½’è§¦å‘</span></span><br><span class="line"><span class="comment">    * å½“ç”±è°ƒåº¦ç¨‹åºç®¡ç†æ—¶ã€‚</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * é»˜è®¤æƒ…å†µä¸‹ï¼Œä½œä¸šæ— æ³•è‡ªè¡Œè§¦å‘ï¼Œå› ä¸ºæŸäº›å†…ç½®æ–¹æ³•è°ƒç”¨ï¼Œ</span></span><br><span class="line"><span class="comment">    * ä¾‹å¦‚ Array.prototype.push å®é™…ä¸Šä¹Ÿæ‰§è¡Œè¯»å–ï¼ˆ#1740ï¼‰</span></span><br><span class="line"><span class="comment">    * å¯èƒ½å¯¼è‡´ä»¤äººå›°æƒ‘çš„æ— é™å¾ªç¯ã€‚</span></span><br><span class="line"><span class="comment">    * å…è®¸çš„æƒ…å†µæ˜¯ç»„ä»¶æ›´æ–°å‡½æ•°å’Œç›‘è§†å›è°ƒã€‚</span></span><br><span class="line"><span class="comment">    * ç»„ä»¶æ›´æ–°å‡½æ•°å¯èƒ½ä¼šæ›´æ–°å­ç»„ä»¶ propsï¼Œè¿›è€Œæ›´æ–°å­ç»„ä»¶ props</span></span><br><span class="line"><span class="comment">    * è§¦å‘åˆ·æ–°ï¼šâ€œé¢„â€ç›‘è§†å›è°ƒï¼Œè¯¥å›è°ƒä¼šæ”¹å˜çˆ¶çº§çš„çŠ¶æ€</span></span><br><span class="line"><span class="comment">    * ä¾èµ–äºï¼ˆ#1801ï¼‰ã€‚ ç›‘è§†å›è°ƒä¸ä¼šè·Ÿè¸ªå…¶ä¾èµ–é¡¹ï¼Œå› æ­¤å¦‚æœ</span></span><br><span class="line"><span class="comment">    * å†æ¬¡è§¦å‘è‡ªèº«ï¼Œè¿™å¯èƒ½æ˜¯æ•…æ„çš„ï¼Œå¹¶ä¸”æ˜¯ç”¨æˆ·çš„</span></span><br><span class="line"><span class="comment">    * è´Ÿè´£æ‰§è¡Œé€’å½’çŠ¶æ€çªå˜ï¼Œæœ€ç»ˆ</span></span><br><span class="line"><span class="comment">    * ç¨³å®šï¼ˆ#1727ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  allowRecurse?: <span class="built_in">boolean</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è®¾ç½®ç»„ä»¶æ¸²æŸ“æ•ˆæœæ—¶ç”±renderer.tsé™„åŠ </span></span><br><span class="line"><span class="comment">    * ç”¨äºåœ¨æŠ¥å‘Šæœ€å¤§é€’å½’æ›´æ–°æ—¶è·å–ç»„ä»¶ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="comment">    * ä»…é™å¼€å‘äººå‘˜ã€‚</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  ownerInstance?: <span class="title class_">ComponentInternalInstance</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä¸‹é¢æ˜¯å…¥å£, ä¼ å…¥ä¸€ä¸ª <code>job</code>, å¹¶ä¸” <code>push</code> è¿›å…¥é˜Ÿåˆ—ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">queueJob</span>(<span class="params">job: SchedulerJob</span>) &#123;</span><br><span class="line">  <span class="comment">// é‡å¤æ•°æ®åˆ é™¤æœç´¢ä½¿ç”¨ Array.includes() çš„ startIndex å‚æ•°</span></span><br><span class="line">  <span class="comment">// é»˜è®¤æƒ…å†µä¸‹ï¼Œæœç´¢ç´¢å¼•åŒ…æ‹¬å½“å‰æ­£åœ¨è¿è¡Œçš„ä½œä¸š</span></span><br><span class="line">  <span class="comment">// æ‰€ä»¥å®ƒä¸èƒ½å†æ¬¡é€’å½’åœ°è§¦å‘è‡ªèº«ã€‚</span></span><br><span class="line">  <span class="comment">// å¦‚æœä½œä¸šæ˜¯ watch() å›è°ƒï¼Œåˆ™æœç´¢å°†ä» +1 ç´¢å¼•å¼€å§‹</span></span><br><span class="line">  <span class="comment">// å…è®¸å®ƒé€’å½’åœ°è§¦å‘è‡ªèº« - ç”¨æˆ·æœ‰è´£ä»»</span></span><br><span class="line">  <span class="comment">// ç¡®ä¿å®ƒä¸ä¼šé™·å…¥æ— é™å¾ªç¯ã€‚</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    !queue.<span class="property">length</span> ||</span><br><span class="line">    !queue.<span class="title function_">includes</span>(</span><br><span class="line">      job,</span><br><span class="line">      isFlushing &amp;&amp; job.<span class="property">allowRecurse</span> ? flushIndex + <span class="number">1</span> : flushIndex</span><br><span class="line">    )</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">if</span> (job.<span class="property">id</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">      queue.<span class="title function_">push</span>(job)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      queue.<span class="title function_">splice</span>(<span class="title function_">findInsertionIndex</span>(job.<span class="property">id</span>), <span class="number">0</span>, job)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">queueFlush</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>const queue: SchedulerJob[] = []</code> è¿™æ˜¯ä¸€ä¸ª <code>SchedulerJob</code> æ•°ç»„.</p><p><code>job.id = instance.uid</code> ä¹Ÿå°±æ˜¯ <code>Vue</code> å®ä¾‹çš„å”¯ä¸€ID</p><h3 id="02-queueFlush"><a href="#02-queueFlush" class="headerlink" title="02. queueFlush"></a>02. queueFlush</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">queueFlush</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!isFlushing &amp;&amp; !isFlushPending) &#123;</span><br><span class="line">    isFlushPending = <span class="literal">true</span></span><br><span class="line">    currentFlushPromise = resolvedPromise.<span class="title function_">then</span>(flushJobs)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸¤ä¸ªå˜é‡</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isFlushing = <span class="literal">false</span> <span class="comment">//æ˜¯å¦æœ‰æ›´æ–°å¾ªç¯æ­£åœ¨æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">let</span> isFlushPending = <span class="literal">false</span> <span class="comment">//æ˜¯å¦æœ‰ç­‰å¾…ä¸­çš„æ›´æ–°å¾ªç¯</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæ ‡å¿—ä½ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯ï¼Œä¸€æ¬¡æ€§åªæ‰§è¡Œä¸€ä¸ªæ›´æ–°å¾ªç¯ï¼Œå½“æ²¡æœ‰å¾ªç¯.</p><p>è®¾ç½® <code>isFlushPending = true</code>ï¼Œç„¶åè®¾ç½®å¾®ä»»åŠ¡</p><p>åˆ°è¿™é‡Œæˆ‘ä»¬å…¶å®å·²ç»å¯ä»¥çŸ¥é“ä»–çš„å¤§æ¦‚è°ƒåº¦æµç¨‹.</p><p>å½“è§¦å‘æ›´æ–°ï¼Œè°ƒç”¨ <code>queueJob =&gt; å¦‚æœæ²¡æœ‰é‡å¤ =&gt; queue.push =&gt; queueFlush =&gt; å¦‚æœæ²¡æœ‰æ‰§è¡Œ =&gt; åŠ å…¥å¾®ä»»åŠ¡(flushJobs)</code></p><p>è¿™æ ·ä¸€ä¸ªæµç¨‹è¯´æ˜äº†ä»€ä¹ˆï¼Ÿ</p><p>é¦–å…ˆ <code>queueJob</code> éœ€è¦å»é‡ï¼Œ<code>include</code>, ä½ç½®åˆ¤æ–­æ˜¯åŸºäºæ˜¯å¦å…è®¸é€’å½’è°ƒç”¨ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">1000</span>;i++) &#123;</span><br><span class="line">    count.<span class="property">value</span>++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æœ¬ä¸ä¼šå¢åŠ é˜Ÿåˆ—ä¸­ <code>job</code>, ä»–å§‹ç»ˆä¿è¯äº†åªæœ‰ä¸€ä¸ªã€‚</p><p>ç¬¬äºŒä¸ªç‚¹å°±æ˜¯å¾®ä»»åŠ¡, æˆ‘ä¹‹å‰å†™äº†ä¸€ä¸ªæ–‡ç« ï¼Œ<a href="/tblog/2023/07/03/eventLoop/">æµè§ˆå™¨äº‹ä»¶å¾ªç¯æ€»ç»“</a>ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resolvedPromise = <span class="comment">/*#__PURE__*/</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>() <span class="keyword">as</span> <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;</span><br><span class="line">resolvedPromise.<span class="title function_">then</span>(flushJobs)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯æŠŠ <code>flushJobs</code> å½“åšå¾®ä»»åŠ¡æ¥æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œéœ€è¦ä¸»çº¿ç¨‹çš„ä»£ç æ‰§è¡Œå®Œæ¯•ä»¥åï¼Œå†æ‰§è¡Œã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isFlushPending = <span class="literal">true</span></span><br><span class="line">currentFlushPromise = resolvedPromise.<span class="title function_">then</span>(flushJobs)</span><br></pre></td></tr></table></figure><p>å½“è¿™ä¸ªä»£ç æ‰§è¡Œï¼Œå°±æ˜¯ä¸€æ¬¡æ›´æ–°å¾ªç¯ï¼Œjsä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä»¥åï¼Œå¼€å§‹æ‰§è¡Œé˜Ÿåˆ—ï¼ŒflushJobsï¼Œè¿™ä¸ªå°±æ˜¯æ‰€è°“çš„æ“ä½œåˆå¹¶ã€‚</p><p>è¿™é‡Œæ˜ç™½äº†è¿™ä¸¤ä¸ªç‚¹ï¼Œå…¶å®å°±å·²ç»å¤§æ¦‚æ˜ç™½äº†äº‹ä»¶è°ƒåº¦ã€‚</p><h3 id="03-flushJobs"><a href="#03-flushJobs" class="headerlink" title="03. flushJobs"></a>03. flushJobs</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flushJobs</span>(<span class="params">seen?: CountMap</span>) &#123;</span><br><span class="line">  isFlushPending = <span class="literal">false</span></span><br><span class="line">  isFlushing = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">    seen = seen || <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// åœ¨åˆ·æ–°ä¹‹å‰å¯¹é˜Ÿåˆ—è¿›è¡Œæ’åºã€‚</span></span><br><span class="line">   <span class="comment">// è¿™ç¡®ä¿äº†ï¼š</span></span><br><span class="line">   <span class="comment">// 1. ç»„ä»¶ä»çˆ¶çº§æ›´æ–°åˆ°å­çº§ã€‚ ï¼ˆå› ä¸ºçˆ¶æ¯æ€»æ˜¯</span></span><br><span class="line">   <span class="comment">// åœ¨å­è¿›ç¨‹ä¹‹å‰åˆ›å»ºï¼Œå› æ­¤å®ƒçš„æ¸²æŸ“æ•ˆæœä¼šæ›´å°</span></span><br><span class="line">   <span class="comment">// ä¼˜å…ˆçº§ç¼–å·ï¼‰</span></span><br><span class="line">   <span class="comment">// 2. å¦‚æœåœ¨çˆ¶ç»„ä»¶æ›´æ–°æœŸé—´å¸è½½äº†ç»„ä»¶ï¼Œ</span></span><br><span class="line">   <span class="comment">// å¯ä»¥è·³è¿‡å®ƒçš„æ›´æ–°ã€‚</span></span><br><span class="line">  queue.<span class="title function_">sort</span>(comparator)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// checkRecursiveUpdate çš„æ¡ä»¶ä½¿ç”¨å¿…é¡»ç”±ä»¥ä¸‹ç¡®å®š</span></span><br><span class="line">   <span class="comment">// try ... catch å—ï¼Œå› ä¸º Rollup é»˜è®¤æƒ…å†µä¸‹ä¼šå–æ¶ˆå¯¹ treeshaking çš„ä¼˜åŒ–</span></span><br><span class="line">   <span class="comment">// åœ¨ try-catch ä¸­ã€‚ è¿™å¯ä»¥ä½¿æ‰€æœ‰è­¦å‘Šä»£ç ä¿æŒä¸å˜ã€‚ è™½ç„¶</span></span><br><span class="line">   <span class="comment">// ä»–ä»¬æœ€ç»ˆä¼šè¢«åƒ terser è¿™æ ·çš„ç¼©å°å™¨åŠ¨æ‘‡ï¼Œä¸€äº›ç¼©å°å™¨</span></span><br><span class="line">   <span class="comment">// å°†æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ï¼ˆä¾‹å¦‚ https://github.com/evanw/esbuild/issues/1610ï¼‰</span></span><br><span class="line">  <span class="keyword">const</span> check = __DEV__</span><br><span class="line">    ? <span class="function">(<span class="params">job: SchedulerJob</span>) =&gt;</span> <span class="title function_">checkRecursiveUpdates</span>(seen!, job)</span><br><span class="line">    : <span class="variable constant_">NOOP</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (flushIndex = <span class="number">0</span>; flushIndex &lt; queue.<span class="property">length</span>; flushIndex++) &#123;</span><br><span class="line">      <span class="keyword">const</span> job = queue[flushIndex]</span><br><span class="line">      <span class="keyword">if</span> (job &amp;&amp; job.<span class="property">active</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (__DEV__ &amp;&amp; <span class="title function_">check</span>(job)) &#123;</span><br><span class="line">          <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// console.log(`running:`, job.id)</span></span><br><span class="line">        <span class="title function_">callWithErrorHandling</span>(job, <span class="literal">null</span>, <span class="title class_">ErrorCodes</span>.<span class="property">SCHEDULER</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    flushIndex = <span class="number">0</span></span><br><span class="line">    queue.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">flushPostFlushCbs</span>(seen)</span><br><span class="line"></span><br><span class="line">    isFlushing = <span class="literal">false</span></span><br><span class="line">    currentFlushPromise = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// ä¸€äº› postFlushCb æ’é˜Ÿä½œä¸šï¼</span></span><br><span class="line">    <span class="comment">// ç»§ç»­å†²æ´—ç›´åˆ°æ’ç©ºã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (queue.<span class="property">length</span> || pendingPostFlushCbs.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="title function_">flushJobs</span>(seen)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®è¿™é‡Œåœ¨æ³¨é‡Šé‡Œé¢å·²ç»è¯´çš„å¾ˆæ˜ç¡®äº†ï¼Œåœ¨è¿™é‡Œå¯ä»¥å¼€å§‹è®²ä¸€è®²å…³äº <code>isFlushing &amp; isFlushPending</code>.</p><p><code>isFlushPending = true</code> è¡¨ç¤ºï¼Œ<code>flushJobs</code> åŠ å…¥å¾®ä»»åŠ¡ä»¥å &#x3D;&gt; å¼€å§‹æ‰§è¡Œè¿™ä¸€ä¸ªåŒºé—´, å…¶ä»–ä¸º false.<br><code>isFlushing = true</code> è¡¨ç¤º <code>flushJobs</code> æ­£åœ¨æ‰§è¡Œçš„åŒºé—´</p><p>è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ <code>queue.sort(comparator)</code>, ä¸ºä»€ä¹ˆéœ€è¦æ’åºï¼Œä»¥åŠ <code>id</code> çš„æ„ä¹‰ï¼Œåœ¨æ³¨é‡Šä¸­éƒ½è§£é‡Šäº†</p><p>ç„¶åéå†é˜Ÿåˆ—ï¼Œå…¨éƒ¨æ‰§è¡Œã€‚</p><p>ç„¶åæ‰§è¡Œå›è°ƒ <code>flushPostFlushCbs</code></p><p>ç„¶åå¼€å§‹ç»§ç»­æ‰§è¡Œ <code>flushJobs(seen)</code>ï¼Œå› ä¸ºåœ¨æ‰§è¡Œä¹‹å‰çš„ <code>queue</code> çš„æ—¶å€™ï¼Œå¯èƒ½ä¹Ÿæœ‰éœ€è¦æ’å…¥é˜Ÿåˆ—ã€‚</p><h3 id="04-flushPostFlushCbs"><a href="#04-flushPostFlushCbs" class="headerlink" title="04. flushPostFlushCbs"></a>04. flushPostFlushCbs</h3><p>ç®€å•è¯´å°±æ˜¯æ‰§è¡Œå›è°ƒå‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">flushPostFlushCbs</span>(<span class="params">seen?: CountMap</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (pendingPostFlushCbs.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> deduped = [...<span class="keyword">new</span> <span class="title class_">Set</span>(pendingPostFlushCbs)]</span><br><span class="line">    pendingPostFlushCbs.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// #1947 already has active queue, nested flushPostFlushCbs call</span></span><br><span class="line">    <span class="keyword">if</span> (activePostFlushCbs) &#123;</span><br><span class="line">      activePostFlushCbs.<span class="title function_">push</span>(...deduped)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    activePostFlushCbs = deduped</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      seen = seen || <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    activePostFlushCbs.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> <span class="title function_">getId</span>(a) - <span class="title function_">getId</span>(b))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (</span><br><span class="line">      postFlushIndex = <span class="number">0</span>;</span><br><span class="line">      postFlushIndex &lt; activePostFlushCbs.<span class="property">length</span>;</span><br><span class="line">      postFlushIndex++</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        __DEV__ &amp;&amp;</span><br><span class="line">        <span class="title function_">checkRecursiveUpdates</span>(seen!, activePostFlushCbs[postFlushIndex])</span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">      &#125;</span><br><span class="line">      activePostFlushCbs[postFlushIndex]()</span><br><span class="line">    &#125;</span><br><span class="line">    activePostFlushCbs = <span class="literal">null</span></span><br><span class="line">    postFlushIndex = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™äº›å›è°ƒå‡½æ•°æ˜¯åœ¨ <code>pendingPostFlushCbs</code> å½“ä¸­, ä»–å¯èƒ½æ˜¯ <code>queuePostRenderEffect</code> åŠ å…¥çš„, <code>queuePostRenderEffect</code> æ˜¯å„ç§ç”Ÿå‘½å‘¨æœŸå‡½æ•°åŠ å…¥çš„ã€‚</p><h3 id="05-æ€»ç»“ã€‚"><a href="#05-æ€»ç»“ã€‚" class="headerlink" title="05. æ€»ç»“ã€‚"></a>05. æ€»ç»“ã€‚</h3><p>è¿™é‡Œè§£é‡Šäº† Vue3.x è°ƒåº¦çš„å¤§æ¦‚æµç¨‹ï¼Œæˆ‘ä¹‹æ‰€ä»¥æƒ³çœ‹è¿™ä¸ªï¼Œæ˜¯å› ä¸ºæˆ‘åœ¨çœ‹ <code>nextTick</code> æºç , ä¸çœ‹è¿™ä¸ªæ— æ³•å®Œå…¨ç†è§£ <code>nextTick</code>.</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> æºç  </tag>
            
            <tag> queue </tag>
            
            <tag> ä»»åŠ¡è°ƒåº¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>fetch ç®€å•ä»‹ç»</title>
      <link href="/2023/07/07/web_fetch/"/>
      <url>/2023/07/07/web_fetch/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-ä»€ä¹ˆæ˜¯-fetch"><a href="#01-ä»€ä¹ˆæ˜¯-fetch" class="headerlink" title="01. ä»€ä¹ˆæ˜¯ fetch"></a>01. ä»€ä¹ˆæ˜¯ fetch</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/fetch">https://developer.mozilla.org/zh-CN/docs/Web/API/fetch</a></p><p><a href="https://www.ruanyifeng.com/blog/2020/12/fetch-tutorial.html">https://www.ruanyifeng.com/blog/2020/12/fetch-tutorial.html</a></p><blockquote><p>fetch()æ˜¯ XMLHttpRequest çš„å‡çº§ç‰ˆï¼Œç”¨äºåœ¨ JavaScript è„šæœ¬é‡Œé¢å‘å‡º HTTP è¯·æ±‚ã€‚æµè§ˆå™¨åŸç”Ÿæä¾›è¿™ä¸ªå¯¹è±¡</p></blockquote><p><a href="https://caniuse.com/?search=fetch">https://caniuse.com/?search=fetch</a> ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ.</p><blockquote><p>ï¼ˆ1ï¼‰fetch()ä½¿ç”¨ Promiseï¼Œä¸ä½¿ç”¨å›è°ƒå‡½æ•°ï¼Œå› æ­¤å¤§å¤§ç®€åŒ–äº†å†™æ³•ï¼Œå†™èµ·æ¥æ›´ç®€æ´ã€‚</p><p>ï¼ˆ2ï¼‰fetch()é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼ŒAPI åˆ†æ•£åœ¨å¤šä¸ªå¯¹è±¡ä¸Šï¼ˆResponse å¯¹è±¡ã€Request å¯¹è±¡ã€Headers å¯¹è±¡ï¼‰ï¼Œæ›´åˆç†ä¸€äº›ï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼ŒXMLHttpRequest çš„ API è®¾è®¡å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œè¾“å…¥ã€è¾“å‡ºã€çŠ¶æ€éƒ½åœ¨åŒä¸€ä¸ªæ¥å£ç®¡ç†ï¼Œå®¹æ˜“å†™å‡ºéå¸¸æ··ä¹±çš„ä»£ç ã€‚</p><p>ï¼ˆ3ï¼‰fetch()é€šè¿‡æ•°æ®æµï¼ˆStream å¯¹è±¡ï¼‰å¤„ç†æ•°æ®ï¼Œå¯ä»¥åˆ†å—è¯»å–ï¼Œæœ‰åˆ©äºæé«˜ç½‘ç«™æ€§èƒ½è¡¨ç°ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼Œå¯¹äºè¯·æ±‚å¤§æ–‡ä»¶æˆ–è€…ç½‘é€Ÿæ…¢çš„åœºæ™¯ç›¸å½“æœ‰ç”¨ã€‚XMLHTTPRequest å¯¹è±¡ä¸æ”¯æŒæ•°æ®æµï¼Œæ‰€æœ‰çš„æ•°æ®å¿…é¡»æ”¾åœ¨ç¼“å­˜é‡Œï¼Œä¸æ”¯æŒåˆ†å—è¯»å–ï¼Œå¿…é¡»ç­‰å¾…å…¨éƒ¨æ‹¿åˆ°åï¼Œå†ä¸€æ¬¡æ€§åå‡ºæ¥</p></blockquote><p>åŸç”Ÿæ”¯æŒ promise.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title function_">fetch</span>(myUrl)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">blob</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">blob</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="regexp">/image/</span>.<span class="title function_">test</span>(blob.<span class="property">type</span>)) <span class="keyword">return</span> <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">url</span>) =&gt;</span> &#123;</span><br><span class="line">        target.<span class="property">blob</span> = url;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        target.<span class="title function_">showError</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;URLä¸æ­£ç¡®æˆ–MIMEç±»å‹ä¸æ­£ç¡®&quot;</span>);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æˆ‘ä¹‹å‰è·å–å›¾ç‰‡çš„ä¸€ä¸ªä¾‹å­ï¼Œæ˜¯é€šè¿‡ resè·å–äºŒè¿›åˆ¶æ–‡ä»¶çš„ä¾‹å­ã€‚</p><p>ç†è®ºä¸Šåˆ°è¿™é‡Œå°±å¯ä»¥å¼€å§‹åŸºæœ¬çš„ä½¿ç”¨äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯å¤§æ¦‚çš„çŸ¥é“æœ‰ä»€ä¹ˆå±æ€§ï¼Œapiï¼Œç”¨çš„æ—¶å€™æŸ¥ã€‚</p><h3 id="02-Response"><a href="#02-Response" class="headerlink" title="02. Response"></a>02. Response</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Response">https://developer.mozilla.org/zh-CN/docs/Web/API/Response</a></p><p><strong>æ•°æ®ç±»å‹</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Response</span>.<span class="title function_">arrayBuffer</span>()  <span class="comment">//äºŒè¿›åˆ¶ æµåª’ä½“</span></span><br><span class="line"><span class="title class_">Response</span>.<span class="title function_">blob</span>()  <span class="comment">//äºŒè¿›åˆ¶ blobï¼Œå›¾ç‰‡ä¹‹ç±»</span></span><br><span class="line"><span class="title class_">Response</span>.<span class="title function_">formData</span>() <span class="comment">//è¡¨å•</span></span><br><span class="line"><span class="title class_">Response</span>.<span class="title function_">json</span>()</span><br><span class="line"><span class="title class_">Response</span>.<span class="title function_">text</span>()</span><br><span class="line"><span class="title class_">Response</span>.<span class="title function_">clone</span>()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = <span class="title class_">Response</span>.<span class="title function_">text</span>()</span><br><span class="line"><span class="keyword">let</span> result = <span class="title class_">Response</span>.<span class="title function_">json</span>() <span class="comment">//error</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥éœ€è¦å…ˆ <code>clone()</code></p><p><strong>çŠ¶æ€ç å’ŒåŸºæœ¬å±æ€§</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Response</span>.<span class="property">ok</span> <span class="number">200</span> &lt; <span class="title class_">Response</span>.<span class="property">status</span> &lt; <span class="number">299</span></span><br><span class="line"><span class="title class_">Response</span>.<span class="property">status</span></span><br><span class="line"><span class="title class_">Response</span>.<span class="property">statusText</span> <span class="comment">//å­—ç¬¦ä¸²ï¼Œok</span></span><br><span class="line"><span class="title class_">Response</span>.<span class="property">type</span> <span class="comment">//è¯·æ±‚ç±»å‹</span></span><br><span class="line"><span class="title class_">Response</span>.<span class="property">url</span></span><br><span class="line"><span class="title class_">Response</span>.<span class="property">redirected</span> <span class="comment">//è¯·æ±‚æ˜¯å¦å‘ç”Ÿè¿‡è·³è½¬</span></span><br><span class="line"><span class="title class_">Response</span>.<span class="title function_">redirect</span>() <span class="comment">//è·³è½¬</span></span><br></pre></td></tr></table></figure><p><strong>body</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Response</span>.<span class="property">body</span> <span class="comment">//ReadableStream</span></span><br><span class="line"><span class="title class_">Response</span>.<span class="property">bodyUsed</span> <span class="comment">//bodyUsed æ˜¯ Response mixin ä¸­çš„ä¸€ä¸ªåªè¯»å±æ€§ã€‚ç”¨ä»¥è¡¨ç¤ºè¯¥ body æ˜¯å¦è¢«ä½¿ç”¨è¿‡ã€‚</span></span><br></pre></td></tr></table></figure><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ReadableStream">https://developer.mozilla.org/zh-CN/docs/Web/API/ReadableStream</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://api.example.com/data&#x27;</span>) <span class="comment">// å‘èµ·ç½‘ç»œè¯·æ±‚</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> reader = response.<span class="property">body</span>.<span class="title function_">getReader</span>(); <span class="comment">// è·å– ReadableStreamDefaultReader å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">readStream</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> reader.<span class="title function_">read</span>() <span class="comment">// é€å—è¯»å–æ•°æ®</span></span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; done, value &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (done) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æ•°æ®è¯»å–å®Œæ¯•&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// å¤„ç†è¯»å–çš„æ•°æ®</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯»å–æ•°æ®å—:&#x27;</span>, value);</span><br><span class="line"></span><br><span class="line">          <span class="comment">// ç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªæ•°æ®å—</span></span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">readStream</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è¯»å–æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯:&#x27;</span>, error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">readStream</span>(); <span class="comment">// å¼€å§‹è¯»å–æ•°æ®æµ</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è¯·æ±‚æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯:&#x27;</span>, error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p><strong>Response.headers</strong></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Headers">https://developer.mozilla.org/zh-CN/docs/Web/API/Headers</a></p><p>ä»¥ä¸Šå°±æ˜¯ response å¤§æ¦‚å‚æ•°ï¼Œé‡ç‚¹å…¶å®æ˜¯ç±»å‹è·å–å’Œbody</p><h3 id="03-options"><a href="#03-options" class="headerlink" title="03. options"></a>03. options</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/fetch">https://developer.mozilla.org/zh-CN/docs/Web/API/fetch</a></p><ul><li>method: è¯·æ±‚ä½¿ç”¨çš„æ–¹æ³•ï¼Œå¦‚ GETã€POSTã€‚</li><li>headers: è¯·æ±‚çš„å¤´ä¿¡æ¯ï¼Œå½¢å¼ä¸º Headers çš„å¯¹è±¡æˆ–åŒ…å« ByteString å€¼çš„å¯¹è±¡å­—é¢é‡ã€‚</li><li>body: è¯·æ±‚çš„ body ä¿¡æ¯ï¼šå¯èƒ½æ˜¯ä¸€ä¸ª Blobã€BufferSourceã€FormDataã€URLSearchParams æˆ–è€… USVString å¯¹è±¡ã€‚æ³¨æ„ GET æˆ– HEAD æ–¹æ³•çš„è¯·æ±‚ä¸èƒ½åŒ…å« body ä¿¡æ¯ã€‚</li><li>mode: è¯·æ±‚çš„æ¨¡å¼ï¼Œå¦‚ corsã€no-cors æˆ–è€… same-originã€‚</li><li>credentials: è¯·æ±‚çš„ credentialsï¼Œå¦‚ omitã€same-origin æˆ–è€… includeã€‚ä¸ºäº†åœ¨å½“å‰åŸŸåå†…è‡ªåŠ¨å‘é€ cookieï¼Œå¿…é¡»æä¾›è¿™ä¸ªé€‰é¡¹ï¼Œä» Chrome 50 å¼€å§‹ï¼Œè¿™ä¸ªå±æ€§ä¹Ÿå¯ä»¥æ¥å— FederatedCredential (en-US) å®ä¾‹æˆ–æ˜¯ä¸€ä¸ª PasswordCredential (en-US) å®ä¾‹ã€‚</li><li>cache: è¯·æ±‚çš„ cache æ¨¡å¼ï¼šdefaultã€ no-storeã€ reload ã€ no-cacheã€ force-cache æˆ–è€… only-if-cachedã€‚</li><li>redirect: å¯ç”¨çš„ redirect æ¨¡å¼ï¼šfollow (è‡ªåŠ¨é‡å®šå‘), error (å¦‚æœäº§ç”Ÿé‡å®šå‘å°†è‡ªåŠ¨ç»ˆæ­¢å¹¶ä¸”æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼‰ï¼Œæˆ–è€… manual (æ‰‹åŠ¨å¤„ç†é‡å®šå‘)ã€‚åœ¨ Chrome ä¸­é»˜è®¤ä½¿ç”¨ followï¼ˆChrome 47 ä¹‹å‰çš„é»˜è®¤å€¼æ˜¯ manualï¼‰ã€‚</li><li>referrer: ä¸€ä¸ª USVString å¯ä»¥æ˜¯ no-referrerã€client æˆ–ä¸€ä¸ª URLã€‚é»˜è®¤æ˜¯ clientã€‚</li><li>referrerPolicy: æŒ‡å®šäº† HTTP å¤´éƒ¨ referer å­—æ®µçš„å€¼ã€‚å¯èƒ½ä¸ºä»¥ä¸‹å€¼ä¹‹ä¸€ï¼šno-referrerã€ no-referrer-when-downgradeã€originã€origin-when-cross-originã€ unsafe-urlã€‚</li><li>integrity: åŒ…æ‹¬è¯·æ±‚çš„ subresource integrity å€¼ï¼ˆä¾‹å¦‚ï¼š sha256-BpfBw7ivV8q2jLiT13fxDYAe2tJllusRSZ273h2nFSE&#x3D;ï¼‰ã€‚</li><li>signal: AbortController</li><li>keepalive</li></ul><h3 id="04-ç»ˆæ­¢-fetch"><a href="#04-ç»ˆæ­¢-fetch" class="headerlink" title="04. ç»ˆæ­¢ fetch"></a>04. ç»ˆæ­¢ fetch</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController">https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController</a></p><p>ä»–ä¸ä»…ä»…å¯ä»¥ç»ˆæ­¢ fetchï¼Œè¿˜å¯ä»¥ç»ˆæ­¢ xmlHttpRequest.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"><span class="keyword">let</span> signal = controller.<span class="property">signal</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetch</span>(url, &#123;</span><br><span class="line">  <span class="attr">signal</span>: controller.<span class="property">signal</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">signal.<span class="title function_">addEventListener</span>(<span class="string">&#x27;abort&#x27;</span>,</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;abort!&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">controller.<span class="title function_">abort</span>(); <span class="comment">// å–æ¶ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(signal.<span class="property">aborted</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><strong>fetch</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> controller.<span class="title function_">abort</span>(), <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/long-operation&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">signal</span>: controller.<span class="property">signal</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">  <span class="keyword">if</span> (err.<span class="property">name</span> == <span class="string">&#x27;AbortError&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Aborted!&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> err;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“ã€‚"><a href="#æ€»ç»“ã€‚" class="headerlink" title="æ€»ç»“ã€‚"></a>æ€»ç»“ã€‚</h3><p>å…¶å®å·®ä¸å¤šï¼Œä¸»è¦è¯­æ³•å’Œç”¨æ³•ä¸Šçš„å·®åˆ«ã€‚fetchåŸç”Ÿ åŸç”ŸPromise é“¾å¼è¯­æ³•ï¼Œå…¶ä»–æ›´å¤§åŒºåˆ«ï¼Œåœ¨äºæµå¼æ•°æ®å¤„ç†ï¼Œresponse.body</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
            <tag> fetch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›¾ç‰‡æ‡’åŠ è½½æ–¹æ¡ˆ</title>
      <link href="/2023/07/06/web_img_lazy_loading/"/>
      <url>/2023/07/06/web_img_lazy_loading/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>è™½ç„¶è¿™é‡Œåªè¯´å›¾ç‰‡æ‡’åŠ è½½ï¼Œè¿˜æ˜¯å¾—çŸ¥é“ä»€ä¹ˆæ˜¯æ‡’åŠ è½½</p><blockquote><p>å»¶è¿ŸåŠ è½½ï¼ˆæ‡’åŠ è½½ï¼‰æ˜¯ä¸€ç§å°†èµ„æºæ ‡è¯†ä¸ºéé˜»å¡ï¼ˆéå…³é”®ï¼‰èµ„æºå¹¶ä»…åœ¨éœ€è¦æ—¶åŠ è½½å®ƒä»¬çš„ç­–ç•¥ã€‚è¿™æ˜¯ä¸€ç§ç¼©çŸ­å…³é”®æ¸²æŸ“è·¯å¾„é•¿åº¦çš„æ–¹æ³•ï¼Œå¯ä»¥ç¼©çŸ­é¡µé¢åŠ è½½æ—¶é—´ã€‚</p></blockquote><p>å¦‚æœåªå±€é™åˆ°å›¾ç‰‡è¿™ä¸€ä¸ªç‚¹ä¸Šï¼Œå°±æ˜¯å»¶ååŠ è½½éå¿…é¡»çš„å›¾ç‰‡ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=`` /&gt;</span></span><br></pre></td></tr></table></figure><h3 id="01-ä½ç½®è®¡ç®—-æ»šåŠ¨äº‹ä»¶-Scroll-DataSet-API"><a href="#01-ä½ç½®è®¡ç®—-æ»šåŠ¨äº‹ä»¶-Scroll-DataSet-API" class="headerlink" title="01. ä½ç½®è®¡ç®— + æ»šåŠ¨äº‹ä»¶ (Scroll) + DataSet API"></a>01. ä½ç½®è®¡ç®— + æ»šåŠ¨äº‹ä»¶ (Scroll) + DataSet API</h3><p>å°±æ˜¯è¯´ï¼Œæˆ‘çŸ¥é“å›¾ç‰‡ä½ç½®ï¼Œæˆ‘èƒ½ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œå½“å›¾ç‰‡ä½ç½®å’Œæ»šåŠ¨äº‹ä»¶é‡åˆçš„æ—¶å€™ï¼Œè·å–å›¾ç‰‡çš„ data-src, æ¸²æŸ“å›¾ç‰‡.</p><p>æœ‰äº›ç½‘ç«™æ–¹æ¡ˆç»†èŠ‚ä¸ä¸€æ ·ï¼Œæ¯”å¦‚æå‰å¤šå°‘è·ç¦»åŠ è½½ã€‚</p><p>è¿™ç§æ–¹æ¡ˆæœ‰ç‚¹å„¿ç±»ä¼¼äºç§»åŠ¨ç«¯åˆ†é¡µï¼Œåˆ’åˆ°æŸäº›ä½ç½®è‡ªåŠ¨åŠ è½½ä¸‹é¢çš„ã€‚</p><p>åœ¨è¿™ä¸ªæ€è·¯ä¹‹ä¸‹ï¼Œå†™äº†ä¸€ç‚¹ä»£ç  <a href="https://codesandbox.io/s/polished-resonance-fw3hfy?file=/index.html">æ–¹æ¡ˆä¸€ Demo</a></p><p>url å¯ä»¥æ¢ï¼Œè¿™ä¸ªæ–¹æ¡ˆæœ€å¤§çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>è¿™é‡Œè¿˜å¯ä»¥æœ‰ä»€ä¹ˆä¼˜åŒ–çš„ç‚¹ï¼Ÿæ¯”å¦‚ ImgClass å®Œæˆä»¥åéœ€è¦åˆ é™¤ç›‘å¬ã€‚å…¶ä»–å°±æ˜¯ä¼˜åŒ–åˆ¤æ–­æ˜¯å¦åœ¨é‡Œé¢ã€‚</p><h3 id="02-æ–¹æ¡ˆ2-getBoundingClientRect"><a href="#02-æ–¹æ¡ˆ2-getBoundingClientRect" class="headerlink" title="02. æ–¹æ¡ˆ2 getBoundingClientRect"></a>02. æ–¹æ¡ˆ2 getBoundingClientRect</h3><blockquote><p>getBoundingClientRect æ˜¯ä¸€ä¸ª DOM å…ƒç´ çš„æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€ä¸ªåŒ…å«è¯¥å…ƒç´ ä½ç½®å’Œå°ºå¯¸ä¿¡æ¯çš„ DOMRect å¯¹è±¡ã€‚DOMRect å¯¹è±¡åŒ…å«ä»¥ä¸‹å±æ€§ï¼š</p><p>topï¼šå…ƒç´ ä¸Šè¾¹ç•Œç›¸å¯¹äºè§†å£é¡¶éƒ¨çš„è·ç¦»ã€‚<br>rightï¼šå…ƒç´ å³è¾¹ç•Œç›¸å¯¹äºè§†å£å·¦è¾¹çš„è·ç¦»ã€‚<br>bottomï¼šå…ƒç´ ä¸‹è¾¹ç•Œç›¸å¯¹äºè§†å£é¡¶éƒ¨çš„è·ç¦»ã€‚<br>leftï¼šå…ƒç´ å·¦è¾¹ç•Œç›¸å¯¹äºè§†å£å·¦è¾¹çš„è·ç¦»ã€‚<br>widthï¼šå…ƒç´ çš„å®½åº¦ã€‚<br>heightï¼šå…ƒç´ çš„é«˜åº¦ã€‚</p></blockquote><p>ä»–çš„ top æ˜¯åŸºäºæ»šåŠ¨çš„ä½ç½®, æ˜¯åŸºäº document.documentElement.scrollTop å†åšè¿ç®—çš„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">isInViewport</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">element</span>.<span class="title function_">getBoundingClientRect</span>().<span class="property">top</span> &lt; <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span> + <span class="number">100</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://caniuse.com/?search=getBoundingClientRect">https://caniuse.com/?search=getBoundingClientRect</a> å…¼å®¹æ€§ok.</p><h3 id="03-æ–¹æ¡ˆ3-Intersection-Observer-API"><a href="#03-æ–¹æ¡ˆ3-Intersection-Observer-API" class="headerlink" title="03. æ–¹æ¡ˆ3 Intersection_Observer_API"></a>03. æ–¹æ¡ˆ3 Intersection_Observer_API</h3><blockquote><p>Intersection Observer API æ˜¯ä¸€ä¸ªç”¨äºè§‚å¯Ÿå…ƒç´ åœ¨è§†å£ä¸­å¯è§æ€§å˜åŒ–çš„ JavaScript APIã€‚å®ƒæä¾›äº†ä¸€ç§å¼‚æ­¥æ–¹å¼æ¥ç›‘å¬ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ä¸å…¶ç¥–å…ˆå…ƒç´ æˆ–æ•´ä¸ªæ–‡æ¡£è§†å£çš„äº¤å‰çŠ¶æ€ã€‚é€šè¿‡ä½¿ç”¨ Intersection Observer APIï¼Œå¼€å‘è€…å¯ä»¥æœ‰æ•ˆåœ°æ£€æµ‹å…ƒç´ æ˜¯å¦è¿›å…¥æˆ–ç¦»å¼€è§†å£ï¼Œæˆ–è€…ä¸å…¶ä»–å…ƒç´ ç›¸äº¤çš„ç¨‹åº¦ã€‚</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;box&quot;</span>&gt;&lt;/div&gt; * <span class="number">10</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">// åˆ›å»º Intersection Observer å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="function">(<span class="params">entries, observer</span>) =&gt;</span> &#123;</span><br><span class="line">        entries.<span class="title function_">forEach</span>(<span class="function"><span class="params">entry</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (entry.<span class="property">isIntersecting</span>) &#123;</span><br><span class="line">                <span class="comment">// å…ƒç´ è¿›å…¥è§†å£æ—¶æ·»åŠ  CSS ç±»å</span></span><br><span class="line">                entry.<span class="property">target</span>.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;visible&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å…ƒç´ ç¦»å¼€è§†å£æ—¶ç§»é™¤ CSS ç±»å</span></span><br><span class="line">                entry.<span class="property">target</span>.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;visible&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬æ‰€æœ‰å…·æœ‰ &quot;.box&quot; ç±»åçš„å…ƒç´ </span></span><br><span class="line">    <span class="keyword">const</span> boxes = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.box&#x27;</span>);</span><br><span class="line">    boxes.<span class="title function_">forEach</span>(<span class="function"><span class="params">box</span> =&gt;</span> &#123;</span><br><span class="line">        observer.<span class="title function_">observe</span>(box);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªç®€å•ä¾‹å­ï¼Œå¦‚æœç”¨åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­åº”ç”¨ <a href="https://codesandbox.io/s/polished-resonance-fw3hfy?file=/intersectionObserver.html">demo</a></p><p><a href="https://caniuse.com/?search=IntersectionObserver">https://caniuse.com/?search=IntersectionObserver</a></p><h3 id="04-æ–¹æ¡ˆ4"><a href="#04-æ–¹æ¡ˆ4" class="headerlink" title="04. æ–¹æ¡ˆ4"></a>04. æ–¹æ¡ˆ4</h3><p><a href="https://caniuse.com/?search=loading">https://caniuse.com/?search=loading</a></p><p>è¿™ä¸ªæ–¹æ¡ˆæœ€ç®€å•ç›´æ¥ï¼Œè€Œä¸”æµè§ˆå™¨ç›´æ”¯æŒï¼Œç°åœ¨æ¥çœ‹è¿˜è¡Œã€‚</p><blockquote><p>loading å±æ€§æ˜¯ HTML <img> å…ƒç´ çš„ä¸€ä¸ªå±æ€§ï¼Œç”¨äºæŒ‡å®šå›¾åƒçš„åŠ è½½è¡Œä¸ºã€‚è¯¥å±æ€§å¯å¸®åŠ©å¼€å‘è€…ä¼˜åŒ–å›¾åƒçš„åŠ è½½æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚loading å±æ€§åœ¨ HTML5.2 è§„èŒƒä¸­è¢«å¼•å…¥ï¼Œæ”¯æŒç°ä»£æµè§ˆå™¨ã€‚</p></blockquote><p>loading å±æ€§æœ‰ä»¥ä¸‹å‡ ä¸ªå¯é€‰å€¼ï¼š</p><ul><li>autoï¼šé»˜è®¤å€¼ï¼Œæµè§ˆå™¨è‡ªåŠ¨é€‰æ‹©åŠ è½½æ–¹å¼ï¼Œæ ¹æ®ç½‘ç»œæ¡ä»¶å’Œç”¨æˆ·ä½“éªŒæ¥å†³å®šã€‚</li><li>lazyï¼šå›¾åƒå»¶è¿ŸåŠ è½½ï¼Œåªæœ‰å½“å›¾åƒè¿›å…¥è§†å£é™„è¿‘æ—¶æ‰å¼€å§‹åŠ è½½ã€‚è¿™å¯ä»¥æé«˜é¡µé¢çš„åŠ è½½é€Ÿåº¦å’Œæ€§èƒ½ã€‚</li><li>eagerï¼šå›¾åƒç«‹å³åŠ è½½ï¼Œä¼˜å…ˆçº§é«˜äºé¡µé¢å…¶ä»–å†…å®¹çš„åŠ è½½ã€‚é€‚ç”¨äºéœ€è¦å°½å¿«å±•ç¤ºå›¾åƒçš„æƒ…å†µã€‚</li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç¬¬ä¸€ç§æ–¹æ¡ˆå…¼å®¹æ€§æœ€å¥½ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½èƒ½æ”¯æŒï¼Œå› ä¸ºä»–å°±æ˜¯é ä½ç½®è®¡ç®—ã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•ï¼ŒgetBoundingClientRectï¼Œå¯ä»¥æ ¹æ®å½“å‰æµè§ˆçš„çª—å£æ¥è®¡ç®— topã€‚</p><p>ç¬¬ä¸‰ç§æ–¹æ³•ï¼ŒIntersectionObserverï¼Œä»–é¿å…äº†å¯¹äº scoll äº‹ä»¶çš„ç›‘æ§ï¼Œå¾ˆå¹³æ»‘ã€‚</p><p>ç¬¬å››ç§æ–¹æ³•ï¼Œloading &#x3D; lazy å…¶å®ç®€å•æœ‰æ•ˆï¼Œä½†æ˜¯åŸç†ç›®å‰ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚</p><p><a href="https://addyosmani.com/blog/lazy-loading/">https://addyosmani.com/blog/lazy-loading/</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DOMRect">https://developer.mozilla.org/zh-CN/docs/Web/API/DOMRect</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/Performance/Lazy_loading">https://developer.mozilla.org/zh-CN/docs/Web/Performance/Lazy_loading</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API">https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API</a></p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
            <tag> lazyloading </tag>
            
            <tag> æ‡’åŠ è½½ </tag>
            
            <tag> æ–¹æ¡ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue3 defineAsyncComponent &amp; Suspense ç”¨æ³•ä»¥åŠæºç </title>
      <link href="/2023/07/06/Vue3_Suspense/"/>
      <url>/2023/07/06/Vue3_Suspense/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-defineAsyncComponent-å®šä¹‰å’Œä½¿ç”¨"><a href="#01-defineAsyncComponent-å®šä¹‰å’Œä½¿ç”¨" class="headerlink" title="01. defineAsyncComponent å®šä¹‰å’Œä½¿ç”¨"></a>01. defineAsyncComponent å®šä¹‰å’Œä½¿ç”¨</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">defineAsyncComponent</span>(<span class="params"></span></span><br><span class="line"><span class="params">  source: AsyncComponentLoader | AsyncComponentOptions</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Component</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">AsyncComponentLoader</span> = <span class="function">() =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="title class_">Component</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AsyncComponentOptions</span> &#123;</span><br><span class="line">  <span class="attr">loader</span>: <span class="title class_">AsyncComponentLoader</span></span><br><span class="line">  loadingComponent?: <span class="title class_">Component</span></span><br><span class="line">  errorComponent?: <span class="title class_">Component</span></span><br><span class="line">  delay?: <span class="built_in">number</span></span><br><span class="line">  timeout?: <span class="built_in">number</span></span><br><span class="line">  suspensible?: <span class="built_in">boolean</span></span><br><span class="line">  onError?: <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    error: <span class="built_in">Error</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    retry: () =&gt; <span class="built_in">void</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    fail: () =&gt; <span class="built_in">void</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    attempts: <span class="built_in">number</span></span></span></span><br><span class="line"><span class="params"><span class="function">  </span>) =&gt;</span> <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸¤ä¸ªå‚æ•° <code>AsyncComponentLoader</code> or <code>AsyncComponentOptions</code></p><p>å†™äº†ä¸€ä¸ª type AsyncComponentLoader &#x3D; () &#x3D;&gt; Promise<Component> å‚æ•°çš„</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">my-async-component</span>&gt;</span><span class="tag">&lt;/<span class="name">my-async-component</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title class_">MyAsyncComponent</span> = <span class="title class_">Vue</span>.<span class="title function_">defineAsyncComponent</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// å¼‚æ­¥åŠ è½½ç»„ä»¶çš„é€»è¾‘</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="title function_">resolve</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;This is an async component!&lt;/div&gt;&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;, <span class="number">2000</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">createApp</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title class_">MyAsyncComponent</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>æ—¢ç„¶å¯ä»¥è¿™æ ·å†™ï¼Œä¹Ÿå¯ä»¥è¿™æ ·å†™</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyAsyncComponent</span> = <span class="title class_">Vue</span>.<span class="title function_">defineAsyncComponent</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span>  <span class="keyword">import</span>(<span class="string">&#x27;../a.vue&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§å°±æ˜¯å†™ä¸€ä¸ª <code>options</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">AsyncComponent</span> = <span class="title class_">Vue</span>.<span class="title function_">defineAsyncComponent</span>(&#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ AsyncComponentOptions é…ç½®å¯¹è±¡</span></span><br><span class="line">    <span class="attr">loader</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(&#123;</span><br><span class="line">                    <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;This is an async component!&lt;/div&gt;&#x27;</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;, <span class="number">10000</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">delay</span>: <span class="number">200</span>, <span class="comment">// å¯é€‰é¡¹ï¼ŒåŠ è½½å»¶è¿Ÿ</span></span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">3000</span>, <span class="comment">// å¯é€‰é¡¹ï¼Œè¶…æ—¶æ—¶é—´</span></span><br><span class="line">    <span class="attr">errorComponent</span>: <span class="string">&#x27;div&#x27;</span>, <span class="comment">// å¯é€‰é¡¹ï¼ŒåŠ è½½é”™è¯¯æ—¶æ˜¾ç¤ºçš„ç»„ä»¶æˆ–æ ‡ç­¾</span></span><br><span class="line">    <span class="attr">timeoutComponent</span>: &#123; <span class="comment">// å¯é€‰é¡¹ï¼ŒåŠ è½½è¶…æ—¶æ—¶æ˜¾ç¤ºçš„ç»„ä»¶æˆ–é…ç½®å¯¹è±¡</span></span><br><span class="line">        <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;Component loading timed out.&lt;/div&gt;&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">suspensible</span>: <span class="literal">true</span> <span class="comment">// å¯é€‰é¡¹ï¼Œå¯ç”¨ç»„ä»¶çš„æš‚åœå’Œæ¢å¤åŠŸèƒ½</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="02-æºç "><a href="#02-æºç " class="headerlink" title="02. æºç "></a>02. æºç </h3><p><strong>packages\runtime-core\src\apiAsyncComponent.ts</strong></p><p>è¿™ä¸ªä»£ç çœ‹å¾—æ¯”è¾ƒçº ç»“ï¼Œç®€å•è¯´å°±æ˜¯</p><ol><li>è·å–å‚æ•°</li><li>å®šä¹‰ä¸€äº›å±€éƒ¨å˜é‡ç”¨äºè·Ÿè¸ªå¼‚æ­¥åŠ è½½çŠ¶æ€ï¼Œå¦‚ pendingRequestã€resolvedComp å’Œ retriesã€‚</li><li>å®ç° load å‡½æ•°ï¼Œç”¨äºæ‰§è¡Œå¼‚æ­¥åŠ è½½è¿‡ç¨‹ã€‚å®ƒä¼šè°ƒç”¨ loader å‡½æ•°ï¼Œå¹¶å¤„ç†åŠ è½½è¿‡ç¨‹ä¸­çš„é”™è¯¯å’Œè¶…æ—¶ã€‚åŠ è½½æˆåŠŸåï¼Œå°†å¾—åˆ°çš„ç»„ä»¶è¿›è¡Œå¤„ç†ï¼Œå¹¶è¿”å› Promise å¯¹è±¡ã€‚</li><li>ä½¿ç”¨ defineComponent å®šä¹‰ä¸€ä¸ªåŒ…è£¹ç»„ä»¶ (AsyncComponentWrapper)ï¼Œå¹¶åœ¨ setup é’©å­ä¸­å¤„ç†å¼‚æ­¥åŠ è½½çš„é€»è¾‘ã€‚</li><li>åœ¨ setup é’©å­ä¸­ï¼Œæ ¹æ®åŠ è½½çŠ¶æ€æ¸²æŸ“ä¸åŒçš„å†…å®¹ï¼ŒåŒ…æ‹¬å·²åŠ è½½çš„ç»„ä»¶ã€åŠ è½½ä¸­çš„ç»„ä»¶ã€é”™è¯¯ç»„ä»¶ç­‰ã€‚</li><li>è¿”å› AsyncComponentWrapper ä½œä¸ºæœ€ç»ˆçš„ç»„ä»¶é€‰é¡¹å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ç±»å‹æ–­è¨€ as T å°†å…¶è½¬æ¢ä¸ºæ³›å‹å‚æ•° T æ‰€æŒ‡å®šçš„ç±»å‹ã€‚</li></ol><p>ç®€å•è¯´å°±æ˜¯è¿™äº›ï¼Œæˆ‘æ›´å…³æ³¨çš„ï¼Œè¿™äº›å‚æ•°æœ‰ä»€ä¹ˆç”¨ã€‚</p><h3 id="03-delay"><a href="#03-delay" class="headerlink" title="03. delay"></a>03. delay</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> delayed = <span class="title function_">ref</span>(!!delay)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (delay) &#123;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    delayed.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">&#125;, delay)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (loaded.<span class="property">value</span> &amp;&amp; resolvedComp) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createInnerComp</span>(resolvedComp, instance)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error.<span class="property">value</span> &amp;&amp; errorComponent) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createVNode</span>(errorComponent, &#123;</span><br><span class="line">        <span class="attr">error</span>: error.<span class="property">value</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (loadingComponent &amp;&amp; !delayed.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createVNode</span>(loadingComponent)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œï¼ŒçŸ¥é“è¿™ä¸ª <code>delay</code> æœ‰ä»€ä¹ˆç”¨äº†å§ï¼Œä»–åªå’Œ <code>loadingComponent</code> ç›¸å…³ã€‚</p><ol><li>åˆ¤æ–­æ˜¯å¦loadå®Œæˆä»¥åŠè§£æå®Œæˆç»„ä»¶</li><li>åˆ¤æ–­é”™è¯¯ä¿¡æ¯å’Œé”™è¯¯ç»„ä»¶</li><li>loadingç»„ä»¶å’Œæ˜¯å¦åº”è¯¥loading</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>delay</code> æ˜¯å‡ºç° <code>loadingComponent</code> ç»„ä»¶å‡ºç°çš„å»¶è¿Ÿæ—¶é—´</p><h3 id="04-timeout"><a href="#04-timeout" class="headerlink" title="04. timeout"></a>04. timeout</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (timeout != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!loaded.<span class="property">value</span> &amp;&amp; !error.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> err = <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">            <span class="string">`Async component timed out after <span class="subst">$&#123;timeout&#125;</span>ms.`</span></span><br><span class="line">        )</span><br><span class="line">        <span class="title function_">onError</span>(err)</span><br><span class="line">        error.<span class="property">value</span> = err</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, timeout)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª <code>timeout</code>ç¨æ˜¾ç®€é™‹ï¼Œå°±æ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå¹¶ä¸”æ— æ³•ä¸­æ–­ <code>promise</code>, ä¹Ÿå°±æ˜¯ <code>load</code>.</p><p>ä½†æ˜¯ï¼Œ<code>error.value</code> ä¼šè§¦å‘ <code>render</code> é‡æ–°æ¸²æŸ“ï¼Œå¹¶ä¸”è°ƒç”¨ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ <code>errorComponent</code></p><h3 id="04-suspensible"><a href="#04-suspensible" class="headerlink" title="04 suspensible"></a>04 suspensible</h3><p>æ˜¯å¦å¼€å¯äº† <code>suspens</code>.</p><h3 id="05-defineAsyncComponent-æ€»ç»“"><a href="#05-defineAsyncComponent-æ€»ç»“" class="headerlink" title="05. defineAsyncComponent æ€»ç»“"></a>05. defineAsyncComponent æ€»ç»“</h3><p>è¿™é‡ŒåŸºæœ¬å°±çŸ¥é“ä»–æ˜¯æ€ä¹ˆç”¨çš„äº†ï¼Œä»¥åŠ errorï¼Œloading ç»„ä»¶åŠ è½½çš„åŸç†ï¼Œä»¥åŠ setTimeout &amp; delay &amp; suspensible ç­‰å‚æ•°ä½œç”¨æ˜¯ä»€ä¹ˆ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (</span><br><span class="line">(__FEATURE_SUSPENSE__ &amp;&amp; suspensible &amp;&amp; instance.<span class="property">suspense</span>) ||</span><br><span class="line">(__SSR__ &amp;&amp; isInSSRComponentSetup)</span><br><span class="line">) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">load</span>()</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">comp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">createInnerComp</span>(comp, instance)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">onError</span>(err)</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span></span><br><span class="line">        errorComponent</span><br><span class="line">        ? <span class="title function_">createVNode</span>(errorComponent <span class="keyword">as</span> <span class="title class_">ConcreteComponent</span>, &#123;</span><br><span class="line">            <span class="attr">error</span>: err</span><br><span class="line">            &#125;)</span><br><span class="line">        : <span class="literal">null</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="06-suspense"><a href="#06-suspense" class="headerlink" title="06. suspense"></a>06. suspense</h3><p>å®˜æ–¹æ–‡æ¡£ <a href="https://cn.vuejs.org/guide/built-ins/suspense.html">Suspense</a>ï¼Œå…¶ä»–çš„ç®€å•æ–‡æ¡£ <a href="https://medium.com/i-am-mike/vue-3-vue3-%E7%9A%84%E6%96%B0%E5%8A%9F%E8%83%BD-suspense-428e02254030">Vue3 çš„æ–°åŠŸèƒ½ â€” Suspense</a></p><blockquote><p><Suspense> æ˜¯ä¸€ä¸ªå†…ç½®ç»„ä»¶ï¼Œç”¨æ¥åœ¨ç»„ä»¶æ ‘ä¸­åè°ƒå¯¹å¼‚æ­¥ä¾èµ–çš„å¤„ç†ã€‚å®ƒè®©æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶æ ‘ä¸Šå±‚ç­‰å¾…ä¸‹å±‚çš„å¤šä¸ªåµŒå¥—å¼‚æ­¥ä¾èµ–é¡¹è§£æå®Œæˆï¼Œå¹¶å¯ä»¥åœ¨ç­‰å¾…æ—¶æ¸²æŸ“ä¸€ä¸ªåŠ è½½çŠ¶æ€ã€‚</p></blockquote><p>è¿™ä¸ªå…¶å®å°±è¯´çš„å¾ˆæ˜ç¡®äº†ï¼Œåˆšæ‰è¯´çš„ defineAsyncComponent æ˜¯é’ˆå¯¹å•ä¸ªç»„ä»¶ï¼ŒSuspenseå¯ä»¥å¯¹äºæ•´ä¸ªä¸‹é¢çš„ç»„ä»¶éƒ½æ§åˆ¶ã€‚</p><blockquote><p>Suspense å¯ä»¥ç­‰å¾…çš„å¼‚æ­¥ä¾èµ–æœ‰ä¸¤ç§ï¼š</p><ol><li>å¸¦æœ‰å¼‚æ­¥ setup() é’©å­çš„ç»„ä»¶ã€‚è¿™ä¹ŸåŒ…å«äº†ä½¿ç”¨ <script setup> æ—¶æœ‰é¡¶å±‚ await è¡¨è¾¾å¼çš„ç»„ä»¶ã€‚</li><li>å¼‚æ­¥ç»„ä»¶, definedAsyncComponent, suspensible = true</li></ol></blockquote><p>ä»¥åŠä¸¤ä¸ªæ’æ§½å’Œäº‹ä»¶</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Suspense</span>&gt;</span><br><span class="line">  &lt;!-- å…·æœ‰æ·±å±‚å¼‚æ­¥ä¾èµ–çš„ç»„ä»¶ --&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Dashboard</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line">  &lt;!-- åœ¨ #fallback æ’æ§½ä¸­æ˜¾ç¤º â€œæ­£åœ¨åŠ è½½ä¸­â€ --&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">template</span> #<span class="attr">fallback</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    Loading...</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Suspense</span>&gt;</span><br></pre></td></tr></table></figure><p>default æ’æ§½åªèƒ½æœ‰ä¸€ä¸ªç»„ä»¶ï¼Œfallback æ­£åœ¨åŠ è½½ã€‚</p><p>äº‹ä»¶</p><blockquote><p><Suspense> ç»„ä»¶ä¼šè§¦å‘ä¸‰ä¸ªäº‹ä»¶ï¼špendingã€resolve å’Œ fallbackã€‚pending äº‹ä»¶æ˜¯åœ¨è¿›å…¥æŒ‚èµ·çŠ¶æ€æ—¶è§¦å‘ã€‚resolve äº‹ä»¶æ˜¯åœ¨ default æ’æ§½å®Œæˆè·å–æ–°å†…å®¹æ—¶è§¦å‘ã€‚fallback äº‹ä»¶åˆ™æ˜¯åœ¨ fallback æ’æ§½çš„å†…å®¹æ˜¾ç¤ºæ—¶è§¦å‘ã€‚</p></blockquote><p>error</p><p>onErrorCaptured åœ¨ä¸Šå±‚æ•è·</p><p>ok, åšä¸€ä¸ªç®€å•æµ‹è¯•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///main</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">AsyncComponentOne</span> /&gt;</span> </span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">template</span> #<span class="attr">fallback</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Loading</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line">  </span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; defineAsyncComponent, <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Loading</span> <span class="keyword">from</span> <span class="string">&#x27;./Loading.vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title class_">AsyncComponentOne</span> = <span class="title function_">defineAsyncComponent</span>(<span class="function">() =&gt;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">import</span>(<span class="string">&#x27;./OneAsyncComponent.vue&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">///OneAsyncComponent</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; defineAsyncComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">ThreeAsyncComponen</span> <span class="keyword">from</span> <span class="string">&#x27;./ThreeAsyncComponent.vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> asyncLeft = <span class="title function_">defineAsyncComponent</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> <span class="keyword">import</span>(<span class="string">`./TwoAsyncComponent.vue`</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">asyncLeft</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ThreeAsyncComponen</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.read-the-docs</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="attribute">color</span>: <span class="number">#888</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">///TwoAsyncComponent.vue</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> dataMsg = <span class="title function_">ref</span>(<span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">resolve</span>(<span class="string">&#x27;&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;, <span class="number">5000</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">getTime</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;))</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Two AsyncComponent &#123;&#123; dataMsg &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.read-the-docs</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="attribute">color</span>: <span class="number">#888</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">///ThreeAsyncComponen.vue</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> dataMsg = <span class="title function_">ref</span>(<span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">resolve</span>(<span class="string">&#x27;&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;, <span class="number">10000</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">getTime</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;))</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Three AsyncComponent &#123;&#123; dataMsg &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.read-the-docs</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="attribute">color</span>: <span class="number">#888</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="07-Suspendse-å¦‚ä½•å®ç°çš„ï¼Ÿ"><a href="#07-Suspendse-å¦‚ä½•å®ç°çš„ï¼Ÿ" class="headerlink" title="07. Suspendse å¦‚ä½•å®ç°çš„ï¼Ÿ"></a>07. Suspendse å¦‚ä½•å®ç°çš„ï¼Ÿ</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Suspense exposes a component-like API, and is treated like a component</span></span><br><span class="line"><span class="comment">// in the compiler, but internally it&#x27;s a special built-in type that hooks</span></span><br><span class="line"><span class="comment">// directly into the renderer.</span></span><br><span class="line"><span class="comment">// Suspense å…¬å¼€äº†ç±»ä¼¼ç»„ä»¶çš„ APIï¼Œå¹¶è¢«è§†ä¸ºç»„ä»¶</span></span><br><span class="line"><span class="comment">// åœ¨ç¼–è¯‘å™¨ä¸­ï¼Œä½†åœ¨å†…éƒ¨å®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å†…ç½®ç±»å‹ï¼Œå¯ä»¥æŒ‚é’©</span></span><br><span class="line"><span class="comment">// ç›´æ¥è¿›å…¥æ¸²æŸ“å™¨ã€‚</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">SuspenseImpl</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Suspense&#x27;</span>,</span><br><span class="line">  <span class="comment">// In order to make Suspense tree-shakable, we need to avoid importing it</span></span><br><span class="line">  <span class="comment">// directly in the renderer. The renderer checks for the __isSuspense flag</span></span><br><span class="line">  <span class="comment">// on a vnode&#x27;s type and calls the `process` method, passing in renderer</span></span><br><span class="line">  <span class="comment">// internals.</span></span><br><span class="line">  <span class="comment">// ä¸ºäº†ä½¿ Suspense æ ‘å¯æ‘‡åŠ¨ï¼Œæˆ‘ä»¬éœ€è¦é¿å…å¯¼å…¥å®ƒ</span></span><br><span class="line">  <span class="comment">// ç›´æ¥åœ¨æ¸²æŸ“å™¨ä¸­ã€‚ æ¸²æŸ“å™¨æ£€æŸ¥ __isSuspense æ ‡å¿—</span></span><br><span class="line">  <span class="comment">// åœ¨ vnode çš„ç±»å‹ä¸Šå¹¶è°ƒç”¨ `process` æ–¹æ³•ï¼Œä¼ å…¥æ¸²æŸ“å™¨</span></span><br><span class="line">  <span class="comment">// å†…éƒ¨ç»“æ„ã€‚</span></span><br><span class="line">  <span class="attr">__isSuspense</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="title function_">process</span>(<span class="params"></span></span><br><span class="line"><span class="params">    n1: VNode | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">    n2: VNode,</span></span><br><span class="line"><span class="params">    container: RendererElement,</span></span><br><span class="line"><span class="params">    anchor: RendererNode | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">    parentComponent: ComponentInternalInstance | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">    parentSuspense: SuspenseBoundary | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">    isSVG: <span class="built_in">boolean</span>,</span></span><br><span class="line"><span class="params">    slotScopeIds: <span class="built_in">string</span>[] | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">    optimized: <span class="built_in">boolean</span>,</span></span><br><span class="line"><span class="params">    <span class="comment">// platform-specific impl passed from renderer</span></span></span><br><span class="line"><span class="params">    rendererInternals: RendererInternals</span></span><br><span class="line"><span class="params">  </span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n1 == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="title function_">mountSuspense</span>(</span><br><span class="line">        n2,</span><br><span class="line">        container,</span><br><span class="line">        anchor,</span><br><span class="line">        parentComponent,</span><br><span class="line">        parentSuspense,</span><br><span class="line">        isSVG,</span><br><span class="line">        slotScopeIds,</span><br><span class="line">        optimized,</span><br><span class="line">        rendererInternals</span><br><span class="line">      )</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">patchSuspense</span>(</span><br><span class="line">        n1,</span><br><span class="line">        n2,</span><br><span class="line">        container,</span><br><span class="line">        anchor,</span><br><span class="line">        parentComponent,</span><br><span class="line">        isSVG,</span><br><span class="line">        slotScopeIds,</span><br><span class="line">        optimized,</span><br><span class="line">        rendererInternals</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">hydrate</span>: hydrateSuspense,</span><br><span class="line">  <span class="attr">create</span>: createSuspenseBoundary,</span><br><span class="line">  <span class="attr">normalize</span>: normalizeSuspenseChildren</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äº h å’Œ TSX props æ¨ç†çš„å¼ºåˆ¶å…¬å…±ç±»å‹</span></span><br><span class="line"><span class="comment">// Force-casted public typing for h and TSX props inference</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">Suspense</span> = (__FEATURE_SUSPENSE__</span><br><span class="line">  ? <span class="title class_">SuspenseImpl</span></span><br><span class="line">  : <span class="literal">null</span>) <span class="keyword">as</span> <span class="built_in">unknown</span> <span class="keyword">as</span> &#123;</span><br><span class="line">  <span class="attr">__isSuspense</span>: <span class="literal">true</span></span><br><span class="line">  <span class="keyword">new</span> (): &#123;</span><br><span class="line">    <span class="attr">$props</span>: <span class="title class_">VNodeProps</span> &amp; <span class="title class_">SuspenseProps</span></span><br><span class="line">    <span class="attr">$slots</span>: &#123;</span><br><span class="line">      <span class="title function_">default</span>(): <span class="title class_">VNode</span>[]</span><br><span class="line">      <span class="title function_">fallback</span>(): <span class="title class_">VNode</span>[]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æºç æ³¨é‡Šé‡Œé¢è¯´</p><blockquote><p> ç›´æ¥åœ¨æ¸²æŸ“å™¨ä¸­ã€‚ æ¸²æŸ“å™¨æ£€æŸ¥ __isSuspense æ ‡å¿—<br> åœ¨ vnode çš„ç±»å‹ä¸Šå¹¶è°ƒç”¨ <code>process</code> æ–¹æ³•ï¼Œä¼ å…¥æ¸²æŸ“å™¨</p></blockquote><p>ä½†æ˜¯è¿™é‡Œæ˜æ˜æ˜¯ä¸€ä¸ª Object, æ²¡æœ‰æ£€æŸ¥ï¼Œäºæ˜¯æˆ‘åˆæŸ¥äº† process çš„å¼•ç”¨</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (__FEATURE_SUSPENSE__ &amp;&amp; shapeFlag &amp; <span class="title class_">ShapeFlags</span>.<span class="property">SUSPENSE</span>) &#123;</span><br><span class="line">    ;(<span class="keyword">type</span> <span class="keyword">as</span> <span class="keyword">typeof</span> <span class="title class_">SuspenseImpl</span>).<span class="title function_">process</span>(</span><br><span class="line">    n1,</span><br><span class="line">    n2,</span><br><span class="line">    container,</span><br><span class="line">    anchor,</span><br><span class="line">    parentComponent,</span><br><span class="line">    parentSuspense,</span><br><span class="line">    isSVG,</span><br><span class="line">    slotScopeIds,</span><br><span class="line">    optimized,</span><br><span class="line">    internals</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>FEATURE_SUSPENSE</strong> æ˜¯æŒ‡çš„æ˜¯å¼€å¯ suspense åŠŸèƒ½.</p><p><strong>mountSuspense</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountSuspense</span>(<span class="params"></span></span><br><span class="line"><span class="params">  vnode: VNode,</span></span><br><span class="line"><span class="params">  container: RendererElement,</span></span><br><span class="line"><span class="params">  anchor: RendererNode | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">  parentComponent: ComponentInternalInstance | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">  parentSuspense: SuspenseBoundary | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">  isSVG: <span class="built_in">boolean</span>,</span></span><br><span class="line"><span class="params">  slotScopeIds: <span class="built_in">string</span>[] | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">  optimized: <span class="built_in">boolean</span>,</span></span><br><span class="line"><span class="params">  rendererInternals: RendererInternals</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="attr">p</span>: patch,</span><br><span class="line">    <span class="attr">o</span>: &#123; createElement &#125;</span><br><span class="line">  &#125; = rendererInternals</span><br><span class="line">  <span class="keyword">const</span> hiddenContainer = <span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//è¿™ä¸ªå¯ä»¥è¯´æ˜¯æ ¸å¿ƒåˆ›å»ºæ–¹æ³•, è¿”å›ä¸€ä¸ª suspenseï¼Œåé¢æ“ä½œçš„æ ¸å¿ƒ</span></span><br><span class="line">  <span class="keyword">const</span> suspense = (vnode.<span class="property">suspense</span> = <span class="title function_">createSuspenseBoundary</span>(</span><br><span class="line">    vnode,</span><br><span class="line">    parentSuspense,</span><br><span class="line">    parentComponent,</span><br><span class="line">    container,</span><br><span class="line">    hiddenContainer,</span><br><span class="line">    anchor,</span><br><span class="line">    isSVG,</span><br><span class="line">    slotScopeIds,</span><br><span class="line">    optimized,</span><br><span class="line">    rendererInternals</span><br><span class="line">  ))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼€å§‹åœ¨ off-dom å®¹å™¨ä¸­æŒ‚è½½å†…å®¹å­æ ‘</span></span><br><span class="line">  <span class="comment">// start mounting the content subtree in an off-dom container</span></span><br><span class="line">  <span class="title function_">patch</span>(</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">    (suspense.<span class="property">pendingBranch</span> = vnode.<span class="property">ssContent</span>!),</span><br><span class="line">    hiddenContainer,</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">    parentComponent,</span><br><span class="line">    suspense,</span><br><span class="line">    isSVG,</span><br><span class="line">    slotScopeIds</span><br><span class="line">  )</span><br><span class="line">  <span class="comment">// ç°åœ¨æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦é‡åˆ°äº†ä»»ä½•å¼‚æ­¥ä¾èµ–</span></span><br><span class="line">  <span class="comment">// now check if we have encountered any async deps</span></span><br><span class="line">  <span class="keyword">if</span> (suspense.<span class="property">deps</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// has async</span></span><br><span class="line">    <span class="comment">// invoke @fallback event</span></span><br><span class="line">    <span class="title function_">triggerEvent</span>(vnode, <span class="string">&#x27;onPending&#x27;</span>)</span><br><span class="line">    <span class="title function_">triggerEvent</span>(vnode, <span class="string">&#x27;onFallback&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// mount the fallback tree</span></span><br><span class="line">    <span class="title function_">patch</span>(</span><br><span class="line">      <span class="literal">null</span>,</span><br><span class="line">      vnode.<span class="property">ssFallback</span>!,</span><br><span class="line">      container,</span><br><span class="line">      anchor,</span><br><span class="line">      parentComponent,</span><br><span class="line">      <span class="literal">null</span>, <span class="comment">// fallback tree will not have suspense context</span></span><br><span class="line">      isSVG,</span><br><span class="line">      slotScopeIds</span><br><span class="line">    )</span><br><span class="line">    <span class="title function_">setActiveBranch</span>(suspense, vnode.<span class="property">ssFallback</span>!)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Suspense has no async deps. Just resolve.</span></span><br><span class="line">    suspense.<span class="title function_">resolve</span>(<span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>createSuspenseBoundary</code></p><blockquote><p>åˆ›å»º suspense å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«äº† <Suspense> ç»„ä»¶çš„å„ç§å±æ€§å’Œæ–¹æ³•ã€‚<br>resolve æ–¹æ³•ç”¨äºå¤„ç†å¼‚æ­¥ç»„ä»¶åŠ è½½å®Œæˆåçš„æ“ä½œã€‚å®ƒä¼šæ ¹æ®åŠ è½½çŠ¶æ€å’Œé…ç½®æ¥ç§»åŠ¨æˆ–æ¸²æŸ“ç»„ä»¶å†…å®¹ï¼Œå¹¶è§¦å‘ç›¸å…³çš„äº‹ä»¶å’Œæ•ˆæœã€‚<br>fallback æ–¹æ³•ç”¨äºå¤„ç†å¼‚æ­¥ç»„ä»¶åŠ è½½è¿‡ç¨‹ä¸­çš„å›é€€ï¼ˆfallbackï¼‰æ“ä½œã€‚å®ƒä¼šæ ¹æ®é…ç½®æ¥æ¸²æŸ“å›é€€å†…å®¹ï¼Œå¹¶è§¦å‘ç›¸å…³çš„äº‹ä»¶ã€‚<br>move æ–¹æ³•ç”¨äºç§»åŠ¨å¼‚æ­¥ç»„ä»¶çš„ä½ç½®ã€‚<br>next æ–¹æ³•ç”¨äºè·å–å½“å‰æ´»è·ƒåˆ†æ”¯çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚<br>registerDep æ–¹æ³•ç”¨äºæ³¨å†Œå¼‚æ­¥ç»„ä»¶çš„ä¾èµ–ã€‚å½“å¼‚æ­¥ç»„ä»¶çš„ä¾èµ–å®ŒæˆåŠ è½½æ—¶ï¼Œä¼šè§¦å‘ç›¸åº”çš„å›è°ƒå¤„ç†ã€‚<br>unmount æ–¹æ³•ç”¨äºå¸è½½ <Suspense> ç»„ä»¶è¾¹ç•ŒåŠå…¶ç›¸å…³çš„ç»„ä»¶ã€‚</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup() is async. This component relies on async logic to be resolved</span></span><br><span class="line"><span class="comment">// before proceeding</span></span><br><span class="line"><span class="keyword">if</span> (__FEATURE_SUSPENSE__ &amp;&amp; instance.<span class="property">asyncDep</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™é‡Œå…¶å®å°±æ˜¯ asyncDepï¼Œå¤„ç† catch + then, å¤„ç†å‚æ•° setupRenderEffect(asyncResult) å¤„ç†é’©å­</span></span><br><span class="line">    parentSuspense &amp;&amp; parentSuspense.<span class="title function_">registerDep</span>(instance, setupRenderEffect)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Give it a placeholder if this is not hydration</span></span><br><span class="line">    <span class="comment">// TODO handle self-defined fallback</span></span><br><span class="line">    <span class="keyword">if</span> (!initialVNode.<span class="property">el</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> placeholder = (instance.<span class="property">subTree</span> = <span class="title function_">createVNode</span>(<span class="title class_">Comment</span>))</span><br><span class="line">        <span class="title function_">processCommentNode</span>(<span class="literal">null</span>, placeholder, container!, anchor)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé‡åˆ°å¼‚æ­¥ä»»åŠ¡ä¸ä¼šç«‹åˆ»æ‰§è¡Œï¼Œè€Œæ˜¯å¢åŠ  <code>Dep++</code>, ç„¶åé¢„ç•™ä½ç½®</p><p>ä¼šåœ¨å¸è½½æˆ–è€…è§£æå®Œæˆä»¥å <code>--</code></p><p>æ‰€ä»¥è¿™é‡Œçš„ dep å‡ºå¤„åœ¨è¿™é‡Œ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">registerDep</span>(<span class="params">instance, setupRenderEffect</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> isInPendingSuspense = !!suspense.<span class="property">pendingBranch</span></span><br><span class="line">    <span class="keyword">if</span> (isInPendingSuspense) &#123;</span><br><span class="line">    suspense.<span class="property">deps</span>++</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> hydratedEl = instance.<span class="property">vnode</span>.<span class="property">el</span></span><br><span class="line">    instance</span><br><span class="line">    .<span class="property">asyncDep</span>!.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">handleError</span>(err, instance, <span class="title class_">ErrorCodes</span>.<span class="property">SETUP_FUNCTION</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">asyncSetupResult</span> =&gt;</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure><p>äº‹ä»¶åœ¨ <code>handleError</code>, è§¦å‘ <code>onErrorCaptured</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// now check if we have encountered any async deps</span></span><br><span class="line"><span class="keyword">if</span> (suspense.<span class="property">deps</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="comment">// has async</span></span><br><span class="line">  <span class="comment">// invoke @fallback event</span></span><br><span class="line">  <span class="title function_">triggerEvent</span>(vnode, <span class="string">&#x27;onPending&#x27;</span>)</span><br><span class="line">  <span class="title function_">triggerEvent</span>(vnode, <span class="string">&#x27;onFallback&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// mount the fallback tree</span></span><br><span class="line">  <span class="title function_">patch</span>(</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">    vnode.<span class="property">ssFallback</span>!,</span><br><span class="line">    container,</span><br><span class="line">    anchor,</span><br><span class="line">    parentComponent,</span><br><span class="line">    <span class="literal">null</span>, <span class="comment">// fallback tree will not have suspense context</span></span><br><span class="line">    isSVG,</span><br><span class="line">    slotScopeIds</span><br><span class="line">  )</span><br><span class="line">  <span class="title function_">setActiveBranch</span>(suspense, vnode.<span class="property">ssFallback</span>!)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// Suspense has no async deps. Just resolve.</span></span><br><span class="line">  suspense.<span class="title function_">resolve</span>(<span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰å¼‚æ­¥ä»»åŠ¡ï¼ŒæŒ‚è½½ <code>fallback</code>ï¼Œä¹Ÿå°±æ˜¯ <code>loading</code> ä¹‹ç±»çš„, <code>setActiveBranch</code> æ˜¯æŠŠ <code>vnode.ssFallback</code> è®¾ç½®ä¸ºå½“å‰çš„, ç„¶åè§¦å‘ç”Ÿå‘½å‘¨æœŸ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">triggerEvent</span>(vnode, <span class="string">&#x27;onPending&#x27;</span>)</span><br><span class="line"><span class="title function_">triggerEvent</span>(vnode, <span class="string">&#x27;onFallback&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰ï¼Œç›´æ¥å®Œæˆã€‚<code>suspense.resolve(false, true)</code>, ä¹Ÿå°±ä¿è¯ä»–åœ¨æ‰€æœ‰å¼‚æ­¥å®Œå…¨æ‰§è¡Œå®Œæˆä»¥åæ‰§è¡Œã€‚</p><p>ä¸€æ—¦ <code>asyncDep</code> æ‰§è¡Œï¼Œå°±ä¼š -1ï¼Œ ç„¶å <code>resolve</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">resolve</span>(<span class="params">resume = <span class="literal">false</span>, sync = <span class="literal">false</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!resume &amp;&amp; !suspense.<span class="property">pendingBranch</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">            <span class="string">`suspense.resolve() is called without a pending branch.`</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (suspense.<span class="property">isUnmounted</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">            <span class="string">`suspense.resolve() is called on an already unmounted suspense boundary.`</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">        vnode,</span><br><span class="line">        activeBranch,</span><br><span class="line">        pendingBranch,</span><br><span class="line">        pendingId,</span><br><span class="line">        effects,</span><br><span class="line">        parentComponent,</span><br><span class="line">        container</span><br><span class="line">    &#125; = suspense</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (suspense.<span class="property">isHydrating</span>) &#123;</span><br><span class="line">        suspense.<span class="property">isHydrating</span> = <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!resume) &#123;</span><br><span class="line">        <span class="keyword">const</span> delayEnter =</span><br><span class="line">            activeBranch &amp;&amp;</span><br><span class="line">            pendingBranch!.<span class="property">transition</span> &amp;&amp;</span><br><span class="line">            pendingBranch!.<span class="property">transition</span>.<span class="property">mode</span> === <span class="string">&#x27;out-in&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> (delayEnter) &#123;</span><br><span class="line">        activeBranch!.<span class="property">transition</span>!.<span class="property">afterLeave</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (pendingId === suspense.<span class="property">pendingId</span>) &#123;</span><br><span class="line">                <span class="title function_">move</span>(pendingBranch!, container, anchor, <span class="title class_">MoveType</span>.<span class="property">ENTER</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// this is initial anchor on mount</span></span><br><span class="line">    <span class="keyword">let</span> &#123; anchor &#125; = suspense</span><br><span class="line">    <span class="comment">// unmount current active tree</span></span><br><span class="line">    <span class="keyword">if</span> (activeBranch) &#123;</span><br><span class="line">        <span class="comment">// if the fallback tree was mounted, it may have been moved</span></span><br><span class="line">        <span class="comment">// as part of a parent suspense. get the latest anchor for insertion</span></span><br><span class="line">        anchor = <span class="title function_">next</span>(activeBranch)</span><br><span class="line">        <span class="title function_">unmount</span>(activeBranch, parentComponent, suspense, <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!delayEnter) &#123;</span><br><span class="line">        <span class="comment">// move content from off-dom container to actual container</span></span><br><span class="line">        <span class="title function_">move</span>(pendingBranch!, container, anchor, <span class="title class_">MoveType</span>.<span class="property">ENTER</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setActiveBranch</span>(suspense, pendingBranch!)</span><br><span class="line">    suspense.<span class="property">pendingBranch</span> = <span class="literal">null</span></span><br><span class="line">    suspense.<span class="property">isInFallback</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// flush buffered effects</span></span><br><span class="line">    <span class="comment">// check if there is a pending parent suspense</span></span><br><span class="line">    <span class="keyword">let</span> parent = suspense.<span class="property">parent</span></span><br><span class="line">    <span class="keyword">let</span> hasUnresolvedAncestor = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">while</span> (parent) &#123;</span><br><span class="line">    <span class="keyword">if</span> (parent.<span class="property">pendingBranch</span>) &#123;</span><br><span class="line">        <span class="comment">// found a pending parent suspense, merge buffered post jobs</span></span><br><span class="line">        <span class="comment">// into that parent</span></span><br><span class="line">        parent.<span class="property">effects</span>.<span class="title function_">push</span>(...effects)</span><br><span class="line">        hasUnresolvedAncestor = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    parent = parent.<span class="property">parent</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// no pending parent suspense, flush all jobs</span></span><br><span class="line">    <span class="keyword">if</span> (!hasUnresolvedAncestor) &#123;</span><br><span class="line">    <span class="title function_">queuePostFlushCb</span>(effects)</span><br><span class="line">    &#125;</span><br><span class="line">    suspense.<span class="property">effects</span> = []</span><br><span class="line"></span><br><span class="line">    <span class="comment">// resolve parent suspense if all async deps are resolved</span></span><br><span class="line">    <span class="keyword">if</span> (isSuspensible) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        parentSuspense &amp;&amp;</span><br><span class="line">        parentSuspense.<span class="property">pendingBranch</span> &amp;&amp;</span><br><span class="line">        parentSuspenseId === parentSuspense.<span class="property">pendingId</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        parentSuspense.<span class="property">deps</span>--</span><br><span class="line">        <span class="keyword">if</span> (parentSuspense.<span class="property">deps</span> === <span class="number">0</span> &amp;&amp; !sync) &#123;</span><br><span class="line">        parentSuspense.<span class="title function_">resolve</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// invoke @resolve event</span></span><br><span class="line">    <span class="title function_">triggerEvent</span>(vnode, <span class="string">&#x27;onResolve&#x27;</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å°±æ˜¯å…¨éƒ¨åˆ›å»ºæµç¨‹ï¼Œæ›´æ–° activeBranch ä¸º defaultï¼Œ æŒ‚è½½ defaultï¼Œ åˆ é™¤ Fallback, ä¿®æ”¹å±æ€§ä¸ºé»˜è®¤å€¼ï¼Œå¤„ç†åµŒå¥—, ç„¶åè§¦å‘ï¼Œ</p><h3 id="08-æ€»ç»“"><a href="#08-æ€»ç»“" class="headerlink" title="08. æ€»ç»“"></a>08. æ€»ç»“</h3><p>ok, ç®€å•è¯´å°±æ˜¯ defineAsyncCom.. å•ä¸ªï¼Œ suspense å¤šä¸ªåŒæ—¶å¤„ç†ã€‚</p><p>suspenseï¼Œæœ‰ defalut å’Œ fallback ä¸¤ä¸ªæ’æ§½ï¼Œå¯ä»¥æä¾›3ä¸ªé’©å­ï¼Œ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">triggerEvent</span>(vnode, <span class="string">&#x27;onPending&#x27;</span>)</span><br><span class="line"><span class="title function_">triggerEvent</span>(vnode, <span class="string">&#x27;onFallback&#x27;</span>)</span><br></pre></td></tr></table></figure><p>åœ¨è¿›è¡Œå¼‚æ­¥ä¹‹å‰è§¦å‘ï¼Œä¸¤ä¸ªé’©å­å¯ä»¥è¯´åŒæ—¶è§¦å‘ï¼Œ <code>triggerEvent(vnode, &#39;onResolve&#39;)</code> åœ¨å®Œæˆä»¥åè§¦å‘ã€‚</p><p>defineAsyncComponent å¯ä»¥å•ä¸ªè¿›è¡Œå¼‚æ­¥ï¼Œä»–å°±æ˜¯ definedComponent å°è£….</p><ul><li><a href="https://cn.vuejs.org/api/general.html#defineasynccomponent">defineasynccomponent</a></li><li><a href="https://cn.vuejs.org/guide/components/async.html">å¼‚æ­¥ç»„ä»¶</a></li><li><a href="https://cn.vuejs.org/guide/built-ins/suspense.html">Suspense</a></li><li><a href="https://medium.com/i-am-mike/vue-3-vue3-%E7%9A%84%E6%96%B0%E5%8A%9F%E8%83%BD-suspense-428e02254030">Vue3 çš„æ–°åŠŸèƒ½ â€” Suspense</a></li><li><a href="https://juejin.cn/post/7044880716793905183#heading-9">Vue3 æ–°ç‰¹æ€§ Teleport Suspenseå®ç°åŸç†</a></li></ul></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> defineAsyncComponent </tag>
            
            <tag> Suspense </tag>
            
            <tag> æºç  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>type å’Œ interface åŒºåˆ«</title>
      <link href="/2023/07/03/ts_type_interface/"/>
      <url>/2023/07/03/ts_type_interface/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="1-ç»§æ‰¿"><a href="#1-ç»§æ‰¿" class="headerlink" title="1. ç»§æ‰¿"></a>1. ç»§æ‰¿</h3><p>interface å¯ä»¥é€šè¿‡ implements å®ç°ç»§æ‰¿ï¼Œç„¶è€Œ type ç†è®ºä¸Šä¸èƒ½ç»§æ‰¿ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">String</span>;</span><br><span class="line">    <span class="attr">sex</span>: <span class="title class_">Number</span>;</span><br><span class="line">    <span class="keyword">readonly</span> <span class="attr">id</span>: <span class="title class_">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Speak</span> &#123;</span><br><span class="line">    <span class="title function_">say</span>(<span class="attr">to</span>: <span class="built_in">number</span>): <span class="title class_">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> <span class="keyword">extends</span> <span class="title class_">Animal</span>, <span class="title class_">Speak</span> &#123; &#125;</span><br></pre></td></tr></table></figure><p><code>class</code> å°±å¯ä»¥ç»§æ‰¿ <code>interface</code> å–å®ç°æ–¹æ³•.</p><p>type æƒ³è¦ç»§æ‰¿ï¼Œå¯ä»¥é€šè¿‡äº¤å‰ç±»å‹å¯ä»¥å®ç°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Animal1</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">String</span>;</span><br><span class="line">    <span class="attr">sex</span>: <span class="title class_">Number</span>;</span><br><span class="line">    <span class="keyword">readonly</span> <span class="attr">id</span>: <span class="title class_">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Speak1</span> &#123;</span><br><span class="line">    <span class="title function_">say</span>(<span class="attr">to</span>: <span class="built_in">number</span>): <span class="title class_">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Person1</span> = <span class="title class_">Animal1</span> &amp; <span class="title class_">Speak1</span>;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥å®ç°ç›¸åŒæ•ˆæœ</p><h3 id="2-åˆå¹¶"><a href="#2-åˆå¹¶" class="headerlink" title="2. åˆå¹¶"></a>2. åˆå¹¶</h3><p>å¦‚æœä¸¤ä¸ªåŒåçš„ interface å¯ä»¥ç›´æ¥åˆå¹¶ï¼Œå¦‚æœé‡è§é‡åçš„å±æ€§ï¼Œä»¥åé¢çš„ä¸ºå‡†ï¼Œtype ä¸è¡Œï¼Œåªä¼šæŠ¥é”™ã€‚</p><p>type ä¸è¡Œï¼Œä»–ä¸èƒ½å®ç°è¿™ç§æ“ä½œã€‚</p><h3 id="3-æ³›å‹"><a href="#3-æ³›å‹" class="headerlink" title="3. æ³›å‹"></a>3. æ³›å‹</h3><p>æ¥å£å’Œç±»å‹éƒ½å¯ä»¥å®ç°æ³›å‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Box</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="attr">value</span>: T;</span><br><span class="line">    <span class="title function_">getInfo</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Box1</span>&lt;T&gt; = &#123;</span><br><span class="line">    <span class="attr">value</span>: T;</span><br><span class="line">    <span class="title function_">getInfo</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-è”åˆç±»å‹ï¼Œäº¤å‰ç±»å‹"><a href="#4-è”åˆç±»å‹ï¼Œäº¤å‰ç±»å‹" class="headerlink" title="4. è”åˆç±»å‹ï¼Œäº¤å‰ç±»å‹"></a>4. è”åˆç±»å‹ï¼Œäº¤å‰ç±»å‹</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyType</span> = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myVar</span>: <span class="title class_">MyType</span>;</span><br><span class="line">myVar = <span class="string">&quot;Hello&quot;</span>; <span class="comment">// ç±»å‹ä¸º string</span></span><br><span class="line">myVar = <span class="number">123</span>; <span class="comment">// ç±»å‹ä¸º number</span></span><br></pre></td></tr></table></figure><p>è”åˆç±»å‹å°±æ˜¯éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä¸è¿‡ interface ä¹Ÿå¯ä»¥</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IMyType</span> &#123;</span><br><span class="line">    <span class="attr">myType</span>:  <span class="built_in">string</span> | <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº¤å‰ç±»å‹ä¹Ÿä¸€æ ·ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Employee</span> = &#123;</span><br><span class="line">  <span class="attr">company</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">position</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">EmployeeWithPerson</span> = <span class="title class_">Person</span> &amp; <span class="title class_">Employee</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">employee</span>: <span class="title class_">EmployeeWithPerson</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line">  <span class="attr">company</span>: <span class="string">&quot;ABC Inc.&quot;</span>,</span><br><span class="line">  <span class="attr">position</span>: <span class="string">&quot;Manager&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IEmployeeWithPerson</span> &#123;</span><br><span class="line">    <span class="attr">company</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">position</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">employee</span>: <span class="title class_">IEmployeeWithPerson</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line">  <span class="attr">company</span>: <span class="string">&quot;ABC Inc.&quot;</span>,</span><br><span class="line">  <span class="attr">position</span>: <span class="string">&quot;Manager&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ•ˆæœç±»ä¼¼ï¼Œä½†æ˜¯æ˜æ˜¾ type æ›´çµæ´»ï¼Œå¯ä»¥éšæ„ç»„è£…ï¼Œä»»æ„åŠ è½½ã€‚</p><h3 id="5-å®šä¹‰æ•°ç»„é¡ºåº"><a href="#5-å®šä¹‰æ•°ç»„é¡ºåº" class="headerlink" title="5. å®šä¹‰æ•°ç»„é¡ºåº"></a>5. å®šä¹‰æ•°ç»„é¡ºåº</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> a &#123; <span class="title function_">a</span>(); &#125;</span><br><span class="line"><span class="keyword">interface</span> b &#123; <span class="title function_">b</span>(); &#125;</span><br><span class="line"><span class="keyword">type</span> list = [a, b];</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> c &#123;</span><br><span class="line">    <span class="attr">c</span>: [a, b]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-typeof"><a href="#6-typeof" class="headerlink" title="6. typeof"></a>6. typeof</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> element = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;testA&#x27;</span>);</span><br><span class="line"><span class="keyword">type</span> d = <span class="keyword">typeof</span> element; <span class="comment">//htmlElement || null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> d1 &#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="keyword">typeof</span> element</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h3><p>å…¶å®ä¸»è¦åŒºåˆ«åœ¨äºç»§æ‰¿ä¸Šï¼Œè¿˜æœ‰æ¥å£åˆå¹¶ä¸Šã€‚</p><p>ç†è®ºä¸Š type èƒ½å¤Ÿå®ç°çš„ interface éƒ½å¯ä»¥å®ç°ï¼Œå·®åˆ«åªæ˜¯åœ¨äº</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> a &#123;</span><br><span class="line">    <span class="attr">b</span>: ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> b = ...</span><br></pre></td></tr></table></figure><p>ä»ç»§æ‰¿ä¸Šæ¥è¯´ï¼Œä¸€ä¸ªæ˜¯ extends implements ç»§æ‰¿ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡è”åˆç±»å‹ï¼Œäº¤å‰ç±»å‹å®ç°ï¼Œæ–¹æ³•ä¸ä¸€æ ·ï¼Œä½†æ˜¯å¯ä»¥å®ç°ç›¸åŒæ•ˆæœã€‚</p><p>interface å¯ä»¥ä½¿ç”¨åˆå¹¶ï¼Œ type å…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨äº¤å‰ç±»å‹æ¥è§£å†³é—®é¢˜ã€‚</p><p>å…¶å®æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œinterface éœ€è¦å¤–é¢åŒ…ä¸€ä¸ªå£³å­ï¼Œä¹Ÿå°±æ˜¯åˆå§‹ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯ type å¯ä»¥ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç±»å‹å­˜åœ¨, ä¹Ÿå°±æ˜¯ç±»å‹ã€‚</p><p>æœŸé—´ï¼Œä¸ç®¡æ˜¯ä½¿ç”¨ å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹æ¨¡æ¿ï¼Œè¿˜æ˜¯æ˜ å°„ç±»å‹ï¼Œè¿˜æ˜¯ typofï¼Œæ¡ä»¶ç±»å‹ ç­‰ç­‰æ–¹å¼ï¼Œè™½ç„¶ä¸èƒ½ç›´æ¥å¯¹ interface ä½¿ç”¨ï¼Œä½†æ˜¯å¯ä»¥å¯¹ interface ä¸‹é¢çš„å±æ€§ä½¿ç”¨ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> typescript </tag>
            
            <tag> type </tag>
            
            <tag> interface </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>typescript åŸºç¡€ç‚¹</title>
      <link href="/2023/07/03/ts_baseTypescript/"/>
      <url>/2023/07/03/ts_baseTypescript/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h2 id="01-ç±»å‹"><a href="#01-ç±»å‹" class="headerlink" title="01. ç±»å‹"></a>01. ç±»å‹</h2><p>Number, Tuple, String, Enum, Any, Void, Null, Undefined, Never, Object, Boolean, Symbol</p><p>éœ€è¦è¯´ä¸€è¯´çš„åªæ˜¯ Tuple, Never, Void</p><p><strong>Tuple</strong></p><blockquote><p>Tuple å…ƒç»„ç±»å‹å…è®¸è¡¨ç¤ºä¸€ä¸ªå·²çŸ¥å…ƒç´ æ•°é‡å’Œç±»å‹çš„æ•°ç»„<br>å½“è®¿é—®ä¸€ä¸ªè¶Šç•Œçš„å…ƒç´ ï¼Œä¼šä½¿ç”¨è”åˆç±»å‹æ›¿ä»£</p></blockquote><p>let x:[string, number] &#x3D; [â€œ1â€, 1];</p><p>x[3] &#x3D; â€œ1â€; &#x2F;&#x2F;è”åˆç±»å‹æ›¿ [String | Number]</p><p><strong>Never &amp; Void</strong></p><p>Never è¡¨ç¤ºæ²¡æœ‰ä»»ä½•è¿”å›å€¼<br>Void Null || undefined</p><h2 id="02-å˜é‡å£°æ˜"><a href="#02-å˜é‡å£°æ˜" class="headerlink" title="02. å˜é‡å£°æ˜"></a>02. å˜é‡å£°æ˜</h2><p>const let var ä½œç”¨åŸŸå’ŒES6ç›¸åŒï¼Œåˆ«ç”¨varå°±è¡Œäº†ã€‚<br>readonly const ä¸€ä¸ªæ˜¯ä¿®é¥°ç¬¦ï¼Œä¸€ä¸ªå£°æ˜å˜é‡<br>readonly ä¸»è¦ç”¨äºæ¥å£ï¼Œç±»ï¼Œå¹¶ä¸”å¯ä»¥ä¸ç”¨åœ¨å£°æ˜çš„æ—¶å€™åˆå§‹åŒ–ï¼Œç¬¬ä¸€æ¬¡èµ‹å€¼åä¸èƒ½å†èµ‹å€¼<br>const å¿…é¡»åˆå§‹åŒ–çš„æ—¶å€™èµ‹å€¼ã€‚</p><h2 id="03-interface"><a href="#03-interface" class="headerlink" title="03. interface"></a>03. interface</h2><p>å’Œ C# java å·®ä¸å¤šï¼Œç”¨äºç±»å®šä¹‰ï¼ŒObjectå®šä¹‰ã€‚<br>éœ€è¦æ³¨æ„ implementså’Œextends å·®åˆ«</p><p>implements æ¥å£<br>extends ç±»ï¼ŒæŠ½è±¡ç±»</p><p>ä»è¯­ä¹‰ä¸Šä¹Ÿå¯ä»¥åŒºåˆ†ï¼Œå¯ä»¥æ··åˆç»§æ‰¿</p><ol><li>åªè¯»å±æ€§ readonly å±æ€§</li><li>å¯é€‰å±æ€§ ?</li><li>ç´¢å¼•ç­¾å [index: string]: { message: string }; å¯ä»¥ç›´æ¥åœ¨å˜é‡å£°æ˜,ä¹Ÿå¯ä»¥ä¹‹é—´è¯¶æ¥åœ¨å˜é‡åé¢</li><li>å‡½æ•°å±æ€§ (param1: type, param2: type): boolean</li><li>ç±»ç±»å‹</li><li>å¤šç»§æ‰¿</li></ol><h2 id="04-class"><a href="#04-class" class="headerlink" title="04. class"></a>04. class</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class a &#123;</span><br><span class="line">constructor() &#123;&#125;</span><br><span class="line">private func() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®é¥°ç¬¦</p><ol><li>public å…±æœ‰</li><li>protected å†…éƒ¨è®¿é—®</li><li>readonly å±æ€§åªè¯»</li><li>private ç§æœ‰</li><li>getters&#x2F;setters è¯»å–å™¨</li><li>static é™æ€å±æ€§ï¼Œé™æ€ç±»</li><li>abstract æŠ½è±¡ç±»</li></ol><p>æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«éœ€è¦æ³¨æ„çš„ï¼Œå¦‚æœä½ æœ‰åç«¯è¯­è¨€ç»éªŒçš„è¯ï¼ŒåŸºæœ¬ä¸€è‡´ã€‚</p><p>éçš„è¯´ä¸€ä¸‹å°±æ˜¯ static ä½¿ç”¨ã€‚<br>ï¼Œ</p><blockquote><p>åœ¨å†…å­˜çº§åˆ«ï¼Œå°†ä¸ºé™æ€å­—æ®µåˆ›å»ºä¸€éƒ¨åˆ†å†…å­˜ï¼Œè¿™äº›å­—æ®µå°†åœ¨ç±»ä¸­çš„æ‰€æœ‰å¯¹è±¡ä¹‹é—´å…±äº«ã€‚</p></blockquote><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ï¼Ÿ<br>å…³é”®åœ¨äºçŠ¶æ€ï¼Œä¸å»ºè®®åœ¨ static å½“ä¸­ä¿å­˜çŠ¶æ€ï¼Œå¯èƒ½ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œæ›´å¤šçš„ç”¨å¤„åœ¨äºåœ¨é™ä½è€¦åˆï¼Œåˆ›å»ºæ— å‰¯ä½œç”¨ä»£ç ã€‚<br>æ¯”å¦‚è¯´æ•°æ®è·å–ï¼Œæ¯”å¦‚å¯ä»¥æå–å‡ºçš„å…¬å…±æ“ä½œï¼Œè¿”å›å…¬å…±çŠ¶æ€ï¼Œæ€»ä¹‹å°±æ˜¯æœ‰æŠ½è±¡ä»·å€¼ï¼Œå¯¹äºå…¨å±€æœ‰ä½œç”¨çš„å‡½æ•°æˆ–è€…å±æ€§ã€‚</p><h2 id="05-Function"><a href="#05-Function" class="headerlink" title="05. Function"></a>05. Function</h2><p>åŸºæœ¬å·®ä¸å¤šï¼Œé»˜è®¤å€¼ï¼Œè§£æ„ï¼Œ<code>...a: string[]</code>. éœ€è¦æ³¨æ„çš„æ˜¯é‡è½½é—®é¢˜ï¼Œæ”¯æŒé‡è½½ä¸éœ€è¦å†ä½¿ç”¨ <code>typeof</code>.</p><h2 id="06-æ³›å‹"><a href="#06-æ³›å‹" class="headerlink" title="06. æ³›å‹"></a>06. æ³›å‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class GenericNumber&lt;T&gt; &#123;</span><br><span class="line">    zeroValue: T;</span><br><span class="line">    add: (x: T, y: T) =&gt; T;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>function ä¹Ÿå¯ä»¥ä½¿ç”¨æ³›å‹ï¼Œæ€»ä¹‹æ˜¯åœ¨æŠ½è±¡åŒä¸€ç±»å‹çš„å¯¹è±¡çš„æ—¶å€™ï¼ŒèŠ‚çº¦ä»£ç ç”¨çš„ã€‚</p><p>æ¯”å¦‚éƒ½æ˜¯æ‰‹æœº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">abstract class phoneAbs &#123;</span><br><span class="line">call() &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">abstract sms(number);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class class oldPhone&lt;T: IOldPhone&gt; extends phoneAbs &#123;</span><br><span class="line">sms(number) &#123; T.sendSMS(number) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Tä¹Ÿå¯ä»¥ extendsï¼Œä¸è¿‡è®°ä½è¿™é‡Œæ˜¯çº¦æŸ</p><h2 id="07-ç±»å‹æ¨æ–­"><a href="#07-ç±»å‹æ¨æ–­" class="headerlink" title="07. ç±»å‹æ¨æ–­"></a>07. ç±»å‹æ¨æ–­</h2><p>ç®€å•å˜é‡ä½¿ç”¨okï¼Œå› ä¸ºä¸Šä¸‹æ–‡é—®é¢˜ï¼Œå¤æ‚æƒ…å†µå¯èƒ½æ¨æ–­ä¸å‡ºï¼Œæ¯”å¦‚è‡ªå®šä¹‰ç±»å‹</p><h2 id="08-é«˜çº§ç±»å‹"><a href="#08-é«˜çº§ç±»å‹" class="headerlink" title="08. é«˜çº§ç±»å‹"></a>08. é«˜çº§ç±»å‹</h2><p>äº¤å‰ç±»å‹ï¼ˆIntersection Typesï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">interface Ant &#123;</span><br><span class="line">    name: string;</span><br><span class="line">    weight: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Fly &#123;</span><br><span class="line">    flyHeight: number;</span><br><span class="line">    speed: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å°‘äº†ä»»ä½•ä¸€ä¸ªå±æ€§éƒ½ä¼šæŠ¥é”™</span><br><span class="line">const flyAnt: Ant &amp; Fly = &#123;</span><br><span class="line">    name: &#x27;èš‚èšå‘€å˜¿&#x27;,</span><br><span class="line">    weight: 0.2,</span><br><span class="line">    flyHeight: 20,</span><br><span class="line">    speed: 1,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è”åˆç±»å‹ï¼ˆUnion Typesï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let a: string | number;</span><br></pre></td></tr></table></figure><p>ä»»æ„ä¸€ä¸ªéƒ½ok, ä½†æ˜¯è”åˆç±»å‹ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œæ— æ³•æ¨æ–­å‡º a ç©¶ç«Ÿæ˜¯ String or Number</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">interface Bird &#123;</span><br><span class="line">    fly();</span><br><span class="line">    layEggs();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Fish &#123;</span><br><span class="line">    swim();</span><br><span class="line">    layEggs();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getSmallPet(): Fish | Bird &#123;</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let pet = getSmallPet();</span><br><span class="line">pet.layEggs(); // okay</span><br><span class="line">pet.swim();  </span><br></pre></td></tr></table></figure><p>æ— æ³•æ¨å¯¼å‡ºç©¶ç«Ÿæ˜¯ <code>Fish</code> è¿˜æ˜¯ <code>Bird</code>, æ‰€ä»¥éœ€è¦åˆ¤æ–­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let pet = getSmallPet();</span><br><span class="line">if(&lt;Fish&gt;pet.swim) ...</span><br><span class="line">else &lt;Bird&gt;pet.layEggs();</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™éœ€è¦åˆ¤æ–­ç±»å‹.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">if(&lt;Fish&gt;pet.swim) ... //å¯ä»¥ç›´æ¥åˆ¤æ–­</span><br><span class="line"></span><br><span class="line">if(pet instanceof Fish) ... </span><br><span class="line"></span><br><span class="line">function isFish(target): target is Fish  &#123;</span><br><span class="line">//åˆ¤æ–­</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//é€šè¿‡æ³›å‹ç¡®å®šæ–¹æ³•</span><br><span class="line">function isOfType&lt;T&gt;(</span><br><span class="line">  target: unknown,</span><br><span class="line">  prop: keyof T</span><br><span class="line">): target is T &#123;</span><br><span class="line">  return (target as T)[prop] !== undefined;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥è¿›è¡Œåˆ¤æ–­</p><h2 id="09-type-ç±»å‹åˆ«å"><a href="#09-type-ç±»å‹åˆ«å" class="headerlink" title="09. type ç±»å‹åˆ«å"></a>09. type ç±»å‹åˆ«å</h2><p>ç±»å‹åˆ«åæœ‰ç‚¹ç±»ä¼¼äº <code>interface</code></p><blockquote><p>ç±»å‹åˆ«åä¼šç»™ä¸€ä¸ªç±»å‹èµ·ä¸ªæ–°åå­—ã€‚ ç±»å‹åˆ«åæœ‰æ—¶å’Œæ¥å£å¾ˆåƒï¼Œä½†æ˜¯å¯ä»¥ä½œç”¨äºåŸå§‹å€¼ï¼Œè”åˆç±»å‹ï¼Œå…ƒç»„ä»¥åŠå…¶å®ƒä»»ä½•ä½ éœ€è¦æ‰‹å†™çš„ç±»å‹ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type name = string;</span><br><span class="line">function getName(): name &#123; ... &#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ <code>name</code> å°±æ˜¯ <code>string</code>, è¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›è«åå…¶å¦™çš„ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">type user&lt;T&gt; = &#123;</span><br><span class="line">name: string;</span><br><span class="line">sex: enmu;</span><br><span class="line">age: number;</span><br><span class="line">m: T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type user&lt;T&gt; = T &amp; string;</span><br><span class="line">type user&lt;T&gt; = T &amp; &#123; name: string, sex: emum &#125;</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥éƒ½å’Œæ¥å£å¾ˆåƒ,ä½¿ç”¨æ–¹å¼ä¹Ÿå¾ˆåƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type name = string;</span><br><span class="line">let haha: name;</span><br><span class="line">function b(user: name): name &#123; return &quot;&quot; &#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆ type ç©¶ç«Ÿå¯ä»¥åšä»€ä¹ˆ.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type Container&lt;T&gt; = &#123; value: T &#125;; //èŒƒå‹</span><br><span class="line">type TreeNode&lt;T&gt; = &#123;</span><br><span class="line">left: TreeNode&lt;T&gt;;</span><br><span class="line">right: TreeNode&lt;T&gt;</span><br><span class="line">&#125; //è‡ªå·±è°ƒç”¨è‡ªå·±</span><br><span class="line">type ä½¿ç”¨é«˜çº§ç±»å‹, &amp; or | , å°±å¯ä»¥å®ç°è”åˆç»§æ‰¿.</span><br><span class="line">type a = (x: number, y: number) =&gt; number</span><br><span class="line">type b = &#x27;a&#x27; | &#x27;b&#x27; | &#x27;c&#x27;</span><br></pre></td></tr></table></figure><p>åŒºåˆ«</p><p>1.type å¯ä»¥å£°æ˜åŸºæœ¬ç±»å‹åˆ«åï¼Œè”åˆç±»å‹ï¼Œå…ƒç»„ç­‰ç±»å‹, ä½†æ˜¯ interface å…¶å®ä¹Ÿå¯ä»¥,åªæ˜¯ä¸èƒ½åƒ type é‚£æ ·å£°æ˜ä¸€ä¸ªå˜é‡.<br>2. type å¯ä»¥ç”¨ typeof è·å–å®ä¾‹<br>3. interfaceå¯ä»¥åˆå¹¶å£°æ˜, ä¸¤ä¸ª interface User å°±è‡ªå·±åˆå¹¶äº†<br>4. è€Œä¸”ä»è¯­ä¹‰ä¸Šæ¥è¯´ï¼Œinterface åº”è¯¥æ›´åŠ ååŠŸèƒ½æ€§ï¼Œtype æ›´åŠ åç±»å‹</p><h2 id="10-keyof-æ³›å‹æ–¹æ³•"><a href="#10-keyof-æ³›å‹æ–¹æ³•" class="headerlink" title="10. keyof æ³›å‹æ–¹æ³•"></a>10. keyof æ³›å‹æ–¹æ³•</h2><h2 id="11-ç±»å‹ç´¢å¼•"><a href="#11-ç±»å‹ç´¢å¼•" class="headerlink" title="11. ç±»å‹ç´¢å¼•"></a>11. ç±»å‹ç´¢å¼•</h2><h2 id="12-å‡½æ•°å±æ€§"><a href="#12-å‡½æ•°å±æ€§" class="headerlink" title="12. å‡½æ•°å±æ€§"></a>12. å‡½æ•°å±æ€§</h2><h2 id="13-Symbol"><a href="#13-Symbol" class="headerlink" title="13. Symbol"></a>13. Symbol</h2><p>å’Œ javascript symbol æ²¡åŒºåˆ«</p><h2 id="14-æ¨¡å—"><a href="#14-æ¨¡å—" class="headerlink" title="14. æ¨¡å—"></a>14. æ¨¡å—</h2><p>å¤ªå¤šç»†èŠ‚äº†ï¼Œè¿™ä¸ªéœ€è¦ä¸“é—¨å†™ä¸€ç¯‡ã€‚</p><h2 id="15-å‘½åç©ºé—´"><a href="#15-å‘½åç©ºé—´" class="headerlink" title="15. å‘½åç©ºé—´"></a>15. å‘½åç©ºé—´</h2><p>å…¶å®å°±æ˜¯æ•´åˆä¸€ä¸ªç±»å‹çš„ç±»æˆ–è€…ç±»å‹ç»Ÿä¸€åœ¨ä¸€ä¸ªå‘½åç©ºé—´ä¸‹ï¼Œæœ‰ç‚¹ç±»ä¼¼ä¹‹å‰ C# partï¼Œå¯ä»¥åœ¨å¤šä¸ªä¸åŒçš„æ–‡ä»¶ä¸‹ã€‚</p><h2 id="16-å£°æ˜åˆå¹¶"><a href="#16-å£°æ˜åˆå¹¶" class="headerlink" title="16. å£°æ˜åˆå¹¶"></a>16. å£°æ˜åˆå¹¶</h2><p>Namespace, Class, Enum, Interface, type Alias, Function, Variable<br>è¦åˆå¹¶å¿…é¡»è¦çŸ¥é“ä»–çš„æ€ä¹ˆç”Ÿæˆçš„ï¼Œæ‰€ä»¥ç®€å•å†™ä¸€ä¸‹ï¼Œtsc ç¼–è¯‘ä¸€ä¸‹å°±okäº†ã€‚<br>æœ€ç»å…¸çš„æ˜¯ Namespace</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var user;</span><br><span class="line">(function() &#123; ... &#125;)(user || (user = &#123;&#125;))</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆä»–çš„åˆå¹¶å°±æ¯”è¾ƒå¥½è¯´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let LogName = &quot;test&quot;;</span><br><span class="line">namespace logName &#123;</span><br><span class="line">export const name = &quot;Namespace name&quot;</span><br><span class="line">&#125;</span><br><span class="line">console.log(logName)</span><br><span class="line"></span><br><span class="line">var LogName = &quot;test&quot;;</span><br><span class="line">var logName;</span><br><span class="line">(function (logName) &#123;</span><br><span class="line">    logName.name = &quot;Namespace name&quot;;</span><br><span class="line">&#125;)(logName || (logName = &#123;&#125;));</span><br><span class="line">console.log(logName);</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆä»–çš„å…ˆåé¡ºåºä¹Ÿä¼šå¯¹ç¼–è¯‘äº§ç”Ÿå½±å“.<br>è¿™ç§åˆå¹¶æœ€å¥½è¿˜æ˜¯ç‹¬ç«‹èµ·åï¼Œåªæ˜¯ç›¸åŒçš„å£°æ˜ï¼Œæ¯”å¦‚ namespace å†é‡‡å–åˆå¹¶çš„æ–¹å¼ã€‚</p><h2 id="link"><a href="#link" class="headerlink" title="link"></a>link</h2><p><a href="https://typescript.bootcss.com/basic-types.html">https://typescript.bootcss.com/basic-types.html</a><br><a href="https://www.jianshu.com/p/57df3cb66d3d">https://www.jianshu.com/p/57df3cb66d3d</a><br><a href="https://zhuanlan.zhihu.com/p/365973520">https://zhuanlan.zhihu.com/p/365973520</a><br><a href="https://zhuanlan.zhihu.com/p/568705587">https://zhuanlan.zhihu.com/p/568705587</a><br><a href="https://jkchao.github.io/typescript-book-chinese/typings/indexSignatures.html">https://jkchao.github.io/typescript-book-chinese/typings/indexSignatures.html</a></p></div>]]></content>
      
      
      
        <tags>
            
            <tag> typescript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ³›å‹</title>
      <link href="/2023/07/03/ts_Generics/"/>
      <url>/2023/07/03/ts_Generics/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>å®˜ç½‘è¿™ä¸€ç« ä»æœ€å¼€å§‹çš„æ³›å‹åŸºæœ¬è¯­æ³•è®²èµ·ï¼Œç„¶åé€šè¿‡ keyofï¼Œ typeofï¼ŒReturonType ç­‰æ–¹å¼æ¥ç±»å‹ï¼Œæ›´æ–¹ä¾¿çš„åˆ›å»ºç±»å‹ï¼Œåªæ˜¯åé¢ç©çš„å¤ªèŠ±äº†ï¼Œæˆ‘ç¡®å®æƒ³ä¸åˆ°è¿™ä¹ˆå¤šç©æ³•æœ‰ä»€ä¹ˆåº”ç”¨ç±»å‹ï¼Œå¯èƒ½åç»­ typescript ç”¨çš„å¤šäº†ä»¥åå†æ¥å¤ä¹ å§ã€‚</p><h3 id="01-Generics-æ³›å‹"><a href="#01-Generics-æ³›å‹" class="headerlink" title="01. Generics æ³›å‹"></a>01. Generics æ³›å‹</h3><p>æ³›å‹æœ€åŸºç¡€çš„å°±æ˜¯ function or class çš„å½¢å˜ï¼Œä¸»è¦ç”¨äºç›¸åŒé€»è¾‘ï¼Œç›¸åŒçš„æ¥å£çš„æŠ½è±¡ã€‚</p><hr><blockquote><p>åœ¨åƒ C# å’Œ Java è¿™æ ·çš„è¯­è¨€ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ³›å‹æ¥åˆ›å»ºå¯é‡ç”¨çš„ç»„ä»¶ï¼Œä¸€ä¸ªç»„ä»¶å¯ä»¥æ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ã€‚ è¿™æ ·ç”¨æˆ·å°±å¯ä»¥ä»¥è‡ªå·±çš„æ•°æ®ç±»å‹æ¥ä½¿ç”¨ç»„ä»¶ã€‚</p></blockquote><p>è¯­æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯å¢åŠ ä¸€ä¸ªä»»æ„ç±»å‹çš„ <code>T</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function log&lt;T&gt;(arg:T) ****:T &#123; return arg &#125;</span><br><span class="line">class log&lt;T extends Ilogs&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼•å…¥ä¸€ä¸ªæ³›å‹ï¼Œåœ¨å£°æ˜çš„æ—¶å€™å¯ä»¥ä¼ å…¥å¯¹åº”æƒ³è¦çš„ç±»å‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log&lt;string&gt;(&quot;&quot;);</span><br><span class="line">new log&lt;testLog&gt;();</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå­—æ˜¯ä»€ä¹ˆä¸é‡è¦ï¼Œä¸»è¦æ˜¯è¡¨è¾¾è¿™ä¸ªæ³›å‹çš„æ„æ€</p><ol><li>T &#x3D; Type</li><li>K &#x3D; Key</li><li>V &#x3D; Value</li><li>E &#x3D; Element</li></ol><p>ç†è®ºä¸Šä½ ç”¨ <code>B</code> ä¹Ÿå¯ä»¥ï¼Œé‡è¦çš„æ˜¯ä»–çš„æ„ä¹‰ï¼Œä½ éœ€è¦ä¼ é€’ä»€ä¹ˆï¼Œç”¨ä»€ä¹ˆä¸ºåŸºç¡€æ¥é‡ç”¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function log&lt;T&gt;(arg: T):T &#123; return arg &#125;;</span><br></pre></td></tr></table></figure><p>ä»–çš„æ ¸å¿ƒå°±åœ¨äºä¼ é€’ç±»å‹ï¼Œä»¥åŠä½ éœ€è¦ <code>function</code> é‡Œé¢å†™ä»€ä¹ˆä»£ç è¿›è¡Œå¤ç”¨ã€‚</p><p>è¿™å°±æ˜¯æœ€åŸºç¡€çš„è¯­æ³•ï¼Œåç»­å¯ä»¥æœ‰å¾ˆå¤šå˜ç§ï¼Œè¿™ç§æ˜¯æœ€åŸºç¡€çš„ç”¨æ³•</p><p>interface, type éƒ½å¯ä»¥ä½¿ç”¨æ³›å‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type a&lt;T&gt; = T &amp; string;</span><br><span class="line">interface ITree&lt;T&gt; &#123;</span><br><span class="line">    value: Object</span><br><span class="line">    parent:T</span><br><span class="line">    child: T[]</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå°±å¯ä»¥å’Œæ³›å‹ç±»è¿›è¡Œè”åŠ¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class tree&lt;T&gt; extends ITree&lt;T&gt; &#123;</span><br><span class="line">    root: T;</span><br><span class="line">    constructor() &#123;&#125;</span><br><span class="line">    create: function(tree: T[]) &#123;</span><br><span class="line">        /...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªè·Ÿæ ‘ç›¸å…³çš„æ³›å‹ç±»ï¼Œ<code>ITree</code> å°±å¯ä»¥ä¸€ä¸ªåŸºç¡€æ³›å‹æ ‘å‹æ¥å£ã€‚</p><h3 id="02-çº¦æŸ"><a href="#02-çº¦æŸ" class="headerlink" title="02. çº¦æŸ"></a>02. çº¦æŸ</h3><p>ä»å¼€å¤´åˆ°ç°åœ¨ï¼Œæ³›å‹æ˜¯ä¸€ä¸ªä»»æ„ç±»å‹ï¼Œè‡ªç„¶å¯ä»¥å¢åŠ çº¦æŸã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function A&lt;T extends ITree&gt;(arg: T): void &#123;</span><br><span class="line">    //...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ extends ä½ å…¶å®å¯ä»¥ç†è§£ä¸ºä¸€ç§ç»§æ‰¿ï¼Œä½†æ˜¯åªèƒ½å¼•ç”¨ç»§æ‰¿åˆ°çš„æ¥å£æˆ–è€…ç±»å‹ï¼Œæ¢ä¸€ç§è¯´æ³•å°±æ˜¯ä¸€ç§çº¦æŸã€‚</p><p>å¥½å¤„å°±æ˜¯ï¼Œå¯ä»¥ä»ä»»æ„ç±»å‹åˆ°æŒ‡å®šä¸€ä¸ªèŒƒå›´ï¼Œæ¯”å¦‚åˆšæ‰çº¦æŸä¸º <code>ITree</code> çš„ä¾‹å­ï¼Œå°±å¯ä»¥ç¡®å®š <code>arg</code> ç±»å‹ä¸€å®šåŒ…å« <code>ITree</code> çš„æ¥å£ï¼Œäºæ˜¯å¯ä»¥è°ƒç”¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function A&lt;T extends string&gt;(arg: T) &#123;</span><br><span class="line">    return arg.length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="03-keyof"><a href="#03-keyof" class="headerlink" title="03. keyof"></a>03. keyof</h3><p>å…¶å®ä¸Šä»£ç æœ€å¥½ç†è§£è¿™ä¸ªä¸œè¥¿çš„ç”¨æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">interface User &#123;</span><br><span class="line">    name: string,</span><br><span class="line">    age: number,</span><br><span class="line">    sex: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type K1 = keyof User;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª <code>keyof User</code> å…¶å®ç›¸å½“äº <code>type K1 = name | age | sex</code>, å¹¶ä¸”å€¼æ˜¯ <code>key</code> çš„å€¼ã€‚</p><p>ä»–æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let user: User = &#123; ... &#125;;</span><br><span class="line">function getUserItem&lt;T extends keyof User&gt;(arg: T) &#123;</span><br><span class="line">    return user[arg];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getUserItem(arg) &#123;</span><br><span class="line">    if(arg === &quot;name&quot; || arg === &quot;age&quot; || arg === &quot;sex&quot;) return user[arg];</span><br><span class="line">    else return ...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªå°±æ˜¯å·®åˆ«ã€‚</p><h3 id="04-typeof-amp-ReturnType"><a href="#04-typeof-amp-ReturnType" class="headerlink" title="04. typeof &amp; ReturnType"></a>04. typeof &amp; ReturnType</h3><p>ä¸€èˆ¬æ¥è¯´ <code>typeof</code> å°±æ˜¯è¿”å›åŸå§‹ç±»å‹çš„, ä½†æ˜¯åœ¨ typescript é‡Œæœ‰ä¸ä¸€æ ·çš„ç”¨å¤„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let O = &#123;</span><br><span class="line">  a: 1,</span><br><span class="line">  b: 2,</span><br><span class="line">  c: 3,</span><br><span class="line">&#125;;</span><br><span class="line">type A3 = typeof O; // &#123; a:1, b:2, c:3 &#125;</span><br><span class="line">type A4 = typeof O[&quot;a&quot;]; //string</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ˜¯åŸºç¡€ç±»å‹ï¼Œç›´æ¥è¿”å›ã€‚</p><p>å¦‚æœæ˜¯å¤æ‚ç±»å‹ï¼Œç›´æ¥è¿”å›ç±»å‹æœ¬èº«</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>):<span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">F1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;tommy&quot;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="string">&quot;99&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T3</span> = <span class="keyword">typeof</span> F;</span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T4</span> = <span class="keyword">typeof</span> <span class="variable constant_">F1</span>;</span><br></pre></td></tr></table></figure><p><a href="https://www.typescriptlang.org/play#code/GYVwdgxgLglg9mABAMQBQEoBcBnKAnGMAc0QG8AoRKxPAUyhDyQCJmBucgX3PNElgQoAjBjKVqdBkzHVZiMAEMAtrUyJmUOEqUBPZgBpxcxAqKr1ATgvMjibt3JQdAB1qIAKgGZEAXkRPXOGAUDgC3dwAWX38XWiDhNiA">Playground Link</a></p><p>é‚£ä¹ˆå¦‚æœéœ€è¦è·å–è¿”å›å€¼çš„ç±»å‹å¦‚ä½•è§£å†³ï¼Ÿ</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>):<span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">F1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;tommy&quot;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="string">&quot;99&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T5</span> = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> F&gt;;</span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T6</span> = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> <span class="variable constant_">F1</span>&gt;;</span><br></pre></td></tr></table></figure><p><a href="https://www.typescriptlang.org/play?ssl=13&ssc=33&pln=12&pc=32#code/GYVwdgxgLglg9mABAMQBQEoBcBnKAnGMAc0QG8AoRKxPAUyhDyQCJmBucgX3PNElgQoAjBjKVqdBkzHVZiMAEMAtrUyJmUOEqUBPZgBpxcxAqKr1ATgvMjibjyg6ADrUQAVAKyIAvIgBK9Ixgbs60ADyOLnDAKAB8HJGubgBsPv6BTCEuEaHRwvFAA">Playground Link</a></p><h3 id="05-Indexed-Access-Types-ç´¢å¼•è®¿é—®ç±»å‹"><a href="#05-Indexed-Access-Types-ç´¢å¼•è®¿é—®ç±»å‹" class="headerlink" title="05. Indexed Access Types ç´¢å¼•è®¿é—®ç±»å‹"></a>05. Indexed Access Types ç´¢å¼•è®¿é—®ç±»å‹</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">ttype <span class="title class_">Person</span> = &#123; <span class="attr">age</span>: <span class="built_in">number</span>; <span class="attr">name</span>: <span class="built_in">string</span>; <span class="attr">alive</span>: <span class="built_in">boolean</span> &#125;;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Age</span> = <span class="title class_">Person</span>[<span class="string">&quot;age&quot;</span>];</span><br><span class="line"><span class="comment">//   ^?</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ---cut---</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">I1</span> = <span class="title class_">Person</span>[<span class="string">&quot;age&quot;</span> | <span class="string">&quot;name&quot;</span>];</span><br><span class="line"><span class="comment">//   ^?</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">I2</span> = <span class="title class_">Person</span>[keyof <span class="title class_">Person</span>];</span><br><span class="line"><span class="comment">//   ^?</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">AliveOrName</span> = <span class="string">&quot;alive&quot;</span> | <span class="string">&quot;name&quot;</span>;</span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">I3</span> = <span class="title class_">Person</span>[<span class="title class_">AliveOrName</span>];</span><br><span class="line"><span class="comment">//   ^?</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyArray</span> = [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;Alice&quot;</span>, <span class="attr">age</span>: <span class="number">15</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;Bob&quot;</span>, <span class="attr">age</span>: <span class="number">23</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;Eve&quot;</span>, <span class="attr">age</span>: <span class="number">38</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Person</span> = <span class="keyword">typeof</span> <span class="title class_">MyArray</span>[<span class="built_in">number</span>];</span><br><span class="line"><span class="comment">//   ^?</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Age</span> = <span class="keyword">typeof</span> <span class="title class_">MyArray</span>[<span class="built_in">number</span>][<span class="string">&quot;age&quot;</span>];</span><br><span class="line"><span class="comment">//   ^?</span></span><br><span class="line"><span class="comment">// Or</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Age2</span> = <span class="title class_">Person</span>[<span class="string">&quot;age&quot;</span>];</span><br><span class="line"><span class="comment">//   ^?</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> key = <span class="string">&quot;age&quot;</span>;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Age</span> = <span class="title class_">Person</span>[key];</span><br><span class="line"><span class="comment">//   ^?</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://www.typescriptlang.org/play#code/C4TwDgpgBAChBOBnA9gOygXigbygQwHMIAuKVAVwFsAjBAbjL0pKkWHgEtUCG8AbDgDcW1ZMj4Q86AL50AUKEhQAgkUywEKVAG0ARIQi6AuvID0pqJYB6Afjn3zUALQuAxuWAunC8NACSAIzqcEhoega6UAA+ULqoTIYmco7Wdj5KfgBMwZphANYQIMgAZhqhqEkpULb2itDKAsIA8vAAcgnq+o2G0bHxzLrydVB+AMw55doNQhAt7cyVFqn2rmhsUACyIMrw8Hgg6tpylrj9LLrTroYANPhEpAEArFDS18c4jMykugBCyNS6W4GUiZcavd6nBLfACiwkBdxYowAHC83kl0tAQlp1HUSpttrt9toKDQEItLNU7MNVNAsLjSlsdnsQMSqLR4EZwkRjGYlpTkhYWhiVERslgsWF9NzycthQUDlgpYYhr4RbSylptPKZZSgA">Playground Link</a></p><p>æ ¹æ®ç´¢å¼•è®¿é—® <code>type</code></p><h3 id="06-æ¡ä»¶ç±»å‹"><a href="#06-æ¡ä»¶ç±»å‹" class="headerlink" title="06. æ¡ä»¶ç±»å‹"></a>06. æ¡ä»¶ç±»å‹</h3><p>æœ‰æ„æ€çš„ <code>extends</code> ç”¨æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class a extends b &#123; &#125;</span><br><span class="line">class a&lt;T extends b&gt; &#123;&#125;</span><br></pre></td></tr></table></figure><p>ç„¶è€Œè¿™é‡Œå´æ˜¯ä¸€ä¸ªåˆ¤æ–­</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">live</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">woof</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Example1</span> = <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> ? <span class="built_in">number</span> : <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Example2</span> = <span class="title class_">RegExp</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> ? <span class="built_in">number</span> : <span class="built_in">string</span>;</span><br></pre></td></tr></table></figure><p><a href="https://www.typescriptlang.org/play#code/JYOwLgpgTgZghgYwgAgIImAWzgG2QbwChlkdgA3CACgEoAuZcge2ABMBuQgX0NElkQoAIkwDmyCAA9IIVgGc0GbHiIkA7kyYxaDZm049CYAJ4AHFAFFJcTKZwQAjMgC8yEeKkz5irLmQB+ZBAAV0wAI2hkBjkwKFBRTgB6RJJkAD1-QiMzS2tbewAmF2QAJQhRK1MJaQhZBXRfPECQ8Mjo2PiklJIMoA">Playground Link</a></p><p>åˆ¤æ–­ç»§æ‰¿è‡ªå“ªé‡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SomeType extends OtherType ? TrueType : FalseType;</span><br></pre></td></tr></table></figure><h3 id="07-Mapped-Types-æ˜ å°„ç±»å‹"><a href="#07-Mapped-Types-æ˜ å°„ç±»å‹" class="headerlink" title="07. Mapped Types æ˜ å°„ç±»å‹"></a>07. Mapped Types æ˜ å°„ç±»å‹</h3><p>è¿™é‡Œåˆå¼•å…¥å’Œå¾ˆå¤šæ¦‚å¿µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type OptionsFlags&lt;Type&gt; = &#123;</span><br><span class="line">  [Property in keyof Type]: boolean;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>Property</code> æ˜¯å±æ€§ï¼Œè¿™é‡Œå†™åš <code>Property</code>, ä½¿ç”¨ ABCDEFGï¼Œæˆ–è€…å…¶ä»–å•è¯éƒ½å¯ä»¥ã€‚</p><p><code>in</code> è¡¨ç¤º <code>Property</code> åœ¨ <code>keyof Type</code> é‡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type FeatureFlags = &#123;</span><br><span class="line">  darkMode: () =&gt; void;</span><br><span class="line">  newUserProfile: () =&gt; void;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">type FeatureOptions = OptionsFlags&lt;FeatureFlags&gt;;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ ¹æ®å®˜æ–¹çš„ä¾‹å­ï¼Œ<code>[Property in keyof FeatureFlags]</code>, ä¹Ÿå°±æ˜¯è¯´ <code>FeatureFlags = darkMode | newUserProfile</code></p><p>è¿™å°±æ˜¯æ˜ å°„ï¼Œå°† <code>FeatureFlags</code> æ˜ å°„åˆ°ä¸€ä¸ªæ–°ç±»å‹ã€‚</p><p><strong>æ˜ å°„ä¿®é¥°ç¬¦</strong></p><blockquote><p>å¯ä»¥é€šè¿‡ä»¥ æˆ– ä¸ºå‰ç¼€æ¥åˆ é™¤æˆ–æ·»åŠ è¿™äº›ä¿®é¥°ç¬¦ã€‚å¦‚æœæ‚¨ä¸æ·»åŠ å‰ç¼€ï¼Œåˆ™å‡å®šã€‚-++</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">CreateMutable</span>&lt;<span class="title class_">Type</span>&gt; = &#123;</span><br><span class="line">  -<span class="keyword">readonly</span> [<span class="title class_">Property</span> <span class="keyword">in</span> keyof <span class="title class_">Type</span>]: <span class="title class_">Type</span>[<span class="title class_">Property</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">CreateMutable1</span>&lt;<span class="title class_">Type</span>&gt; = &#123;</span><br><span class="line">  +<span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof <span class="title class_">Type</span>]: P;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">LockedAccount</span> = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T10</span> = <span class="title class_">CreateMutable1</span>&lt;<span class="title class_">LockedAccount</span>&gt;;</span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">T11</span> = <span class="title class_">CreateMutable</span>&lt;<span class="title class_">LockedAccount</span>&gt;;</span><br></pre></td></tr></table></figure><p>è¿™æ · <code>+-</code> ä¼šå¯¼è‡´ä¸ä¸€æ ·çš„ç»“æœã€‚</p><p><code>T11</code> ä¼šå–æ¶ˆæ‰€æœ‰çš„ <code>readonly</code></p><p><code>T10</code> æ‰€æœ‰éƒ½ä¼šå¢åŠ  <code>readonly</code></p><p>ä½œç”¨äºä¿®é¥°ç¬¦ï¼Œé‚£ä¹ˆæ‰€æœ‰ä¿®é¥°ç¬¦éƒ½ä¼šå—åˆ°è¿™ä¸ªç¬¦å·é™åˆ¶</p><p><a href="https://juejin.cn/post/7031450398959337486">TypeScript ä¸­çš„ä¿®é¥°ç¬¦</a></p><p><strong>Key Remapping via as</strong></p><p>ç”¨ as é‡æ–°æ˜ å°„ key</p><blockquote><p>In TypeScript 4.1 and onwards</p></blockquote><p>as å…¶å®æ˜¯ä¸€ç§æ–­è¨€ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let A: any = 18</span><br><span class="line">let B = A as string;</span><br><span class="line"></span><br><span class="line">let C:number = 18;</span><br><span class="line">let D:string = D as unknow as string;</span><br><span class="line"></span><br><span class="line">let F:string | number = 18;</span><br><span class="line">let E:string = F as string;</span><br></pre></td></tr></table></figure><p>åœ¨ç±»å‹ä¸­çš„åº”ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">type Getters&lt;T&gt; = &#123;</span><br><span class="line">  [P in keyof T as `get$&#123;Capitalize&lt;string &amp; P&gt;&#125;`]: () =&gt; T[P]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Person &#123;</span><br><span class="line">  name: string;</span><br><span class="line">  age: number;</span><br><span class="line">  location: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type LazyPerson = Getters&lt;Person&gt;;</span><br></pre></td></tr></table></figure><h3 id="08-Exclude-amp-Extract"><a href="#08-Exclude-amp-Extract" class="headerlink" title="08. Exclude &amp; Extract"></a>08. Exclude &amp; Extract</h3><p>Exclude</p><blockquote><p>type Exclude&lt;T, U&gt; &#x3D; T extends U ? never : T</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">type Fruits = &quot;apple&quot; | &quot;banana&quot; | &#x27;peach&#x27; | &#x27;orange&#x27;;</span><br><span class="line">type DislikeFruits = &quot;apple&quot; | &quot;banana&quot;;</span><br><span class="line">type FloveFruits = Exclude&lt;Fruits, DislikeFruits&gt; // ç­‰æ•ˆäº type FloveFruits = &quot;peach&quot; | &quot;orange&quot;</span><br><span class="line"></span><br><span class="line">// å®é™…ä¸Š Exclude è¿›è¡Œçš„æ¯”è¾ƒ</span><br><span class="line">type FloveFruits =</span><br><span class="line">  | (&quot;apple&quot; extends &quot;apple&quot; | &quot;banana&quot; ? never : &quot;apple&quot;)</span><br><span class="line">  | (&quot;banana&quot; extends &quot;apple&quot; | &quot;banana&quot; ? never : &quot;banana&quot;)</span><br><span class="line">  | (&quot;peach&quot; extends &quot;apple&quot; | &quot;banana&quot; ? never : &quot;peach&quot;)</span><br><span class="line">  | (&quot;orange&quot; extends &quot;apple&quot; | &quot;banana&quot; ? never : &quot;orange&quot;)</span><br><span class="line">// æ‰€ä»¥æœ€åçš„ç»“æœ</span><br><span class="line">type FloveFruits = &quot;peach&quot; | &quot;orange&quot;</span><br></pre></td></tr></table></figure><p>ä¾‹å­æ¥æº <a href="https://www.typescriptlang.org/docs/handbook/2/generics.html">typescript ä¹‹ Exclude å’Œ Extract</a></p><p>ä¾‹å­è¯´æ˜äº† <code>Exclude</code> æ¯ä¸ªå­—æ®µå’Œæ•´ä¸ªDislikeFruits åˆ¤æ–­ç»§æ‰¿ï¼Œå¦‚æœ true : never : <code>Exclude</code> å­—æ®µ.</p><p><code>Extract</code> æ°å¥½å’Œ <code>Exclude</code> ç›¸å</p><blockquote><p>type Extract&lt;T, U&gt; &#x3D; T extends U ? T : never</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type Fruits = &quot;apple&quot; | &quot;banana&quot;  | &#x27;peach&#x27; | &#x27;orange&#x27;;</span><br><span class="line">type DislikeFruits = &quot;apple&quot; | &quot;banana&quot;;</span><br><span class="line">type FloveFruits = Extract&lt;Fruits, DislikeFruits&gt; // ç­‰æ•ˆäº type FloveFruits = &quot;apple&quot; | &quot;banana&quot;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ç°åœ¨ä¸ç®¡æ˜¯ <code>Exclude</code> è¿˜æ˜¯ <code>Extract</code> éƒ½æ˜¯ä½¿ç”¨è”åˆç±»å‹ä½œä¸ºå‚æ•°ï¼Œå¦‚æœå¯¹è±¡æˆ–è€…æ¥å£ï¼Œå°±æ˜¯æ•´ä¸ª <code>extends</code>.</p><h3 id="09-Omit-amp-Pick"><a href="#09-Omit-amp-Pick" class="headerlink" title="09. Omit &amp; Pick"></a>09. Omit &amp; Pick</h3><blockquote><p>type Pick&lt;T, K extends keyof T&gt; &#x3D; {<br>    [key in k]: T[key]<br>}</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">interface TState &#123;</span><br><span class="line">name: string;</span><br><span class="line">age: number;</span><br><span class="line">like: string[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type T28 = Pick&lt;TState, &quot;name&quot; | &quot;age&quot;&gt;;</span><br><span class="line"></span><br><span class="line">//ç»“æœ</span><br><span class="line">type T28 = &#123;</span><br><span class="line">    name: string;</span><br><span class="line">    age: number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>type Omit&lt;T, K extends keyof any&gt; &#x3D; Pick&lt;T, Exclude&lt;keyof T, K&gt;&gt;; </p></blockquote><p>åˆ©ç”¨ <code>Pick</code> æ¥åˆ›å»º Omit, Omit æ˜¯æ’é™¤ã€‚</p><p>ä¸¤è€…äº’ä¸ºè¡¥å……ï¼Œå¦‚æœæ’é™¤å°‘é‡çš„ Key ä½¿ç”¨ Omit, æ’é™¤å¤§é‡çš„ä½¿ç”¨ <code>Pick</code></p><h3 id="10-Partial"><a href="#10-Partial" class="headerlink" title="10. Partial"></a>10. Partial</h3><blockquote><p>Partial çš„ä½œç”¨å°±æ˜¯å°†æŸä¸ªç±»å‹é‡Œçš„å±æ€§å…¨éƒ¨å˜ä¸ºå¯é€‰é¡¹ </p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type Partial&lt;T&gt; = &#123;</span><br><span class="line">    [P in keyof T]?: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="11-Record"><a href="#11-Record" class="headerlink" title="11. Record"></a>11. Record</h3><blockquote><p>Record&lt;K extends keyof any, T&gt; çš„ä½œç”¨æ˜¯å°† K ä¸­æ‰€æœ‰çš„å±æ€§çš„å€¼è½¬åŒ–ä¸º T ç±»å‹ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type Record&lt;K extends keyof any, T&gt; = &#123;</span><br><span class="line">    [P in K]: T;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="12-æ€»ç»“"><a href="#12-æ€»ç»“" class="headerlink" title="12. æ€»ç»“"></a>12. æ€»ç»“</h3><ol><li>æ³›å‹</li><li>çº¦æŸ: extends æ¥é™åˆ¶ T çš„ç±»å‹æˆ–è€…èŒƒå›´</li><li>keyof: è·å–ç±»å‹çš„æ‰€æœ‰Key</li><li>typeof &amp; ReturnType é€šè¿‡ typeof è¿”å›å…¨éƒ¨å¯¹è±¡ç±»å‹ï¼ŒReturnTypeå’Œtypeé…åˆè·å–è¿”å›å€¼çš„ç±»å‹</li><li>Indexed Access Types é€šè¿‡ç´¢å¼•è·å–type</li><li>æ¡ä»¶ç±»å‹ é€šè¿‡ç±»ä¼¼ä¸‰å…ƒè¡¨è¾¾å¼çš„æ–¹å¼ a extends T ? â€œstringâ€ : â€œnumberâ€</li><li>Mapped Types: Property å…³é”®å­—ï¼Œinï¼Œ+- ä¿®é¥°ç¬¦</li><li>Exclude &amp; Extract: Exclude&lt;T, U&gt; T extends U ? never : T; T &#x3D; Tçš„æ¯ä¸€é¡¹ï¼ŒExtract è¿”å›å€¼ç›¸å</li><li>Omit &amp; Pick Pické€‰æ‹©ï¼ŒOmitæ’é™¤</li><li>Partial æ‰€æœ‰éƒ½ç±»å‹è½¬æ¢ä¸º ?</li><li>Record æ‰€æœ‰ç±»å‹è½¬æ¢ä¸º T</li></ol><p>æ³›å‹çš„åŸºç¡€æ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Œä¼ å…¥åŠ¨æ€ç±»å‹ï¼Œè®©ä»£ç å¯ä»¥æœ€é«˜ç¨‹åº¦çš„å¤ç”¨ï¼Œä¸ºäº†å¸®åŠ©å¤ç”¨é€ å°±äº†è¿™ä¹ˆå¤šæ–¹æ³•ã€‚</p><h3 id="13-link"><a href="#13-link" class="headerlink" title="13. link"></a>13. link</h3><ol><li><a href="https://www.typescriptlang.org/docs/handbook/2/types-from-types.html">Creating Types from Types</a></li><li><a href="https://www.typescriptlang.org/docs/handbook/2/generics.html">æ³›å‹</a></li><li><a href="https://www.51cto.com/article/711374.html">TS typeof æ“ä½œç¬¦åŸæ¥æœ‰è¿™äº”ç§ç”¨é€”ï¼</a></li><li><a href="https://juejin.cn/post/6844904184894980104#heading-15">ä¸€æ–‡è¯»æ‡‚ TypeScript æ³›å‹åŠåº”ç”¨ï¼ˆ 7.8Kå­—ï¼‰</a></li><li><a href="https://bobbyhadz.com/blog/typescript-conversion-of-type-to-type-may-be-mistake">Conversion of type â€˜Xâ€™ to type â€˜Yâ€™ may be a mistake in TS</a></li><li><a href="https://blog.csdn.net/pfourfire/article/details/125301619">TypeScript - ç†æ¸…Omitä¸Excludeçš„å…³ç³»ä¸åŒºåˆ«</a></li><li><a href="https://blog.csdn.net/qq_28992047/article/details/106879772">å­¦ä¹ TypeScript ä¹‹ Pickä¸æ³›å‹çº¦æŸ</a></li></ol></div>]]></content>
      
      
      
        <tags>
            
            <tag> typescript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸‰æ–œæ æŒ‡ä»¤</title>
      <link href="/2023/07/03/ts_triple-slash-directives/"/>
      <url>/2023/07/03/ts_triple-slash-directives/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-ä»€ä¹ˆæ˜¯ä¸‰æ–œæ æŒ‡ä»¤"><a href="#01-ä»€ä¹ˆæ˜¯ä¸‰æ–œæ æŒ‡ä»¤" class="headerlink" title="01. ä»€ä¹ˆæ˜¯ä¸‰æ–œæ æŒ‡ä»¤"></a>01. ä»€ä¹ˆæ˜¯ä¸‰æ–œæ æŒ‡ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;reference path=&quot;...&quot; /&gt;</span><br><span class="line">/// &lt;reference types=&quot;...&quot; /&gt;</span><br><span class="line">/// &lt;reference lib=&quot;...&quot; /&gt;</span><br><span class="line">/// &lt;reference no-default-lib=&quot;true&quot;/&gt;</span><br><span class="line">/// &lt;amd-module /&gt;</span><br><span class="line">/// &lt;amd-dependency /&gt;</span><br></pre></td></tr></table></figure><p>å®˜æ–¹æ–‡æ¡£ä¸­ç»™å‡ºçš„æ ·ä¾‹ï¼Œæˆ‘ä¹Ÿç»å¸¸åœ¨ <code>typescript</code> é¡¹ç›®å½“ä¸­çœ‹åˆ°ç±»ä¼¼çš„å¼•ç”¨</p><blockquote><p>ä¸‰æ–œçº¿æŒ‡ä»¤æ˜¯åŒ…å«å•ä¸ªXMLæ ‡ç­¾çš„å•è¡Œæ³¨é‡Šã€‚ æ³¨é‡Šçš„å†…å®¹ä¼šåšä¸ºç¼–è¯‘å™¨æŒ‡ä»¤ä½¿ç”¨ã€‚</p><p>ä¸‰æ–œçº¿æŒ‡ä»¤ä»…å¯æ”¾åœ¨åŒ…å«å®ƒçš„æ–‡ä»¶çš„æœ€é¡¶ç«¯ã€‚ ä¸€ä¸ªä¸‰æ–œçº¿æŒ‡ä»¤çš„å‰é¢åªèƒ½å‡ºç°å•è¡Œæˆ–å¤šè¡Œæ³¨é‡Šï¼Œè¿™åŒ…æ‹¬å…¶å®ƒçš„ä¸‰æ–œçº¿æŒ‡ä»¤ã€‚ å¦‚æœå®ƒä»¬å‡ºç°åœ¨ä¸€ä¸ªè¯­å¥æˆ–å£°æ˜ä¹‹åï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šè¢«å½“åšæ™®é€šçš„å•è¡Œæ³¨é‡Šï¼Œå¹¶ä¸”ä¸å…·æœ‰ç‰¹æ®Šçš„æ¶µä¹‰ã€‚</p><p>ä¸‰æ–œçº¿å¼•ç”¨å‘Šè¯‰ç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­è¦å¼•å…¥çš„é¢å¤–çš„æ–‡ä»¶ã€‚</p></blockquote><p>é‚£ä¹ˆè¿™äº›ä¸œè¥¿æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p><p>å°±æ˜¯ä¸ºç¼–è¯‘å’Œæ™ºèƒ½æç¤ºï¼Œæ¯”å¦‚è¯´ï¼Œæˆ‘å…¨å±€å¼•ç”¨äº† <code>Jquery</code>, ä½†æ˜¯æˆ‘æœ‰è¿™ä¹ˆå¤šæ–‡ä»¶ï¼Œéƒ½æ²¡æœ‰æ™ºèƒ½æç¤ºï¼Œè¿™ä¸ªæ—¶å€™ <code>reference</code> å°±å‡ºåœºäº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;reference types=&quot;Jquery&quot; /&gt;</span><br><span class="line">/// &lt;reference path=&quot;node_modules/jquery/....&quot; /&gt;</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªçš„å·®åˆ«å°±æ˜¯ä¸€ä¸ªé€šè¿‡åå­—è‡ªå·±å» <code>node_modules</code> é‡Œé¢æ‰¾ï¼Œä¸€ä¸ªæ˜¯ç›´æ¥ç»™å‡ºåœ°å€ï¼Œéƒ½èƒ½è®© <code>typescript</code> é€šè¿‡ç¼–è¯‘äº†ã€‚</p><p>å…¶ä»–ç”¨æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;reference lib=&quot;...&quot; /&gt;</span><br><span class="line"></span><br><span class="line">æ­¤æŒ‡ä»¤å…è®¸æ–‡ä»¶æ˜¾å¼åŒ…å«ç°æœ‰çš„å†…ç½® lib æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">/// &lt;reference no-default-lib=&quot;true&quot;/&gt;</span><br><span class="line"></span><br><span class="line">æ­¤æŒ‡ä»¤å°†æ–‡ä»¶æ ‡è®°ä¸ºé»˜è®¤åº“</span><br><span class="line"></span><br><span class="line">/// &lt;amd-dependency path=&quot;legacy/moduleA&quot; name=&quot;moduleA&quot;/&gt;</span><br><span class="line"></span><br><span class="line">é»˜è®¤æƒ…å†µä¸‹ï¼ŒAMD æ¨¡å—æ˜¯åŒ¿åç”Ÿæˆçš„ã€‚ å½“ä½¿ç”¨å…¶ä»–å·¥å…·å¤„ç†ç”Ÿæˆçš„æ¨¡å—ï¼ˆä¾‹å¦‚æ†ç»‘å™¨ï¼‰æ—¶ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚r.js</span><br><span class="line"></span><br><span class="line">è¯¥æŒ‡ä»¤å…è®¸å°†å¯é€‰æ¨¡å—åç§°ä¼ é€’ç»™ç¼–è¯‘å™¨ï¼šamd-module</span><br><span class="line"></span><br><span class="line">/// &lt;amd-dependency /&gt;</span><br><span class="line"></span><br><span class="line">å°†å¯¼è‡´å°†åç§°åˆ†é…ç»™æ¨¡å—ä½œä¸ºè°ƒç”¨ AMD çš„ä¸€éƒ¨åˆ†ï¼šNamedModuledefine</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="link"><a href="#link" class="headerlink" title="link"></a>link</h3><p><a href="https://www.typescriptlang.org/docs/handbook/triple-slash-directives.html">triple-slash-directives</a></p></div>]]></content>
      
      
      
        <tags>
            
            <tag> typescript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mixin</title>
      <link href="/2023/07/03/ts_mixin/"/>
      <url>/2023/07/03/ts_mixin/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="å®˜æ–¹ä¾‹å­"><a href="#å®˜æ–¹ä¾‹å­" class="headerlink" title="å®˜æ–¹ä¾‹å­"></a>å®˜æ–¹ä¾‹å­</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">// Disposable Mixin</span><br><span class="line">class Disposable &#123;</span><br><span class="line">    isDisposed: boolean;</span><br><span class="line">    dispose() &#123;</span><br><span class="line">        this.isDisposed = true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Activatable Mixin</span><br><span class="line">class Activatable &#123;</span><br><span class="line">    isActive: boolean;</span><br><span class="line">    activate() &#123;</span><br><span class="line">        this.isActive = true;</span><br><span class="line">    &#125;</span><br><span class="line">    deactivate() &#123;</span><br><span class="line">        this.isActive = false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SmartObject implements Disposable, Activatable &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        setInterval(() =&gt; console.log(this.isActive + &quot; : &quot; + this.isDisposed), 500);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    interact() &#123;</span><br><span class="line">        this.activate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Disposable</span><br><span class="line">    isDisposed: boolean = false;</span><br><span class="line">    dispose: () =&gt; void;</span><br><span class="line">    // Activatable</span><br><span class="line">    isActive: boolean = false;</span><br><span class="line">    activate: () =&gt; void;</span><br><span class="line">    deactivate: () =&gt; void;</span><br><span class="line">&#125;</span><br><span class="line">applyMixins(SmartObject, [Disposable, Activatable]);</span><br><span class="line"></span><br><span class="line">let smartObj = new SmartObject();</span><br><span class="line">setTimeout(() =&gt; smartObj.interact(), 1000);</span><br><span class="line"></span><br><span class="line">////////////////////////////////////////</span><br><span class="line">// In your runtime library somewhere</span><br><span class="line">////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">function applyMixins(derivedCtor: any, baseCtors: any[]) &#123;</span><br><span class="line">    baseCtors.forEach(baseCtor =&gt; &#123;</span><br><span class="line">        Object.getOwnPropertyNames(baseCtor.prototype).forEach(name =&gt; &#123;</span><br><span class="line">            derivedCtor.prototype[name] = baseCtor.prototype[name];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®˜æ–¹ä¾‹å­å…³äº mixin çš„è§£é‡Šæœ‰ç‚¹ç±»ä¼¼äºåŸå‹é“¾çš„ç»§æ‰¿ï¼Œå•çº¯çš„å¤åˆ¶åŸå‹é“¾ã€‚</p><p>åç»­çš„åŸå‹é“¾è¦†ç›–ä¹‹å‰çš„åŸå‹é“¾, æ ¸å¿ƒä»£ç å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function applyMixins(derivedCtor: any, baseCtors: any[]) &#123;</span><br><span class="line">    baseCtors.forEach(baseCtor =&gt; &#123;</span><br><span class="line">        Object.getOwnPropertyNames(baseCtor.prototype).forEach(name =&gt; &#123;</span><br><span class="line">            derivedCtor.prototype[name] = baseCtor.prototype[name];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ²¡ä»€ä¹ˆéš¾ä»¥ç†è§£çš„ï¼ŒçŸ¥è¯†è®©æˆ‘ç–‘æƒ‘çš„ç‚¹åœ¨äºæ˜æ˜å°±æ˜¯ä¸€ä¸ªåŸå‹é“¾çš„å¤åˆ¶ï¼Œä¸ºä»€ä¹ˆè¦ä¸“é—¨å¼€ä¸€ç« æ¥è¯´æ˜ï¼Œå¹¶ä¸”å…¶ä¸€ä¸ªåå­—å« mixin.</p><h3 id="02-å…¶ä»–åœ°æ–¹å®šä¹‰çš„mixin"><a href="#02-å…¶ä»–åœ°æ–¹å®šä¹‰çš„mixin" class="headerlink" title="02. å…¶ä»–åœ°æ–¹å®šä¹‰çš„mixin"></a>02. å…¶ä»–åœ°æ–¹å®šä¹‰çš„mixin</h3><blockquote><p>ã€Œæ··åˆã€æ˜¯ä¸€ä¸ªå‡½æ•°ï¼š</p><p>ä¼ å…¥ä¸€ä¸ªæ„é€ å‡½æ•°ï¼›<br>åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ–°åŠŸèƒ½ï¼Œå¹¶ä¸”æ‰©å±•æ„é€ å‡½æ•°çš„æ–°ç±»ï¼›<br>è¿”å›è¿™ä¸ªæ–°ç±»ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// æ‰€æœ‰ mixins éƒ½éœ€è¦</span><br><span class="line">type Constructor&lt;T = &#123;&#125;&gt; = new (...args: any[]) =&gt; T;</span><br><span class="line"></span><br><span class="line">/////////////</span><br><span class="line">// mixins ä¾‹å­</span><br><span class="line">////////////</span><br><span class="line"></span><br><span class="line">// æ·»åŠ å±æ€§çš„æ··åˆä¾‹å­</span><br><span class="line">function Timestamped&lt;TBase extends Constructor&gt;(Base: TBase) &#123;</span><br><span class="line">  return class extends Base &#123;</span><br><span class="line">    timestamp = Date.now();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ·»åŠ å±æ€§å’Œæ–¹æ³•çš„æ··åˆä¾‹å­</span><br><span class="line">function Activatable&lt;TBase extends Constructor&gt;(Base: TBase) &#123;</span><br><span class="line">  return class extends Base &#123;</span><br><span class="line">    isActivated = false;</span><br><span class="line"></span><br><span class="line">    activate() &#123;</span><br><span class="line">      this.isActivated = true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    deactivate() &#123;</span><br><span class="line">      this.isActivated = false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»–è¿™ä¸ªä¾‹å­å…¶å®ç±»ä¼¼äºé«˜è§£ç»„ä»¶çš„å†™æ³•ï¼Œé«˜è§£ç»„ä»¶æ˜¯åœ¨åç»­è°ƒç”¨åŸæœ‰çš„ç»„ä»¶ï¼Œè€Œè¿™ä¸ªä¾‹å­æ˜¯ç»§æ‰¿</p><p>å…¶å®å’Œå‰é¢å®˜æ–¹ä¾‹å­å½“ä¸­å¤åˆ¶åŸå‹é“¾çš„æ–¹å¼å…¶å®å·®ä¸å¤šï¼Œextends æœ¬è´¨ä¸Šä¹Ÿæ˜¯åŸå‹é“¾ç»§æ‰¿ï¼Œåªæ˜¯ç»†å¾®ä¸Šæœ‰å·®åˆ«ã€‚</p><h3 id="03-ä»€ä¹ˆæ˜¯typescript-mixin"><a href="#03-ä»€ä¹ˆæ˜¯typescript-mixin" class="headerlink" title="03. ä»€ä¹ˆæ˜¯typescript mixin"></a>03. ä»€ä¹ˆæ˜¯typescript mixin</h3><p>å…¶å®å°±æ˜¯ç»§æ‰¿ï¼Œä»æ•ˆæœä¸Šæ¥çœ‹ä¹Ÿç®—æ˜¯ mixin</p><h3 id="04-link"><a href="#04-link" class="headerlink" title="04. link"></a>04. link</h3><ol><li><a href="https://www.tslang.cn/docs/handbook/mixins.html">Mixins</a></li><li><a href="https://jkchao.github.io/typescript-book-chinese/typings/mixins.html#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0">æ·±å…¥ç†è§£ typescript æ··åˆ</a></li><li><a href="https://juejin.cn/post/6844903527941144589">setPrototypeOf ä¸ Object.createåŒºåˆ«</a></li></ol></div>]]></content>
      
      
      
        <tags>
            
            <tag> typescript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>infer</title>
      <link href="/2023/07/03/ts_Infer/"/>
      <url>/2023/07/03/ts_Infer/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><blockquote><p>infer æ˜¯åœ¨ typescript 2.8ä¸­æ–°å¢çš„å…³é”®å­—ã€‚<br>infer å¯ä»¥åœ¨ extends æ¡ä»¶ç±»å‹çš„å­—å¥ä¸­ï¼Œåœ¨çœŸå®åˆ†æ”¯ä¸­å¼•ç”¨æ­¤æ¨æ–­ç±»å‹å˜é‡ï¼Œæ¨æ–­å¾…æ¨æ–­çš„ç±»å‹ã€‚</p></blockquote><h2 id="01-infer-æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"><a href="#01-infer-æœ‰ä»€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="01. infer æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"></a>01. infer æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h2><blockquote><p>æ¨å¯¼æ³›å‹å‚æ•°</p></blockquote><p>ä»–çš„æœ¬è´¨ä¸Šå°±æ˜¯æ¨å¯¼æ³›å‹å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type T1&lt;T&gt; = T extends () =&gt; infer p ? p : number </span><br></pre></td></tr></table></figure><p>åˆ¤æ–­ T ç»§æ‰¿è‡ª () &#x3D;&gt; T, å¦‚æœæ˜¯è¿”å› Tï¼Œ å¦‚æœä¸æ˜¯è¿”å› number.</p><p>è€Œè¿™ä¸ª <code>infer p == T</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type T2 = T1&lt;() =&gt; string&gt;</span><br><span class="line">//T2 === string</span><br><span class="line">type T3 = T1&lt;(i: number) =&gt; void&gt;</span><br><span class="line">//T3 === number</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥å¤šä¸ªå‚æ•°ï¼Œè¿›è¡Œåå˜å’Œé€†å˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type T4&lt;T&gt; = T extends (a: infer P, b: infer P) =&gt; void ? P : any;</span><br><span class="line">type T5 = T4&lt;() =&gt; void&gt;; //any</span><br><span class="line">type T6 = T4&lt;(a:string, b: number) =&gt; void&gt; // string &amp; number</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªæ˜¯ä¾‹å­æ˜¯ç½‘ä¸Šçœ‹åˆ°çš„ä¾‹å­</p><blockquote><p>åå˜ï¼šç±»å‹æ¨å¯¼åˆ°å…¶å­ç±»å‹çš„è¿‡ç¨‹ï¼ŒA | B -&gt; A &amp; B å°±æ˜¯ä¸€ä¸ªåå˜<br>é€†å˜ï¼šç±»å‹æ¨å¯¼åˆ°å…¶è¶…ç±»å‹çš„è¿‡ç¨‹</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´å‚æ•°æ˜¯ä¸€ä¸ªé€†å˜ <code>string &amp; nubmer</code> &#x3D; never;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type User = &#123; name: string, age:number &#125;;</span><br><span class="line">type OtherInfo = &#123; sex: string &#125;;</span><br><span class="line">type T7 = T4&lt;(a: User, b:OtherInfo) =&gt; void&gt; // User &amp; OtherInfo</span><br></pre></td></tr></table></figure><p>ä¹‹å‰çš„ <code>ReturnType</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type ReturnType&lt;T extends (...args: any) =&gt; any&gt; = T </span><br><span class="line">  extends (...args: any) =&gt; infer R ? R : any;</span><br></pre></td></tr></table></figure><h3 id="02-åº”ç”¨åœºæ™¯"><a href="#02-åº”ç”¨åœºæ™¯" class="headerlink" title="02. åº”ç”¨åœºæ™¯"></a>02. åº”ç”¨åœºæ™¯</h3><blockquote><p>ä¸€èˆ¬ä¸šåŠ¡ä»£ç ç”¨ any ä¹Ÿä¸è¦å†™ inferï¼Œå› ä¸ºè¦é¡¾åŠå¯è¯»æ€§å’Œç»´æŠ¤æ€§ï¼Œè¦ä¸åŒäº‹ä¹Ÿä¼šæ‰“äººçš„ã€‚<br>å¦‚æœæœ‰æœºä¼šä½ å°è£… utilã€hookï¼Œç”šè‡³æ˜¯ä¸€ä¸ª npm åŒ…ï¼Œä½ éœ€è¦é€šè¿‡ä½¿ç”¨è€…çš„è¾“å…¥ç»™äºˆæ›´å¥½çš„ç±»å‹æç¤ºï¼Œinfer å°±æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„å…³é”®å­—äº†ã€‚<br>å…·ä½“ä¾‹å­æœ‰å¾ˆå¤šï¼Œå¦‚æœä½ æœ‰å¿ƒç¿»ä¸€ç¿»å„ç§åº“çš„ ts å®šä¹‰å°±ä¼šå‘ç° infer è¢«å¤§é‡ä½¿ç”¨</p></blockquote><p><a href="https://github.com/reduxjs/redux/blob/8ad084251a5b3e4617157fc52795b6284e68bc1e/src/types/reducers.ts#L48">redux&#x2F;src&#x2F;types&#x2F;reducers.ts</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Infer a combined state shape from a `ReducersMapObject`.</span><br><span class="line"> *</span><br><span class="line"> * @template M Object map of reducers as provided to `combineReducers(map: M)`.</span><br><span class="line"> */</span><br><span class="line">export type StateFromReducersMapObject&lt;M&gt; = M extends ReducersMapObject</span><br><span class="line">  ? &#123; [P in keyof M]: M[P] extends Reducer&lt;infer S, any&gt; ? S : never &#125;</span><br><span class="line">  : never</span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Infer reducer union type from a `ReducersMapObject`.</span><br><span class="line"> *</span><br><span class="line"> * @template M Object map of reducers as provided to `combineReducers(map: M)`.</span><br><span class="line"> */</span><br><span class="line">export type ReducerFromReducersMapObject&lt;M&gt; = M extends &#123;</span><br><span class="line">  [P in keyof M]: infer R</span><br><span class="line">&#125;</span><br><span class="line">  ? R extends Reducer&lt;any, any&gt;</span><br><span class="line">    ? R</span><br><span class="line">    : never</span><br><span class="line">  : never</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Infer action type from a reducer function.</span><br><span class="line"> *</span><br><span class="line"> * @template R Type of reducer.</span><br><span class="line"> */</span><br><span class="line">export type ActionFromReducer&lt;R&gt; = R extends Reducer&lt;any, infer A&gt; ? A : never</span><br></pre></td></tr></table></figure><h3 id="03-link"><a href="#03-link" class="headerlink" title="03. link"></a>03. link</h3><ol><li><a href="http://www.semlinker.com/ts-infer/">TypeScript infer å…³é”®å­—</a></li><li><a href="https://jkchao.github.io/typescript-book-chinese/tips/infer.html#%E4%B8%80%E4%BA%9B%E7%94%A8%E4%BE%8B">infer</a></li><li><a href="https://github.com/reduxjs/redux/blob/8ad084251a5b3e4617157fc52795b6284e68bc1e/src/types/reducers.ts#L48">redux&#x2F;src&#x2F;types&#x2F;reducers.ts</a></li></ol></div>]]></content>
      
      
      
        <tags>
            
            <tag> typescript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è£…é¥°å™¨(js &amp; ts)</title>
      <link href="/2023/07/03/ts_decorator/"/>
      <url>/2023/07/03/ts_decorator/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-jsç‰ˆæœ¬"><a href="#01-jsç‰ˆæœ¬" class="headerlink" title="01. jsç‰ˆæœ¬"></a>01. jsç‰ˆæœ¬</h3><p>ä¹‹å‰åœ¨çœ‹ typescript decorators çš„æ—¶å€™æƒ³èµ· js å…¶å®ä¹Ÿæœ‰ decorators, äºæ˜¯ç¿»äº†ä¸€ä¸‹é˜®ä¸€å³°çš„ es6 æ•™ç¨‹ã€‚<br>åœ¨è‡ªå·±æµ‹è¯•çš„æ—¶å€™ï¼Œå‘ç°ä¸å…‰æ˜¯ç¼–è¾‘å™¨æç¤ºé”™è¯¯ï¼Œå¹¶ä¸”åœ¨æµè§ˆå™¨ä¸­ä¹Ÿä¸æ”¯æŒï¼Œé€šè¿‡nodejså°è¯•ï¼Œä¹Ÿä¸è¡Œã€‚</p><p>äºæ˜¯æŸ¥äº†ä¸€ä¸‹</p><p><a href="https://caniuse.com/decorators">https://caniuse.com/decorators</a></p><p>å¹¶ä¸æ”¯æŒï¼Œæƒ³è¦ä½¿ç”¨ç‰¹æ€§</p><ol><li>react</li><li>typescript</li><li>babel</li></ol><p>Es6åŸç”Ÿè¯­æ³•</p><p><a href="https://es6.ruanyifeng.com/#docs/decorator">https://es6.ruanyifeng.com/#docs/decorator</a></p><h3 id="02-typescript-decorators"><a href="#02-typescript-decorators" class="headerlink" title="02. typescript decorators"></a>02. typescript decorators</h3><p>ä¸ç®¡æ˜¯ C#ï¼Œjava æˆ–è€… agï¼Œnest.js åªè¦ä½ ä½¿ç”¨è¿‡å¯¹è¿™ä¸ªä¸œè¥¿å°±ä¸ä¼šé™Œç”Ÿã€‚</p><blockquote><p>éšç€TypeScriptå’ŒES6é‡Œå¼•å…¥äº†ç±»ï¼Œåœ¨ä¸€äº›åœºæ™¯ä¸‹æˆ‘ä»¬éœ€è¦é¢å¤–çš„ç‰¹æ€§æ¥æ”¯æŒæ ‡æ³¨æˆ–ä¿®æ”¹ç±»åŠå…¶æˆå‘˜ã€‚ è£…é¥°å™¨ï¼ˆDecoratorsï¼‰ä¸ºæˆ‘ä»¬åœ¨ç±»çš„å£°æ˜åŠæˆå‘˜ä¸Šé€šè¿‡å…ƒç¼–ç¨‹è¯­æ³•æ·»åŠ æ ‡æ³¨æä¾›äº†ä¸€ç§æ–¹å¼ã€‚ Javascripté‡Œçš„è£…é¥°å™¨ç›®å‰å¤„åœ¨ å»ºè®®å¾é›†çš„ç¬¬äºŒé˜¶æ®µï¼Œä½†åœ¨TypeScripté‡Œå·²åšä¸ºä¸€é¡¹å®éªŒæ€§ç‰¹æ€§äºˆä»¥æ”¯æŒã€‚<br>æ³¨æ„â€ƒ è£…é¥°å™¨æ˜¯ä¸€é¡¹å®éªŒæ€§ç‰¹æ€§ï¼Œåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜ã€‚<br>è‹¥è¦å¯ç”¨å®éªŒæ€§çš„è£…é¥°å™¨ç‰¹æ€§ï¼Œä½ å¿…é¡»åœ¨å‘½ä»¤è¡Œæˆ–tsconfig.jsoné‡Œå¯ç”¨experimentalDecoratorsç¼–è¯‘å™¨é€‰é¡¹ï¼š</p></blockquote><p>è¦ä½¿ç”¨è¿™ä¸ªä½ éœ€è¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tsc --target ES5 --experimentalDecorators --emitDecoratorMetadata</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;compilerOptions&quot;: &#123;</span><br><span class="line">        &quot;target&quot;: &quot;ES5&quot;,</span><br><span class="line">        &quot;experimentalDecorators&quot;: true,</span><br><span class="line">        &quot;emitDecoratorMetadata&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡æ¡£ä¸­ä»‹ç»äº†è¿™å‡ ç§è£…é¥°å™¨</p><ol><li>ç±»è£…é¥°å™¨</li><li>æ–¹æ³•è£…é¥°å™¨</li><li>è®¿é—®å™¨è£…é¥°å™¨</li><li>å±æ€§è£…é¥°å™¨</li><li>å‚æ•°è£…é¥°å™¨</li></ol><p>ä¹Ÿå°±æ˜¯ä¸»è¦ç”¨é€”æ˜¯ç»™ç±»ï¼Œfunctionï¼Œä»¥åŠé‡Œé¢çš„å±æ€§ï¼Œå‚æ•°ï¼Œè®¿é—®å™¨æœåŠ¡ã€‚</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function decoratorA(target) &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function decoratorB(value:boolean) &#123;</span><br><span class="line">return function(target, key, desc) &#123;</span><br><span class="line">....</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒºåˆ«ä¸»è¦åœ¨äºæ˜¯å¦ä¼ å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@decoratorA</span><br><span class="line">@decoratorB(false)</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªè£…é¥°å™¨ç”¨åœ¨ä¸åŒçš„å¯¹è±¡ä¸Šå‚æ•°æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>è¿™æ ·å°±æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„è£…é¥°å™¨</p><h3 id="03-æ‰§è¡Œæ—¶æœº"><a href="#03-æ‰§è¡Œæ—¶æœº" class="headerlink" title="03. æ‰§è¡Œæ—¶æœº"></a>03. æ‰§è¡Œæ—¶æœº</h3><p>æˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆæ—¶å€™æ‰§è¡Œè£…é¥°å™¨</p><blockquote><p>è£…é¥°å™¨åªåœ¨è§£é‡Šæ‰§è¡Œæ—¶åº”ç”¨ä¸€æ¬¡</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">function log(value: string): any &#123;</span><br><span class="line">  console.log(`log function $&#123;value&#125;`);</span><br><span class="line">  return function () &#123;</span><br><span class="line">    //çœç•¥å‚æ•°ï¼Œå› ä¸ºæˆ‘ä¸éœ€è¦</span><br><span class="line">    console.log(`log return function $&#123;value&#125;`);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@log(&quot;ç±»&quot;)</span><br><span class="line">class testLog &#123;</span><br><span class="line">  @log(&quot;å±æ€§&quot;)</span><br><span class="line">  B: number;</span><br><span class="line"></span><br><span class="line">  @log(&quot;é™æ€å±æ€§&quot;)</span><br><span class="line">  static C: number;</span><br><span class="line"></span><br><span class="line">  @log(&quot;æ–¹æ³•&quot;)</span><br><span class="line">  A() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  @log(&quot;é™æ€æ–¹æ³•&quot;)</span><br><span class="line">  static D() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  F(@log(&quot;å‚æ•°&quot;) i: number) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  @log(&quot;è®¿é—®å™¨&quot;)</span><br><span class="line">  set X(arg) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿”å›ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">log function å±æ€§</span><br><span class="line">return function å±æ€§</span><br><span class="line">index.js:66 log function æ–¹æ³•</span><br><span class="line">return function æ–¹æ³•</span><br><span class="line">index.js:66 log function å‚æ•°</span><br><span class="line">return function å‚æ•°</span><br><span class="line">index.js:66 log function è®¿é—®å™¨</span><br><span class="line">return function è®¿é—®å™¨</span><br><span class="line">index.js:66 log function é™æ€å±æ€§</span><br><span class="line">return function é™æ€å±æ€§</span><br><span class="line">index.js:66 log function é™æ€æ–¹æ³•</span><br><span class="line">return function é™æ€æ–¹æ³•</span><br><span class="line">index.js:66 log function ç±»</span><br><span class="line">return function ç±»</span><br></pre></td></tr></table></figure><blockquote><p>å±æ€§ &gt; æ–¹æ³• &gt; å‚æ•° &gt; è®¿é—®å™¨ &gt; é™æ€å±æ€§ &gt; é™æ€æ–¹æ³• &gt; ç±»</p></blockquote><p>ç„¶åå°±æ˜¯ç›¸åŒè£…é¥°å™¨ï¼Œæ¯”å¦‚ä¸€ä¸ªç±»æœ‰ä¸¤ä¸ªè£…é¥°å™¨çš„æƒ…å†µä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@log(&quot;ç±»&quot;)</span><br><span class="line">@log(&quot;ç±»1&quot;)</span><br><span class="line">class testLog &#123;</span><br><span class="line">  @log(&quot;å±æ€§&quot;)</span><br><span class="line">  @log(&quot;å±æ€§1&quot;)</span><br><span class="line">  B: number;</span><br><span class="line"></span><br><span class="line">  @log(&quot;é™æ€å±æ€§&quot;)</span><br><span class="line">  @log(&quot;é™æ€å±æ€§1&quot;)</span><br><span class="line">  static C: number;</span><br><span class="line"></span><br><span class="line">  @log(&quot;æ–¹æ³•&quot;)</span><br><span class="line">  @log(&quot;æ–¹æ³•1&quot;)</span><br><span class="line">  A() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  @log(&quot;é™æ€æ–¹æ³•&quot;)</span><br><span class="line">  @log(&quot;é™æ€æ–¹æ³•1&quot;)</span><br><span class="line">  static D() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  F(@log(&quot;å‚æ•°&quot;) i: number, @log(&quot;å‚æ•°1&quot;) y: number) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  @log(&quot;è®¿é—®å™¨&quot;)</span><br><span class="line">  @log(&quot;è®¿é—®å™¨1&quot;)</span><br><span class="line">  set X(arg) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">log function å±æ€§</span><br><span class="line">index.js:66 log function å±æ€§1</span><br><span class="line">return function å±æ€§1</span><br><span class="line">return function å±æ€§</span><br><span class="line">index.js:66 log function æ–¹æ³•</span><br><span class="line">index.js:66 log function æ–¹æ³•1</span><br><span class="line">return function æ–¹æ³•1</span><br><span class="line">return function æ–¹æ³•</span><br><span class="line">index.js:66 log function å‚æ•°</span><br><span class="line">index.js:66 log function å‚æ•°1</span><br><span class="line">return function å‚æ•°1</span><br><span class="line">return function å‚æ•°</span><br><span class="line">index.js:66 log function è®¿é—®å™¨</span><br><span class="line">index.js:66 log function è®¿é—®å™¨1</span><br><span class="line">return function è®¿é—®å™¨1</span><br><span class="line">return function è®¿é—®å™¨</span><br><span class="line">index.js:66 log function é™æ€å±æ€§</span><br><span class="line">index.js:66 log function é™æ€å±æ€§1</span><br><span class="line">return function é™æ€å±æ€§1</span><br><span class="line">return function é™æ€å±æ€§</span><br><span class="line">index.js:66 log function é™æ€æ–¹æ³•</span><br><span class="line">index.js:66 log function é™æ€æ–¹æ³•1</span><br><span class="line">return function é™æ€æ–¹æ³•1</span><br><span class="line">return function é™æ€æ–¹æ³•</span><br><span class="line">index.js:66 log function ç±»</span><br><span class="line">index.js:66 log function ç±»1</span><br><span class="line">return function ç±»1</span><br><span class="line">return function ç±»</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´å…ˆæ”¾å…ˆæ‰§è¡Œæ„é€ å‡½æ•°ï¼Œåé¢è£…é¥°å™¨çš„åæ‰§è¡Œæ„é€ å‡½æ•°ï¼Œä½†æ˜¯å…ˆæ‰§è¡Œå›è°ƒã€‚<br>æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯åæ”¾å…ˆæ‰§è¡Œã€‚</p><h3 id="04-ç±»è£…é¥°å™¨"><a href="#04-ç±»è£…é¥°å™¨" class="headerlink" title="04. ç±»è£…é¥°å™¨"></a>04. ç±»è£…é¥°å™¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type ClassDecorator = &lt;TFunction extends Function&gt;</span><br><span class="line">(target: TFunction) =&gt; TFunction | void;</span><br></pre></td></tr></table></figure><p>å¯ä»¥åšä»€ä¹ˆï¼Ÿ</p><blockquote><p>å¦‚æœç±»è£…é¥°å™¨è¿”å›äº†ä¸€ä¸ªå€¼ï¼Œå¥¹å°†ä¼šè¢«ç”¨æ¥ä»£æ›¿åŸæœ‰çš„ç±»æ„é€ å™¨çš„å£°æ˜ã€‚<br>å› æ­¤ï¼Œç±»è£…é¥°å™¨é€‚åˆç”¨äºç»§æ‰¿ä¸€ä¸ªç°æœ‰ç±»å¹¶æ·»åŠ ä¸€äº›å±æ€§å’Œæ–¹æ³•ã€‚<br>ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªtoStringæ–¹æ³•ç»™æ‰€æœ‰çš„ç±»æ¥è¦†ç›–å®ƒåŸæœ‰çš„toStringæ–¹æ³•ã€‚<br>ä¹Ÿå°±æ˜¯è¯´å…¶å®åªèƒ½å¯¹æ„é€ å‡½æ•°è¿›è¡Œé‡è½½ï¼Œå½“ç„¶ä¹Ÿå¤Ÿç”¨äº†</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function classDecorator&lt;T extends &#123; new (...args: any[]) &#125;&gt;(constructor: T) &#123;</span><br><span class="line">  return class extends constructor &#123;</span><br><span class="line">    title = &quot;classDecorator title&quot;;</span><br><span class="line">toString() &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„è£…é¥°å™¨ classDecorator é‡è½½äº†ç±»çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”æ–°å»ºå±æ€§ titleï¼Œ é‡è½½äº† <code>toString()</code> è¾“å‡ºã€‚</p><h3 id="05-å±æ€§è£…é¥°å™¨"><a href="#05-å±æ€§è£…é¥°å™¨" class="headerlink" title="05. å±æ€§è£…é¥°å™¨"></a>05. å±æ€§è£…é¥°å™¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type PropertyDecorator = (target: Object, propertyKey: string | symbol) =&gt; void;</span><br></pre></td></tr></table></figure><p>@<strong>å‚æ•°</strong></p><ol><li>target ç›®æ ‡</li><li>propertyKey å±æ€§å</li></ol><p>@<strong>å¯ä»¥åšä»€ä¹ˆ</strong></p><blockquote><p>ç›‘æ§å˜åŒ–<br>é‡å†™å±æ€§<br>æ”¶é›†ä¿¡æ¯<br>æ ‡è®°éªŒè¯</p></blockquote><p>ç­‰ç­‰ï¼Œæ¯”å¦‚è¯´å®ç°ä¸€ä¸ª readonly</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function myReadonly(target: Object, key: string) &#123;</span><br><span class="line">  Reflect.defineProperty(target, key, &#123;</span><br><span class="line">    set(v) &#123;</span><br><span class="line">      if (this.key === undefined) &#123;</span><br><span class="line">        this.key = v;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        throw new Error(`$&#123;key&#125; is readonly`);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class C &#123;</span><br><span class="line">  @myReadonly</span><br><span class="line">  foo: string = &quot;a&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let myC = new C();</span><br><span class="line">myC.foo = &quot;aaaaaaa&quot;;</span><br><span class="line">console.log(myC.foo);</span><br></pre></td></tr></table></figure><h3 id="06-æ–¹æ³•è£…é¥°å™¨"><a href="#06-æ–¹æ³•è£…é¥°å™¨" class="headerlink" title="06. æ–¹æ³•è£…é¥°å™¨"></a>06. æ–¹æ³•è£…é¥°å™¨</h3><p>@<strong>å‚æ•°</strong></p><ol><li>target: å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å™¨ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ¥è¯´æ˜¯ç±»çš„åŸå‹é“¾ã€‚</li><li>propertyKey: å±æ€§çš„åç§°ã€‚</li><li>descriptor: {<br> value<br> writable<br> enumerable<br> configurable<br>}</li></ol><p>@<strong>è¿”å›</strong></p><ol><li>å¦‚æœè¿”å›äº†å€¼ï¼Œå®ƒä¼šè¢«ç”¨äºæ›¿ä»£å±æ€§çš„æè¿°å™¨ã€‚</li></ol><p>@<strong>åœºæ™¯</strong></p><p>å‡ ä¹å¯ä»¥é€‚ç”¨ä»»ä½•åœºæ™¯ï¼Œä½ ç”šè‡³å¯ä»¥é‡å†™æ–¹æ³•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">descriptor.value === Function</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function logger(target: any, propertyKey: string, descriptor: PropertyDescriptor) &#123;</span><br><span class="line">  const original = descriptor.value;</span><br><span class="line"></span><br><span class="line">  descriptor.value = function (...args) &#123;</span><br><span class="line">    console.log(&#x27;params: &#x27;, ...args);</span><br><span class="line">    const result = original.call(this, ...args);</span><br><span class="line">    console.log(&#x27;result: &#x27;, result);</span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class C &#123;</span><br><span class="line">  @logger</span><br><span class="line">  add(x: number, y:number ) &#123;</span><br><span class="line">    return x + y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const c = new C();</span><br><span class="line">c.add(1, 2);</span><br></pre></td></tr></table></figure><h3 id="07-è®¿é—®å™¨è£…é¥°å™¨"><a href="#07-è®¿é—®å™¨è£…é¥°å™¨" class="headerlink" title="07. è®¿é—®å™¨è£…é¥°å™¨"></a>07. è®¿é—®å™¨è£…é¥°å™¨</h3><p>@<strong>å‚æ•°</strong></p><ol><li>target</li><li>propertyKey</li><li>descriptor {<br> get<br> set<br> enumerable<br> configurable<br>}</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ç®¡æ˜¯ç»™ <code>get</code> or <code>set</code> æ·»åŠ è®¿é—®å™¨ï¼Œæ·»åŠ ä¸€ä¸ªå°±ç›¸å½“äºéƒ½æ·»åŠ äº†</p><p>@<strong>è¿”å›</strong> å¿½ç•¥</p><p>@<strong>åœºæ™¯</strong></p><p>å…¶å®å’Œæ–¹æ³•å·®ä¸å¤šï¼Œé‡å†™ï¼ŒåŠ æ—¥å¿—ç­‰ç­‰ï¼Œåªè¦ä½ æƒ³å¾—åˆ°ã€‚</p><h3 id="08-å‚æ•°è£…é¥°å™¨"><a href="#08-å‚æ•°è£…é¥°å™¨" class="headerlink" title="08. å‚æ•°è£…é¥°å™¨"></a>08. å‚æ•°è£…é¥°å™¨</h3><p>@<strong>å‚æ•°</strong></p><ol><li>target: å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å™¨ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ¥è¯´æ˜¯ç±»çš„åŸå‹é“¾ã€‚</li><li>propertyKey: å±æ€§çš„åç§°(æ³¨æ„æ˜¯æ–¹æ³•çš„åç§°ï¼Œè€Œä¸æ˜¯å‚æ•°çš„åç§°)ã€‚</li><li>parameterIndex: å‚æ•°åœ¨æ–¹æ³•ä¸­æ‰€å¤„çš„ä½ç½®çš„ä¸‹æ ‡ã€‚</li></ol><p>@<strong>è¿”å›</strong> </p><p>å¿½ç•¥</p><p>@<strong>åœºæ™¯</strong></p><p>éªŒè¯ï¼ŒéªŒè¯æ–¹å¼ï¼Œæ—¥å¿—ç­‰ç­‰ã€‚</p><h3 id="09-ä¾‹å­"><a href="#09-ä¾‹å­" class="headerlink" title="09. ä¾‹å­"></a>09. ä¾‹å­</h3><p>å¦‚æœæˆ‘éœ€è¦å†™ä¸€ä¸ªç±»çš„å‚æ•°çš„è£…é¥°å™¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">// 1. å±æ€§ &gt; æ–¹æ³• &gt; å‚æ•° &gt; è®¿é—®å™¨ &gt; é™æ€å±æ€§ &gt; é™æ€æ–¹æ³• &gt; ç±»</span><br><span class="line">// 2. è£…é¥°å™¨åªåœ¨è§£é‡Šæ‰§è¡Œæ—¶åº”ç”¨ä¸€æ¬¡</span><br><span class="line">// 3. æ‰€ä»¥éœ€è¦åœ¨æ–¹æ³•æˆ–è€…ç±»è£…é¥°å™¨è§£æçš„æ—¶å€™ï¼Œé‡è½½ä¸ºå¿…åŒ…ï¼Œå…ˆéªŒè¯å‚æ•°ï¼Œåè°ƒç”¨</span><br><span class="line">// 4. éœ€è¦æœ‰å˜é‡ä¿å­˜éªŒè¯çš„å‡½æ•°</span><br><span class="line">// 5. éœ€è¦å·¥å‚æ–¹æ³•ï¼Œæˆ–è€…æŠ½è±¡ç±»å»å†™æ¸…æ¥šå„ç§ä¸åŒçš„éªŒè¯</span><br><span class="line"></span><br><span class="line">//éªŒè¯ç±»å‹</span><br><span class="line">type Validator = (x: any) =&gt; boolean;</span><br><span class="line"></span><br><span class="line">//éªŒè¯æ–¹æ³•é›†åˆ</span><br><span class="line">let validatorMap = new Map&lt;string, Validator&gt;();</span><br><span class="line"></span><br><span class="line">//å±æ€§éªŒè¯è£…é¥°å™¨å·¥å‚</span><br><span class="line">function validatorFactiory(vaildator: Validator) &#123;</span><br><span class="line">  return function (target, key, index) &#123;</span><br><span class="line">    let keyStr = key as string;</span><br><span class="line">    let t = validatorMap[keyStr] ?? [];</span><br><span class="line">    t[index] = vaildator;</span><br><span class="line">    validatorMap.set(key, t);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//æš‚æ—¶ä¸éœ€è¦å‚æ•°</span><br><span class="line">//</span><br><span class="line">function valid(target: any, key: string, descriptor: PropertyDescriptor) &#123;</span><br><span class="line"></span><br><span class="line">  //ä¿å­˜åŸæœ‰æ–¹æ³•</span><br><span class="line">  const original = descriptor.value;</span><br><span class="line"></span><br><span class="line">  descriptor.value = function (...args) &#123;</span><br><span class="line"></span><br><span class="line">    //éªŒè¯å‚æ•°</span><br><span class="line">    for (let i in args) &#123;</span><br><span class="line">      let validtors = validatorMap.get(key);</span><br><span class="line">      if (validtors !== undefined) &#123;</span><br><span class="line">        for (let i = 0; i &lt; validtors.length; i++) &#123;</span><br><span class="line">          if(!validtors[i](args[i])) &#123;</span><br><span class="line">            throw new Error(`$&#123;key&#125; å€¼ä¸º $&#123;args[i]&#125;, éªŒè¯å¤±è´¥`);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    original.call(this, &#123; ...args &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const validString = validatorFactiory((v: any) =&gt; &#123;</span><br><span class="line">  return typeof v === &quot;string&quot;;</span><br><span class="line">&#125;);</span><br><span class="line">const validNumber = validatorFactiory((v: any) =&gt; &#123;</span><br><span class="line">  return Number.isInteger(v);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">class C &#123;</span><br><span class="line">  @valid</span><br><span class="line">  a(@validString a) &#123;</span><br><span class="line">    return a;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let myC = new C();</span><br><span class="line">myC.a(1);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±å†™äº†ä¸€ä¸ªç®€å•çš„è£…é¥°å™¨ï¼Œä¸ä»…å¦‚æ­¤ï¼Œæ¯”å¦‚æˆ‘è¦å†™ä¸€ä¸ªè§£æ request bodyçš„è£…é¥°å™¨ï¼Œä¹Ÿå¯ä»¥è¿™æ ·å†™ã€‚</p><h3 id="11-link"><a href="#11-link" class="headerlink" title="11. link"></a>11. link</h3><p><a href="https://es6.ruanyifeng.com/#docs/decorator">é˜®ä¸€å³° es6 è£…é¥°å™¨</a></p><p><a href="https://www.tslang.cn/docs/handbook/decorators.html">typescript ä¸­æ–‡æ–‡æ¡£ è£…é¥°å™¨</a></p><p><a href="https://jkchao.github.io/typescript-book-chinese/tips/metadata.html#%E5%9F%BA%E7%A1%80">Reflect Metadata typescript</a></p><p><a href="https://stackoverflow.com/questions/58057916/what-does-t-extends-new-args-any-constructort-mean-in-typescr">What does &lt;T extends { new(â€¦args: any[]): {} }&gt;(constructor:T) mean in typescript?</a></p><p>[TypeScript ä¸­çš„ Decorator &amp; å…ƒæ•°æ®åå°„ï¼šä»å°ç™½åˆ°ä¸“å®¶ï¼ˆéƒ¨åˆ† Iï¼‰(<a href="https://zhuanlan.zhihu.com/p/20297283">https://zhuanlan.zhihu.com/p/20297283</a>)</p><p><a href="https://stackoverflow.com/questions/45165224/what-is-reflect-decorate-in-js-code-transpiled-from-ts">What is <code>Reflect.decorate</code> in JS code transpiled from TS?</a></p><p><a href="https://github.com/tc39/proposal-decorators">tc39 Decorators</a></p><p><a href="https://stackoverflow.com/questions/37694322/typescript-ts1241-unable-to-resolve-signature-of-method-decorator-when-called-a">typescript TS1241: Unable to resolve signature of method decorator when called as an expression</a></p><p><a href="https://github.com/rbuckton/reflect-metadata">reflect-metadata</a></p><p><a href="https://jkchao.github.io/typescript-book-chinese/tips/metadata.html#%E5%9F%BA%E7%A1%80">Reflect Metadata</a></p><p><a href="https://www.zhihu.com/question/20679872">ä»€ä¹ˆæ˜¯å…ƒæ•°æ®ï¼Ÿä¸ºä½•éœ€è¦å…ƒæ•°æ®?</a></p><p><a href="https://www.ruanyifeng.com/blog/2007/03/metadata.html">å…ƒæ•°æ®,é˜®ä¸€å³°</a></p><p><a href="https://mirone.me/zh-hans/a-complete-guide-to-typescript-decorator/">TypeScriptè£…é¥°å™¨å®Œå…¨æŒ‡å—</a></p></div>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> typescript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ConstructSignature é”™è¯¯</title>
      <link href="/2023/07/03/constructSignatureError/"/>
      <url>/2023/07/03/constructSignatureError/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="ConstructSignature"><a href="#ConstructSignature" class="headerlink" title="ConstructSignature"></a>ConstructSignature</h1><p>çœ‹æ„é€ å‡½æ•°ç­¾åèµ·æºäºä¸€ä¸ªé”™è¯¯</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">commonMobileFunc</span> &#123;</span><br><span class="line">  <span class="keyword">abstract</span> <span class="title function_">call</span>(<span class="attr">ph</span>: <span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="keyword">abstract</span> <span class="title function_">sms</span>(<span class="attr">ph</span>: <span class="built_in">number</span>, <span class="attr">text</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">oldMobile</span> <span class="keyword">extends</span> <span class="title class_ inherited__">commonMobileFunc</span> &#123;</span><br><span class="line">  <span class="title function_">call</span>(<span class="attr">ph</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;&#125;</span><br><span class="line">  <span class="title function_">sms</span>(<span class="attr">ph</span>: <span class="built_in">number</span>, <span class="attr">text</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">newMobile</span> <span class="keyword">extends</span> <span class="title class_ inherited__">commonMobileFunc</span> &#123;</span><br><span class="line">  <span class="title function_">call</span>(<span class="attr">ph</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;&#125;</span><br><span class="line">  <span class="title function_">sms</span>(<span class="attr">ph</span>: <span class="built_in">number</span>, <span class="attr">text</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;&#125;</span><br><span class="line">  <span class="title function_">videoCall</span>(<span class="params">ph: <span class="built_in">number</span></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">exec</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">model</span>: T;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">arg: T</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">model</span> = <span class="keyword">new</span> <span class="title function_">arg</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">sms</span>(<span class="params">ph: <span class="built_in">number</span>, text: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">model</span>.<span class="title function_">sms</span>(ph, text);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æŠ½è±¡å‡ºä¸€ä¸ªé€šç”¨çš„æ‰‹æœºåŠŸèƒ½ç±»å‹<br>æ–°æ‰‹æœº call sms videoCall<br>æ—§æ‰‹æœº call sms<br>å¦‚æœæˆ‘æƒ³å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å·¥å‚æ–¹æ³•ï¼Œä¾èµ–æ³¨å…¥ç­‰ç­‰æ–¹å¼<br>è¿™æ¬¡æƒ³é€šè¿‡æ³›å‹çš„æ–¹æ³•å»å®ä¾‹åŒ–ï¼Œä½†æ˜¯æŠ¥é”™äº†ã€‚</p></blockquote><p>ä½†æ˜¯æ„é€ å‡½æ•°ç­¾åå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜</p><h3 id="01-ä»€ä¹ˆæ˜¯æ„é€ å‡½æ•°ç­¾å"><a href="#01-ä»€ä¹ˆæ˜¯æ„é€ å‡½æ•°ç­¾å" class="headerlink" title="01. ä»€ä¹ˆæ˜¯æ„é€ å‡½æ•°ç­¾å"></a>01. ä»€ä¹ˆæ˜¯æ„é€ å‡½æ•°ç­¾å</h3><p>è¯­æ³•</p><blockquote><p>ConstructSignature: newâ€ƒTypeParametersopt (ParameterListopt) TypeAnnotationopt</p></blockquote><p>TypeScript å®˜æ–¹è§£é‡Š</p><blockquote><p>An object type containing one or more construct signatures is said to be a constructor type. Constructor types may be written using constructor type literals or by including construct signatures in object type literals.</p></blockquote><p>æœºç¿»</p><blockquote><p>åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ„é€ ç­¾åçš„å¯¹è±¡ç±»å‹è¢«ç§°ä¸ºæ„é€ å‡½æ•°ç±»å‹ã€‚ æ„é€ å‡½æ•°ç±»å‹å¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°ç±»å‹æ–‡å­—æˆ–é€šè¿‡åœ¨å¯¹è±¡ç±»å‹æ–‡å­—ä¸­åŒ…å«æ„é€ ç­¾åæ¥ç¼–å†™ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™ç§</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> &lt;<span class="variable constant_">T1</span>,<span class="variable constant_">T2</span> ...&gt;<span class="function">(<span class="params">p1, p2</span>) =&gt;</span> <span class="title class_">Result</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·é—®é¢˜å°±å¾—åˆ°äº†è§£å†³, æ²¿ç”¨æœ€å¼€å§‹æŠ½è±¡çš„ä¾‹å­</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> I1 &#123;</span><br><span class="line">  <span class="keyword">new</span> (): commonMobileFunc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C2</span> &#123;</span><br><span class="line">    <span class="attr">model</span>: commonMobileFunc;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">arg: I1</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">model</span> = <span class="keyword">new</span> <span class="title function_">arg</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç”¨ç®€å†™çš„æ–¹å¼</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">C2</span> &#123;</span><br><span class="line">    <span class="attr">model</span>: commonMobileFunc;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">arg: &#123; <span class="keyword">new</span>(): commonMobileFunc &#125;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">model</span> = <span class="keyword">new</span> <span class="title function_">arg</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="02-æ³›å‹æ„é€ å‡½æ•°ç­¾å"><a href="#02-æ³›å‹æ„é€ å‡½æ•°ç­¾å" class="headerlink" title="02. æ³›å‹æ„é€ å‡½æ•°ç­¾å"></a>02. æ³›å‹æ„é€ å‡½æ•°ç­¾å</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> T3&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">new</span> (): T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> T4 &#123;</span><br><span class="line">    <span class="title function_">sms</span>(<span class="attr">ph</span>: <span class="built_in">number</span>, <span class="attr">text</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">    <span class="title function_">call</span>(<span class="attr">ph</span>: <span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C3</span>&lt;T&gt; <span class="keyword">implements</span> <span class="variable constant_">T4</span> &#123;</span><br><span class="line">  <span class="attr">model</span>: T;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">arg: T3&lt;T&gt;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">model</span> = <span class="keyword">new</span> <span class="title function_">arg</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">sms</span>(<span class="attr">ph</span>: <span class="built_in">number</span>, <span class="attr">text</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">      <span class="comment">//..</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">call</span>(<span class="attr">ph</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">      <span class="comment">//..</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦æ™ºèƒ½æç¤ºï¼Œå¯ä»¥å¢åŠ çº¦æŸ</p><h3 id="03-åº”ç”¨åœºæ™¯"><a href="#03-åº”ç”¨åœºæ™¯" class="headerlink" title="03. åº”ç”¨åœºæ™¯"></a>03. åº”ç”¨åœºæ™¯</h3><p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ³›å‹å·¥å‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function F1&lt;T&gt;(arg: &#123; new():T &#125;) &#123;</span><br><span class="line">    return new arg();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä¸Šæ–‡å†™çš„ä¹Ÿæ˜¯ä¸€ç§å·¥å‚ï¼Œæ¯”å¦‚æˆ‘æƒ³å®ç°ä¾èµ–æ³¨å…¥,å°±æ˜¯æºäºç±»ä¼¼çš„æ€è·¯</p><h3 id="04-å®šä¹‰äº†æ„é€ å™¨ç­¾åçš„æ¥å£æ— æ³•è¢«å®ç°"><a href="#04-å®šä¹‰äº†æ„é€ å™¨ç­¾åçš„æ¥å£æ— æ³•è¢«å®ç°" class="headerlink" title="04. å®šä¹‰äº†æ„é€ å™¨ç­¾åçš„æ¥å£æ— æ³•è¢«å®ç°"></a>04. å®šä¹‰äº†æ„é€ å™¨ç­¾åçš„æ¥å£æ— æ³•è¢«å®ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface T2&lt;T&gt; &#123;</span><br><span class="line">  new (): T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class C5&lt;T&gt; implements T2&lt;T&gt; &#123;</span><br><span class="line">    constructor(arg: T) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Class â€˜C5 Tâ€™ incorrectly implements interface â€˜T2 Tâ€™.<br>Type â€˜C5 Tâ€™ provides no match for the signature â€˜new (): Tâ€™.ts(2420)</p></blockquote><p>æˆ‘è§‰å¾—è¿™ä¸ªåº”è¯¥å®ç°</p><h3 id="05-link"><a href="#05-link" class="headerlink" title="05. link"></a>05. link</h3><ol><li><a href="https://www.typescriptlang.org/docs/handbook/2/functions.html">More on Functions</a></li><li><a href="https://stackoverflow.com/questions/13407036/how-does-interfaces-with-construct-signatures-work">How does interfaces with construct signatures work?</a></li><li><a href="https://juejin.cn/post/6844904184894980104#heading-14">ä¸€æ–‡è¯»æ‡‚ TypeScript æ³›å‹åŠåº”ç”¨ï¼ˆ 7.8Kå­—ï¼‰</a></li></ol></div>]]></content>
      
      
      
        <tags>
            
            <tag> typescript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é‡ç»˜å’Œå›æµçš„åŸºæœ¬æ¦‚å¿µ</title>
      <link href="/2023/07/03/repaint_reflow/"/>
      <url>/2023/07/03/repaint_reflow/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="01-åŸºæœ¬æ¦‚å¿µ"><a href="#01-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="01. åŸºæœ¬æ¦‚å¿µ"></a>01. åŸºæœ¬æ¦‚å¿µ</h3><p>å•çº¯è¯´æ¦‚å¿µå°±æ˜¯ æµè§ˆå™¨æ¸²æŸ“ä¼šè§£æcssï¼Œdomå¯¹å§ï¼Œå¦‚æœä½ æ›´æ”¹èƒŒæ™¯é¢œè‰²ï¼Œdomç­‰ç­‰å°±éœ€è¦é‡æ–°æ¸²æŸ“å¯¹å§ï¼Œè¿™ä¸ªå°±æ˜¯é‡ç»˜å’Œå›æµã€‚</p><p>å¤æ‚ä¸€ç‚¹è¯´æ¦‚å¿µå°±æ˜¯</p><blockquote><p>é‡ç»˜ï¼ˆRepaintï¼‰ï¼š</p><p>å®šä¹‰ï¼šé‡ç»˜æ˜¯æŒ‡å½“å…ƒç´ çš„æ ·å¼å‘ç”Ÿæ”¹å˜ï¼Œä½†ä¸å½±å“å…¶å¸ƒå±€çš„æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨é‡æ–°ç»˜åˆ¶å…ƒç´ çš„å¯è§†éƒ¨åˆ†ã€‚</p><p>è¿‡ç¨‹ï¼šæµè§ˆå™¨ä¼šæ ¹æ®æ–°çš„æ ·å¼å±æ€§å€¼æ›´æ–°å…ƒç´ çš„è§†è§‰å¤–è§‚ï¼Œé‡æ–°ç»˜åˆ¶å…ƒç´ çš„èƒŒæ™¯è‰²ã€è¾¹æ¡†ã€æ–‡æœ¬ç­‰å¯è§†æ•ˆæœã€‚<br>å½±å“ï¼šé‡ç»˜æ“ä½œä¸ä¼šå½±å“é¡µé¢çš„å¸ƒå±€å’Œå‡ ä½•å±æ€§ï¼Œåªæ˜¯é‡æ–°ç»˜åˆ¶å…ƒç´ çš„å¤–è§‚ï¼Œæ‰€ä»¥å¼€é”€ç›¸å¯¹è¾ƒå°ã€‚</p><p>å›æµï¼ˆReflowï¼‰ï¼š</p><p>å®šä¹‰ï¼šå›æµæ˜¯æŒ‡å½“é¡µé¢çš„å¸ƒå±€å‘ç”Ÿæ”¹å˜ï¼Œä¾‹å¦‚å…ƒç´ çš„å°ºå¯¸ã€ä½ç½®ã€æ˜¾ç¤º&#x2F;éšè—çŠ¶æ€ç­‰æ”¹å˜æ—¶ï¼Œæµè§ˆå™¨é‡æ–°è®¡ç®—å¹¶åº”ç”¨æ‰€æœ‰å—å½±å“å…ƒç´ çš„å‡ ä½•å±æ€§ï¼Œç„¶åé‡æ–°æ’åˆ—é¡µé¢ä¸­çš„å…ƒç´ ã€‚</p><p>è¿‡ç¨‹ï¼šæµè§ˆå™¨ä¼šä»é¡µé¢çš„æ ¹èŠ‚ç‚¹å¼€å§‹é€’å½’éå†ï¼Œå¹¶è®¡ç®—æ¯ä¸ªå—å½±å“å…ƒç´ çš„å¸ƒå±€å±æ€§ï¼Œä¾‹å¦‚ä½ç½®ã€å°ºå¯¸ã€ç›¸å¯¹å…³ç³»ç­‰ã€‚<br>å½±å“ï¼šå›æµæ“ä½œæ¶‰åŠå¤§é‡çš„è®¡ç®—å’Œé‡æ–°æ’åˆ—ï¼Œä¼šå¯¼è‡´æ•´ä¸ªé¡µé¢æˆ–éƒ¨åˆ†é¡µé¢çš„é‡å»ºï¼Œå¼€é”€è¾ƒå¤§ï¼Œå¯èƒ½ä¼šå¼•èµ·é¡µé¢é—ªçƒå’Œæ€§èƒ½ä¸‹é™ã€‚</p></blockquote><h3 id="02-æµè§ˆå™¨è¯·æ±‚çš„åŸºæœ¬åŸç†"><a href="#02-æµè§ˆå™¨è¯·æ±‚çš„åŸºæœ¬åŸç†" class="headerlink" title="02. æµè§ˆå™¨è¯·æ±‚çš„åŸºæœ¬åŸç†"></a>02. æµè§ˆå™¨è¯·æ±‚çš„åŸºæœ¬åŸç†</h3><p>åœ¨çŸ¥é“ä»€ä¹ˆæ˜¯é‡ç»˜å’Œå›æµä»¥åï¼Œå¦‚æœè¦ææ¸…æ¥šç©¶ç«Ÿæ˜¯æ€ä¹ˆå›äº‹å„¿ï¼Œå°±éœ€è¦æµè§ˆå™¨å¤§æ¦‚æ˜¯æ€ä¹ˆåšçš„</p><ol><li>ç”¨æˆ·åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥è¦è®¿é—®çš„ç½‘å€ï¼ˆURLï¼‰ï¼Œç„¶åæŒ‰ä¸‹å›è½¦é”®ã€‚</li><li>æµè§ˆå™¨ä¼šå°†è¾“å…¥çš„ç½‘å€å‘é€ç»™æœ¬åœ°çš„DNSè§£æå™¨ï¼Œè§£æå™¨è´Ÿè´£å°†åŸŸåè½¬æ¢ä¸ºå¯¹åº”çš„IPåœ°å€ã€‚</li><li>æµè§ˆå™¨ä½¿ç”¨HTTPæˆ–HTTPSåè®®ï¼Œé€šè¿‡TCP&#x2F;IPåè®®ä¸æœåŠ¡å™¨å»ºç«‹ç½‘ç»œè¿æ¥ã€‚è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œç¡®ä¿å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„å¯é è¿æ¥ã€‚</li><li>æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚ï¼ŒåŒ…æ‹¬è¯·æ±‚çš„æ–¹æ³•ï¼ˆGETã€POSTç­‰ï¼‰ã€è¯·æ±‚çš„èµ„æºè·¯å¾„ã€è¯·æ±‚å¤´éƒ¨ç­‰ä¿¡æ¯ã€‚</li><li>æœåŠ¡å™¨æ¥æ”¶åˆ°æµè§ˆå™¨å‘é€çš„è¯·æ±‚åï¼Œæ ¹æ®è¯·æ±‚çš„èµ„æºè·¯å¾„å’Œå…¶ä»–å‚æ•°è¿›è¡Œå¤„ç†ã€‚æœåŠ¡å™¨å¯èƒ½éœ€è¦æŸ¥è¯¢æ•°æ®åº“ã€æ‰§è¡Œä¸šåŠ¡é€»è¾‘ç­‰æ“ä½œï¼Œæœ€ç»ˆç”Ÿæˆç›¸åº”çš„æ•°æ®æˆ–é¡µé¢ã€‚</li><li>æœåŠ¡å™¨å°†å¤„ç†ç»“æœå°è£…æˆHTTPå“åº”ï¼ŒåŒ…æ‹¬å“åº”çš„çŠ¶æ€ç ã€å“åº”å¤´éƒ¨å’Œå“åº”ä½“ç­‰ä¿¡æ¯ã€‚æœåŠ¡å™¨ä¼šå°†å“åº”å‘é€å›ç»™æµè§ˆå™¨ã€‚</li><li>æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„HTTPå“åº”ï¼Œå¼€å§‹æ¥æ”¶å“åº”æ•°æ®ã€‚</li><li>æµè§ˆå™¨å¯¹æ”¶åˆ°çš„HTTPå“åº”è¿›è¡Œè§£æï¼Œæå–å‡ºå“åº”å¤´éƒ¨å’Œå“åº”ä½“ç­‰ä¿¡æ¯ã€‚</li><li>æµè§ˆå™¨å¼€å§‹æ ¹æ®è§£æå¾—åˆ°çš„å“åº”æ•°æ®ï¼Œæ¸²æŸ“é¡µé¢ã€‚è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬è§£æHTMLç»“æ„ã€æ„å»ºDOMæ ‘ï¼ŒåŠ è½½å’Œè§£æCSSæ ·å¼ï¼Œä»¥åŠæ‰§è¡ŒJavaScriptä»£ç ã€‚</li><li>æµè§ˆå™¨å°†DOMæ ‘å’ŒCSSæ ·å¼ç»“åˆèµ·æ¥ï¼Œæ„å»ºæ¸²æŸ“æ ‘ï¼ˆRender Treeï¼‰ã€‚æ¸²æŸ“æ ‘è¡¨ç¤ºäº†è¦æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šçš„æ‰€æœ‰å¯è§å…ƒç´ åŠå…¶æ ·å¼ä¿¡æ¯ã€‚</li><li>æµè§ˆå™¨æ ¹æ®æ¸²æŸ“æ ‘çš„ä¿¡æ¯ï¼Œè®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨é¡µé¢ä¸Šçš„ä½ç½®å’Œå¤§å°ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºå¸ƒå±€æˆ–å›æµï¼ˆreflowï¼‰ã€‚</li><li>æµè§ˆå™¨æ ¹æ®æ¸²æŸ“æ ‘å’Œå¸ƒå±€ç»“æœï¼Œå¼€å§‹ç»˜åˆ¶é¡µé¢çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†å…¶å‘ˆç°åœ¨å±å¹•ä¸Šã€‚</li><li>ç»˜åˆ¶å®Œæˆåï¼Œæµè§ˆå™¨å°†é¡µé¢å‘ˆç°ç»™ç”¨æˆ·è¿›è¡ŒæŸ¥çœ‹ã€‚ç”¨æˆ·å¯ä»¥ä¸é¡µé¢è¿›è¡Œäº¤äº’ï¼Œæ‰§è¡Œæ“ä½œã€‚</li></ol><p>ç®€å•è¯´å°±å¦‚ä¸‹</p><p>url &#x3D;&gt; dns &#x3D;&gt; ip &#x3D;&gt; tcp &#x3D;&gt; http(get,post..) &#x3D;&gt; è·å–å“åº”æ•°æ®(å¤´ï¼Œæ•°æ®ç­‰) &#x3D;&gt; è§£æhtml &#x3D;&gt; æ„å»ºdomæ ‘ &#x3D;&gt; cssæ ‘ &#x3D;&gt; æ‰§è¡Œjavascript &#x3D;&gt; ç»“åˆdomæ ‘ï¼Œcssæ ‘ èº«æˆ renderæ ‘ã€‚ &#x3D;&gt; æ¸²æŸ“å‡ºå…ƒç´ ä½ç½®å’Œå¤§å°(å›æµ) &#x3D;&gt; ç»˜åˆ¶å…ƒç´ (é‡ç»˜)</p><p>è¿‡ç¨‹å¤§æ¦‚å°±æ˜¯è¿™æ ·, è¿™é‡ŒçŸ¥é“äº†å›æµå’Œé‡ç»˜äº§ç”Ÿçš„é˜¶æ®µï¼Œä½†æ˜¯è¿™é‡Œå…¶å®æ²¡æœ‰è¯´ä¸€äº›ç»†èŠ‚æ¦‚å¿µï¼Œä½†æ˜¯å’Œå›æµå’Œé‡ç»˜ç›¸å…³ã€‚</p><ol><li>æµè§ˆå™¨å°†DOMè§£æä¸ºDOMæ ‘ï¼Œå¹¶å°†æ ‘ä¸­çš„èŠ‚ç‚¹åˆ†å‰²ä¸ºå¤šä¸ªå›¾å±‚ï¼ˆLayerï¼‰ï¼Œä»¥ä¾¿è¿›è¡Œåç»­çš„æ¸²æŸ“ä¼˜åŒ–ã€‚</li><li>æµè§ˆå™¨å¯¹æ¯ä¸ªå›¾å±‚çš„èŠ‚ç‚¹è¿›è¡Œæ ·å¼è®¡ç®—ï¼Œç¡®å®šæ¯ä¸ªèŠ‚ç‚¹çš„æœ€ç»ˆæ ·å¼ç»“æœã€‚</li><li>layout, æ¸²æŸ“å‡ºå…ƒç´ ä½ç½®å’Œå¤§å°(å›æµ)</li><li>åœ¨ç»˜åˆ¶ï¼ˆPaintï¼‰é˜¶æ®µï¼Œæµè§ˆå™¨å°†æ¯ä¸ªèŠ‚ç‚¹çš„ç»˜åˆ¶å‘½ä»¤è½¬åŒ–ä¸ºä½å›¾ï¼Œå°†èŠ‚ç‚¹çš„å†…å®¹ç»˜åˆ¶åˆ°å›¾å±‚çš„ä½å›¾ä¸­</li><li>å›¾å±‚ä½œä¸ºçº¹ç†ä¸Šä¼ è‡³GPU</li><li>æµè§ˆå™¨å°†ä¸åŒå›¾å±‚çš„ä½å›¾è¿›è¡Œåˆæˆï¼ˆCompositeï¼‰ï¼ŒæŒ‰ç…§æ­£ç¡®çš„å±‚æ¬¡é¡ºåºå åŠ åœ¨ä¸€èµ·ï¼Œç”Ÿæˆæœ€ç»ˆçš„å±å¹•å›¾åƒ</li></ol><p>è¿™å°±æ˜¯æµè§ˆå™¨æ¸²æŸ“çš„åŸºæœ¬æµç¨‹ï¼Œä¸ºä»€ä¹ˆè¦è®²è¿™ä¸ªï¼Ÿä¸ºä»€ä¹ˆè¦çŸ¥é“å›¾å±‚çš„æ¦‚å¿µï¼Ÿ</p><p>å› ä¸ºé‡ç»˜å’Œå›æµå¯ä»¥æ§åˆ¶åœ¨å›¾å±‚ä¸­ï¼Œå¯ä»¥é™åˆ¶èŒƒå›´ï¼Œä»è€Œæå‡æ€§èƒ½ã€‚</p><h3 id="03-é‡ç»˜ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#03-é‡ç»˜ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="03. é‡ç»˜ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ"></a>03. é‡ç»˜ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ä»ä¹‹å‰è®²çš„åŸºæœ¬æ¦‚å¿µæˆ‘ä»¬å¯ä»¥çŸ¥é“é‡ç»˜çš„ä»£ä»·æ˜¯æ¯”è¾ƒå°çš„</p><blockquote><p>æµè§ˆå™¨ä¼šæ ¹æ®æ–°çš„æ ·å¼å±æ€§å€¼æ›´æ–°å…ƒç´ çš„è§†è§‰å¤–è§‚ï¼Œé‡æ–°ç»˜åˆ¶å…ƒç´ çš„èƒŒæ™¯è‰²ã€è¾¹æ¡†ã€æ–‡æœ¬ç­‰å¯è§†æ•ˆæœã€‚<br>å½±å“ï¼šé‡ç»˜æ“ä½œä¸ä¼šå½±å“é¡µé¢çš„å¸ƒå±€å’Œå‡ ä½•å±æ€§ï¼Œåªæ˜¯é‡æ–°ç»˜åˆ¶å…ƒç´ çš„å¤–è§‚ï¼Œæ‰€ä»¥å¼€é”€ç›¸å¯¹è¾ƒå°.</p></blockquote><p>å› ä¸ºå®ƒä¸ä¼šæ”¹å˜æ•´ä½“å¤§å°ï¼Œä¸ä¼šå¯¼è‡´æ•´ä½“å¤§å°é‡æ–°è®¡ç®—ï¼Œä»…ä»…æ”¹å˜å½“å‰éƒ¨åˆ†ï¼Œæ‰€ä»¥ä»£ä»·æ˜¯æ¯”è¾ƒå°çš„ã€‚</p><p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯é‡ç»˜çš„èŒƒå›´, æˆ‘åœ¨æŸ¥èµ„æ–™çš„æ—¶å€™ï¼Œå¯¹äºé‡ç»˜çš„è¯´æ³•éƒ½æ˜¯åªå½±å“å½“å‰çš„å…ƒç´ ï¼Œé‚£ä¹ˆä»–æ˜¯å¦æœ‰å¯èƒ½å½±å“åˆ°å…¶ä»–å…ƒç´ å‘¢ï¼Ÿ</p><p>è¿™é‡Œæ˜¯å¯èƒ½è§¦å‘é‡ç»˜çš„æ“ä½œ</p><ul><li>color</li><li>background</li><li>outline-color  </li><li>border-style </li><li>background-image </li><li>outline</li><li>border-radius </li><li>background-position </li><li>outline-style</li><li>visibility </li><li>background-repeat </li><li>outline-width     </li><li>text-decoration </li><li>background-size </li><li>box-shadow</li></ul><p>é‡ç»˜çš„å¼€é”€å…¶å®å¯ä»¥ä¸é‚£ä¹ˆç²¾ç¡®è®¡ç®—ï¼Œå› ä¸ºæ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šå‡ºç°ä¸åœçš„ä¿®æ”¹æ ·å¼ï¼Œå¾€å¾€æ˜¯åšåŠ¨ç”»çš„æ—¶å€™æ‰ä¼šå‡ºç°ã€‚è¿™ä¸ªæ—¶å€™å–„ç”¨ css3åŠ¨ç”»çš„gpuåŠ é€Ÿçš„ç‰¹æ€§å°±å¥½äº†ã€‚</p><h3 id="04-å›æµçš„ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#04-å›æµçš„ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="04. å›æµçš„ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ"></a>04. å›æµçš„ä»£ä»·æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>å›æµå°±æ¯”è¾ƒç®€å•äº†ï¼Œä»»ä½•æ”¹å˜éƒ½å¯èƒ½å¯¼è‡´æ•´ä¸ªé¡µé¢å›æµï¼Œæœ€ç®€å•çš„ä¾‹å­å°±æ˜¯çª—å£å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆæ•´ä¸ªé¡µé¢ä¹Ÿå°±å›æµäº†ã€‚</p><p>æ¯”å¦‚ä½ çªç„¶æ”¹å˜ä¸€ä¸ªå…ƒç´ çš„å¤§å°ï¼Œè‡ªç„¶ä¼šå¯¼è‡´é—®é¢˜ï¼Œè¿™å°±æ˜¯åº”è¯¥é¿å…æˆ–è€…ä¼˜åŒ–çš„ä¸œè¥¿ã€‚</p><ul><li>width </li><li>top </li><li>text-align </li><li>height </li><li>bottom </li><li>overflow-y </li><li>padding </li><li>left </li><li>font-weight </li><li>margin </li><li>right </li><li>overflow </li><li>display </li><li>position </li><li>font-family </li><li>border-width </li><li>float </li><li>line </li><li>height </li><li>border </li><li>clear </li><li>vertival-align </li><li>min-height </li><li>white-space</li></ul><h3 id="05-ä¼˜åŒ–"><a href="#05-ä¼˜åŒ–" class="headerlink" title="05. ä¼˜åŒ–"></a>05. ä¼˜åŒ–</h3><h5 id="05-01-åˆå¹¶æ“ä½œ"><a href="#05-01-åˆå¹¶æ“ä½œ" class="headerlink" title="05.01. åˆå¹¶æ“ä½œ"></a>05.01. åˆå¹¶æ“ä½œ</h5><p>å½“æˆ‘ä»¬è¦å»ä¿®æ”¹cssï¼Œå°½é‡ä¸ç”¨ä½¿ç”¨è¡Œå†…cssï¼Œå¤šç”¨classï¼Œä¿è¯ä¿®æ”¹æ¬¡æ•°å°‘ã€‚<br>è®¾è®¡ css çš„æ—¶å€™ï¼Œå¤šç”¨é€‰æ‹©å™¨ã€‚<br>ä¿è¯ä¸€ä»¶äº‹ï¼Œå‡å°‘æ¬¡æ•°ï¼Œä½†æ˜¯è¿™ä¸ªä¼¼ä¹ç°åœ¨æµè§ˆå™¨éƒ½åšäº†ä¼˜åŒ–ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦æ³¨æ„ã€‚</p><p>åœ¨cssä¸Šæ³¨æ„ï¼Œåœ¨domæ“ä½œä¸Šä¹Ÿéœ€è¦æ³¨æ„ã€‚<br>æ¯”å¦‚æˆ‘è¦ç»‘å®šæ•°æ®ï¼Œå†™ä¸€ä¸ªå¾ªç¯ä¸åœçš„åˆ›å»ºï¼Œå¯èƒ½ä¼šä¸åœçš„è§¦å‘å›æµã€‚</p><p>åˆå¹¶å°±æ˜¯å‡å°‘å›æµæ¬¡æ•°</p><ul><li>æ¯”å¦‚è¯´å…ˆéšè—ï¼Œä¿®æ”¹ï¼Œæ˜¾ç¤º</li><li>ä½¿ç”¨ document fragmentï¼Œæ˜¯ä¸€ä¸ªåœ¨å†…å­˜ä¸­å­˜åœ¨ä½†ä¸åœ¨ DOM æ ‘ä¸­çš„æ–‡æ¡£èŠ‚ç‚¹ï¼Œç›¸å½“äºä¸€ä¸ªä¸´æ—¶å®¹å™¨ã€‚</li><li>æˆ–è€…æ‹·è´åˆ°ä¸€ä¸ªä¸æ˜¾ç¤ºçš„åœ°æ–¹ï¼Œåœ¨è¿›è¡Œç§»åŠ¨æ“ä½œã€‚</li></ul><h5 id="05-2-é¿å…è§¦å‘åŒæ­¥å¸ƒå±€"><a href="#05-2-é¿å…è§¦å‘åŒæ­¥å¸ƒå±€" class="headerlink" title="05.2. é¿å…è§¦å‘åŒæ­¥å¸ƒå±€"></a>05.2. é¿å…è§¦å‘åŒæ­¥å¸ƒå±€</h5><p>é¦–å…ˆéœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯åŒæ­¥å¸ƒå±€äº‹ä»¶ï¼Œæˆ‘ä»¬åˆšæ‰çœ‹äº†æµè§ˆå™¨æ‰§è¡Œçš„æµç¨‹</p><p>dom tree &#x3D;&gt; ccs tree &#x3D;&gt; javascript &#x3D;&gt; render tree &#x3D;&gt; layout.</p><p>ä½†æ˜¯å¦‚æœé‡åˆ°ä¸€ç§æƒ…å†µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function a() &#123;</span><br><span class="line">for(let i=0;i&lt;els.length;i++) &#123;</span><br><span class="line">els[i].style.width = box.offsetWidth + &quot;px&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬æ¥æ˜¯ javascript æ‰§è¡Œä»¥åå¼€å§‹è®¡ç®—æ•´ä¸ªå¸ƒå±€ï¼Œä½†æ˜¯å¦‚æœä½ æ¯æ¬¡éƒ½å»è·å–ï¼Œå°±ä¼šå¼ºåˆ¶è®¡ç®—æ•´ä¸ªå¸ƒå±€ï¼Œç„¶åè¿”å›æ•°æ®ï¼Œå†ä¸€æ¬¡å¾ªç¯ï¼Œè¿™ä¸ªå°±æ˜¯é—®é¢˜ã€‚</p><p>ä¸ä»…ä»…æ˜¯æˆ‘è¿™ç§æ“ä½œä¼šè§¦å‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function logBoxHeight() &#123;</span><br><span class="line">Â  box.classList.add(&#x27;super-big&#x27;);</span><br><span class="line"></span><br><span class="line">Â  // Gets the height of the box in pixels</span><br><span class="line">Â  // and logs it out.</span><br><span class="line">Â  console.log(box.offsetHeight);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥javascriptè·å–å±æ€§éœ€è¦è°¨æ…, å‰é¢å¦‚æœæœ‰æ ·å¼ä¿®æ”¹ï¼Œé‚£ä¹ˆå†è·å–å°±ä¼šè§¦å‘ã€‚</p><h5 id="05-03-å–„ç”¨css3ç¡¬åŠ åŠ é€Ÿ"><a href="#05-03-å–„ç”¨css3ç¡¬åŠ åŠ é€Ÿ" class="headerlink" title="05.03 å–„ç”¨css3ç¡¬åŠ åŠ é€Ÿ"></a>05.03 å–„ç”¨css3ç¡¬åŠ åŠ é€Ÿ</h5><p>ç®€å•è¯´å°±æ˜¯ç§»åŠ¨ä½¿ç”¨transformï¼Œæ¥ä»£æ›¿topï¼Œleftã€‚<br>åˆ«ç”¨visibilityï¼Œä½¿ç”¨opacityã€‚<br>å¦‚æœè¦å†™åŠ¨ç”»ï¼Œå¤šç”¨å¯ä»¥è§¦å‘gpuåŠ é€Ÿçš„</p><ul><li>transform</li><li>opacity</li><li>filters</li><li>Will-change</li></ul><h5 id="05-04-requestAnimationFrame"><a href="#05-04-requestAnimationFrame" class="headerlink" title="05.04 requestAnimationFrame"></a>05.04 requestAnimationFrame</h5><p><code>window.requestAnimationFrame()</code> æ˜¯ä¸€ä¸ªç”¨äºæ‰§è¡ŒåŠ¨ç”»çš„ Web API æ–¹æ³•ã€‚å®ƒæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰è¢«è°ƒç”¨ã€‚</p><h3 id="06-æ€»ç»“"><a href="#06-æ€»ç»“" class="headerlink" title="06. æ€»ç»“"></a>06. æ€»ç»“</h3><p>è¿™é‡Œå¼„æ¸…æ¥šäº†å›æµå’Œé‡ç»˜çš„åŸºæœ¬æ¦‚å¿µï¼Œä¸ºä»€ä¹ˆè¦çŸ¥é“è¿™äº›æ¦‚å¿µï¼Œä»è€Œæ›´å¥½çš„å»æå‡æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸€äº›å…³é”®çš„é¡µé¢ä¸Šã€‚</p><p>åªæ˜¯ç°åœ¨å¤§å®¶éƒ½ç”¨æ¡†æ¶äº†ï¼Œæ¡†æ¶å¸®ä½ åšäº†å¤§éƒ¨åˆ†çš„äº‹æƒ…ã€‚</p><h3 id="07-å¼•ç”¨"><a href="#07-å¼•ç”¨" class="headerlink" title="07. å¼•ç”¨"></a>07. å¼•ç”¨</h3><p><a href="https://blog.csdn.net/JHXL_/article/details/124046715">ä¸€æ–‡æ•™ä¼šä½ ä½•ä¸ºé‡ç»˜ã€å›æµï¼Ÿ</a><br><a href="https://segmentfault.com/a/1190000017329980">ä½ çœŸçš„äº†è§£å›æµå’Œé‡ç»˜å—</a></p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> css </tag>
            
            <tag> javascript </tag>
            
            <tag> æµè§ˆå™¨ </tag>
            
            <tag> é‡ç»˜ </tag>
            
            <tag> å›æµ </tag>
            
            <tag> ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IFC å¸ƒå±€æ¨¡å‹</title>
      <link href="/2023/07/03/IFC/"/>
      <url>/2023/07/03/IFC/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1. ç®€ä»‹"></a>1. ç®€ä»‹</h3><p>å®˜æ–¹è§£é‡Š</p><blockquote><p>An inline formatting context is a formatting context that contains inline-level boxes. It is used to determine the layout for the inline-level boxes and their relationships with the line boxes they participate in.</p></blockquote><p>ç®€å•æ¥è¯´ï¼ŒIFC æ˜¯ä¸€ç§ç”¨äºç¡®å®šè¡Œå†…å…ƒç´ çš„å¸ƒå±€å’Œä¸æ‰€åœ¨è¡Œç›’å­ä¹‹é—´å…³ç³»çš„æ¸²æŸ“ä¸Šä¸‹æ–‡ã€‚å®ƒå®šä¹‰äº†è¡Œå†…å…ƒç´ å¦‚ä½•æ’åˆ—ã€å¦‚ä½•å¤„ç†æ–‡æœ¬æ¢è¡Œå’Œæº¢å‡ºç­‰é—®é¢˜ï¼ŒåŒæ—¶è¿˜æ§åˆ¶äº†è¡Œå†…å…ƒç´ ä¸å‘¨å›´å…ƒç´ ä¹‹é—´çš„é—´è·å’Œå¯¹é½æ–¹å¼ã€‚</p><h3 id="2-ç‰¹æ€§"><a href="#2-ç‰¹æ€§" class="headerlink" title="2. ç‰¹æ€§"></a>2. ç‰¹æ€§</h3><ul><li>è¡Œå†…å…ƒç´ åœ¨ IFC ä¸­ä»å·¦åˆ°å³æ’åˆ—ï¼Œç›´åˆ°å æ»¡ä¸€è¡Œï¼Œç„¶åæ¢è¡Œç»§ç»­æ’åˆ—ã€‚</li><li>IFC ä¸­çš„å…ƒç´ åœ¨å‚ç›´æ–¹å‘ä¸Šä»¥åŸºçº¿å¯¹é½ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ã€‚</li><li>IFC çš„å®½åº¦ç”±å…¶åŒ…å«çš„è¡Œå†…å…ƒç´ çš„å®½åº¦å†³å®šï¼Œä¸ä¼šè¶…å‡ºå…¶çˆ¶å®¹å™¨çš„å®½åº¦ã€‚</li><li>IFC ä¸­çš„å…ƒç´ å¯ä»¥é€šè¿‡è®¾ç½® vertical-align å±æ€§æ¥è°ƒæ•´å‚ç›´å¯¹é½æ–¹å¼ã€‚</li><li>IFC ä¸­çš„å…ƒç´ å¯ä»¥é€šè¿‡è®¾ç½® text-align å±æ€§æ¥è°ƒæ•´æ°´å¹³å¯¹é½æ–¹å¼ã€‚</li></ul><h3 id="3-line-box"><a href="#3-line-box" class="headerlink" title="3. line-box"></a>3. line-box</h3><p>è¿™é‡Œæœ‰ä¸€ä¸ªline-boxçš„æ¦‚å¿µï¼Œåœ¨å½¢æˆ IFC ä»¥åï¼Œå°±æœ‰è¿™ä¸ªç©æ„å„¿ã€‚</p><blockquote><p>åœ¨IFCä¸­ï¼Œç›’å­æ°´å¹³æ”¾ç½®ï¼Œä¸€ä¸ªæ¥ç€ä¸€ä¸ªï¼Œä»åŒ…å«å—çš„é¡¶éƒ¨å¼€å§‹ã€‚æ°´å¹³margins,borders,å’Œpaddingåœ¨è¿™äº›ç›’å­ä¸­è¢«å¹³åˆ†ã€‚è¿™äº›ç›’å­ä¹Ÿè®¸é€šè¿‡ä¸åŒçš„æ–¹å¼è¿›è¡Œå¯¹é½:ä»–ä»¬çš„åœ°æ­¥å’Œé¡¶éƒ¨ä¹Ÿè®¸è¢«å¯¹é½ï¼Œæˆ–è€…é€šè¿‡æ–‡å­—çš„åŸºçº¿è¿›è¡Œå¯¹é½ã€‚çŸ©å½¢åŒºåŸŸåŒ…å«ç€æ¥è‡ªä¸€è¡Œçš„ç›’å­å«åšline boxã€‚</p></blockquote><p>æœ‰å¤šå°‘ä¸ªline boxï¼Œå–å†³äºä½  IFC é•¿åº¦å’Œæ˜¾ç¤ºçš„å®½åº¦ã€‚</p><blockquote><p>line boxçš„å®½åº¦ç”±æµ®åŠ¨æƒ…å†µå’Œå®ƒçš„åŒ…å«å—å†³å®šã€‚line boxçš„é«˜åº¦ç”±line-heightçš„è®¡ç®—ç»“æœå†³å®šã€‚</p><p>ä¸€ä¸ªline boxæ€»æ˜¯è¶³å¤Ÿé«˜å¯¹äºåŒ…å«åœ¨å®ƒå†…çš„æ‰€æœ‰ç›’å­ã€‚ç„¶åï¼Œå®ƒä¹Ÿè®¸æ¯”åŒ…å«åœ¨å®ƒå†…æœ€é«˜çš„ç›’å­é«˜ã€‚(æ¯”å¦‚ï¼Œç›’å­å¯¹é½å¯¼è‡´åŸºçº¿æé«˜äº†)ã€‚å½“ç›’å­Bçš„é«˜åº¦æ¯”åŒ…å«å®ƒçš„line boxçš„é«˜åº¦ä½ï¼Œåœ¨line boxå†…çš„Bçš„å‚å€¼å¯¹é½çº¿é€šè¿‡â€™vertical alignâ€™å±æ€§å†³å®šã€‚å½“å‡ ä¸ªè¡Œå†…çº§ç›’å­åœ¨ä¸€ä¸ªå•ç‹¬çš„line boxå†…ä¸èƒ½å¾ˆå¥½çš„æ°´å¹³æ”¾ç½®ï¼Œåˆ™ä»–ä»¬è¢«åˆ†é…æˆäº†2ä¸ªæˆ–è€…æ›´å¤šçš„å‚ç›´é‡å çš„line boxs.å› æ­¤,ä¸€ä¸ªæ®µè½æ˜¯å¾ˆå¤šä¸ªline boxsçš„å‚ç›´å åŠ ã€‚Line boxsè¢«å åŠ æ²¡æœ‰å‚ç›´æ–¹å‘ä¸Šçš„åˆ†ç¦»(ç‰¹æ®Šæƒ…å†µé™¤å¤–)ï¼Œå¹¶ä¸”ä»–ä»¬ä¹Ÿä¸é‡å ã€‚</p></blockquote><p>è¿™é‡Œæ˜¯ç›´æ¥ç¿»è¯‘å®˜æ–¹çš„è‹±æ–‡</p><ol><li>é«˜åº¦è‡ªé€‚åº”ï¼šline box çš„é«˜åº¦ä¼šæ ¹æ®è¡Œå†…å…ƒç´ çš„é«˜åº¦æ¥è‡ªé€‚åº”ï¼Œä»¥åŒ…å«æ‰€æœ‰è¡Œå†…å…ƒç´ çš„å†…å®¹ã€‚è¡Œå†…å…ƒç´ å¯ä»¥å…·æœ‰ä¸åŒçš„é«˜åº¦ï¼Œä½† line box çš„é«˜åº¦ä¼šæ ¹æ®æœ€é«˜çš„è¡Œå†…å…ƒç´ æ¥ç¡®å®šã€‚</li><li>å‚ç›´å¯¹é½ï¼šline box ä¼šæ ¹æ®åŸºçº¿ï¼ˆbaselineï¼‰å¯¹é½è¡Œå†…å…ƒç´ ã€‚è¡Œå†…å…ƒç´ çš„åŸºçº¿å¯ä»¥æ˜¯ä¸åŒçš„ï¼Œä½† line box ä¼šæ ¹æ®è¿™äº›åŸºçº¿æ¥å¯¹é½å®ƒä»¬ã€‚è¿™å¯ä»¥å®ç°è¡Œå†…å…ƒç´ çš„å‚ç›´å¯¹é½ã€‚</li><li>æ°´å¹³å¸ƒå±€ï¼šline box å†…çš„è¡Œå†…å…ƒç´ ä¼šæ°´å¹³æ’åˆ—ã€‚å½“ line box çš„å®½åº¦ä¸è¶³ä»¥å®¹çº³æ‰€æœ‰è¡Œå†…å…ƒç´ æ—¶ï¼Œä¼šæ ¹æ®ç›¸åº”çš„æ’åˆ—è§„åˆ™è¿›è¡Œæ¢è¡Œã€‚</li><li>è¾¹ç•Œè®¡ç®—ï¼šline box çš„è¾¹ç•Œç”±å…¶ä¸­çš„è¡Œå†…å…ƒç´ å†³å®šã€‚line box çš„é¡¶éƒ¨å’Œåº•éƒ¨è¾¹ç•Œä¼šæ ¹æ®è¡Œå†…å…ƒç´ çš„ä¸Šè¾¹ç•Œå’Œä¸‹è¾¹ç•Œæ¥è®¡ç®—ã€‚</li><li>å†…è”ç›’å­é›†åˆï¼šline box å®é™…ä¸Šæ˜¯ä¸€ç»„åŒ…å«è¡Œå†…ç›’å­ï¼ˆinline boxesï¼‰çš„çŸ©å½¢æ¡†ï¼Œæ¯ä¸ªè¡Œå†…ç›’å­å¯¹åº”ä¸€ä¸ªè¡Œå†…å…ƒç´ ã€‚è¡Œå†…ç›’å­ä¼šæ ¹æ®å…¶å…·ä½“çš„å°ºå¯¸å’Œä½ç½®æ’åˆ—åœ¨ line box å†…éƒ¨ã€‚</li></ol><p>è¿™ä¸ªæ¯”è¾ƒæŠ½è±¡ï¼Œæ¢æˆä¸€ä¸ªå®é™…çš„ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">EM &#123;</span><br><span class="line">padding: 10px;</span><br><span class="line">margin: 1em;</span><br><span class="line">border-width: medium;</span><br><span class="line">border-style: dashed;</span><br><span class="line">line-height: 2.4em;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;p&gt;Several &lt;em&gt;emphasized words&lt;/em&gt; appear here.&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æœ‰3ä¸ª <code>line box</code>.</p><p>![alt text](&#x2F;img&#x2F;æˆªå›¾ 2023-06-05 16-41-10.png)</p><p>å…¶ä¸­ä¸¤ä¸ªåŒ¿åï¼Œä¸€ä¸ª emï¼Œ å…¶å®æˆ‘åˆšæ‰æ˜¯å¾ˆç–‘æƒ‘ä¸ºä»€ä¹ˆè¦çŸ¥é“è¿™ä¸ªï¼Ÿç„¶åèµ„æ–™ä¸­ç»™äº†ä¸€ä¸ªä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.dib-baseline &#123;</span><br><span class="line">display: inline-block;</span><br><span class="line">width: 150px;</span><br><span class="line">height: 150px;</span><br><span class="line">border: 1px solid #cad5eb;</span><br><span class="line">background-color: #f0f3f9;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;span class=&quot;dib-baseline&quot;&gt;&lt;/span&gt;</span><br><span class="line">  &lt;span class=&quot;dib-baseline&quot;&gt;x-baseline&lt;/span&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>æˆ‘è–„å¼±çš„çŸ¥è¯†ä¸­é“ç†ä¸Šå»è¯´ï¼Œåº”è¯¥æ˜¯å¹¶æ’çš„ï¼Œå…¶å®ä¸æ˜¯ã€‚</p><p>![alt text](&#x2F;img&#x2F;æˆªå›¾ 2023-06-05 16-45-18.png)</p><p>ç»“æœæ˜¯è¿™ä¸ªæ ·å­ã€‚</p><blockquote><p>æ²¡æœ‰å†…è”å…ƒç´ çš„æ¡†æ¡†ï¼š<br>å½“å®¹å™¨æ²¡æœ‰å†…è”å…ƒç´ æ—¶ï¼ŒåŸºçº¿ä¼šè¢«è®¾ç½®ä¸ºå®¹å™¨çš„ä¸‹è¾¹ç¼˜ï¼ˆå³ä¸‹è¾¹æ¡†ä¸‹é¢çš„ä½ç½®ï¼‰ã€‚è¿™æ˜¯å› ä¸ºåœ¨æ²¡æœ‰å†…è”å…ƒç´ çš„æƒ…å†µä¸‹ï¼ŒåŸºçº¿çš„ä½ç½®æ²¡æœ‰å…·ä½“çš„å‚è€ƒç‰©ï¼Œå› æ­¤é»˜è®¤è¢«è®¾ç½®ä¸ºå®¹å™¨çš„ä¸‹è¾¹ç¼˜ã€‚</p><p>æœ‰å­—ç¬¦çš„æ¡†æ¡†ï¼š<br>å½“å®¹å™¨å†…æœ‰å­—ç¬¦ä½œä¸ºå†…è”å…ƒç´ æ—¶ï¼ŒåŸºçº¿ä¼šæ ¹æ®å­—ç¬¦çš„å…·ä½“å½¢çŠ¶å’Œå­—ä½“ç‰¹æ€§è¿›è¡Œè®¡ç®—ï¼Œå¹¶è¢«è®¾ç½®ä¸ºå­—ç¬¦çš„åŸºçº¿ä½ç½®ã€‚åŸºçº¿çš„ä½ç½®é€šå¸¸æ˜¯å­—ç¬¦åº•éƒ¨ä¸å­—ç¬¦ä¸»è¦éƒ¨åˆ†çš„å¯¹é½çº¿ï¼Œç”¨äºå¯¹é½å­—ç¬¦çš„ä½ç½®å’Œå…¶ä»–è¡Œå†…å…ƒç´ ã€‚</p></blockquote><p>æœ‰ä¸€ä¸ªä¸­å¿ƒçº¿çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯ <code>baseline</code>, ifc å®¹å™¨åŸºäº baseline è¿›è¡Œå®šä½ã€‚</p><p>æ‰€ä»¥å‡ºç°äº†è¿™ç§æƒ…å†µï¼Œå½“å®¹å™¨æ²¡æœ‰å†…è”å…ƒç´ æ—¶ï¼ŒåŸºçº¿ä¼šè¢«è®¾ç½®ä¸ºå®¹å™¨çš„ä¸‹è¾¹ç¼˜ï¼Œå½“å®¹å™¨å†…æœ‰å­—ç¬¦ä½œä¸ºå†…è”å…ƒç´ æ—¶ï¼ŒåŸºäºå­—ä½“ä½œä¸º baseline ä½ç½®ã€‚</p><h3 id="4-line-çº¿"><a href="#4-line-çº¿" class="headerlink" title="4. line çº¿"></a>4. line çº¿</h3><p><a href="/img/css-ifc-baseline.jpg" title="alt text" class="gallery-item" style="box-shadow: none;"> <img src="/img/css-ifc-baseline.jpg" alt="alt text"></a></p><p>ç†è®ºä¸Šæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡é»˜è®¤çš„åŸºçº¿æ°´å¹³æ’åˆ—ï¼Œå°±æ˜¯baselineè¿™æ¡çº¿ï¼Œ top, middle, bottom é€šè¿‡ vertical-align è®¾ç½®ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘å°±äº§ç”Ÿäº†ä¸€ä¸ªç–‘é—®ï¼Œæ€ä¹ˆå½±å“ baselineå‘¢ï¼Ÿ</p><p>é¦–å…ˆ baseline å’Œ middle line æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¦‚æœå­—ä½“è¶Šå¤§å·®è·è¶Šå¤§ï¼Œæ‰€ä»¥æƒ³è¦å®Œå…¨å±…ä¸­ï¼Œç›´æ¥ <code>font-size:0</code> å°±å¯ä»¥äº†ã€‚</p><p>åŒæ ·ï¼Œå›¾ç‰‡çš„ bottonline å’Œ baselineï¼Œä½ è¦ä¹ˆè®¾ç½®ä¸º vertical-align ä¸º bottom, æˆ–è€…è¿˜æ˜¯è®¾ç½® <code>font-szieï¼š0</code> çº¿è‡ªç„¶å°±é‡åˆäº†ã€‚</p><h3 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h3><p>ifc æ˜¯ä¸€ä¸ªé¡ºåºæ’åˆ—çš„æ¨¡å‹ï¼Œæ°´å¹³é¡ºåºæ’åˆ—ï¼Œç®€å•ç”¨å°± <code>text-align</code>, æ°´å¹³æ–¹å‘ä½¿ç”¨ margin, padding å°±okäº†ã€‚</p><p>å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¿˜æ˜¯éœ€è¦çŸ¥é“line box å’Œ line è¿™ä¸ªæ¦‚å¿µã€‚</p><h3 id="6-èµ„æ–™"><a href="#6-èµ„æ–™" class="headerlink" title="6. èµ„æ–™"></a>6. èµ„æ–™</h3><ul><li><a href="https://www.zhangxinxu.com/wordpress/2015/08/css-deep-understand-vertical-align-and-line-height/">CSSæ·±å…¥ç†è§£vertical-alignå’Œline-heightçš„åŸºå‹å…³ç³»</a></li><li><a href="https://blog.csdn.net/weixin_41192489/article/details/120197275">css æ ¼å¼åŒ–ä¸Šä¸‹æ–‡å¸ƒå±€â€”â€”BFCå’ŒIFCã€è¯¦è§£ã€‘</a></li><li><a href="https://segmentfault.com/a/1190000004466536">[è¯‘]:BFCä¸IFC</a></li><li><a href="https://mengsixing.github.io/blog/css-ifc.html#css-%E5%86%85%E8%81%94%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8A%E4%B8%8B%E6%96%87">CSS IFC æ€»ç»“</a></li></ul></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> css </tag>
            
            <tag> ifc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css å‚ç›´å±…ä¸­æ–¹æ¡ˆ</title>
      <link href="/2023/07/03/Implementation_Methods_for_Horizontal_and_Vertical_Centering/"/>
      <url>/2023/07/03/Implementation_Methods_for_Horizontal_and_Vertical_Centering/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>ä¸€èˆ¬æ–¹æ¡ˆä¸Šæ¥è¯´å¾ˆå¤šã€‚</p><ol><li>flex</li><li>grid</li><li>table</li><li>absolute</li></ol><h3 id="01-flex-åŸºæœ¬çŸ¥è¯†"><a href="#01-flex-åŸºæœ¬çŸ¥è¯†" class="headerlink" title="01. flex åŸºæœ¬çŸ¥è¯†"></a>01. flex åŸºæœ¬çŸ¥è¯†</h3><p>åšè¿™ä¸ªä¹‹å‰éœ€è¦å…ˆç®€å•çŸ¥é“ä¸€ä¸‹ flex æ˜¯åšä»€ä¹ˆçš„ï¼Œé˜®ä¸€å³°çš„é‚£ä¸€ç¯‡å°±æŒºå¥½ã€‚</p><p><a href="/img/bg2015071004.png" title="alt text" class="gallery-item" style="box-shadow: none;"> <img src="/img/bg2015071004.png" alt="alt text"></a></p><blockquote><p>å®¹å™¨é»˜è®¤å­˜åœ¨ä¸¤æ ¹è½´ï¼šæ°´å¹³çš„ä¸»è½´ï¼ˆmain axisï¼‰å’Œå‚ç›´çš„äº¤å‰è½´ï¼ˆcross axisï¼‰ã€‚ä¸»è½´çš„å¼€å§‹ä½ç½®ï¼ˆä¸è¾¹æ¡†çš„äº¤å‰ç‚¹ï¼‰å«åšmain startï¼Œç»“æŸä½ç½®å«åšmain endï¼›äº¤å‰è½´çš„å¼€å§‹ä½ç½®å«åšcross startï¼Œç»“æŸä½ç½®å«åšcross endã€‚</p><p>é¡¹ç›®é»˜è®¤æ²¿ä¸»è½´æ’åˆ—ã€‚å•ä¸ªé¡¹ç›®å æ®çš„ä¸»è½´ç©ºé—´å«åšmain sizeï¼Œå æ®çš„äº¤å‰è½´ç©ºé—´å«åšcross sizeã€‚</p></blockquote><p>è¿™ä¸ªæ˜¯åŸºæœ¬æ¦‚å¿µï¼Œç”±è¿™äº›ç‚¹æ¥æ§åˆ¶ flex å¸ƒå±€ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åŸºæœ¬çš„å±æ€§</p><ul><li>flex-direction æ–¹å‘ï¼Œmain axis &amp; cross axis åˆ‡æ¢</li><li>flex-wrap æ§åˆ¶æ¢è¡Œ</li><li>flex-flow å‰ä¸¤ä¸ªçš„ç®€å†™</li><li>justify-content å®šä¹‰äº†é¡¹ç›®åœ¨ä¸»è½´ä¸Šçš„å¯¹é½æ–¹å¼ã€‚</li><li>align-items äº¤å‰è½´çš„å¯¹é½æ–¹å¼</li><li>align-content å¤šæ ¹è½´çº¿çš„å¯¹é½æ–¹å¼</li></ul><p>åœ¨è¿™ä¸ªåŸºç¡€åªä¸Šï¼Œå°±åŸºæœ¬ç†è§£äº†, flex è¿ä½œæ–¹å¼</p><p><code>display:flex</code> å£°æ˜å®¹å™¨å¸ƒå±€æ–¹å¼ï¼Œä»–æŒ‰ç…§ä»å·¦åˆ°åˆä¸€æ¬¡æ’åˆ—ï¼Œä½ å¯ä»¥æ ¹æ®å±æ€§æ¥ä¿®æ”¹ä¸»è½´ï¼Œä»¥åŠè½´çš„å¯¹é½æ–¹å¼ã€‚</p><p>ä¸Šé¢çš„éƒ½æ˜¯å¯¹å®¹å™¨è¿›è¡Œè®¾ç½®ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®ä»¥ä¸‹å±æ€§ã€‚</p><ul><li>order è®¾ç½®ä¼˜å…ˆçº§ï¼Œç”¨äºæ’åº</li><li>flex-grow å¯ä»¥æ”¾å¤§ï¼ŒåŸæœ¬æ¯ä¸ªå•å…ƒæ ¼éƒ½æ˜¯1, ä½ å¯ä»¥å•ç‹¬è®¾ç½®ä»–</li><li>flex-shrink ç¼©å°çš„æ¯”ä¾‹</li><li>flex-basis</li><li>flex ä¸Šé¢çš„ç®€å†™</li><li>align-self å•ç‹¬è®¾ç½®å¯¹é½æ–¹å¼ï¼Œä¸€èˆ¬ç”¨ä¸åˆ°ï¼Œä½ è¦ç©èŠ±æ´»çš„æ—¶å€™å°±éœ€è¦äº†</li></ul><h3 id="02-flex-å‚ç›´å±…ä¸­"><a href="#02-flex-å‚ç›´å±…ä¸­" class="headerlink" title="02. flex å‚ç›´å±…ä¸­"></a>02. flex å‚ç›´å±…ä¸­</h3><p>åœ¨ä¸Šé¢çš„åŸºç¡€ä¹‹ä¸Šï¼Œå°±å¯ä»¥çŸ¥é“å¦‚ä½•å†™äº†</p><ol><li>display: flex</li><li>è®¾ç½®äº¤å‰è½´å¯¹é½æ–¹å¼å±…ä¸­</li><li>è®¾ç½®æ°´å¹³è½´å¯¹é½æ–¹å¼å±…ä¸­</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">   &lt;style&gt;</span><br><span class="line">     .box &#123;</span><br><span class="line">       display: flex;</span><br><span class="line">       align-items: center;</span><br><span class="line">       justify-content: center;</span><br><span class="line">       width: 500px;</span><br><span class="line">       height: 500px;</span><br><span class="line">       border: 1px black solid;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     .item &#123;</span><br><span class="line">     &#125;</span><br><span class="line">   &lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">     &lt;div class=&quot;item&quot;&gt;a&lt;/div&gt;</span><br><span class="line">   &lt;/div&gt;</span><br></pre></td></tr></table></figure><p>å°±å®Œæˆäº†ã€‚</p><h3 id="03-grid-å¸ƒå±€åŸºæœ¬çŸ¥è¯†"><a href="#03-grid-å¸ƒå±€åŸºæœ¬çŸ¥è¯†" class="headerlink" title="03. grid å¸ƒå±€åŸºæœ¬çŸ¥è¯†"></a>03. grid å¸ƒå±€åŸºæœ¬çŸ¥è¯†</h3><p>grid çš„æ¦‚å¿µå’Œ flex åŒºåˆ«å¾ˆå¤§ï¼Œflexåªå…³å¿ƒ item, grid æ˜¯åœ¨äº row å’Œ column,</p><ul><li>grid-template-columns æŒ‡å®šæ¯ä¸€åˆ—çš„åˆ—å®½</li><li>grid-template-rows æŒ‡å®šæ¯ä¸€è¡Œçš„è¡Œé«˜</li><li>repeat é‡å¤ï¼Œä¸ç”¨æ¯ä¸ªéƒ½å†™</li><li>auto-fill è‡ªåŠ¨è®¡ç®—ï¼Œç±»ä¼¼äºè‡ªåŠ¨æ¢è¡Œï¼Œè¿™ä¸ªæ˜¯é’ˆå¯¹äº repeat(ä¸ªæ•°, å®½åº¦)</li><li>fr ç™¾åˆ†æ¯”</li><li>auto è‡ªè¡Œå†³å®šå®½åº¦</li><li>grid-row-gap è¡Œé—´è·</li><li>grid-column-gap åˆ—é—´è·</li><li>grid-gap ä¸Šé¢ä¸¤ä½é›†åˆ</li><li>grid-template-areas åˆå¹¶å•å…ƒæ ¼æ‰€ç”¨ã€‚</li><li>grid-auto-flow å…ˆè¡Œååˆ—ï¼Œè¿˜æ˜¯å…ˆåˆ—åè¡Œ</li><li>justify-items itemå†…éƒ¨æ°´å¹³ä½ç½®</li><li>align-items itemå†…éƒ¨å‚ç›´ä½ç½®</li><li>place-items ä¸Šé¢ä¸¤ä¸ªé›†åˆ</li><li>justify-content itemæœ¬èº«å¯¹äºå®¹å™¨çš„æ°´å¹³ä½ç½®</li><li>align-content itemæœ¬èº«å¯¹äºå®¹å™¨çš„å‚ç›´ä½ç½®</li><li>place-content ä¸Šé¢ä¸¤ä¸ªé›†åˆ</li><li>grid-auto-columns è®¾ç½®é¢å¤–ç½‘æ ¼æ‰“å°</li><li>grid-auto-rows</li></ul><p>è¿™é‡Œå°±å¾ˆæ˜ç¡®äº†ï¼ŒåŒºåˆ«ã€‚</p><p>ä¸€ä¸ªæ˜¯ä¸€ç»´ï¼Œä¸€ä¸ªæ˜¯äºŒç»´ã€‚grid æ˜æ˜¾æ›´é€‚åˆå¸ƒå±€ï¼Œç„¶è€Œflexæ›´é€‚åˆå±€éƒ¨çš„å¸ƒå±€ã€‚</p><h3 id="04-grid-å‚ç›´å±…ä¸­"><a href="#04-grid-å‚ç›´å±…ä¸­" class="headerlink" title="04. grid å‚ç›´å±…ä¸­"></a>04. grid å‚ç›´å±…ä¸­</h3><p>å¦‚æœåªæ˜¯å‚ç›´å±…ä¸­çš„è¯å¾ˆç®€å•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">display: grid;</span><br><span class="line">grid-template-columns: 100px;</span><br><span class="line">grid-template-rows: 100px;</span><br><span class="line">justify-content: center;</span><br><span class="line">align-content: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸç†éƒ½ä¸€æ ·ã€‚</p><h3 id="05-table"><a href="#05-table" class="headerlink" title="05. table"></a>05. table</h3><p>å…¶å®å°±æ˜¯ä½¿ç”¨ td çš„ <code>vertical-align: middle &amp; text-align: center</code>.</p><p>è¿™é‡Œéœ€è¦çŸ¥é“ä¸€ä¸ªæ¦‚å¿µ é‡ç»˜ å’Œ å›æµ, è¿™ä¸ªæ¦‚å¿µå¦‚æœè¦è®²æ¸…æ¥šï¼Œéœ€è¦ä»æµè§ˆå™¨åŠ è½½è¿‡ç¨‹è¯´èµ·ã€‚</p><p>ç®€å•è¯´ï¼Œå°±æ˜¯</p><blockquote><p>é‡ç»˜ï¼ˆRepaintï¼‰ï¼šå½“å…ƒç´ çš„æ ·å¼å‘ç”Ÿæ”¹å˜ï¼Œä½†ä¸å½±å“å…¶å¸ƒå±€æ—¶ï¼Œæµè§ˆå™¨ä¼šæ‰§è¡Œé‡ç»˜æ“ä½œã€‚é‡ç»˜æ„å‘³ç€æµè§ˆå™¨ä¼šé‡æ–°ç»˜åˆ¶å…ƒç´ çš„å¯è§†éƒ¨åˆ†ï¼Œä»¥åæ˜ æ–°çš„æ ·å¼ï¼Œä½†å¹¶ä¸ä¼šå½±å“å…ƒç´ çš„å¤§å°å’Œä½ç½®ã€‚é‡ç»˜æ“ä½œæ¯”å›æµæ“ä½œæ›´åŠ è½»é‡çº§ï¼Œå¯¹æ€§èƒ½å½±å“è¾ƒå°ã€‚</p><p>å›æµï¼ˆReflowï¼‰ï¼šå½“é¡µé¢çš„å¸ƒå±€å‘ç”Ÿæ”¹å˜ï¼Œä¾‹å¦‚å…ƒç´ çš„å°ºå¯¸ã€ä½ç½®ã€æ˜¾ç¤º&#x2F;éšè—çŠ¶æ€ç­‰æ”¹å˜æ—¶ï¼Œæµè§ˆå™¨ä¼šæ‰§è¡Œå›æµæ“ä½œã€‚å›æµä¼šé‡æ–°è®¡ç®—å¹¶åº”ç”¨æ‰€æœ‰å—å½±å“å…ƒç´ çš„å‡ ä½•å±æ€§ï¼Œç„¶åé‡æ–°æ’åˆ—é¡µé¢ä¸­çš„å…ƒç´ ã€‚å›æµæ“ä½œç›¸å¯¹è¾ƒä¸ºæ˜‚è´µï¼Œä¼šå¼•èµ·é¡µé¢é‡æ–°å¸ƒå±€ï¼Œå¯¹æ€§èƒ½æœ‰è¾ƒå¤§çš„å½±å“ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä½ æ›´æ”¹ä¸€ä¸ªå…ƒç´ çš„å®½é«˜ï¼Œæˆ–è€…èƒŒæ™¯é¢œè‰²éƒ½å¯èƒ½è§¦å‘ï¼Œå…³é”®æ˜¯ table ç‰¹åˆ«å®¹æ˜“è§¦å‘ã€‚</p><blockquote><p>table åŠå…¶å†…éƒ¨å…ƒç´ å¯èƒ½éœ€è¦å¤šæ¬¡è®¡ç®—æ‰èƒ½ç¡®å®šå¥½å…¶åœ¨æ¸²æŸ“æ ‘ä¸­èŠ‚ç‚¹çš„å±æ€§å€¼ï¼Œæ¯”åŒç­‰å…ƒç´ è¦å¤šèŠ±ä¸¤å€æ—¶é—´ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å°½é‡é¿å…ä½¿ç”¨ table å¸ƒå±€é¡µé¢çš„åŸå› ä¹‹ä¸€</p></blockquote><p>è¿™æ˜¯tableæˆ‘æŸ¥åˆ°çš„é—®é¢˜ï¼Œä½†æ˜¯ç°ä»£æµè§ˆå™¨ä¼˜åŒ–åšçš„å¾ˆå¥½ï¼Œå¹¶ä¸”æ€ä¹ˆå»ä½¿ç”¨tableï¼Œæ¯”å¦‚åŒ…å«å¤§é‡çš„åµŒå¥—æˆ–è·¨è¡Œ&#x2F;è·¨åˆ—çš„å•å…ƒæ ¼æ—¶ç¡®å®å¾ˆå¤æ‚ï¼Œç¡®å®ä¼šè®¡ç®—å¾ˆå¤šã€‚</p><p>ä½†æ˜¯å¦‚æœä½ é€šè¿‡å…¶ä»–æ–¹å¼å»å®ç°ï¼Œæ¯”å¦‚ grid æˆ–è€… flexï¼Œåœ¨è¿™ç§å¤æ‚åº¦ä¸‹ï¼Œæ˜¯å¦æ€§èƒ½ä¼šæ¯”tableå¥½ï¼Œè¿™ä¸ªæˆ‘æ²¡æœ‰åšè¿‡æµ‹è¯•ï¼Œä½†æ˜¯æˆ‘è§‰å¾—å¾ˆéš¾è¯´ã€‚</p><p>å¦å¤–ï¼Œå¦‚æœåªæ˜¯ç®€å•çš„ä¸ºäº†å±…ä¸­ <code>display:table</code> ä¹Ÿæ˜¯ä¸€ç§æ–¹æ¡ˆã€‚</p><h3 id="06-absolute"><a href="#06-absolute" class="headerlink" title="06. absolute"></a>06. absolute</h3><p>è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯è¯´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.container &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.centered &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  top: 50%;</span><br><span class="line">  left: 50%;</span><br><span class="line">  transform: translate(-50%, -50%);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ä¸»è¦ç‚¹åœ¨äº <code> transform: translate(-50%, -50%);</code> ä¸Šã€‚</p><p>top &amp; left è®¡ç®—çš„æ˜¯çˆ¶ç»“ç‚¹ï¼Œæ‰€ä»¥æ˜¯300pxï¼Œå¦‚æœå†åŠ ä¸Šå…ƒç´ æœ¬èº«é«˜å’Œå®½ï¼Œé‚£ä¹ˆå°±ä¸æ˜¯æ­£ç¡®çš„ã€‚</p><p>ä½†æ˜¯åŠ ä¸Šäº† transform: translateï¼Œè¿™é‡Œçš„ç™¾åˆ†æ¯”æ˜¯æ ¹æ®å½“å‰å…ƒç´ è®¡ç®—çš„ï¼Œè¿™ä¸ªç§»åŠ¨å°±èƒ½ä¿è¯å±…ä¸­</p><h3 id="07-æ€»ç»“"><a href="#07-æ€»ç»“" class="headerlink" title="07. æ€»ç»“"></a>07. æ€»ç»“</h3><p>è¿™é‡Œè®°å½•äº†4ç§å‚ç›´å±…ä¸­çš„æ–¹æ¡ˆ, å¦‚æœåœ¨æ²¡æœ‰æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜çš„æƒ…å†µä¸‹è¿˜æ˜¯ä½¿ç”¨ flexï¼Œå› ä¸ºä»–åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆç¼ºç‚¹ã€‚</p><p>ä½¿ç”¨ç»å¯¹å®šä½æ˜¯éœ€è¦ç¡®å®šçˆ¶çº§é«˜åº¦çš„ã€‚è€Œä¸”éœ€è¦è®¾ç½®å®¹å™¨çš„å®šä½å±æ€§ï¼Œå¯èƒ½ä¼šå¯¹å…¶ä»–å¸ƒå±€å±æ€§äº§ç”Ÿå½±å“ã€‚</p><p>ä½¿ç”¨ display:table,å¯¹äºä¸€äº›ç‰¹æ®Šå¸ƒå±€è¦æ±‚å¯èƒ½ä¸é€‚ç”¨ã€‚</p><h3 id="08-å¼•ç”¨"><a href="#08-å¼•ç”¨" class="headerlink" title="08. å¼•ç”¨"></a>08. å¼•ç”¨</h3><ul><li><a href="https://www.ruanyifeng.com/blog/2015/07/flex-grammar.html">Flex å¸ƒå±€æ•™ç¨‹ï¼šè¯­æ³•ç¯‡</a></li><li><a href="https://github.com/Coffcer/flex-layout">flex-layout</a></li><li><a href="https://www.ruanyifeng.com/blog/2019/03/grid-layout-tutorial.html">CSS Grid ç½‘æ ¼å¸ƒå±€æ•™ç¨‹</a></li><li><a href="https://www.duidaima.com/Group/Topic/CSS/9504">CSSå¸ƒå±€ä¸­Grid å’ŒFlex è¯¥ç”¨å“ªä¸ªæ¯”è¾ƒå¥½ï¼Ÿ</a></li><li><a href="https://blog.csdn.net/JHXL_/article/details/124046715">ä¸€æ–‡æ•™ä¼šä½ ä½•ä¸ºé‡ç»˜ã€å›æµï¼Ÿ</a></li><li><a href="https://blog.csdn.net/chunxiaqiudong5/article/details/104049484">CSS å˜å½¢(CSS3) transform</a></li></ul></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> css </tag>
            
            <tag> flex </tag>
            
            <tag> grid </tag>
            
            <tag> table </tag>
            
            <tag> transform </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BFC å¸ƒå±€æ¨¡å‹</title>
      <link href="/2023/07/03/BFC/"/>
      <url>/2023/07/03/BFC/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id=""><a href="#" class="headerlink" title=""></a></h1><blockquote><p>BFC (å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡) æ˜¯ CSS ä¸­çš„ä¸€ç§å¸ƒå±€æ¨¡å‹ï¼Œç”¨äºæ§åˆ¶å—çº§å…ƒç´ çš„å¸ƒå±€å’Œæ¸²æŸ“è§„åˆ™ã€‚BFC æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¸²æŸ“åŒºåŸŸï¼Œå…¶ä¸­çš„å…ƒç´ æŒ‰ç…§ä¸€å®šçš„è§„åˆ™è¿›è¡Œå¸ƒå±€ï¼Œä¸ä¼šå½±å“åˆ°å¤–éƒ¨çš„å¸ƒå±€ã€‚</p><p>IFC (è¡Œå†…æ ¼å¼åŒ–ä¸Šä¸‹æ–‡)ï¼šIFC æ˜¯è¡Œå†…å…ƒç´ çš„å¸ƒå±€æ¨¡å‹ï¼Œç”¨äºæ§åˆ¶è¡Œå†…å…ƒç´ çš„å¸ƒå±€å’Œæ¸²æŸ“è§„åˆ™ã€‚IFC ä¸­çš„è¡Œå†…å…ƒç´ æŒ‰ç…§ä¸€å®šçš„è§„åˆ™è¿›è¡Œæ’åˆ—ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® display: inline-block æˆ–ä½¿ç”¨è¡¨æ ¼å¸ƒå±€ç­‰æ–¹å¼åˆ›å»º IFCã€‚</p><p>Flexbox (å¼¹æ€§ç›’å¸ƒå±€)ï¼šFlexbox æ˜¯ä¸€ç§åŸºäºä¸»è½´å’Œäº¤å‰è½´çš„å¸ƒå±€æ¨¡å‹ï¼Œç”¨äºåˆ›å»ºçµæ´»çš„ç›’å­å¸ƒå±€ã€‚é€šè¿‡ä½¿ç”¨ display: flex å±æ€§ï¼Œå¯ä»¥å°†å®¹å™¨å…ƒç´ å˜ä¸ºä¸€ä¸ª Flexbox å®¹å™¨ï¼Œå­å…ƒç´ å¯ä»¥é€šè¿‡è®¾ç½®å„ç§å¼¹æ€§å±æ€§æ¥å®ç°è‡ªé€‚åº”çš„å¸ƒå±€ã€‚</p><p>Grid (ç½‘æ ¼å¸ƒå±€)ï¼šGrid æ˜¯ä¸€ç§äºŒç»´ç½‘æ ¼å¸ƒå±€æ¨¡å‹ï¼Œç”¨äºå°†é¡µé¢åˆ’åˆ†ä¸ºè¡Œå’Œåˆ—ï¼Œå¹¶ä»¥ç½‘æ ¼å•å…ƒæ ¼çš„å½¢å¼å¯¹å…ƒç´ è¿›è¡Œå¸ƒå±€ã€‚é€šè¿‡ä½¿ç”¨ display: grid å±æ€§ï¼Œå¯ä»¥å°†å®¹å™¨å…ƒç´ å˜ä¸ºä¸€ä¸ª Grid å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨å„ç§ç½‘æ ¼ç›¸å…³çš„å±æ€§æ¥æ§åˆ¶å…ƒç´ çš„ä½ç½®å’Œå°ºå¯¸ã€‚</p><p>Float (æµ®åŠ¨å¸ƒå±€)ï¼šFloat æ˜¯ä¸€ç§æ—©æœŸçš„å¸ƒå±€æ¨¡å‹ï¼Œé€šè¿‡è®¾ç½®å…ƒç´ çš„ float å±æ€§ï¼Œä½¿å…ƒç´ æµ®åŠ¨åˆ°æŒ‡å®šçš„æ–¹å‘ï¼Œå…¶ä»–å…ƒç´ ä¼šç¯ç»•åœ¨å…¶å‘¨å›´ã€‚Float å¸ƒå±€å¸¸ç”¨äºåˆ›å»ºå¤šåˆ—å¸ƒå±€å’Œå®ç°æ–‡å­—ç¯ç»•æ•ˆæœï¼Œä½†ä¹Ÿä¼šå¸¦æ¥ä¸€äº›å¸ƒå±€ä¸Šçš„é—®é¢˜ï¼Œå¦‚å¸ƒå±€å¡Œé™·ç­‰ã€‚</p><p>Table (è¡¨æ ¼å¸ƒå±€)ï¼šä½¿ç”¨ HTML è¡¨æ ¼æ ‡ç­¾  table åŠå…¶ç›¸å…³æ ‡ç­¾ trã€td ç­‰è¿›è¡Œå¸ƒå±€ã€‚è¡¨æ ¼å¸ƒå±€é€‚ç”¨äºéœ€è¦å‘ˆç°è¡¨æ ¼ç»“æ„çš„åœºæ™¯ï¼Œä½†åœ¨å…¶ä»–å¸ƒå±€éœ€æ±‚ä¸Šè¾ƒä¸ºæœ‰é™ï¼Œä¸æ¨èå°†è¡¨æ ¼å¸ƒå±€ç”¨äºéè¡¨æ ¼ç»“æ„çš„é¡µé¢å¸ƒå±€ã€‚</p></blockquote><p>å„ç§å¸ƒå±€æ¨¡å‹ï¼Œä»Šå¤©è¦å­¦ä¹ çš„æ˜¯ BFC æ¨¡å‹ã€‚</p><h3 id="1-ä»€ä¹ˆæ˜¯BFCæ¨¡å‹"><a href="#1-ä»€ä¹ˆæ˜¯BFCæ¨¡å‹" class="headerlink" title="1. ä»€ä¹ˆæ˜¯BFCæ¨¡å‹"></a>1. ä»€ä¹ˆæ˜¯BFCæ¨¡å‹</h3><blockquote><p>BFCï¼ˆBlock Formatting Contextï¼‰æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼Œæ˜¯Webé¡µé¢ä¸­ç›’æ¨¡å‹å¸ƒå±€çš„CSSæ¸²æŸ“æ¨¡å¼ï¼ŒæŒ‡ä¸€ä¸ªç‹¬ç«‹çš„æ¸²æŸ“åŒºåŸŸæˆ–è€…è¯´æ˜¯ä¸€ä¸ªéš”ç¦»çš„ç‹¬ç«‹å®¹å™¨ï¼Œç”¨äºæ§åˆ¶å—çº§å…ƒç´ çš„å¸ƒå±€å’Œæ¸²æŸ“è§„åˆ™</p></blockquote><h3 id="2-BFC-å½¢æˆçš„æ¡ä»¶"><a href="#2-BFC-å½¢æˆçš„æ¡ä»¶" class="headerlink" title="2. BFC å½¢æˆçš„æ¡ä»¶"></a>2. BFC å½¢æˆçš„æ¡ä»¶</h3><p>æ ¹å…ƒç´ ï¼ˆå³ html å…ƒç´ ï¼‰æˆ–åŒ…å«å®ƒçš„å…ƒç´ ã€‚<br>æµ®åŠ¨å…ƒç´ ï¼ˆå…ƒç´ çš„ float å±æ€§ä¸ä¸º noneï¼‰ã€‚<br>ç»å¯¹å®šä½å…ƒç´ ï¼ˆå…ƒç´ çš„ position å±æ€§ä¸º absolute æˆ– fixedï¼‰ã€‚<br>è¡Œå†…å—å…ƒç´ ï¼ˆå…ƒç´ çš„ display å±æ€§ä¸º inline-blockï¼‰ã€‚<br>è¡¨æ ¼å•å…ƒæ ¼ï¼ˆå…ƒç´ çš„ display å±æ€§ä¸º table-cellï¼‰ã€‚<br>è¡¨æ ¼æ ‡é¢˜ï¼ˆå…ƒç´ çš„ display å±æ€§ä¸º table-captionï¼‰ã€‚<br>åŒ…å«äº†ä»¥ä¸Šä»»æ„ä¸€ä¸ªæ¡ä»¶çš„å…ƒç´ çš„ç¥–å…ˆå…ƒç´ ï¼Œä¸”è¯¥ç¥–å…ˆå…ƒç´ çš„ overflow å±æ€§ä¸ä¸º visibleã€‚</p><h3 id="3-è§£å†³è¾¹ç•Œé‡å "><a href="#3-è§£å†³è¾¹ç•Œé‡å " class="headerlink" title="3. è§£å†³è¾¹ç•Œé‡å "></a>3. è§£å†³è¾¹ç•Œé‡å </h3><blockquote><p>è¾¹ç•Œé‡å æ˜¯ç”±äº CSS ç›’æ¨¡å‹ä¸­çš„å¤–è¾¹è·åˆå¹¶ï¼ˆmargin collapsingï¼‰è§„åˆ™æ‰€è‡´ã€‚å½“ä¸¤ä¸ªå‚ç›´ç›¸é‚»çš„å—çº§å…ƒç´ å…·æœ‰ç›¸é‚»çš„å¤–è¾¹è·æ—¶ï¼Œå®ƒä»¬çš„å¤–è¾¹è·ä¼šåˆå¹¶æˆä¸€ä¸ªå¤–è¾¹è·ï¼Œå¯¼è‡´å®ƒä»¬ä¹‹é—´çš„é—´è·ä¸æ˜¯ç®€å•åœ°ç›¸åŠ ï¼Œè€Œæ˜¯å–å…¶ä¸­è¾ƒå¤§çš„å¤–è¾¹è·å€¼</p></blockquote><p><a href="https://developer.aliyun.com/article/605570#slide-2">CSS-ç›’å­æ¨¡å‹-è¾¹è·åˆå¹¶</a></p><p>è¿™é‡Œæä¾›äº†å¾ˆå¤šè¾¹è·é‡å çš„æ¡ˆä¾‹ï¼Œæœ€ç®€å•çš„è§£æ³•å°±æ˜¯ <code>overflow:hidden</code>, å½¢æˆä¸€ä¸ª BFC</p><h3 id="4-è§£å†³æµ®åŠ¨é—®é¢˜"><a href="#4-è§£å†³æµ®åŠ¨é—®é¢˜" class="headerlink" title="4. è§£å†³æµ®åŠ¨é—®é¢˜"></a>4. è§£å†³æµ®åŠ¨é—®é¢˜</h3><p>å…¶å®è¿™ä¸ªé—®é¢˜ç°åœ¨æ²¡ä»€ä¹ˆæ„ä¹‰äº†ï¼Œç°åœ¨å¾ˆå°‘è¿˜æœ‰å¸ƒå±€é‡‡ç”¨æµ®åŠ¨å¸ƒå±€äº†ï¼Œæµ®åŠ¨å¸ƒå±€ä¼šå‡ºç°çˆ¶å…ƒç´ ä¼šå‘ç”Ÿé«˜åº¦å¡Œé™·ï¼Œæ— æ³•æ­£å¸¸åŒ…è£¹æµ®åŠ¨å…ƒç´ çš„é—®é¢˜ï¼Œä½ å¯ä»¥åœ¨åé¢æ¸…é™¤æµ®åŠ¨ <code>clear:both</code>, ä¹Ÿå¯ä»¥çˆ¶å…ƒç´  BFCï¼Œ<code>overflow: hidden</code></p><p>å½“ç„¶ï¼Œæ–‡å­—ç¯ç»•ä¸çŸ¥é“è¿˜ä½¿ç”¨ float? </p><h3 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h3><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œbfcä¼šåˆ›å»ºä¸€ä¸ªç¨³å®šçš„åŒºåŸŸï¼ŒåŒºåŸŸå†…ä¸ä¼šå—åˆ°å¤–éƒ¨å½±å“ï¼Œå¤–éƒ¨ä¹Ÿä¸ä¼šå½±å“å†…éƒ¨ï¼Œä»è€Œé¿å…ä¸€äº›æµè§ˆå™¨ç‰¹æ€§å¯¼è‡´çš„é—®é¢˜ï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯ <code>overflow:hidden</code>.</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> css </tag>
            
            <tag> bfc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ºä»€ä¹ˆè¦ç”¨ void 0 ä»£æ›¿ undefined</title>
      <link href="/2023/07/03/undefined_void_0/"/>
      <url>/2023/07/03/undefined_void_0/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="ä¸ºä»€ä¹ˆè¦ç”¨-void-0-ä»£æ›¿-undefined"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨-void-0-ä»£æ›¿-undefined" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨ void 0 ä»£æ›¿ undefined"></a>ä¸ºä»€ä¹ˆè¦ç”¨ void 0 ä»£æ›¿ undefined</h1><p>åœ¨çœ‹ Vue3.x æºç çš„æ—¶å€™ï¼Œå‘ç°å…³äº undefined èµ‹å€¼éƒ½æ˜¯ä½¿ç”¨ Void 0ï¼Œè§‰å¾—å¾ˆå¥‡æ€ªï¼Œäºæ˜¯å­¦ä¹ äº†ä¸€ä¸‹ã€‚</p><h3 id="01-ä»€ä¹ˆæ˜¯-globalThis"><a href="#01-ä»€ä¹ˆæ˜¯-globalThis" class="headerlink" title="01. ä»€ä¹ˆæ˜¯ globalThis?"></a>01. ä»€ä¹ˆæ˜¯ globalThis?</h3><blockquote><p>globalThis æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå®ƒæä¾›äº†åœ¨ä»»ä½•æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­éƒ½å¯ç”¨çš„æ ‡å‡†å…¨å±€å¯¹è±¡çš„è®¿é—®æ–¹å¼ã€‚åœ¨ Web æµè§ˆå™¨ä¸­ï¼Œå…¨å±€å¯¹è±¡å¯èƒ½æœ‰å¤šç§ä¸åŒçš„åç§°ï¼Œæ¯”å¦‚åœ¨æµè§ˆå™¨çª—å£ä¸­ï¼Œå…¨å±€å¯¹è±¡é€šå¸¸æ˜¯ windowï¼Œè€Œåœ¨ Web Worker ä¸­ï¼Œå…¨å±€å¯¹è±¡æ˜¯ selfã€‚è€Œåœ¨ Node.js ä¸­ï¼Œå…¨å±€å¯¹è±¡æ˜¯ globalã€‚globalThis æä¾›äº†ä¸€ç§è·¨å¹³å°çš„æ–¹å¼æ¥è®¿é—®å…¨å±€å¯¹è±¡ï¼Œå®ƒå¯ä»¥åœ¨ä»»ä½•å¹³å°ä¸Šä½¿ç”¨ï¼Œè€Œä¸éœ€è¦è€ƒè™‘å…¨å±€å¯¹è±¡çš„åç§°ã€‚</p></blockquote><h3 id="02-undefined-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#02-undefined-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="02. undefined æ˜¯ä»€ä¹ˆï¼Ÿ"></a>02. undefined æ˜¯ä»€ä¹ˆï¼Ÿ</h3><blockquote><p>undefined æ˜¯å…¨å±€å¯¹è±¡çš„å±æ€§â€”â€”å³å…¨å±€ä½œç”¨åŸŸçš„å˜é‡ã€‚</p></blockquote><p>å®ƒçš„è¯­ä¹‰è¡¨ç¤ºï¼Œæœªè¢«å®šä¹‰çš„å€¼ï¼Œå®ƒæ˜¯ä¸€ç§åŸå§‹æ•°æ®ç±»å‹ã€‚</p><blockquote><p>è¡¨ç¤º no valueï¼ˆæ— å€¼ï¼‰â€”â€”ä¹Ÿæ— å¯¹è±¡ä¹Ÿæ— å€¼</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´, undefined æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å¹³æ—¶çš„ä½¿ç”¨æ–¹å¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"><span class="keyword">var</span> b = <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯å°† undefined åŸå§‹å€¼èµ‹å€¼ç»™å˜é‡ã€‚</p><p>æˆ‘ä»¬ç›´æ¥è°ƒç”¨ <code>undefined</code> æˆ–è€…ä¸èµ‹å€¼ï¼Œå…¶å®ç­‰äº</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = globalThis.<span class="property">undefined</span>;</span><br><span class="line"><span class="keyword">var</span> b = globalThis.<span class="property">undefined</span>;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯å…¨å±€å¯¹è±¡çš„å±æ€§</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">globalThis.<span class="property">undefined</span> === <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼Œ<code>undefined</code> è¡¨ç¤ºä¸€ç§åŸå§‹å€¼ï¼Œç›´æ¥åœ¨ <code>javascript</code> å†™ <code>undefined</code> å°±æ˜¯è¡¨ç¤º <code>globalThis.undefined</code>, åŒæ—¶ <code>undefined</code> ä¹Ÿå¯ä»¥ä½œä¸ºå˜é‡å.</p><h3 id="03-undefined-æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#03-undefined-æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="03. undefined æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>03. undefined æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3><p>é—®é¢˜å°±åœ¨äº <code>undefined</code> ä¹Ÿå¯ä»¥ä½œä¸ºå˜é‡åï¼Œå› ä¸ºæˆ‘ä»¬å¹³æ—¶å®Œå…¨æ˜¯æŠŠ <code>undefined</code> å½“ä½œå­—é¢é‡æ¥ä½¿ç”¨çš„ï¼Œæ‹¿ <code>null</code> æ¥è¯´ï¼Œ <code>null</code> å°±æ˜¯å­—é¢é‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="literal">null</span> = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>ä»–ä¼šç›´æ¥å‘Šè¯‰ä½ </p><blockquote><p>Variable declaration not allowed at this location.ts(1440)</p></blockquote><p>ç„¶è€Œ <code>undefined</code> ä¸ä¼š.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="literal">undefined</span> = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>ä»–å¨˜çš„æ˜¯å¯ä»¥é€šè¿‡çš„â€¦</p><p>æ‰€ä»¥é—®é¢˜å°±åœ¨è¿™é‡Œäº†ï¼Œä½ æ— æ³•ç¡®å®š <code>undefined</code> ä¸­æ˜¯å¦æ˜¯ <code>undefined</code> çš„åŸå§‹å€¼, </p><p>å®ƒå¯èƒ½æ˜¯åŸå§‹å¯¹è±¡ï¼Œå¯èƒ½æ˜¯å±€éƒ¨å˜é‡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [<span class="literal">undefined</span>, cat = <span class="literal">undefined</span>] = [<span class="string">&#x27;test&#x27;</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">undefined</span>); <span class="comment">//test</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat); <span class="comment">//test</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(globalThis.<span class="property">undefined</span>) <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure><p>è¿˜å¥½å®ƒä¸èƒ½ç›´æ¥èµ‹å€¼ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">undefined</span> = <span class="number">0</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">undefined</span>) <span class="comment">//undefined</span></span><br><span class="line"><span class="keyword">let</span> desc = <span class="title class_">Reflect</span>.<span class="title function_">getOwnPropertyDescriptor</span>(globalThis, <span class="string">`undefined`</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(desc) <span class="comment">// &#123;value: undefined, writable: false, enumerable: false, configurable: false&#125;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚</p><h3 id="04-void-å…³é”®å­—"><a href="#04-void-å…³é”®å­—" class="headerlink" title="04. void å…³é”®å­—"></a>04. void å…³é”®å­—</h3><blockquote><p>void æ˜¯ JavaScript ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨äºæ‰§è¡Œä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä½†ä¸è¿”å›ä»»ä½•å€¼ã€‚åœ¨è¯­æ³•ä¸Šï¼Œå®ƒé€šå¸¸è¢«ç”¨äºåœ¨ä¸€ä¸ªé“¾æ¥æˆ–æŒ‰é’®çš„ href æˆ– onclick å±æ€§ä¸­ï¼Œä»¥é¿å…æµè§ˆå™¨åœ¨æ‰§è¡Œé“¾æ¥æˆ–æŒ‰é’®æ“ä½œæ—¶è·³è½¬åˆ°æ–°çš„é¡µé¢æˆ–åˆ·æ–°å½“å‰é¡µé¢ã€‚</p><p>åœ¨ä½¿ç”¨ void æ—¶ï¼Œå¯ä»¥å°†å…¶åé¢è·Ÿä¸€ä¸ª JavaScript è¡¨è¾¾å¼ã€‚è¯¥è¡¨è¾¾å¼å°†è¢«æ‰§è¡Œï¼Œä½†è¿”å›å€¼å°†è¢«å¿½ç•¥ï¼Œå¹¶ä¸” void è¿ç®—ç¬¦çš„ç»“æœå°†å§‹ç»ˆæ˜¯ undefinedã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡ä½ å³è¾¹æ˜¯ä»€ä¹ˆï¼Œè¿”å›ä»€ä¹ˆï¼ŒåŠ  <code>void</code> å°±è¿”å› <code>undefined</code> åŸå§‹å€¼ã€‚</p><h3 id="05-ä¸ºä»€ä¹ˆè¦ç”¨-void-0-ä»£æ›¿-undefined"><a href="#05-ä¸ºä»€ä¹ˆè¦ç”¨-void-0-ä»£æ›¿-undefined" class="headerlink" title="05. ä¸ºä»€ä¹ˆè¦ç”¨ void 0 ä»£æ›¿ undefined"></a>05. ä¸ºä»€ä¹ˆè¦ç”¨ void 0 ä»£æ›¿ undefined</h3><p>åŸºäºä¸Šé¢è¯´çš„ï¼Œç°åœ¨å°±æ˜ç™½äº†ä¸ºä»€ä¹ˆè¦ç”¨ <code>void 0</code> ä»£æ›¿ <code>undefined</code>, å°±æ˜¯å› ä¸º <code>undefined</code> å¯ä»¥æ˜¯å˜é‡åã€‚</p><p>ä½¿ç”¨ <code>void 0</code> å¯ä»¥ä¿è¯æ˜¯ <code>undefined</code> åŸå§‹å€¼ã€‚</p><p>å¦å¤–ï¼Œä½¿ç”¨ <code>globalThis.undefined</code> ä¹Ÿå¯ä»¥è·å–åŸå§‹å€¼ï¼Œåªæ˜¯å®ƒè¦ç¨å¾®é•¿ä¸€ç‚¹ï¼Œæœ¬è´¨ä¸Šæ²¡åŒºåˆ«ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
            <tag> undefined </tag>
            
            <tag> void 0 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript ç±»å‹åˆ¤æ–­æ–¹æ³•æ€»ç»“</title>
      <link href="/2023/07/03/js_type_check/"/>
      <url>/2023/07/03/js_type_check/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>å¸¸ç”¨çš„åˆ¤æ–­ç±»å‹çš„æ–¹å¼å¦‚ä¸‹</p><ul><li>typeof</li><li>instanceof</li><li>Object.prototype.toString.call</li><li>Array.isArray</li><li>&#x3D;&#x3D;</li><li>&#x3D;&#x3D;&#x3D;</li><li>Object.is</li></ul><h3 id="1-x3D-x3D"><a href="#1-x3D-x3D" class="headerlink" title="1. &#x3D;&#x3D;"></a>1. &#x3D;&#x3D;</h3><p>&#x3D;&#x3D; æœ‰ä¸€ä¸ªç±»å‹è½¬æ¢çš„è¿‡ç¨‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> == <span class="string">&#x27;1&#x27;</span>;  <span class="comment">// trueï¼Œè¿›è¡Œç±»å‹è½¬æ¢åï¼Œå­—ç¬¦ä¸² &#x27;1&#x27; è¢«è½¬æ¢ä¸ºæ•°å­— 1ï¼Œç„¶åæ¯”è¾ƒç›¸ç­‰æ€§</span></span><br><span class="line"><span class="literal">true</span> == <span class="number">1</span>;  <span class="comment">// trueï¼Œå¸ƒå°”å€¼ true è¢«è½¬æ¢ä¸ºæ•°å­— 1ï¼Œç„¶åæ¯”è¾ƒç›¸ç­‰æ€§</span></span><br><span class="line"><span class="literal">null</span> == <span class="literal">undefined</span>;  <span class="comment">// trueï¼Œå› ä¸ºå®ƒä»¬è¢«è§†ä¸ºç›¸ç­‰çš„ç‰¹æ®Šå€¼</span></span><br></pre></td></tr></table></figure><p>å°±æ˜¯éšå¼è½¬æ¢ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚</p><p>è½¬æ¢ä»¥åå¯¹æ¯”ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œè¿™ä¸ªæ˜¯æœ€ä¸æ¨èçš„ï¼Œé¦–å…ˆç‰¹æ®Šæƒ…å†µå¾ˆå¤šï¼Œè¿˜ä¼šè¿›è¡Œç±»å‹è½¬æ¢å†æ¥å¯¹æ¯”ï¼Œè€Œä¸”åªèƒ½å¤„ç†åŸºç¡€ç±»å‹.</p><h3 id="2-x3D-x3D-x3D"><a href="#2-x3D-x3D-x3D" class="headerlink" title="2. &#x3D;&#x3D;&#x3D;"></a>2. &#x3D;&#x3D;&#x3D;</h3><p>å®ƒæ¯” <code>==</code> å¥½ä¸€ç‚¹çš„æ˜¯ï¼Œä»–ä¸ä¼šè¿›è¡Œç±»å‹è½¬æ¢ï¼Œä¹Ÿå°±æ˜¯ç±»å‹ç›¸åŒä¸”å€¼ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œè¿”å› <code>true</code>.</p><p>ä½†æ˜¯ä»–çš„ç¼ºç‚¹ä¾ç„¶ï¼Œå°±æ˜¯åªèƒ½å¤„ç†åŸºç¡€ç±»å‹ï¼Œä½†æ˜¯ä»–ä¹Ÿæœ‰ç”¨å‡ºã€‚</p><h3 id="3-Object-is"><a href="#3-Object-is" class="headerlink" title="3. Object.is"></a>3. Object.is</h3><p>ä¸Šé¢ <code>===</code> æœ‰ä¸€ä¸ªé—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+0 === -0 //true</span><br><span class="line">NaN === NaN //false</span><br></pre></td></tr></table></figure><p>ç„¶è€Œåœ¨ Object.is ä¸­ç›¸å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object.is(+0, -0); //false</span><br><span class="line">Object.is(NaN, NaN); //false</span><br></pre></td></tr></table></figure><p>å…¶ä»–ç»“æœä¸€è‡´ã€‚</p><h3 id="4-typeof"><a href="#4-typeof" class="headerlink" title="4. typeof"></a>4. typeof</h3><p>typeof èƒ½åšçš„å¾ˆæ˜ç¡®ï¼Œè¿…é€Ÿç¡®å®šåŸºç¡€ç±»å‹ï¼Œæ¯”å¦‚è¿™é‡Œæˆ‘å°±æ˜¯éœ€è¦ string or numberï¼Œç›´æ¥ç”¨å°±å¥½äº†ã€‚</p><p>ç¼ºç‚¹å°±æ˜¯å¯ä»¥åŒºåˆ†çš„ç±»å‹å¤ªå°‘äº†ï¼Œ</p><blockquote><p>typeof è¿ç®—ç¬¦é€šè¿‡æ£€æŸ¥å˜é‡çš„å†…éƒ¨æ ‡ç­¾æ¥ç¡®å®šå…¶ç±»å‹ã€‚ä¸åŒç±»å‹çš„å˜é‡åœ¨å†…éƒ¨è¢«èµ‹äºˆäº†ä¸åŒçš„æ ‡ç­¾</p></blockquote><p>ä½†æ˜¯è¿™ä¸ªæ ‡ç­¾åˆä¸å¯¹å¤–æš´éœ²ã€‚</p><p>ä»–ä¸èƒ½åˆ¤æ–­å¤æ‚ç±»å‹ï¼Œæ¯”å¦‚ new String(), Date, Null ç­‰ç­‰ï¼Œä»–éƒ½è¿”å› <code>object</code>, è€Œä¸”ä¼šæ··æ·† function å’Œ æ­£åˆ™ã€‚</p><p>æ‰€ä»¥åªèƒ½ç”¨ä»–åˆ¤æ–­åŸºç¡€ç±»å‹ï¼Œç”šè‡³è¿ function éƒ½ä¸è¡Œ.</p><p>è¿˜æœ‰å¾ˆå¤šé—®é¢˜ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/typeof">typeof</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">typeof null === &quot;object&quot;;</span><br><span class="line">typeof undeclaredVariable; // &quot;undefined&quot;</span><br><span class="line">typeof document.all === &#x27;undefined&#x27;;</span><br></pre></td></tr></table></figure><p>é™¤äº†åˆ¤æ–­æŸäº›ç¡®å®šçš„åŸºç¡€ç±»å‹ï¼Œä¸å»ºè®®ä½¿ç”¨</p><h3 id="5-instanceof"><a href="#5-instanceof" class="headerlink" title="5. instanceof"></a>5. instanceof</h3><p>ä»–çš„é€»è¾‘æœ¬è´¨ä¸Šæ˜¯ä¸åœçš„ç½‘ä¸Šå¯»æ‰¾åŒ¹é…çš„åŸå‹æˆ–è€…æ„é€ å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">object <span class="keyword">instanceof</span> constructor</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼ŒåŸºç¡€ç±»å‹æ˜¯æ— æ³•åŒ¹é…çš„</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">instanceof</span> <span class="title class_">Number</span> <span class="comment">//false</span></span><br><span class="line">(<span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">1</span>)) <span class="keyword">instanceof</span> <span class="title class_">Number</span> <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p>ä¾ç…§è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¿™æ ·å†™</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> <span class="title class_">Person</span>(); </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person <span class="keyword">instanceof</span> <span class="title class_">Person</span>); </span><br></pre></td></tr></table></figure><h3 id="6-è‡ªå·±å†™ä¸€ä¸ª-instanceof"><a href="#6-è‡ªå·±å†™ä¸€ä¸ª-instanceof" class="headerlink" title="6. è‡ªå·±å†™ä¸€ä¸ª instanceof"></a>6. è‡ªå·±å†™ä¸€ä¸ª instanceof</h3><p>æ ¸å¿ƒå°±æ˜¯ä¸åœçš„å¾€ä¸ŠæŸ¥ï¼Œå†™ä¸€ä¸ªé€’å½’.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myInstanceof</span>(<span class="params">obj, type</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> prototype = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(obj);</span><br><span class="line"><span class="keyword">if</span>(prototype === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span>(prototype.<span class="property">constructor</span> === type) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">myInstanceof</span>(prototype, type);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-Object-prototype-toString-call"><a href="#7-Object-prototype-toString-call" class="headerlink" title="7. Object.prototype.toString.call"></a>7. Object.prototype.toString.call</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/toString">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/toString</a></p><blockquote><p>Object.prototype.toString æ˜¯ Object ç±»åŸå‹ä¸Šçš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè¿”å›ä¸€ä¸ªè¡¨ç¤ºå¯¹è±¡ç±»å‹çš„å­—ç¬¦ä¸²ã€‚å½“æˆ‘ä»¬è°ƒç”¨ Object.prototype.toString æ–¹æ³•æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥è°ƒç”¨è€…çš„å†…éƒ¨æ ‡ç­¾ï¼Œå¹¶è¿”å›ç›¸åº”çš„å­—ç¬¦ä¸²è¡¨ç¤ºå¯¹è±¡ç±»å‹ã€‚</p></blockquote><p>è¿™ä¸ªå°±å¾ˆå¥‡æ€ªäº†ï¼Œæ—¢ç„¶ typeof ä¹Ÿæ˜¯è°ƒç”¨å†…éƒ¨çš„æ ‡ç­¾ï¼Œä¸ºä»€ä¹ˆ typeof ä¸è¡Œã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>;</span><br><span class="line"></span><br><span class="line">toString.<span class="title function_">call</span>(<span class="keyword">new</span> <span class="title class_">Date</span>()); <span class="comment">// [object Date]</span></span><br><span class="line">toString.<span class="title function_">call</span>(<span class="keyword">new</span> <span class="title class_">String</span>()); <span class="comment">// [object String]</span></span><br><span class="line"><span class="comment">// Math has its Symbol.toStringTag</span></span><br><span class="line">toString.<span class="title function_">call</span>(<span class="title class_">Math</span>); <span class="comment">// [object Math]</span></span><br><span class="line"></span><br><span class="line">toString.<span class="title function_">call</span>(<span class="literal">undefined</span>); <span class="comment">// [object Undefined]</span></span><br><span class="line">toString.<span class="title function_">call</span>(<span class="literal">null</span>); <span class="comment">// [object Null]</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æå‡ºçš„æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object.prototype.toString.call(&#x27;1&#x27;) //[object String]</span><br><span class="line">Object.prototype.toString.call(new String(&#x27;1&#x27;)) //[object String]</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯æ²¡æœ‰åŒºåˆ†çš„ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯æœ‰åŒºåˆ«çš„ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯</p><blockquote><p>ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨ toString() æ˜¯ä¸å¯é çš„ï¼›å¯¹è±¡å¯ä»¥é€šè¿‡å®šä¹‰ Symbol.toStringTag å±æ€§æ¥æ›´æ”¹ Object.prototype.toString() çš„è¡Œä¸ºï¼Œä»è€Œå¯¼è‡´æ„æƒ³ä¸åˆ°çš„ç»“æœ</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const myDate = new Date();</span><br><span class="line">Object.prototype.toString.call(myDate); // [object Date]</span><br><span class="line"></span><br><span class="line">myDate[Symbol.toStringTag] = &quot;myDate&quot;;</span><br><span class="line">Object.prototype.toString.call(myDate); // [object myDate]</span><br><span class="line"></span><br><span class="line">Date.prototype[Symbol.toStringTag] = &quot;prototype polluted&quot;;</span><br><span class="line">Object.prototype.toString.call(new Date()); // [object prototype polluted]</span><br></pre></td></tr></table></figure><h3 id="8-Array-isArray"><a href="#8-Array-isArray" class="headerlink" title="8. Array.isArray"></a>8. Array.isArray</h3><ul><li>é¦–å…ˆï¼Œå®ƒä¼šä½¿ç”¨ Object.prototype.toString æ–¹æ³•æ¥è·å–å€¼çš„å†…éƒ¨æ ‡ç­¾ã€‚</li><li>ç„¶åï¼Œå®ƒä¼šå°†å†…éƒ¨æ ‡ç­¾ä¸å­—ç¬¦ä¸² â€œ[object Array]â€ è¿›è¡Œæ¯”è¾ƒã€‚</li><li>å¦‚æœå†…éƒ¨æ ‡ç­¾ä¸ â€œ[object Array]â€ åŒ¹é…ï¼Œå³è¡¨ç¤ºè¯¥å€¼ä¸ºæ•°ç»„ï¼Œè¿”å› trueã€‚</li><li>å¦‚æœå†…éƒ¨æ ‡ç­¾ä¸ â€œ[object Array]â€ ä¸åŒ¹é…ï¼Œå³è¡¨ç¤ºè¯¥å€¼ä¸æ˜¯æ•°ç»„ï¼Œè¿”å› falseã€‚</li></ul><p>åŸç†ä¸Šåº”è¯¥å’Œ Object.prototype.toString.call ä¸€æ ·ã€‚</p><h3 id="9-æ€»ç»“"><a href="#9-æ€»ç»“" class="headerlink" title="9. æ€»ç»“"></a>9. æ€»ç»“</h3><p>è¿˜æ˜¯è¦ typoef å’Œ Object.prototype.toString.call è”åˆä½¿ç”¨æ‰èƒ½çœŸæ­£å¾ˆå¥½çš„è§£å†³é—®é¢˜ã€‚</p><p>instanceof çœŸçš„å¯ä»¥é€€ä¼‘äº†ã€‚</p><h3 id="10-èµ„æ–™"><a href="#10-èµ„æ–™" class="headerlink" title="10. èµ„æ–™"></a>10. èµ„æ–™</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/toString">Object.prototype.toString()</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/typeof">typeof</a></p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
            <tag> instanceof </tag>
            
            <tag> Object.is </tag>
            
            <tag> isArray </tag>
            
            <tag> toString.call </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript new åšäº†ä»€ä¹ˆï¼Ÿ</title>
      <link href="/2023/07/03/js_new/"/>
      <url>/2023/07/03/js_new/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="new-åšäº†ä»€ä¹ˆï¼Ÿ"><a href="#new-åšäº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="new åšäº†ä»€ä¹ˆï¼Ÿ"></a>new åšäº†ä»€ä¹ˆï¼Ÿ</h1><p>ç»å¸¸ä½¿ç”¨ new</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, sex</span>) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">sex</span> = sex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> person = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;tommy&#x27;</span>, <span class="string">&#x27;male&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">name</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>();</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆ new å…³é”®å­—åšäº†ä»€ä¹ˆ ?</p><ol><li>åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼šä½¿ç”¨ new å…³é”®å­—åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°†æˆä¸ºå®ä¾‹åŒ–çš„å¯¹è±¡ã€‚</li><li>è®¾ç½®åŸå‹é“¾è¿æ¥ï¼šå°†æ–°åˆ›å»ºçš„å¯¹è±¡çš„åŸå‹é“¾æ¥åˆ°æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼ˆConstructor.prototypeï¼‰ä¸Šã€‚è¿™æ ·ï¼Œå®ä¾‹å¯¹è±¡å°±å¯ä»¥è®¿é—®æ„é€ å‡½æ•°åŸå‹å¯¹è±¡ä¸Šå®šä¹‰çš„å±æ€§å’Œæ–¹æ³•ã€‚</li><li>ç»‘å®š this ä¸Šä¸‹æ–‡ï¼šå°†æ„é€ å‡½æ•°çš„ this ä¸Šä¸‹æ–‡ç»‘å®šåˆ°æ–°åˆ›å»ºçš„å¯¹è±¡ä¸Šï¼Œä½¿æ„é€ å‡½æ•°å†…éƒ¨çš„ä»£ç å¯ä»¥è®¿é—®å’Œæ“ä½œæ–°å¯¹è±¡ã€‚</li><li>æ‰§è¡Œæ„é€ å‡½æ•°ä»£ç ï¼šæ‰§è¡Œæ„é€ å‡½æ•°çš„ä»£ç å—ï¼Œå°†å±æ€§å’Œæ–¹æ³•æ·»åŠ åˆ°æ–°åˆ›å»ºçš„å¯¹è±¡ä¸Šã€‚åœ¨æ„é€ å‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨ this å…³é”®å­—å¼•ç”¨æ–°å¯¹è±¡ï¼Œå¹¶å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ã€‚</li><li>è¿”å›æ–°å¯¹è±¡ï¼šå¦‚æœæ„é€ å‡½æ•°æ²¡æœ‰æ˜¾å¼è¿”å›å…¶ä»–å¯¹è±¡ï¼Œé‚£ä¹ˆ new è¡¨è¾¾å¼å°†éšå¼è¿”å›æ–°åˆ›å»ºçš„å¯¹è±¡å®ä¾‹ã€‚è¿™æ ·ï¼Œé€šè¿‡ new åˆ›å»ºçš„å¯¹è±¡å°±å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼Œå¹¶å¼•ç”¨è¯¥å®ä¾‹ã€‚</li></ol><p>æŒ‰ç…§è¿™ä¸ªé€»è¾‘ï¼Œæˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ªå‡½æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_new</span>(<span class="params">func, ...params</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œå¹¶ä¸”æŠŠåŸå‹é“¾å‰¯æµ…æ‹·è´åˆ°æ–°çš„å¯¹è±¡ä¸­</span></span><br><span class="line"><span class="comment">//func.prototype </span></span><br><span class="line"><span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(func.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="comment">//è°ƒç”¨ func, å¹¶ä¸”ä»¥ objä¸ºthis.</span></span><br><span class="line"><span class="keyword">const</span> result = func.<span class="title function_">apply</span>(obj, params);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> o = result || obj;</span><br><span class="line"><span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¹Ÿå°±è¯´æ˜äº†åŸç†ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
            <tag> new </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨äº‹ä»¶å¾ªç¯</title>
      <link href="/2023/07/03/eventLoop/"/>
      <url>/2023/07/03/eventLoop/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="1-V8å¼•æ“"><a href="#1-V8å¼•æ“" class="headerlink" title="1. V8å¼•æ“"></a>1. V8å¼•æ“</h3><p>å½“æˆ‘ä»¬æœ‰æ®µ javascript æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ</p><p>å½“æµè§ˆå™¨è§£æåˆ°ä¸€æ®µjavascriptï¼Œä¼šå°† javascript äº¤ç»™ jså¼•æ“ï¼Œå¼•æ“å»åšä¸€ç³»åˆ—äº‹æƒ…ã€‚</p><p>è¯æ³•åˆ†æï¼Œè¯­æ³•åˆ†æï¼Œç¼–è¯‘ï¼Œä¼˜åŒ–ä¹‹ç±»çš„ï¼Œä½†æ˜¯å¦‚æœè¦å…³è”åˆ°æˆ‘ä»¬å¸¸ç”¨çš„jsï¼Œéå¸¸é‡è¦çš„å°±æ˜¯ï¼Œå †å’Œæ ˆï¼Œä¸‹é¢æ˜¯å †æ ˆçš„ç®€å•è§£é‡Šã€‚</p><blockquote><p>æ‰§è¡Œæ ˆï¼ˆExecution Stackï¼‰ï¼š</p><p>æ‰§è¡Œæ ˆæ˜¯ä¸€ç§åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ•°æ®ç»“æ„ï¼Œä¹Ÿè¢«ç§°ä¸ºè°ƒç”¨æ ˆï¼ˆCall Stackï¼‰ã€‚å®ƒç”¨äºè·Ÿè¸ªå‡½æ•°çš„è°ƒç”¨é¡ºåºå’Œæ‰§è¡ŒçŠ¶æ€ã€‚æ¯å½“å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecution Contextï¼‰ä¼šè¢«æ·»åŠ åˆ°æ‰§è¡Œæ ˆçš„é¡¶éƒ¨ã€‚æ‰§è¡Œæ ˆä¸­çš„é¡¶éƒ¨å§‹ç»ˆæ˜¯å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°ã€‚å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šè¢«ä»æ‰§è¡Œæ ˆä¸­ç§»é™¤ï¼Œæ§åˆ¶æƒäº¤å›ç»™è°ƒç”¨è¯¥å‡½æ•°çš„ä¸Šä¸‹æ–‡ã€‚<br>å †ï¼ˆHeapï¼‰ï¼š</p><p>å †æ˜¯ç”¨äºåŠ¨æ€åˆ†é…å†…å­˜çš„åŒºåŸŸï¼Œç”¨äºå­˜å‚¨å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¦‚å¯¹è±¡å’Œæ•°ç»„ã€‚JavaScriptä¸­çš„å¯¹è±¡å’Œæ•°ç»„éƒ½å­˜å‚¨åœ¨å †ä¸­ã€‚</p></blockquote><p>æ–‡ç« ä¸­æåˆ°äº†ä¸€ä¸ªæ¦‚å¿µï¼Œå°±æ˜¯</p><blockquote><p>ä½ ç»™V8ä¸€æ®µJSä»£ç ï¼Œå®ƒå°±ä»å¤´åˆ°å°¾ä¸€å£æ°”æ‰§è¡Œä¸‹å»ï¼Œä¸­é—´ä¸ä¼šåœæ­¢</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ‰§è¡Œä¸­...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå¡ä½ï¼Œ</p><h3 id="2-ä»€ä¹ˆæ˜¯jsçº¿ç¨‹å’Œæ¸²æŸ“çº¿ç¨‹"><a href="#2-ä»€ä¹ˆæ˜¯jsçº¿ç¨‹å’Œæ¸²æŸ“çº¿ç¨‹" class="headerlink" title="2. ä»€ä¹ˆæ˜¯jsçº¿ç¨‹å’Œæ¸²æŸ“çº¿ç¨‹"></a>2. ä»€ä¹ˆæ˜¯jsçº¿ç¨‹å’Œæ¸²æŸ“çº¿ç¨‹</h3><blockquote><p>JavaScriptçº¿ç¨‹æ˜¯ç”¨äºæ‰§è¡ŒJavaScriptä»£ç çš„çº¿ç¨‹ã€‚å®ƒè´Ÿè´£è§£æå’Œæ‰§è¡Œç½‘é¡µä¸­çš„JavaScriptä»£ç ï¼Œå¹¶å¤„ç†ä¸ä¹‹ç›¸å…³çš„äº‹ä»¶å’Œæ“ä½œã€‚JavaScriptçº¿ç¨‹æ˜¯å•çº¿ç¨‹çš„ï¼Œæ„å‘³ç€å®ƒä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚å½“æµè§ˆå™¨åœ¨æ¸²æŸ“é¡µé¢æ—¶ï¼ŒJavaScriptçº¿ç¨‹ä¼šè¢«å ç”¨ï¼Œæ‰§è¡ŒJavaScriptä»£ç å¯èƒ½ä¼šé˜»å¡å…¶ä»–ä»»åŠ¡çš„æ‰§è¡Œï¼ŒåŒ…æ‹¬ç”¨æˆ·ç•Œé¢çš„å“åº”ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ç¼–å†™JavaScriptä»£ç æ—¶éœ€è¦æ³¨æ„é¿å…é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œï¼Œä»¥å…é˜»å¡ç”¨æˆ·ç•Œé¢çš„åŸå› ã€‚</p><p>æ¸²æŸ“çº¿ç¨‹æ˜¯è´Ÿè´£å°†HTMLã€CSSå’ŒJavaScriptè½¬æ¢ä¸ºå¯è§†åŒ–é¡µé¢çš„çº¿ç¨‹ã€‚å®ƒä»æµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“ä¸­æ´¾ç”Ÿå‡ºæ¥ï¼Œå¹¶æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œï¼ŒåŒ…æ‹¬è§£æHTMLå’ŒCSSã€æ„å»ºDOMæ ‘ã€è®¡ç®—å¸ƒå±€å’Œç»˜åˆ¶é¡µé¢ç­‰ã€‚æ¸²æŸ“çº¿ç¨‹é€šå¸¸æ˜¯å¤šçº¿ç¨‹çš„ï¼Œå®ƒå¯ä»¥å°†å·¥ä½œåˆ†é…ç»™ä¸åŒçš„å­çº¿ç¨‹æ¥æé«˜æ€§èƒ½å’Œå“åº”æ€§ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæ˜¯æ‰§è¡Œ javascript ä»£ç ï¼Œä¸€ä¸ªæ˜¯æ¸²æŸ“çº¿ç¨‹</p><p>ä¸¤ä¸ªéƒ½æ˜¯å•çº¿ç¨‹ï¼Œåªæ˜¯æ¸²æŸ“çº¿ç¨‹å¯èƒ½ä¼šæŠŠéƒ¨åˆ†ä»£ç äº¤ç»™gpuæ¥åšæ¸²æŸ“ã€‚</p><h3 id="3-äº‹ä»¶å¾ªç¯æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ"><a href="#3-äº‹ä»¶å¾ªç¯æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ" class="headerlink" title="3. äº‹ä»¶å¾ªç¯æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ"></a>3. äº‹ä»¶å¾ªç¯æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ</h3><p>æˆ‘æœ€å¼€å§‹ä½¿ç”¨javascriptçš„æ—¶å€™ä»¥ä¸ºï¼Œæ˜¯ä¸€ä¸ªæœ‰æ—¶é—´çº¿çš„é˜Ÿåˆ—ï¼Œé‚£ä¸ªæ—¶é—´çº¿å¿…é¡»å»æ‰§è¡ŒæŸä¸ªä¸œè¥¿ã€‚ã€‚</p><ol><li>JavaScript ä»£ç çš„æ‰§è¡Œä»ä¸»çº¿ç¨‹å¼€å§‹ï¼Œä¸»çº¿ç¨‹è´Ÿè´£æ‰§è¡ŒåŒæ­¥çš„ JavaScript ä»£ç ã€‚</li><li>å½“é‡åˆ°å¼‚æ­¥æ“ä½œï¼ˆå¦‚å®šæ—¶å™¨ã€ç½‘ç»œè¯·æ±‚ã€äº‹ä»¶ç›‘å¬å™¨ç­‰ï¼‰æ—¶ï¼Œå¼‚æ­¥æ“ä½œè¢«æ”¾ç½®åœ¨ä»»åŠ¡é˜Ÿåˆ—ï¼ˆTask Queueï¼‰ä¸­ï¼Œè€Œä¸ä¼šç«‹å³æ‰§è¡Œã€‚</li><li>å½“ä¸»çº¿ç¨‹ä¸Šçš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œäº‹ä»¶å¾ªç¯è¿›å…¥æ£€æŸ¥é˜¶æ®µã€‚</li><li>äº‹ä»¶å¾ªç¯æ£€æŸ¥ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦æœ‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡ï¼Œåˆ™å°†ä»»åŠ¡ç§»å‡ºé˜Ÿåˆ—ï¼Œå¹¶å°†å…¶å‘é€åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œã€‚</li><li>å¼‚æ­¥ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå¯èƒ½åŒ…æ‹¬å›è°ƒå‡½æ•°ã€Promise çš„å¤„ç†å‡½æ•°ã€å®šæ—¶å™¨çš„å›è°ƒç­‰ã€‚</li><li>æ‰§è¡Œå®Œå¼‚æ­¥ä»»åŠ¡åï¼Œäº‹ä»¶å¾ªç¯å†æ¬¡è¿›å…¥æ£€æŸ¥é˜¶æ®µï¼Œé‡å¤æ­¥éª¤ 4 å’Œæ­¥éª¤ 5ã€‚</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå…ˆæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œé‡åˆ°å¼‚æ­¥ä»£ç æ”¾è¿›åˆ—é˜Ÿï¼Œç­‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åæ£€æŸ¥ï¼Œå‘é€åˆ°ä¸»çº¿ç¨‹ï¼Œå®Œæˆä»¥å(ç»§ç»­æ£€æŸ¥ï¼Œç»§ç»­å‘é€åˆ°ä¸»çº¿ç¨‹)</p><p>è¿™ä¸ªè¿‡ç¨‹å°±å«åšäº‹ä»¶å¾ªç¯ã€‚</p><h3 id="4-setTimeoutï¼Œç½‘ç»œè¯·æ±‚æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ"><a href="#4-setTimeoutï¼Œç½‘ç»œè¯·æ±‚æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ" class="headerlink" title="4. setTimeoutï¼Œç½‘ç»œè¯·æ±‚æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ"></a>4. setTimeoutï¼Œç½‘ç»œè¯·æ±‚æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ</h3><p>æˆ‘äº§ç”Ÿäº†ä¸€ä¸ªç–‘é—®ï¼Œå¦‚æœè¿›å…¥äº†ä»»åŠ¡é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ—¶é—´åˆ°äº†ï¼Œéœ€è¦è§¦å‘äº†ï¼Œæ€ä¹ˆåšçš„ï¼Ÿç½‘ç»œè¯·æ±‚ï¼Œæ˜¯ç«‹åˆ»å‘é€ï¼Ÿ</p><p>å¼‚æ­¥ä»»åŠ¡ï¼Œéœ€è¦æ‰§è¡Œï¼Œé‚£ä¹ˆæ˜¯ç«‹åˆ»æ‰§è¡Œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ï¼Œæ¯”å¦‚Promiseæ‰§è¡Œçš„éƒ¨åˆ†ï¼Œç„¶åæŠŠå‰©ä½™å›è°ƒçš„éƒ¨åˆ†åŠ å…¥ä»»åŠ¡åˆ—é˜Ÿã€‚</p><p>é€šè¿‡äº‹ä»¶å¾ªç¯æ£€æŸ¥æ˜¯å¦åº”è¯¥æ‰§è¡Œï¼Œæ¯”å¦‚delayæ—¶é—´ï¼Œæ¯”å¦‚å¼‚æ­¥æ˜¯å¦å®Œæˆã€‚</p><p>ç„¶åæ¨é€åˆ°ä¸»çº¿ç¨‹ã€‚</p><p>è¿™é‡Œå°±ä¼šæƒ³åˆ°ä¸€ä¸ªé—®é¢˜, ä¹Ÿå°±æ˜¯ä¸€ä¸ªç¼ºé™·</p><p>å› ä¸ºç›®å‰çš„å•çº¿ç¨‹åšæ³•ï¼Œæ˜æ˜¾ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ã€‚å°±æ˜¯ä¸»çº¿ç¨‹é˜»å¡ä»¥åï¼Œä¼šå½±å“å…¶ä»–å¼‚æ­¥ä»»åŠ¡ï¼Œå¯¼è‡´å…¨é¢çš„é˜»å¡ã€‚</p><p>ä¹Ÿå°±æ˜¯ setTimeout ä¸å‡†ç¡®ï¼Œå¼‚æ­¥å®Œæˆä¹‹åå¹¶ä¸æ‰§è¡Œï¼Œåšä¸€ä¸ªç®€å•çš„æµ‹è¯•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//event</span></span><br><span class="line"><span class="keyword">const</span> startEvent = (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">getTime</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`startEvent`</span>, startEvent);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> endEvent = ((<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">getTime</span>());</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`endEvent`</span>, endEvent - startEvent); <span class="comment">//endEvent 27595</span></span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`finish setTimout:`</span>, (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">getTime</span>());</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">2000000000</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">let</span> b = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`finish for:`</span>, (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">getTime</span>());</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°±æ˜¯æœ‰å»¶è¿Ÿã€‚</p><h3 id="5-ä¸ºä»€ä¹ˆjsæ˜¯å•çº¿ç¨‹ï¼Ÿ"><a href="#5-ä¸ºä»€ä¹ˆjsæ˜¯å•çº¿ç¨‹ï¼Ÿ" class="headerlink" title="5. ä¸ºä»€ä¹ˆjsæ˜¯å•çº¿ç¨‹ï¼Ÿ"></a>5. ä¸ºä»€ä¹ˆjsæ˜¯å•çº¿ç¨‹ï¼Ÿ</h3><p>åœ¨ç¬¬å››ä¸ªèŠ‚ç‚¹ï¼ŒçŸ¥é“äº†å•çº¿ç¨‹æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œç„¶è€Œå¤šçº¿ç¨‹æ˜æ˜¾ä¼šè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸ç”¨å¤šçº¿ç¨‹å‘¢ï¼Ÿ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setText</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> myA = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">  myA.<span class="property">innerText</span> = (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">getTime</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="title function_">setText</span>(), <span class="number">1000</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="title function_">setText</span>(), <span class="number">2000</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="title function_">setText</span>(), <span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ¨¡æ‹Ÿå¼‚æ­¥ï¼Œåˆ†åˆ«1ç§’ï¼Œ2ç§’ï¼Œ3ç§’ã€‚ å›è°ƒä¸­å†™å…¥æ–°çš„å†…å®¹ã€‚</p><p>æˆ‘ä»¬æƒ³ä¸€æƒ³å¦‚æœä½¿ç”¨å¤šçº¿ç¨‹ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p><p>1ç§’ &#x3D;&gt; è°ƒç”¨å›è°ƒ &#x3D;&gt; æ“ä½œdom<br>2ç§’ &#x3D;&gt; è°ƒç”¨å›è°ƒ &#x3D;&gt; æ“ä½œdom<br>3ç§’ &#x3D;&gt; è°ƒç”¨å›è°ƒ &#x3D;&gt; æ“ä½œdom</p><p>ä¸ä¸»çº¿ç¨‹ä¸ç›¸å…³ï¼Œå‡ ä¸ªçº¿ç¨‹ç›¸äº’æ— å…³ï¼Œçœ‹ä¸Šå»å¾ˆç¾å¥½ã€‚</p><p>ä½†æ˜¯å®é™…ä¸Šï¼Œå¯èƒ½äº’æ–¥ï¼Œå› ä¸º4ä¸ªçº¿ç¨‹ï¼Œéƒ½ä¼šæ“ä½œdomï¼Œå¯¼è‡´é¡µé¢çš„å›æµæˆ–è€…é‡ç»˜ï¼Œè€Œä¸”æ—¶é—´ä¸ä¸€å®šä¼šè¿™ä¹ˆæ³¾æ¸­åˆ†æ˜ï¼Œå®Œå…¨å¯èƒ½å¯¼è‡´å†²çªï¼Œä»è€Œæå‡é¡µé¢çš„å¤æ‚åº¦ã€‚</p><p>è€Œä¸”åŠ é”è¿™ç§æƒ…å†µä¸‹ï¼Œè™½ç„¶è¯´æ˜¯1ç§’ï¼Œä½†æ˜¯ä¸ä¸€å®šä¼š1ç§’èƒ½è§£å†³ï¼Œä»è€Œå¯¼è‡´å…¶ä»–çº¿ç¨‹é˜»å¡ã€‚</p><p>è¯´ç™½äº†ï¼Œä¹‹æ‰€ä»¥å•çº¿ç¨‹ï¼Œå°±æ˜¯è¦ä¿è¯æ“ä½œ web api çš„åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œä¸æ˜¯ç»™çº¿ç¨‹åŠ é”ï¼Œå¯¼è‡´ç¨‹åºå¤æ‚åº¦é™¡å¢ã€‚</p><h3 id="6-å¾®ä»»åŠ¡ï¼Œå®ä»»åŠ¡"><a href="#6-å¾®ä»»åŠ¡ï¼Œå®ä»»åŠ¡" class="headerlink" title="6. å¾®ä»»åŠ¡ï¼Œå®ä»»åŠ¡"></a>6. å¾®ä»»åŠ¡ï¼Œå®ä»»åŠ¡</h3><p>åˆšæ‰åœ¨ç¬¬ä¸‰æ¡ä¸­è¯´åˆ°ï¼ŒjavascriptåŸºæœ¬æ‰§è¡Œçš„æ¦‚å¿µï¼Œå°±æ˜¯ä¸€å£æ°”æ‰§è¡Œï¼Œç„¶åæŠŠå¼‚æ­¥ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œç„¶åé€æ¡æ¨é€åˆ°ä¸»çº¿ç¨‹ã€‚</p><blockquote><p>äº‹ä»¶å¾ªç¯ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—å¯ä»¥åˆ†ä¸ºä¸åŒçš„é˜Ÿåˆ—ï¼ŒåŒ…æ‹¬å®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆMacro Task Queueï¼‰å’Œå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆMicro Task Queueï¼‰ã€‚</p></blockquote><ul><li>å®ä»»åŠ¡é˜Ÿåˆ—åŒ…å«äº†ä¸€äº›è¾ƒä¸ºè€—æ—¶çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ DOM æ“ä½œã€ç½‘ç»œè¯·æ±‚ç­‰ã€‚æ¯ä¸ªå®ä»»åŠ¡åœ¨æ‰§è¡Œå®Œæ¯•åï¼Œäº‹ä»¶å¾ªç¯æ‰ä¼šå»æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li><li>å¾®ä»»åŠ¡é˜Ÿåˆ—ç”¨äºå¤„ç†ä¸€äº›è½»é‡çº§çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ Promise çš„å›è°ƒå‡½æ•°ã€MutationObserver çš„å›è°ƒç­‰ã€‚å¾®ä»»åŠ¡åœ¨æ¯ä¸ªå®ä»»åŠ¡æ‰§è¡Œç»“æŸåç«‹å³æ‰§è¡Œï¼Œç¡®ä¿å®ƒä»¬åœ¨ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ä¹‹å‰è¢«å¤„ç†ã€‚</li></ul><p>æˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“ï¼Œå“ªäº›æ˜¯å¾®ä»»åŠ¡ï¼Œå“ªäº›æ˜¯å®ä»»åŠ¡</p><p><strong>å¾®ä»»åŠ¡</strong></p><ul><li>Promise å›è°ƒå‡½æ•°ï¼ˆthen, catch, finallyï¼‰</li><li>MutationObserver çš„å›è°ƒå‡½æ•°</li><li>process.nextTickï¼ˆä»…é™ Node.js ç¯å¢ƒï¼‰</li><li>queueMicrotask å‡½æ•°</li><li>Object.observeï¼ˆå·²è¢«åºŸå¼ƒï¼‰</li></ul><p><strong>å®ä»»åŠ¡</strong></p><ul><li>setTimeout å’Œ setInterval å›è°ƒå‡½æ•°</li><li>I&#x2F;O æ“ä½œå’Œç½‘ç»œè¯·æ±‚ï¼ˆå¦‚ AJAXã€fetchï¼‰</li><li>UI æ¸²æŸ“</li><li>requestAnimationFrame å›è°ƒå‡½æ•°</li><li>é¡µé¢åŠ è½½äº‹ä»¶ï¼ˆDOMContentLoaded, loadï¼‰</li><li>åŸç”Ÿäº‹ä»¶ï¼ˆå¦‚ç‚¹å‡»äº‹ä»¶ã€é”®ç›˜äº‹ä»¶ï¼‰</li><li>postMessage å’Œ MessageChannel</li><li>setImmediateï¼ˆä»…é™ Node.js ç¯å¢ƒï¼‰</li></ul><p>è¿™é‡ŒåŒ…å«äº†å¤§å¤šæ•°å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡ï¼Œä½†æ˜¯ä¸ä¿è¯å…¨éƒ¨ï¼Œå› ä¸ºæˆ‘ä¹Ÿæ²¡æ‰¾åˆ°å…¨éƒ¨å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡çš„è¿æ¥ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ£€æŸ¥é˜Ÿåˆ—ä»»åŠ¡ä¸­ï¼Œè¿˜åŒ…å«ä¸€äº›ç»†èŠ‚ã€‚</p><ol><li>å½“ä¸»çº¿ç¨‹ä¸Šçš„ä»£ç æ‰§è¡Œå®Œæˆåï¼Œäº‹ä»¶å¾ªç¯ä¼šé¦–å…ˆæ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li><li>å¦‚æœå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡ï¼Œäº‹ä»¶å¾ªç¯ä¼šæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºä¾æ¬¡æ‰§è¡Œæ‰€æœ‰çš„å¾®ä»»åŠ¡ï¼Œç›´åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºã€‚è¿™æ„å‘³ç€å¾®ä»»åŠ¡ä¼šåœ¨ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ä¹‹å‰æ‰§è¡Œã€‚</li><li>å½“å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºåï¼Œäº‹ä»¶å¾ªç¯ä¼šæ£€æŸ¥å®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li><li>å¦‚æœå®ä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡ï¼Œäº‹ä»¶å¾ªç¯ä¼šé€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œè¯¥ä»»åŠ¡çš„å…¨éƒ¨ä»£ç ã€‚</li><li>æ‰§è¡Œå®Œå½“å‰é€‰ä¸­çš„å®ä»»åŠ¡åï¼Œå¦‚æœæœ‰å¿…è¦ï¼Œäº‹ä»¶å¾ªç¯ä¼šå†æ¬¡æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œé‡å¤æ­¥éª¤ 2ã€‚</li><li>é‡å¤æ­¥éª¤ 3~5ï¼Œä¸æ–­åœ°ä»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­é€‰å–ä»»åŠ¡å¹¶æ‰§è¡Œï¼Œç›´åˆ°å®ä»»åŠ¡é˜Ÿåˆ—å’Œå¾®ä»»åŠ¡é˜Ÿåˆ—éƒ½ä¸ºç©ºã€‚</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå…ˆæ£€æŸ¥å¾®ä»»åŠ¡ï¼Œåœ¨æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼Œå†æ£€æŸ¥å¾®ä»»åŠ¡ï¼Œå†æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ã€‚</p><p>è¿™å°±æ˜¯ç»†èŠ‚ã€‚</p><h3 id="7-ç¬¬ä¸€é¢˜"><a href="#7-ç¬¬ä¸€é¢˜" class="headerlink" title="7. ç¬¬ä¸€é¢˜"></a>7. ç¬¬ä¸€é¢˜</h3><p>æˆ‘å»ç½‘ä¸Šæ‰¾äº†é¢è¯•é¢˜ï¼Œæ¥éªŒè¯ä¸€ä¸‹è¿™ä¸€ç« çš„å­¦ä¹ æˆæœ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise1&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">promise1.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>, promise1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt; (<span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">&#125;))</span><br><span class="line"><span class="title function_">fn</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>console.log(â€˜promise1â€™)</li><li>console.log(â€˜1â€™, promise1);</li><li>console.log(2);</li><li>console.log(â€˜startâ€™)</li><li>console.log(3);</li><li>console.log(res)</li></ul><p>ç†è®ºä¸Šæ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯ç”±äº promise1 å¹¶æ²¡æœ‰ resolve, rejectï¼Œæ‰€ä»¥ console.log(3); æ²¡æœ‰è¿”å›ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ Promise é‡Œé¢çš„æ–¹å¼åªç«‹åˆ»æ‰§è¡Œçš„ï¼Œä»–ä¸å±äºå¼‚æ­¥ä»»åŠ¡ï¼Œå°±æ˜¯V8å¼•æ“åœ¨æ‰§è¡Œçš„æ—¶å€™é¡ºåºæ‰§è¡Œçš„ä»£ç ï¼Œæ¯”å¦‚ä½ å‘èµ·è¯·æ±‚ï¼Œä»–ä¼šç«‹åˆ»å‘èµ·è¯·æ±‚ã€‚</p><h3 id="8-ç¬¬äºŒé¢˜"><a href="#8-ç¬¬äºŒé¢˜" class="headerlink" title="8. ç¬¬äºŒé¢˜"></a>8. ç¬¬äºŒé¢˜</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//å¾®ä»»åŠ¡</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise1&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> timer2 = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//å®ä»»åŠ¡</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;timer2&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> timer1 = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//å®ä»»åŠ¡</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;timer1&#x27;</span>)</span><br><span class="line">  <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//å¾®ä»»åŠ¡</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise2&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start&#x27;</span>); <span class="comment">//ç›´æ¥æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><ul><li>console.log(â€˜startâ€™)</li><li>console.log(â€˜promise1â€™);</li><li>console.log(â€˜timer1â€™)</li><li>console.log(â€˜promise2â€™)</li><li>console.log(â€˜timer2â€™)</li></ul><p>çœ‹åˆ°æ²¡ï¼Œå¹¶ä¸å¤æ‚ï¼Œä½ æ˜ç™½äº†åŸç†ä»¥åï¼Œä»–çš„çŸ¥è¯†ç‚¹å°±æ˜¯ä¸åœçš„åœ¨å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡ä¹‹é—´è½¬æ¢ï¼Œç„¶åæ ¹æ®ä½œç”¨åŸŸï¼Œä¸åœçš„æ‰§è¡Œã€‚</p><h3 id="9-ç¬¬ä¸‰é¢˜"><a href="#9-ç¬¬ä¸‰é¢˜" class="headerlink" title="9. ç¬¬ä¸‰é¢˜"></a>9. ç¬¬ä¸‰é¢˜</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//å®ä»»åŠ¡</span></span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> promise2 = promise1.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//å¾®ä»»åŠ¡</span></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;error!!!&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise1&#x27;</span>, promise1) <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise2&#x27;</span>, promise2) <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//å®ä»»åŠ¡</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise1&#x27;</span>, promise1)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise2&#x27;</span>, promise2)</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜å¢åŠ äº† <code>setTimeout</code> æ—¶é—´ã€‚</p><ul><li>console.log(â€˜promise1â€™, promise1)</li><li>console.log(â€˜promise2â€™, promise2)</li><li>throw new Error(â€˜error!!!â€™)</li><li>console.log(â€˜promise1â€™, promise1)</li><li>console.log(â€˜promise2â€™, promise2)</li></ul><p>å¦‚æœåŠ å…¥äº† setTimout,è¿˜éœ€è¦è€ƒè™‘è¿™ä¸ªæ‰§è¡Œçš„æ—¶é—´é¡ºåº</p><h3 id="9-ç¬¬å››é¢˜"><a href="#9-ç¬¬å››é¢˜" class="headerlink" title="9. ç¬¬å››é¢˜"></a>9. ç¬¬å››é¢˜</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123; <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//å®ä»»åŠ¡</span></span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer1&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1é‡Œçš„å†…å®¹&quot;</span>); <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> promise2 = promise1.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//å¾®ä»»åŠ¡</span></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error!!!&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>, promise1); <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise2&quot;</span>, promise2); <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//å®ä»»åŠ¡</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer2&quot;</span>); </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>, promise1);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise2&quot;</span>, promise2);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure><ul><li>console.log(â€œpromise1é‡Œçš„å†…å®¹â€);</li><li>console.log(â€œpromise1â€, promise1);</li><li>console.log(â€œpromise2â€, promise2);</li><li>throw new Error(â€œerror!!!â€);</li><li>console.log(â€œtimer1â€);</li><li>console.log(â€œtimer2â€); </li><li>console.log(â€œpromise1â€, promise1);</li><li>console.log(â€œpromise2â€, promise2);</li></ul><p>æˆ‘è¿™é‡Œæœ‰ä¸€ä¸ªé”™è¯¯ï¼Œå°±æ˜¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer1&quot;</span>);</span><br></pre></td></tr></table></figure><p>æˆ‘ç¬¬ä¸€ååº”è¿˜æ˜¯é¡ºåºæ‰§è¡Œï¼Œå…¶å® <code>resolve(&quot;success&quot;);</code> éœ€è¦çœ‹åšä¸€ä¸ªå¾®ä»»åŠ¡ã€‚</p><p>æ‰€ä»¥æ­¥éª¤æ˜¯ </p><ol><li>æ‰§è¡Œå®Œæ‰€æœ‰çš„ä»£ç å</li><li>æ‰§è¡Œå¾®ä»»åŠ¡ promise1.then(() &#x3D;&gt; â€¦) ä½†æ˜¯æ²¡æœ‰éœ€è¦æ‰§è¡Œçš„</li><li>æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ promise1 ä¸‹çš„ settimeout</li><li>ä¼˜å…ˆæ‰§è¡Œé¡ºåºä»£ç  console.log(â€œtimer1â€);</li><li>æ‰§è¡Œå¾®ä»»åŠ¡ promise1.then(() &#x3D;&gt; {â€¦});</li><li>æ‰§è¡Œå®ä»»åŠ¡ setTimeout(() &#x3D;&gt; {â€¦}) æœ€åä¸€ä¸ª setTimeout.</li></ol><h3 id="10-æ€»ç»“"><a href="#10-æ€»ç»“" class="headerlink" title="10. æ€»ç»“"></a>10. æ€»ç»“</h3><p>è¿™é‡Œæˆ‘å­¦åˆ°äº†ï¼Œæµè§ˆå™¨ javascript æ‰§è¡Œçš„æœºåˆ¶</p><p>é¡ºåºæ‰§è¡Œï¼Œé‡åˆ°å¼‚æ­¥ä»»åŠ¡å…ˆæ”¾åœ¨åˆ—é˜Ÿä¸­<br>æ‰§è¡Œå®Œæˆä»¥åè¿›å…¥å¾ªç¯ &#x3D;&gt; æŸ¥è¯¢å¾®ä»»åŠ¡ï¼Œæ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡ &#x3D;&gt; æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ &#x3D;&gt; æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡ &#x3D;&gt; æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡(å¾ªç¯)</p><p>é¢è¯•é—®è¿™ä¸ªå†ä¹Ÿæ²¡é—®é¢˜äº†ã€‚</p><h3 id="11-å¼•ç”¨"><a href="#11-å¼•ç”¨" class="headerlink" title="11. å¼•ç”¨"></a>11. å¼•ç”¨</h3><ul><li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loops">event-loops</a></li><li><a href="https://juejin.cn/post/6844904087163502605">å¼‚æ­¥ä»»åŠ¡(å¾®ä»»åŠ¡ã€å®ä»»åŠ¡)ï¼Œä½ å­¦ä¼šäº†å—ï¼Ÿè¿˜æœ‰4é“é¢è¯•é¢˜</a></li></ul></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
            <tag> æµè§ˆå™¨ </tag>
            
            <tag> æ—¶é—´å¾ªç¯ </tag>
            
            <tag> eventloop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±æ‹·è´æ–¹æ³•ä¼˜ç¼ºç‚¹æ€»ç»“</title>
      <link href="/2023/07/03/deepClone/"/>
      <url>/2023/07/03/deepClone/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="æ·±åº¦æ‹·è´"><a href="#æ·±åº¦æ‹·è´" class="headerlink" title="æ·±åº¦æ‹·è´"></a>æ·±åº¦æ‹·è´</h1><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœéœ€è¦æ·±åº¦æ‹·è´ï¼Œç½‘ä¸Šä¼šæ¨èä¸‰ç§æ–¹å¼ã€‚</p><ol><li>JSON.stringify(obj)</li><li>_.cloneDeep(value)</li><li>è‡ªå·±å†™æ·±åº¦éå†</li></ol><h3 id="JSON-stringify"><a href="#JSON-stringify" class="headerlink" title="JSON.stringify"></a>JSON.stringify</h3><blockquote><p>é¦–å…ˆï¼Œå°†è¦è¢«åºåˆ—åŒ–çš„å¯¹è±¡ï¼ˆç§°ä¸ºç›®æ ‡å¯¹è±¡ï¼‰ä¼ é€’ç»™å‡½æ•°ã€‚JSON.stringify()<br>JSON.stringify()å‡½æ•°æ£€æŸ¥ç›®æ ‡å¯¹è±¡çš„æ•°æ®ç±»å‹ã€‚ å¦‚æœç›®æ ‡å¯¹è±¡æ˜¯ä¸€ä¸ªç®€å•ç±»å‹ï¼ˆä¾‹å¦‚å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ã€nullã€undefinedï¼‰ï¼Œåˆ™å®ƒä¼šç›´æ¥è¿”å›è¯¥å€¼çš„JSONè¡¨ç¤ºã€‚<br>å¦‚æœç›®æ ‡å¯¹è±¡æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™ä¼šé€’å½’åœ°è°ƒç”¨è‡ªèº«ï¼Œå¯¹æ¯ä¸ªæ•°ç»„å…ƒç´ è¿›è¡Œåºåˆ—åŒ–ï¼Œå¹¶å°†ç»“æœæ‹¼æ¥æˆä¸€ä¸ªJSONæ•°ç»„ã€‚JSON.stringify()<br>å¦‚æœç›®æ ‡å¯¹è±¡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ä¼šé€’å½’åœ°è°ƒç”¨è‡ªèº«ï¼Œå¯¹æ¯ä¸ªå¯¹è±¡å±æ€§è¿›è¡Œåºåˆ—åŒ–ï¼Œå¹¶å°†ç»“æœæ‹¼æ¥æˆä¸€ä¸ªJSONå¯¹è±¡ã€‚JSON.stringify()<br>åœ¨åºåˆ—åŒ–å¯¹è±¡å±æ€§æ—¶ï¼Œä¼šè·³è¿‡å±æ€§å€¼ä¸ºå‡½æ•°æˆ–undefinedçš„å±æ€§ï¼Œå¹¶åœ¨å…¶ä»–æƒ…å†µä¸‹å°†å±æ€§å€¼è½¬æ¢ä¸ºJSONæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚JSON.stringify()<br>æœ€åï¼Œè¿”å›ä¸€ä¸ªJSONæ ¼å¼çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ•´ä¸ªç›®æ ‡å¯¹è±¡ã€‚JSON.stringify()</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¼šè·³è¿‡ä¸€äº›å±æ€§ã€‚ ä¾‹å¦‚ï¼Œå½“å¯¹è±¡åŒ…å«å¾ªç¯å¼•ç”¨æ—¶ï¼Œä¼šå°†è¿™äº›å¼•ç”¨è·³è¿‡ï¼Œä»¥é¿å…æ— é™é€’å½’ã€‚ æ­¤å¤–ï¼Œå¯¹äºæŸäº›ä¸æ”¯æŒçš„æ•°æ®ç±»å‹ï¼ˆä¾‹å¦‚æ—¥æœŸå¯¹è±¡ï¼‰ï¼Œå¯èƒ½ä¼šå°†å®ƒä»¬è½¬æ¢ä¸ºnullæˆ–ç©ºå­—ç¬¦ä¸²ã€‚</p></blockquote><p>ä»–çš„ä¸»è¦é—®é¢˜å…¶å®ä¸æ˜¯é—®é¢˜ï¼Œä¸»è¦æ˜¯é”™è¯¯çš„åº”ç”¨æ–¹å¼ï¼Œä»–æœ¬èº«å°±æ˜¯ä¸ºäº† json &#x3D;&gt; string.</p><p>æ‰€ä»¥å½“ä½ ä½¿ç”¨ä»–çš„æ—¶å€™</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj))</span><br></pre></td></tr></table></figure><p>ä¼šå‘ç°ä»¥ä¸‹é—®é¢˜</p><ol><li>Date() ä»–ç›´æ¥ç»™ä½  toString() äº†ã€‚</li><li>ä»–ä¸æ”¯æŒå‡½æ•°å¯¹è±¡</li><li>ä»–ä¸æ”¯æŒ Map,Set,Error,RegExpï¼ŒSymbol ç­‰ç­‰.</li><li>ä¸æ”¯æŒå¾ªç¯å¼•ç”¨</li></ol><p>ä¸æ”¯æŒå¾ªç¯å¼•ç”¨çš„é—®é¢˜ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line">obj.<span class="property">b</span> = obj;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™å°±ä¼šæŠ¥é”™ã€‚</p><h3 id="clonedeep"><a href="#clonedeep" class="headerlink" title="_.clonedeep"></a>_.clonedeep</h3><p>clonedeep æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œé—®é¢˜æ˜¯éœ€è¦å¼•å…¥ <code>lodash</code>.</p><p>ç®€å•çœ‹äº†ä¸€ä¸‹ä»–çš„æºç </p><p><strong>.internal&#x2F;baseClone.js</strong></p><p>å¤§æ¦‚æ˜¯è¿™ä¸ªé€’å½’çš„æ€è·¯æ¥çš„</p><h3 id="è‡ªå·±å†™ä¸€ä¸ª-deepClone"><a href="#è‡ªå·±å†™ä¸€ä¸ª-deepClone" class="headerlink" title="è‡ªå·±å†™ä¸€ä¸ª deepClone"></a>è‡ªå·±å†™ä¸€ä¸ª deepClone</h3><p>æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªé€’å½’ï¼Œæˆ‘å†™ä¸€ä¸ªä¼ªä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> argsTag = <span class="string">&#x27;[object Arguments]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> arrayTag = <span class="string">&#x27;[object Array]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> boolTag = <span class="string">&#x27;[object Boolean]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> dateTag = <span class="string">&#x27;[object Date]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> errorTag = <span class="string">&#x27;[object Error]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> mapTag = <span class="string">&#x27;[object Map]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> numberTag = <span class="string">&#x27;[object Number]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> objectTag = <span class="string">&#x27;[object Object]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> regexpTag = <span class="string">&#x27;[object RegExp]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> setTag = <span class="string">&#x27;[object Set]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> stringTag = <span class="string">&#x27;[object String]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> symbolTag = <span class="string">&#x27;[object Symbol]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> weakMapTag = <span class="string">&#x27;[object WeakMap]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> arrayBufferTag = <span class="string">&#x27;[object ArrayBuffer]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> dataViewTag = <span class="string">&#x27;[object DataView]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> float32Tag = <span class="string">&#x27;[object Float32Array]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> float64Tag = <span class="string">&#x27;[object Float64Array]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> int8Tag = <span class="string">&#x27;[object Int8Array]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> int16Tag = <span class="string">&#x27;[object Int16Array]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> int32Tag = <span class="string">&#x27;[object Int32Array]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> uint8Tag = <span class="string">&#x27;[object Uint8Array]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> uint8ClampedTag = <span class="string">&#x27;[object Uint8ClampedArray]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> uint16Tag = <span class="string">&#x27;[object Uint16Array]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> uint32Tag = <span class="string">&#x27;[object Uint32Array]&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ¤æ–­ç±»å‹ï¼Œå¦‚æœ typeof ä¸æ˜¯ objectï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="comment">//åˆ¤æ–­ç±»å‹</span></span><br><span class="line">    <span class="comment">//ä½ éœ€è¦æŠŠæ¯ä¸€ä¸ªç±»å‹åˆ—å‡ºæ¥å•ç‹¬å¤„ç†ï¼Œå¦‚åŒä¸Šå›¾çš„tag</span></span><br><span class="line">    <span class="comment">//åŸºç¡€ç±»å‹ new String(), new Date() ä¹‹ç±»çš„ï¼Œä½¿ç”¨å–å‡ºåŸå§‹å€¼ï¼Œæ¥åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œå¹¶ä¸”èµ‹å€¼</span></span><br><span class="line">    <span class="comment">//å¦‚æœæ˜¯Array, Map, Set ... ä¹‹ç±»çš„çš„é›†åˆï¼Œå­—å…¸ï¼Œæ•°ç»„ï¼Œéå†å¾ªç¯é€’å½’ã€‚</span></span><br><span class="line">    <span class="comment">//æœ€åç»™å‡ºä¸€ä¸ªç»“æœ</span></span><br><span class="line">    <span class="comment">//return reuslt</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–°æ–¹å¼ï¼ŒstructuredClone"><a href="#æ–°æ–¹å¼ï¼ŒstructuredClone" class="headerlink" title="æ–°æ–¹å¼ï¼ŒstructuredClone"></a>æ–°æ–¹å¼ï¼ŒstructuredClone</h3><p>è§£å†³äº†å¤§éƒ¨åˆ†é—®é¢˜ã€‚</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/structuredClone">https://developer.mozilla.org/en-US/docs/Web/API/structuredClone</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> calendarEvent = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;Builder.io Conf&quot;</span>,</span><br><span class="line">  <span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">123</span>),</span><br><span class="line">  <span class="attr">attendees</span>: [<span class="string">&quot;Steve&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> copied = <span class="title function_">structuredClone</span>(calendarEvent)</span><br></pre></td></tr></table></figure><blockquote><p>å…‹éš†æ— é™åµŒå¥—çš„å¯¹è±¡å’Œæ•°ç»„<br>å…‹éš†å¾ªç¯å¼•ç”¨<br>å…‹éš†å„ç§ JavaScript ç±»å‹ï¼Œä¾‹å¦‚ ã€ ã€ ç­‰ç­‰DateSetMapErrorRegExpArrayBufferBlobFileImageData<br>ä¼ è¾“ä»»ä½•å¯è½¬ç§»å¯¹è±¡</p></blockquote><p>ä½†æ˜¯ä»–ä¹Ÿæœ‰é—®é¢˜</p><p>é¦–å…ˆä»–æ— æ³•å…‹éš† <code>function</code></p><blockquote><p>Uncaught DOMException: Failed to execute â€˜structuredCloneâ€™ on â€˜Windowâ€™: function() { console.log(1) } could not be cloned.</p></blockquote><p>è€Œä¸”åœ¨æŸäº›æƒ…å†µä¸‹ä»–ä¼šç›´æ¥è·³è¿‡ <code>function</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123; </span><br><span class="line">  foo = <span class="string">&#x27;bar&#x27;</span> </span><br><span class="line">  <span class="title function_">myMethod</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">foo</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> myClass = <span class="keyword">new</span> <span class="title class_">MyClass</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cloned = <span class="title function_">structuredClone</span>(myClass)</span><br><span class="line">cloned.<span class="property">myMethod</span> === <span class="literal">undefined</span>; <span class="comment">//true</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­å½“ä¸­ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cloned <span class="keyword">instanceof</span> <span class="title class_">MyClass</span> <span class="comment">//false</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ä»–ä¸ä¼šéšç€åŸå‹é“¾åƒä¸ŠæŸ¥æ‰¾ï¼Œåªæ˜¯éå†å±æ€§ã€‚</p><p>è¿˜ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ <code>getter &amp; setter</code>. ä»–ä¼šè·³è¿‡ï¼Œä½ æŠŠä»–ç†è§£ä¸º fn å°±è¡Œäº†ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå•çº¯çš„æ˜¯ç»™ä½ æ·±åº¦å…‹éš†æ•°æ®çš„æ–¹æ³•ï¼Œå¦‚æœä½ è¦å…‹éš†ä¸€ä¸ªç±»ï¼Œé‚£æ˜¯ä¸è¡Œçš„ã€‚</p><p><a href="https://caniuse.com/?search=structuredClone">https://caniuse.com/?search=structuredClone</a></p><p>æµè§ˆå™¨æ”¯æŒæƒ…å†µ, nodejsä¸­è‡³å°‘æˆ‘ç›®å‰çš„ v16.18 æ˜¯ä¸æ”¯æŒçš„ã€‚</p><h3 id="æ·±æ‹·è´çš„åº”ç”¨åœºæ™¯"><a href="#æ·±æ‹·è´çš„åº”ç”¨åœºæ™¯" class="headerlink" title="æ·±æ‹·è´çš„åº”ç”¨åœºæ™¯"></a>æ·±æ‹·è´çš„åº”ç”¨åœºæ™¯</h3><p>å…¶å®æ·±æ‹·è´è¿˜æ˜¯ç‰¹æ®Šåœºæ™¯çš„ç‰¹æ®Šåº”ç”¨ï¼Œéšæ„ä½¿ç”¨å¯èƒ½å¯¼è‡´é—®é¢˜ã€‚</p><p>å› ä¸ºæŒç»­çš„éå†éœ€è¦è€ƒè™‘æœ‰å¤šæ·±çš„é—®é¢˜ï¼Œè¿˜éœ€è¦è€ƒè™‘æ˜¯å¦è¦éå†prototypeé—®é¢˜ï¼Œè¿˜éœ€è¦è§£å†³ä¸€äº›æ•°æ®å°±æ˜¯æœ‰é—®é¢˜çš„æƒ…å†µã€‚</p><p>æ‰€ä»¥è¿˜æ˜¯è¦å‰§æƒ…æƒ…å†µå…·ä½“åˆ†æã€‚</p><h3 id="å¦‚ä½•æµ…æ‹·è´"><a href="#å¦‚ä½•æµ…æ‹·è´" class="headerlink" title="å¦‚ä½•æµ…æ‹·è´"></a>å¦‚ä½•æµ…æ‹·è´</h3><p>éƒ½è¯´é“è¿™é‡Œäº†ï¼Œé‚£ä¹ˆå¦‚ä½•æµ…æ‹·è´</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o = &#123;...x&#125;</span><br><span class="line"><span class="keyword">let</span> o = x</span><br><span class="line"><span class="keyword">let</span> o = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, x);</span><br><span class="line"><span class="keyword">let</span> o = <span class="title class_">Object</span>.<span class="title function_">create</span>(x)</span><br></pre></td></tr></table></figure><p>ç­‰ç­‰..</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
            <tag> æ·±æ‹·è´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿…åŒ…å’Œä½œç”¨åŸŸ</title>
      <link href="/2023/07/03/closures_and_scopes/"/>
      <url>/2023/07/03/closures_and_scopes/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="1-ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸ"><a href="#1-ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸ"></a>1. ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸ</h3><blockquote><p>åœ¨ JavaScript ä¸­ï¼Œä½œç”¨åŸŸï¼ˆScopeï¼‰æŒ‡çš„æ˜¯å˜é‡å’Œå‡½æ•°åœ¨ä»£ç ä¸­å¯è®¿é—®çš„èŒƒå›´ã€‚ä½œç”¨åŸŸè§„å®šäº†åœ¨ä»£ç ä¸­å®šä¹‰çš„å˜é‡åœ¨ä½•å¤„ä»¥åŠåœ¨ä½•æ—¶å¯è¢«è®¿é—®ã€‚</p><p>JavaScript é‡‡ç”¨çš„æ˜¯è¯æ³•ä½œç”¨åŸŸï¼ˆLexical Scopeï¼‰æ¨¡å‹ï¼Œä¹Ÿç§°ä¸ºé™æ€ä½œç”¨åŸŸæ¨¡å‹ã€‚è¿™æ„å‘³ç€ä½œç”¨åŸŸæ˜¯åœ¨ä»£ç ç¼–å†™é˜¶æ®µç¡®å®šçš„ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ç¡®å®šçš„ã€‚</p></blockquote><p>JavaScript ä¸­æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹çš„ä½œç”¨åŸŸï¼š</p><ul><li>å…¨å±€ä½œç”¨åŸŸï¼ˆGlobal Scopeï¼‰ï¼šå…¨å±€ä½œç”¨åŸŸæ˜¯åœ¨ä»£ç çš„æœ€å¤–å±‚å®šä¹‰çš„ï¼Œå®ƒåœ¨æ•´ä¸ªç¨‹åºä¸­éƒ½æ˜¯å¯è®¿é—®çš„ã€‚åœ¨å…¨å±€ä½œç”¨åŸŸä¸­å®šä¹‰çš„å˜é‡å’Œå‡½æ•°å¯ä»¥åœ¨ä»£ç çš„ä»»ä½•åœ°æ–¹è¢«è®¿é—®ã€‚</li><li>å‡½æ•°ä½œç”¨åŸŸï¼ˆFunction Scopeï¼‰ï¼šå‡½æ•°ä½œç”¨åŸŸæ˜¯æŒ‡åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰çš„å˜é‡å’Œå‡½æ•°åªèƒ½åœ¨å‡½æ•°å†…éƒ¨è®¿é—®ï¼Œå‡½æ•°å¤–éƒ¨æ— æ³•è®¿é—®è¿™äº›å˜é‡å’Œå‡½æ•°ã€‚æ¯æ¬¡è°ƒç”¨å‡½æ•°æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ä½œç”¨åŸŸã€‚</li><li>å—çº§ä½œç”¨åŸŸï¼ˆBlock Scopeï¼‰ï¼šåœ¨ ES6ï¼ˆECMAScript 2015ï¼‰ä¹‹å‰ï¼ŒJavaScript ä¸­æ²¡æœ‰å—çº§ä½œç”¨åŸŸã€‚å—çº§ä½œç”¨åŸŸæ˜¯æŒ‡åœ¨ä»£ç å—ï¼ˆå¦‚æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥æˆ–ä½¿ç”¨èŠ±æ‹¬å· {} åŒ…å›´çš„ä»£ç ï¼‰ä¸­å®šä¹‰çš„å˜é‡ä»…åœ¨è¯¥å—å†…éƒ¨å¯è®¿é—®ã€‚ä» ES6 å¼€å§‹ï¼Œå¼•å…¥äº† let å’Œ const å…³é”®å­—ï¼Œå¯ä»¥åœ¨å—çº§ä½œç”¨åŸŸä¸­å£°æ˜å˜é‡ã€‚</li></ul><p>å…¶å®è¿™é‡Œè¿˜æœ‰å…¶ä»–ä½œç”¨åŸŸ.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params">x = <span class="number">1</span></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>x &#x3D; 1 è¿™é‡Œä¹Ÿæ˜¯ä¸€ä¸ªå•ç‹¬çš„ä½œç”¨åŸŸã€‚</p><p><strong>ä½œç”¨åŸŸé“¾</strong></p><blockquote><p>ä½œç”¨åŸŸé“¾ï¼ˆScope Chainï¼‰æ˜¯ç”±åµŒå¥—çš„ä½œç”¨åŸŸç»„æˆçš„ï¼Œå®ƒå†³å®šäº†å˜é‡æŸ¥æ‰¾çš„é¡ºåºã€‚å½“åœ¨ä¸€ä¸ªä½œç”¨åŸŸä¸­è®¿é—®ä¸€ä¸ªå˜é‡æ—¶ï¼ŒJavaScript å¼•æ“ä¼šå…ˆåœ¨å½“å‰ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™ä¼šå‘ä¸Šä¸€çº§ä½œç”¨åŸŸç»§ç»­æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°è¯¥å˜é‡æˆ–è¾¾åˆ°å…¨å±€ä½œç”¨åŸŸã€‚å¦‚æœå˜é‡åœ¨ä»»ä½•ä½œç”¨åŸŸä¸­éƒ½æ‰¾ä¸åˆ°ï¼Œåˆ™ä¼šå¼•å‘ä¸€ä¸ªé”™è¯¯ã€‚</p></blockquote><p>å¥½äº†ï¼Œè¿™é‡Œå¤§æ¦‚äº†è§£äº†ä½œç”¨åŸŸçš„æµç¨‹ã€‚</p><h3 id="2-è¯æ³•ä½œç”¨åŸŸ"><a href="#2-è¯æ³•ä½œç”¨åŸŸ" class="headerlink" title="2. è¯æ³•ä½œç”¨åŸŸ"></a>2. è¯æ³•ä½œç”¨åŸŸ</h3><blockquote><p>è¯æ³•ï¼ˆLexicalï¼‰ æŒ‡çš„æ˜¯å®šä¹‰æŸä¸ªäº‹ç‰©ã€‚<br>ä»»ä½•åˆ›å»ºæ–‡å­—ã€è¡¨è¾¾å¼æˆ–å˜é‡çš„å£°æ˜éƒ½å«è¯æ³•ã€‚<br>è¯æ³•ä½œç”¨åŸŸï¼ˆLexical Scopeï¼‰ æ˜¯å®šä¹‰è¡¨è¾¾å¼å¹¶èƒ½è¢«è®¿é—®çš„åŒºé—´ã€‚<br>ä¸€ä¸ªå£°æ˜ï¼ˆå®šä¹‰å˜é‡ã€å‡½æ•°ç­‰ï¼‰çš„è¯æ³•ä½œç”¨åŸŸå°±æ˜¯å®ƒè¢«å®šä¹‰æ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸã€‚</p></blockquote><p>è¯æ³•ä½œç”¨åŸŸçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿè¯æ³•ä½œç”¨åŸŸï¼ˆLexical Scopeï¼‰ æ˜¯å®šä¹‰è¡¨è¾¾å¼å¹¶èƒ½è¢«è®¿é—®çš„åŒºé—´ã€‚</p><p>å°±æ˜¯å®šä¹‰äº†ç¨‹åºçš„è®¿é—®èŒƒå›´ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> g = <span class="string">&#x27;g&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> a1 = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> b1 = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">c</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> c1 = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">d</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> d1 = <span class="string">&#x27;d&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(e1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">e</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> e1 = <span class="string">&#x27;e&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d1)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯æ³•ä½œç”¨åŸŸå†³å®šäº†ä½ å®šä¹‰çš„å˜é‡å¦‚ä½•è®¿é—®ï¼Œæ¯”å¦‚è¯´ function d å’Œ function e. </p><p>ä»–ä»¬å†…éƒ¨çš„å˜é‡å®šä¹‰çš„è¯æ³•ä½œç”¨åŸŸå°±åœ¨å†…éƒ¨ï¼Œä¹Ÿå°±æ˜¯ d1 åªåœ¨ d å†…éƒ¨æœ‰æ•ˆï¼Œ e1 åªåœ¨ e å†…éƒ¨æœ‰æ•ˆã€‚</p><p>æ‰€ä»¥ d æ— æ³•è®¿é—® e1, e æ— æ³•è®¿é—®å¾— d1ã€‚</p><p>æ¢è¨€ä¹‹ï¼Œåªæœ‰è¯æ³•ä½œç”¨åŸŸå†…çš„ä»£ç æ‰å¯ä»¥è®¿é—®è¯¥ä½œç”¨åŸŸå†…éƒ¨çš„ä»£ç ã€‚</p><p>æ¯”å¦‚ g åœ¨æ‰€æœ‰æ–¹æ³•ä¸­éƒ½èƒ½è°ƒç”¨ã€‚</p><h3 id="3-å¿…åŒ…"><a href="#3-å¿…åŒ…" class="headerlink" title="3. å¿…åŒ…"></a>3. å¿…åŒ…</h3><p>è¯æ³•ä½œç”¨åŸŸæ˜¯å¿…åŒ…çš„å‰æï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå¿…åŒ….</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">tommyWords</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;tommy&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">words</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;tommy&#125;</span> <span class="subst">$&#123;words&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>name æ˜¯åœ¨ tommyWords çš„è¯æ³•ä½œç”¨åŸŸä¸‹ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰è¿”å›çš„åŒ¿åå‡½æ•°èƒ½è®¿é—®ï¼Œå½¢æˆäº†ä¸€ä¸ªç§æœ‰å˜é‡ã€‚</p><p>è¿™å°±æ˜¯å¿…åŒ…çš„ä¸€ä¸ªç‰¹æ€§ï¼Œ<strong>ç§æœ‰å˜é‡</strong>ï¼ŒåŸç”Ÿjså¹¶æ²¡æœ‰è¿™ä¸ªèƒ½åŠ›ï¼Œä½†æ˜¯å€ŸåŠ©å¿…åŒ…å°±æœ‰äº†ã€‚</p><p>ç¬¬äºŒä¸ªç‚¹å°±æ˜¯ï¼Œ<strong>ç¼“å­˜æ•°æ®</strong>ï¼Œè¿™ä¸€ç‚¹å°±éœ€è¦çŸ¥é“åƒåœ¾å›æ”¶çš„æœºåˆ¶.</p><blockquote><p>JavaScript ä¸­çš„åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰æ˜¯ä¸€ç§è‡ªåŠ¨ç®¡ç†å†…å­˜çš„æœºåˆ¶ï¼Œå®ƒè´Ÿè´£æ£€æµ‹ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œå¹¶è‡ªåŠ¨é‡Šæ”¾å®ƒä»¬æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚åƒåœ¾å›æ”¶å™¨ä¼šå‘¨æœŸæ€§åœ°æ‰«æå†…å­˜ä¸­çš„å¯¹è±¡ï¼Œå¹¶æ ‡è®°å“ªäº›å¯¹è±¡æ˜¯å¯è¾¾çš„ï¼ˆä»ç„¶è¢«å¼•ç”¨ï¼‰ï¼Œå“ªäº›å¯¹è±¡æ˜¯ä¸å¯è¾¾çš„ï¼ˆæ²¡æœ‰å¼•ç”¨æŒ‡å‘å®ƒä»¬ï¼‰ã€‚ç„¶åï¼Œåƒåœ¾å›æ”¶å™¨ä¼šæ¸…é™¤ä¸å¯è¾¾å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ï¼Œä»¥ä¾¿å¯ä»¥è¢«å†æ¬¡ä½¿ç”¨ã€‚</p><p>å¼•ç”¨è®¡æ•°ï¼ˆReference Countingï¼‰ï¼šè¿™æ˜¯ä¸€ç§æœ€ç®€å•çš„åƒåœ¾å›æ”¶ç®—æ³•ã€‚å®ƒé€šè¿‡åœ¨å¯¹è±¡ä¸Šç»´æŠ¤ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰æ–°çš„å¼•ç”¨æŒ‡å‘å¯¹è±¡æ—¶ï¼Œè®¡æ•°å™¨åŠ 1ï¼Œå½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å‡1ã€‚å½“è®¡æ•°å™¨ä¸º0æ—¶ï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡ä¸å†è¢«å¼•ç”¨ï¼Œå³ä¸ºä¸å¯è¾¾å¯¹è±¡ï¼Œå¯ä»¥è¢«å›æ”¶ã€‚ç„¶è€Œï¼Œå¼•ç”¨è®¡æ•°ç®—æ³•æ— æ³•è§£å†³å¾ªç¯å¼•ç”¨çš„æƒ…å†µï¼Œå³ä½¿å¯¹è±¡ä¹‹é—´äº’ç›¸å¼•ç”¨ï¼Œä½†å®ƒä»¬ä¸ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†æ²¡æœ‰è”ç³»ï¼Œä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯åƒåœ¾å¹¶è¢«å›æ”¶ã€‚</p><p>æ ‡è®°æ¸…é™¤ï¼ˆMark and Sweepï¼‰ï¼šè¿™æ˜¯ä¸€ç§å¸¸ç”¨çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œç”¨äºè§£å†³å¼•ç”¨è®¡æ•°ç®—æ³•æ— æ³•å¤„ç†çš„å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚æ ‡è®°æ¸…é™¤ç®—æ³•åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šæ ‡è®°é˜¶æ®µå’Œæ¸…é™¤é˜¶æ®µã€‚åœ¨æ ‡è®°é˜¶æ®µï¼Œåƒåœ¾å›æ”¶å™¨ä¼šä»æ ¹å¯¹è±¡ï¼ˆå…¨å±€å¯¹è±¡ã€æ´»åŠ¨å‡½æ•°çš„å˜é‡ç­‰ï¼‰å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡ã€‚åœ¨æ¸…é™¤é˜¶æ®µï¼Œåƒåœ¾å›æ”¶å™¨ä¼šæ‰«ææ•´ä¸ªå †å†…å­˜ï¼Œæ¸…é™¤æœªè¢«æ ‡è®°çš„å¯¹è±¡ï¼Œå³ä¸å¯è¾¾å¯¹è±¡ã€‚è¢«æ¸…é™¤çš„å†…å­˜ç©ºé—´ä¼šè¢«æ ‡è®°ä¸ºå¯å†åˆ†é…çš„ï¼Œä»¥ä¾¿å°†æ¥å¯ä»¥è¢«æ–°çš„å¯¹è±¡ä½¿ç”¨ã€‚</p></blockquote><p>æ¯”å¦‚è¯´</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> a1 = <span class="string">&#x27;a1&#x27;</span>;</span><br><span class="line"><span class="comment">//todo..</span></span><br><span class="line"><span class="keyword">return</span> other;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">a</span>();</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå½“ a() è°ƒç”¨å®Œï¼Œå°±æ²¡æœ‰åœ°æ–¹å¯ä»¥å¼•ç”¨a1äº†ï¼Œä¹Ÿå°±æ˜¯æ— æ³•æ ‡è®°ï¼Œæ‰€ä»¥ä¼šè¢«æ¸…é™¤äº†ï¼Œå†æ¥çœ‹å¿…åŒ…ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> a1 = <span class="string">&#x27;a1&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">todo</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> a1 + todo;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> o = <span class="title function_">a</span>()</span><br></pre></td></tr></table></figure><p>è¿™æ ·åªè¦oï¼Œè¿˜æœ‰äººè°ƒç”¨ï¼Œé‚£ä¹ˆ a1å°±ä¸ä¼šæ¸…é™¤ï¼Œä½†æ˜¯å¦‚æœ o1 ä¸å†æœ‰äººè°ƒç”¨ï¼Œa1è¿˜æ˜¯ä¼šè¢«æ¸…é™¤ã€‚</p><p>å¦‚æœ o ä¸æ˜¯å¸¸é‡ï¼Œç»§ç»­èµ‹å€¼ <code>o = a()</code>ï¼Œé‚£ä¹ˆä¹Ÿä¼šæ¸…ç†ã€‚</p><p>æ‰€ä»¥å¿…åŒ…ä¸­çš„å˜é‡ä¸æ˜¯ä¸ä¼šè¢«æ¸…é™¤ï¼Œè¿˜æ˜¯çœ‹åŒ¿åæ–¹æ³•æ˜¯å¦è¿˜æœ‰å¼•ç”¨ã€‚</p><p>ä½†æ˜¯å¦‚æœä½ ä¸€è‡´æœ‰å¼•ç”¨ï¼Œæ¯”å¦‚è¯´</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">return</span> count++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c = <span class="title function_">a</span>(); <span class="comment">//1</span></span><br><span class="line">c = <span class="title function_">a</span>(); <span class="comment">//2</span></span><br><span class="line">c = <span class="title function_">a</span>(); <span class="comment">//3</span></span><br><span class="line">c = <span class="title function_">a</span>(); <span class="comment">//4</span></span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ˜¯ä¸€ç§ç¼“å­˜ã€‚</p><p><strong>æ‹†åˆ†å˜é‡</strong></p><p>æ¯”å¦‚è¯´æˆ‘æœ‰ä¸€ä¸ª request æ¨¡å—ï¼Œéœ€è¦ä¼ å…¥ url, callbackã€‚å¦‚æœæˆ‘éœ€è¦ä¸åœçš„è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆæ¯æ¬¡éƒ½éœ€è¦ä¼ å…¥è¿™ä¸¤ä¸ªå‚æ•°ï¼Œä½¿ç”¨å¿…åŒ…å‘¢ï¼Ÿ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getDate</span>(<span class="params">url</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">callback</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">request</span>(url, callback);</span><br><span class="line"><span class="title function_">callback</span>(result)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gDate = <span class="title function_">getDate</span>(...);</span><br><span class="line"><span class="title function_">gDate</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> ...)</span><br><span class="line"><span class="title function_">gDate</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> ...)</span><br><span class="line"><span class="title function_">gDate</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> ...)</span><br></pre></td></tr></table></figure><p>è¿™è¿˜æœ‰å…¶ä»–ä½¿ç”¨æ–¹å¼ï¼Œå¤§æ¦‚æ˜¯ç±»ä¼¼çš„ä½¿ç”¨æ–¹å¼ã€‚</p><h3 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4. æ€»ç»“"></a>4. æ€»ç»“</h3><p>å¿…åŒ…æä¾›äº†ç§æœ‰å˜é‡ï¼Œæ‹†åˆ†å˜é‡ï¼ŒçŠ¶æ€ç®¡æ§ï¼Œæ¨¡å—åŒ–å¼€å‘ï¼Œäº‹ä»¶å›è°ƒç­‰ç­‰åŠŸèƒ½ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>es6 æ›´æ–°æ€»ç»“</title>
      <link href="/2023/07/03/baseEs6/"/>
      <url>/2023/07/03/baseEs6/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><ol><li>å­—ç¬¦ä¸²</li><li>æ•°å€¼</li><li>å‡½æ•°</li><li>æ•°ç»„</li><li>å¯¹è±¡(object)</li><li>è¿ç®—ç¬¦</li><li>Symbol</li><li>Set&amp;Map</li><li>Proxy</li><li>Reflect</li><li>Promise</li><li>Iterator</li><li>Generator</li><li>async</li><li>Class</li><li>Module</li></ol><h3 id="001-å­—ç¬¦ä¸²"><a href="#001-å­—ç¬¦ä¸²" class="headerlink" title="001. å­—ç¬¦ä¸²"></a>001. å­—ç¬¦ä¸²</h3><ol><li>å­—ç¬¦çš„ Unicode è¡¨ç¤ºæ³• â€˜\u0061â€™ or â€˜\uD842\uDFB7â€™</li><li>æ”¯æŒ Iterator éå†</li><li>æ¨¡æ¿å­—ç¬¦ä¸² <code>$&#123;name&#125;</code></li><li>æ ‡ç­¾æ¨¡æ¿ alert<code>welcome to $&#123;name&#125; house</code></li></ol><p>function alert() {<br>    console.log(arguments[0]);<br>    console.log(arguments[1]);<br>}</p><p>&#x2F;&#x2F; Array [â€˜welcome toâ€™, â€˜homeâ€™]<br>&#x2F;&#x2F; name </p><p>ä¼ å‚æ–¹å¼éœ€è¦æ³¨æ„</p><ol start="5"><li>String.fromCodePoint() ç”¨äºä» Unicode ç ç‚¹è¿”å›å¯¹åº”å­—ç¬¦ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸èƒ½è¯†åˆ«ç ç‚¹å¤§äº0xFFFFçš„å­—ç¬¦ã€‚</li><li>String.raw<code>\a</code> &#x3D; <code>\\a</code> è½¬ä¹‰ï¼Œç”¨äºæ¨¡æ¿è½¬ä¹‰ï¼Œå·²ç»è½¬ä¹‰è¿˜æ˜¯è¦å†è½¬</li><li>String.codePointAt() ç ç‚¹åœ¨U+10000åˆ°U+10FFFFä¹‹é—´çš„å­—ç¬¦ â€˜ğ ®·â€™.length &#x3D;&#x3D;&#x3D; 2, æ‰€ä»¥è¿™ä¸ªå…¶å®æ˜¯éœ€è¦å¤„ç†çš„ã€‚</li><li>String.repeat â€œabcâ€.repeat(2);</li><li>padStart,patEnd è¡¥å…¨ï¼Œ</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a.padStart(10, &#x27;1234567891011&#x27;) &quot;123456789a&quot;</span><br><span class="line">a.padStart(10, &#x27;12&#x27;) &quot;121212121a&quot;</span><br></pre></td></tr></table></figure><ol start="10"><li>trimLeft, trimEnd</li><li>matchAll</li><li>replaceAll ä¸ç”¨å†™æ­£åˆ™äº† replace(&#x2F;a&#x2F;g, â€˜_â€™), ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æœ‰ä¸€äº›ç‰¹æ®Šå­—ç¬¦æ¥åŒ¹é…ï¼Œä½ ä¼šæ­£åˆ™ä¹Ÿå¯ä»¥æ— è§†</li><li>at()æ–¹æ³•æ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°ï¼Œè¿”å›å‚æ•°æŒ‡å®šä½ç½®çš„å­—ç¬¦ï¼Œæ”¯æŒè´Ÿç´¢å¼•ï¼ˆå³å€’æ•°çš„ä½ç½®ï¼‰</li></ol><h3 id="02-æ•°å€¼"><a href="#02-æ•°å€¼" class="headerlink" title="02. æ•°å€¼"></a>02. æ•°å€¼</h3><ol><li>è¡¨ç¤ºäºŒè¿›åˆ¶ 0b || 0B</li><li>è¡¨ç¤ºå…«è¿›åˆ¶ 0o || 0O</li><li>æ•°å€¼åˆ†å‰² 1000000 å¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿æ¥åˆ†å‰² 1_000_000</li><li>Number.isFinite() <a href="https://baike.baidu.com/item/infinity/18702999?fr=aladdin">https://baike.baidu.com/item/infinity/18702999?fr=aladdin</a> æ­£æ— ç©·å’Œè´Ÿæ— ç©·ï¼Œjavascript <code>1.7976931348623157e+308</code> è¶…è¿‡æ­£è´Ÿå€¼</li><li>Number.isNaN() æ˜¯æ•°å€¼ç±»å‹ä½†æ˜¯éæ•°å­—ã€‚ Number.isNaN(â€œaâ€ * 2) &#x3D;&#x3D;&#x3D; true</li><li>Number.isInteger() æ˜¯å¦å€¼æ•´æ•°, æ­£è´Ÿéƒ½ä¸º true</li><li>parseInt &amp; parseFloat ä» windowç§»æ¤åˆ° Number ä¸‹</li><li>Number.EPSILON äºŒè¿›åˆ¶çš„é—®é¢˜å°±ä¸å¤è¿°äº†ï¼Œä¸»è¦æ˜¯å¯ä»¥æ£€æµ‹ä¸¤ä¸ªæ•°å­—</li><li>Number.MAX_SAFE_INTEGER </li><li>Number.MIN_SAFE_INTEGER</li><li>Number.isSafeInteger() 9,10,11 éƒ½æ˜¯å›´ç»•ç€æ˜¯å¦è¶…è¿‡ç²¾åº¦ä¼°ç®—èŒƒå›´æ˜¯å¦æ˜¯å®‰å…¨æ•°å­—</li><li>BigInt åç¼€å¿…é¡» + nï¼Œ æ¯”å¦‚3n, ç»†èŠ‚æ²¡çœ‹ï¼Œä½†æ˜¯ä¸èƒ½æœ‰å°æ•°ç‚¹ã€‚</li></ol><p>éœ€è¦ç²¾ç¡®è®¡ç®—æ•°å­—æˆ‘ç”¨çš„æ¯”è¾ƒå°‘ï¼Œéœ€è¦çš„æ—¶å€™å†å­¦ä¹ å§ã€‚</p><h3 id="03-å‡½æ•°-function"><a href="#03-å‡½æ•°-function" class="headerlink" title="03. å‡½æ•° function"></a>03. å‡½æ•° function</h3><ol><li>é»˜è®¤å‚æ•° function(x, y&#x3D;1) â€¦ ,éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªç‹¬ç«‹çš„ä½œç”¨åŸŸï¼Œå¹¶ä¸”æ¯æ¬¡æ‰§è¡Œéƒ½ä¼šè®¡ç®—</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let x = 99</span><br><span class="line">function a(p = x + 1)</span><br><span class="line">a() // 100</span><br><span class="line">x = 100</span><br><span class="line">a() // 101</span><br></pre></td></tr></table></figure><p>å†…éƒ¨çš„ä½œç”¨åŸŸå¯ä»¥åšå¾ˆå¤šäº‹æƒ…</p><ol start="2"><li>function.length è¿”å›å‚æ•°ä¸ªæ•° é»˜è®¤å€¼å’Œé»˜è®¤å€¼åé¢çš„å‚æ•°éƒ½ä¸è®¤ã€‚</li><li>name, è¿”å› function name</li><li>&#x3D;&gt; å‡½æ•°ï¼Œä¸»è¦æ³¨æ„ this çš„å¼•ç”¨ã€‚</li><li>rest ç±»ä¼¼æ‰©å±•è¿ç®—ç¬¦ function(â€¦values) a { &#x2F;&#x2F;valuesæ•°ç»„ }</li></ol><h3 id="04-æ•°ç»„"><a href="#04-æ•°ç»„" class="headerlink" title="04. æ•°ç»„"></a>04. æ•°ç»„</h3><ol><li>â€¦</li><li>Array.from ç±»æ•°ç»„è½¬æ¢ä¸ºæ•°ç»„</li><li>Array.of() åˆ›å»ºæ•°ç»„</li><li>Array.copyWith(target(éœ€è¦å¤åˆ¶çš„ä½ç½®), start(å¼€å§‹å¤åˆ¶ä½ç½®), end(åœæ­¢å¤åˆ¶çš„ä½ç½®))</li><li>find()ï¼ŒfindIndex()ï¼ŒfindLast()ï¼ŒfindLastIndex() </li><li>fill</li><li>entries()ï¼Œkeys() å’Œ values()</li><li>includes()</li><li>flat()ï¼ŒflatMap() å¤šç»´æ•°ç»„è½¬ä¸€ç»´</li><li>at() æ”¯æŒè´Ÿç´¢å¼•</li></ol><h3 id="05-Object"><a href="#05-Object" class="headerlink" title="05. Object"></a>05. Object</h3><ol><li>æ”¯æŒç®€å†™ï¼Œä¹Ÿå°±æ˜¯</li></ol><p>var o &#x3D; 1<br>var b &#x3D; { o, a() {} }</p><ol start="2"><li>å¯ä»¥ä½¿ç”¨å˜é‡ä½œä¸º Object Key</li><li>Object.getOwnPropertyDescriptor è·å–å±æ€§æè¿°ï¼Œå°±æ˜¯å¯å†™ï¼Œå¯è¯»ï¼Œå€¼ï¼Œä¹‹ç±»çš„å€¼</li><li>forâ€¦in &#x2F;&#x2F;enumerableæ— æ•ˆ</li><li>Object.keys(obj) &#x2F;&#x2F;enumerableæ— æ•ˆ</li><li>Object.getOwnPropertyNames(obj) &#x2F;&#x2F;enumerableæ— æ•ˆ</li><li>Object.getOwnPropertySymbols(obj) &#x2F;&#x2F;enumerableæ— æ•ˆ</li><li>Reflect.ownKeys(obj) &#x2F;&#x2F;enumerableæ— æ•ˆ</li><li>AggregateError åˆå¹¶å¤šä¸ªé”™è¯¯ <code>AggregateError(errors[, message])</code></li><li>Object.is åŸºæœ¬ç­‰äº &#x3D;&#x3D;&#x3D; ï¼Œå·®åˆ«åœ¨ Object.is(NaN, NaN) &#x3D;&#x3D; true, +0 -0å¯¹æ¯”ä¸ºfalse</li><li>Object.assign å°±æ˜¯åˆå¹¶object, éœ€è¦æ³¨æ„çš„ Object.assignæ˜¯æµ…æ‹·è´ï¼Œå¹¶ä¸”åŒåå±æ€§æ˜¯æ›¿æ¢ï¼Œä¸æ˜¯åˆå¹¶</li><li>Object.getOwnPropertyDescriptors() </li><li><strong>proto</strong> ç”¨æ¥è¯»å–æˆ–è®¾ç½®å½“å‰å¯¹è±¡çš„åŸå‹å¯¹è±¡. </li><li>Object.setPrototypeOf</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function setPrototypeOf(target, proto) &#123;</span><br><span class="line">target.__proto__ = proto;</span><br><span class="line">return target</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="15"><li>Object.setPrototypeOf</li></ol><p>è·å–å’Œè®¾ç½® <strong>proto</strong> , å»ºè®®ä¸è¦ç›´æ¥ä½¿ç”¨ Object.set or Object.get æ–¹å¼ï¼Œ<strong>proto</strong> ç›´æ¥ä½¿ç”¨çš„æ–¹å¼å…¼å®¹æ€§ä¸å¤ªå¥½ï¼Œå› ä¸ºè¯´ä¸å®šå¯èƒ½å–æ¶ˆã€‚</p><ol start="16"><li>Object.keys()ï¼ŒObject.values()ï¼ŒObject.entries() enumerable &#x3D; true å°±æ„å‘³ç€å¯ä»¥éå†ã€‚</li><li>Object.fromEntrise å°†é”®å€¼å¯¹è½¬æ¢ä¸ºobjectï¼Œmapè½¬object</li><li>Object.hasOwn, å’ŒObject.hasOwnProperty ç±»ä¼¼ã€‚</li></ol><h3 id="06-è¿ç®—ç¬¦"><a href="#06-è¿ç®—ç¬¦" class="headerlink" title="06. è¿ç®—ç¬¦"></a>06. è¿ç®—ç¬¦</h3><ol><li>**  æœ‰ç‚¹åƒä½è¿ç®—ï¼Œ å¹³æ–¹</li><li>? message.user.name å¦‚æœéœ€è¦åˆ¤æ–­ï¼Œéœ€è¦åˆ¤æ–­3æ¬¡ï¼Œ message?.user?.name</li></ol><p>æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„</p><blockquote><p>ä¸€. çŸ­è·¯ï¼Œæœ¬è´¨ä¸Šï¼Œ?.è¿ç®—ç¬¦ç›¸å½“äºä¸€ç§çŸ­è·¯æœºåˆ¶ ï¼Œåªè¦ä¸æ»¡è¶³æ¡ä»¶ï¼Œå°±ä¸å†å¾€ä¸‹æ‰§è¡Œã€‚<br>äºŒ. åˆ«ç”¨æ‹¬å·ï¼Œå› ä¸ºçŸ­è·¯çš„åŸå› </p></blockquote><ol start="3"><li>?? åˆ¤æ–­ null || undefined , ä½†æ˜¯ä¸åˆ¤æ–­0, falseä¹‹ç±»çš„</li><li>x ||&#x3D; y, x &amp;&amp;&#x3D; y, x ??&#x3D; y.</li></ol><h3 id="07-Symbol"><a href="#07-Symbol" class="headerlink" title="07. Symbol"></a>07. Symbol</h3><p>å”¯ä¸€ä¸ä¼šé‡å¤çš„å€¼ï¼Œæ˜¯ä¸€ç§åŸºç¡€ç±»å‹ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½ <code>new</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let a = Symbol()</span><br><span class="line">let b = Symbol()</span><br><span class="line">a === b false</span><br></pre></td></tr></table></figure><p>å¯ä»¥æœ‰ descriptionï¼ŒSymbol(â€˜aâ€™), <code>toString</code> or <code>Symbol.description</code></p><p>å¦‚æœä»¥ <code>Symbol</code> ä½œä¸ºæ–¹æ³•æˆ–è€…å±æ€§çš„ <code>key</code>, æ™®é€šæ–¹æ³•æ˜¯æ— æ³•éå†çš„</p><p>æ¯”å¦‚ <code>for...in</code>, <code>Object.keys</code>, <code>for of</code>, <code>Object.getOwnPropertyName</code>, <code>JSON.stringfly</code> ä¹‹ç±»çš„ã€‚</p><p>åªèƒ½ä» Object.getOwnPropertySymbol(), Reflect.ownKeys å¯ä»¥è·å–ã€‚</p><p>ä»–è¿˜æœ‰ä¸€äº›å†…ç½®çš„å€¼ï¼Œä¸»è¦æ˜¯ Object æˆ–è€… Class ç”¨äºæŒ‡å‘ä¸€ä¸ªå†…éƒ¨æ–¹æ³•ã€‚</p><ol><li>Symbol.hasInstance å¯ä»¥é‡å†™ instanceof</li><li>Symbol.isConcatSpreadable </li><li>Symbol.species æ”¹å˜è¡ç”Ÿå¯¹è±¡ instanceof æŒ‡å‘</li><li>Symbol.replace</li><li>Symbol.search</li><li>Symbol.split</li><li>Symbol.iterator</li><li>Symbol.toPrimitive</li><li>Symbol.toStringTag</li><li>Symbol.unscopables</li><li>Symbol.toPrimitive &#x2F;&#x2F;æŒ‡å‘ä¸€ä¸ªæ–¹æ³•ã€‚è¯¥å¯¹è±¡è¢«è½¬ä¸ºåŸå§‹ç±»å‹çš„å€¼æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¿”å›è¯¥å¯¹è±¡å¯¹åº”çš„åŸå§‹ç±»å‹å€¼</li><li>Symbol.toStringTag</li></ol><h3 id="08-set-map"><a href="#08-set-map" class="headerlink" title="08. set map"></a>08. set map</h3><p>Set, æœ¬èº«æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–ä¸€ä¸ªSetæ•°æ®ç»“æ„ï¼Œå¯ä»¥ä¼ å…¥æ•°ç»„æˆ–è€…æ”¯æŒiterableæ¥å£çš„æ•°æ®.<br>æœ¬èº«æ˜¯ä¸€ä¸ªé›†åˆï¼Œå†…éƒ¨ä¸èƒ½æœ‰é‡å¤å€¼</p><ul><li>add</li><li>size</li><li>delete</li><li>get</li><li>has</li><li>clear</li></ul><p>éå†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set.prototype[Symbol.iterator] === Set.prototype.values</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ <code>for of</code> ok, è¿˜å¯ä»¥ä½¿ç”¨ <code>forEach, set.keys(), set.values, set.entries</code> å»éå†<br>ä½¿ç”¨ Set ä¸»è¦ä½¿ç”¨ä»–å»é‡çš„åŠŸèƒ½æ¥è¿›è¡Œæ“ä½œã€‚</p><p>WeakSet å’Œ Set ç±»ä¼¼ï¼Œä½†æ˜¯ä»–æ–¹æ³•å°‘äº†ã€‚</p><ul><li>add</li><li>delete</li><li>has</li></ul><p>åŒºåˆ«ä¸»è¦åœ¨äº WeakSet åªèƒ½å­˜å¯¹è±¡ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨ã€‚<br>å¼±å¼•ç”¨éœ€è¦å…ˆçŸ¥é“å›æ”¶çš„æœºåˆ¶ï¼Œç®€å•æ˜¯å°±æ˜¯å¦‚æœä¸€ä¸ªå¯¹è±¡è¿˜è¢«å¼•ç”¨ï¼Œå°±ä¸ä¼šå›æ”¶ï¼Œæ¯”å¦‚å¿…åŒ…ä¸­çš„å˜é‡ã€‚<br>é‚£ä¹ˆå­˜æ”¾åœ¨ WeakSet å½“ä¸­çš„å¯¹è±¡æ— éœ€è€ƒè™‘åœ¨é‡Œé¢ï¼Œä¸è®¡å…¥åœ¨å¼•ç”¨å½“ä¸­ã€‚<br>æ‰€ä»¥å¯ä»¥ç”¨æ¥å­˜æ”¾ä¸€äº›ä¸´æ—¶å¯¹è±¡ï¼Œä¹Ÿä¸ç”¨å»ç®¡ä»–çš„é‡Šæ”¾ã€‚</p><p>Map</p><p>Mapå’ŒObjectç±»ä¼¼ï¼Œéƒ½æ˜¯å±äºHashç»“æ„ï¼Œå°±æ˜¯é”®å€¼å¯¹ã€‚</p><blockquote><p>äº‹å®ä¸Šï¼Œä¸ä»…ä»…æ˜¯æ•°ç»„ï¼Œä»»ä½•å…·æœ‰ Iterator æ¥å£ã€ä¸”æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªåŒå…ƒç´ çš„æ•°ç»„çš„æ•°æ®ç»“æ„ï¼ˆè¯¦è§ã€ŠIteratorã€‹ä¸€ç« ï¼‰éƒ½å¯ä»¥å½“ä½œMapæ„é€ å‡½æ•°çš„å‚æ•°</p></blockquote><p>æ‰€ä»¥ Mapçš„åˆ›å»ºå¯ä»¥ add å’Œå¯ä»¥æ„é€ å‡½æ•°ä¼ å…¥</p><blockquote><p>terator æ¥å£ã€ä¸”æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªåŒå…ƒç´ çš„æ•°ç»„çš„æ•°æ®ç»“æ„</p></blockquote><p>Map åé¢çš„å€¼ä¼šè¦†ç›–å‰é¢çš„ï¼ŒKeyç›¸åŒçš„è¯ï¼Œåªè¦ä¸¤ä¸ªå€¼ä¸¥æ ¼ç›¸ç­‰ï¼ŒMap å°†å…¶è§†ä¸ºä¸€ä¸ªé”®, æ¯”å¦‚ +0 å’Œ -0, ä½†æ˜¯NaNè™½ç„¶ NaN &#x3D;&#x3D;&#x3D; NaN &#x3D;&#x3D; falseï¼Œ ä½†æ˜¯ä¹Ÿè§†ä¸ºç›¸åŒå¥ã€‚</p><p>mapçš„é¡ºåºå°±æ˜¯æ’å…¥çš„é¡ºåºï¼Œå¹¶ä¸”æ²¡æœ‰æä¾›æ’åºçš„æ–¹æ³•ã€‚</p><ul><li>set</li><li>size</li><li>get</li><li>delete</li><li>clear</li><li>â€¦</li></ul><p>éå†ï¼Œ æœ¬èº«æ”¯æŒ Iterator, æ‰€ä»¥ <code>Map.keys(), Map.values(), Map.entries </code> ä»¥åŠæœ¬èº«çš„ <code>Map.forEach</code> éƒ½å¯ä»¥ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ <code>for of</code>.</p><p>æ•´ä½“çœ‹ä¸‹æ¥ï¼Œåœ¨ä¸çœ‹åº•å±‚ä»£ç çš„æƒ…å†µä¸‹ï¼ŒMapä¼˜åŠ¿ä¸æ˜æ˜¾ã€‚<br>åªèƒ½è¯´å¤šäº†ä¸€å±‚å°è£…ã€‚</p><p><strong>WeakMap</strong>.</p><ul><li>set</li><li>delete</li><li>has</li><li>get</li></ul><p>WeakMap ä¹Ÿæ˜¯å¼±å¼•ç”¨ï¼Œä¸è¿‡åªå€¼ key æ˜¯å¼±å¼•ç”¨ï¼Œå¹¶ä¸”key åªèƒ½å¯¹å¯¹è±¡ã€‚<br>ä½œç”¨å’Œ WeakSet ä¸€æ ·ï¼Œåªæ˜¯ç»“æ„ä¸åŒ<br>ä»–ä»¬ä¸¤éƒ½ä¸èƒ½éå†ï¼Œå› ä¸ºå¼±å¼•ç”¨å¯¼è‡´å¯¹è±¡éšæ—¶å¯èƒ½æ¶ˆå¤±ï¼Œåœ¨éå†çš„æ—¶å€™ï¼Œä¼šå¯¼è‡´é”™è¯¯ã€‚<br>ä¿å­˜ä»¥åå»éªŒè¯ä¸€ä¸ªå¯¹è±¡æ˜¯å¦è¿˜å­˜åœ¨ï¼Œæ˜¯å¦è¿˜æœ‰å¼•ç”¨ã€‚</p><p><strong>WeakRef</strong></p><p>WeakSet å’Œ WeakMap éƒ½æ˜¯åœ¨åˆ›å»º, add, set(key) çš„æ—¶å€™æ‰æ˜¯å¼±å¼•ç”¨ã€‚<br>WeakRef å¯ä»¥æŠŠä»–åŒ…è£…ä¸€ä¸‹ï¼Œå˜æˆä¸€ä¸ªå¼±å¼•ç”¨ã€‚</p><p>åœ¨åšå¼±å¼•ç”¨çš„æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘äº§ç”Ÿäº†æå¤§çš„ç–‘æƒ‘ï¼Œåæ¥è¿˜ <code>chrome</code> æ ¸å¿ƒæµ‹è¯•æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let john = &#123; name: &quot;John&quot; &#125;;</span><br><span class="line">let weakMap = new WeakMap();</span><br><span class="line">weakMap.set(john, &quot;...&quot;);</span><br><span class="line">john = null; </span><br><span class="line"></span><br><span class="line">weakMap //æ— å±æ€§</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨ firefox ä¸‹ä¸æ˜¯è¿™æ ·çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">john = null</span><br><span class="line">weakMapä¾ç„¶ä¿æŒå¼•ç”¨ã€‚</span><br></pre></td></tr></table></figure><h3 id="09-proxy"><a href="#09-proxy" class="headerlink" title="09. proxy"></a>09. proxy</h3><p><strong>Proxy</strong> ä»£ç†ï¼Œå¯ä»¥ç†è§£ä¸ºæŠŠåŸæœ‰å¯¹è±¡åŒ…è£¹åœ¨é‡Œé¢ï¼Œè®¿é—®çœŸå®çš„å¯¹è±¡éœ€è¦å…ˆç»è¿‡è¿™ä¸ªä»£ç†ã€‚</p><ol><li>get(target, propKey, receiver)ï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„è¯»å–ï¼Œæ¯”å¦‚proxy.fooå’Œproxy[â€˜fooâ€™]ã€‚</li><li>set(target, propKey, value, receiver)ï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„è®¾ç½®ï¼Œæ¯”å¦‚proxy.foo &#x3D; væˆ–proxy[â€˜fooâ€™] &#x3D; vï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li>has(target, propKey)ï¼šæ‹¦æˆªpropKey in proxyçš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li>deleteProperty(target, propKey)ï¼šæ‹¦æˆªdelete proxy[propKey]çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li>ownKeys(target)ï¼šæ‹¦æˆªObject.getOwnPropertyNames(proxy)ã€Object.getOwnPropertySymbols(proxy)ã€Object.keys(proxy)ã€forâ€¦inå¾ªç¯ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚è¯¥æ–¹æ³•è¿”å›ç›®æ ‡å¯¹è±¡æ‰€æœ‰è‡ªèº«çš„å±æ€§çš„å±æ€§åï¼Œè€ŒObject.keys()çš„è¿”å›ç»“æœä»…åŒ…æ‹¬ç›®æ ‡å¯¹è±¡è‡ªèº«çš„å¯éå†å±æ€§ã€‚</li><li>getOwnPropertyDescriptor(target, propKey)ï¼šæ‹¦æˆªObject.getOwnPropertyDescriptor(proxy, propKey)ï¼Œè¿”å›å±æ€§çš„æè¿°å¯¹è±¡ã€‚</li><li>defineProperty(target, propKey, propDesc)ï¼šæ‹¦æˆªObject.defineProperty(proxy, propKey, propDescï¼‰ã€Object.defineProperties(proxy, propDescs)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li>preventExtensions(target)ï¼šæ‹¦æˆªObject.preventExtensions(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li>getPrototypeOf(target)ï¼šæ‹¦æˆªObject.getPrototypeOf(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚</li><li>isExtensible(target)ï¼šæ‹¦æˆªObject.isExtensible(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li>setPrototypeOf(target, proto)ï¼šæ‹¦æˆªObject.setPrototypeOf(proxy, proto)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚å¦‚æœç›®æ ‡å¯¹è±¡æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆè¿˜æœ‰ä¸¤ç§é¢å¤–æ“ä½œå¯ä»¥æ‹¦æˆªã€‚</li><li>apply(target, object, args)ï¼šæ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºå‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚proxy(â€¦args)ã€proxy.call(object, â€¦args)ã€proxy.apply(â€¦)ã€‚</li><li>construct(target, args)ï¼šæ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚new proxy(â€¦args)ã€‚</li></ol><p><strong>Proxy</strong> å¯ä»¥æ‹¦æˆªä»¥ä¸Šæ“ä½œ, å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ã€‚</p><p>æ¯”å¦‚ Es6 æ²¡æœ‰æä¾› Set æ•°æ®ç»“æ„, æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªæ•°ç»„æ·»åŠ ä¸èƒ½æœ‰é‡å¤</p><ol><li>é€šè¿‡ Class é‡å†™ä¸€ä¸ªå¯¹è±¡ã€‚</li><li>æˆ–è€…é€šè¿‡ç»Ÿä¸€çš„ handlerï¼Œå»ä»£ç†ä¸€ä¸ª Arrayå¯¹è±¡å»å®ç°ç‰¹æ€§</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var proxy = new Proxy(arr, &#123;</span><br><span class="line">    set: function(target, propkey, value, receiver) &#123;</span><br><span class="line">        if(!target.includes(value)) &#123;</span><br><span class="line">            return Reflect.set(target, propkey, value, receiver);    </span><br><span class="line">        &#125;</span><br><span class="line">return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ Array.push æ˜¯æ— æ³•é“¾å¼ [].push(1).push(2), Proxy get å°±å¯ä»¥å®ç°ï¼Œè¿˜å¯ä»¥é˜²æ­¢è°ƒç”¨å†…éƒ¨æ–¹æ³•ï¼Œå½¢æˆç§æœ‰å˜é‡ã€‚</p><p>Proxy éœ€è¦æœ‰å‡ ç‚¹æ³¨æ„çš„ã€‚</p><ol><li>receiver è¿™ä¸ªå‚æ•°å¦‚æœåœ¨ç»§æ‰¿ï¼ŒåŸå‹é“¾, <strong>proto</strong> èµ‹å€¼ä»¥åï¼Œæ˜¯æŒ‡å‘å½“å‰Objectï¼Œä¸ä¸€å®šæ˜¯æŒ‡å‘ä½ åœ¨ç»‘å®š proxy æ—¶å€™çš„ Object.</li><li>this æŒ‡å‘å’Œ receiver æœ‰ç›¸åŒçš„é—®é¢˜ï¼Œæœ€å¥½ä¸è¦ä»¥ this.xx å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚</li></ol><h3 id="10-Reflect"><a href="#10-Reflect" class="headerlink" title="10. Reflect"></a>10. Reflect</h3><blockquote><ol><li>å°†Objectå¯¹è±¡çš„ä¸€äº›æ˜æ˜¾å±äºè¯­è¨€å†…éƒ¨çš„æ–¹æ³•ï¼ˆæ¯”å¦‚Object.definePropertyï¼‰ï¼Œæ”¾åˆ°Reflectå¯¹è±¡ä¸Šã€‚ç°é˜¶æ®µï¼ŒæŸäº›æ–¹æ³•åŒæ—¶åœ¨Objectå’ŒReflectå¯¹è±¡ä¸Šéƒ¨ç½²ï¼Œæœªæ¥çš„æ–°æ–¹æ³•å°†åªéƒ¨ç½²åœ¨Reflectå¯¹è±¡ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»Reflectå¯¹è±¡ä¸Šå¯ä»¥æ‹¿åˆ°è¯­è¨€å†…éƒ¨çš„æ–¹æ³•ã€‚</li><li>ä¿®æ”¹æŸäº›Objectæ–¹æ³•çš„è¿”å›ç»“æœï¼Œè®©å…¶å˜å¾—æ›´åˆç†ã€‚æ¯”å¦‚ï¼ŒObject.defineProperty(obj, name, desc)åœ¨æ— æ³•å®šä¹‰å±æ€§æ—¶ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè€ŒReflect.defineProperty(obj, name, desc)åˆ™ä¼šè¿”å›false</li><li>è®©Objectæ“ä½œéƒ½å˜æˆå‡½æ•°è¡Œä¸ºã€‚æŸäº›Objectæ“ä½œæ˜¯å‘½ä»¤å¼ï¼Œæ¯”å¦‚name in objå’Œdelete obj[name]ï¼Œè€ŒReflect.has(obj, name)å’ŒReflect.deleteProperty(obj, name)è®©å®ƒä»¬å˜æˆäº†å‡½æ•°è¡Œä¸ºã€‚</li><li>Reflectå¯¹è±¡çš„æ–¹æ³•ä¸Proxyå¯¹è±¡çš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ï¼Œåªè¦æ˜¯Proxyå¯¹è±¡çš„æ–¹æ³•ï¼Œå°±èƒ½åœ¨Reflectå¯¹è±¡ä¸Šæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ã€‚è¿™å°±è®©Proxyå¯¹è±¡å¯ä»¥æ–¹ä¾¿åœ°è°ƒç”¨å¯¹åº”çš„Reflectæ–¹æ³•ï¼Œå®Œæˆé»˜è®¤è¡Œä¸ºï¼Œä½œä¸ºä¿®æ”¹è¡Œä¸ºçš„åŸºç¡€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡Proxyæ€ä¹ˆä¿®æ”¹é»˜è®¤è¡Œä¸ºï¼Œä½ æ€»å¯ä»¥åœ¨Reflectä¸Šè·å–é»˜è®¤è¡Œä¸ºã€‚</li></ol></blockquote><h3 id="11-Promise"><a href="#11-Promise" class="headerlink" title="11. Promise"></a>11. Promise</h3><p>promise å¦‚æœåªæ˜¯è¯´è¯­æ³•çš„è¯ï¼Œå…¶å®æŒºç®€å•çš„ã€‚<br>é¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ Promise æ˜¯è¯­æ³•ç³–ï¼Œä½ é€šè¿‡JSå¯ä»¥è‡ªå·±å†™ä¸€ä¸ªå‡ºæ¥ã€‚<br>3ç§çŠ¶æ€ï¼Œpendding, fulfilled, rejected<br>å½“ä½ è°ƒç”¨ä¸€ä¸ª promiseï¼Œå°±å·²ç»åœ¨ pendding çŠ¶æ€ä¸‹ã€‚<br>then(fulfilled, rejected), å¤„ç†å…¶ä»–ä¸¤ç§çŠ¶æ€ã€‚<br>è¿™å°±æ˜¯æœ€åŸºæœ¬çš„è¯­æ³•ã€‚</p><p>é“¾å¼è°ƒç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">promise.then(result =&gt; deep(result)).then(tree =&gt; todo)</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯åŒ…è£…å‰ä¸€ä¸ª promise ç»“æœè¿”å›ä¸€ä¸ªæ–°çš„ promise</p><p>.catch </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">promise.then(fulfilled, rejected)</span><br></pre></td></tr></table></figure><p>.finally </p><p>.all å…¨éƒ¨æˆåŠŸæ‰ç®—æˆåŠŸfulfilled<br>.race åªè¦æœ‰ä¸€ä¸ªæˆåŠŸçŠ¶æ€å°±æ˜¯fulfilled<br>.allSettled å…¨éƒ¨è¿”å›å°±ç®—æˆåŠŸï¼Œä¸ç®¡é‡Œé¢çŠ¶æ€<br>.any åªè¦æœ‰ä¸€ä¸ªæ˜¯ fulfilledï¼Œå…¨éƒ¨rejected rejected</p><h3 id="12-Generator"><a href="#12-Generator" class="headerlink" title="12. Generator"></a>12. Generator</h3><p>è¯­æ³•å°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function* a() &#123;</span><br><span class="line">yield 1</span><br><span class="line">yield 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šè¿”å›ä¸€ä¸ª iterator å¯¹è±¡ï¼Œå¯ä»¥è¿›è¡Œéå†ï¼Œæˆ–è€…è‡ªå·±è°ƒç”¨ next<br>next å¯¹è±¡åŒ…å« </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; value: any, done: boolean &#125;</span><br></pre></td></tr></table></figure><p>done è¡¨ç¤ºæ˜¯å¦å®Œç»“</p><p>Generator çš„ä¸€ä¸ªç‰¹æ€§å°±æ˜¯ï¼Œé˜»æ­¢ä»£ç è¿è¡Œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function* a() &#123;</span><br><span class="line">yield b();</span><br><span class="line">yield c();</span><br><span class="line">yield d();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var o = a(); //ä¸æ‰§è¡Œï¼Œåªæ˜¯ä¼ å‚</span><br><span class="line">o.next(); //æ‰§è¡Œb()</span><br><span class="line">o.next(); //æ‰§è¡Œc()</span><br><span class="line">o.next(); //æ‰§è¡Œd()</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ªä¾‹å­è¯´æ˜è¿”å›å’Œå‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function a(s) &#123;</span><br><span class="line">    console.log(&quot;a&quot;);</span><br><span class="line">    return &quot;ar&quot; + s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function b(s) &#123;</span><br><span class="line">    console.log(&quot;b&quot;);</span><br><span class="line">    return &quot;br&quot; + s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function c(s) &#123;</span><br><span class="line">    console.log(&quot;c&quot;);</span><br><span class="line">    return &quot;cr&quot; + s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function* g(s) &#123;</span><br><span class="line">    let av = yield a(s);</span><br><span class="line">    let bv = yield b(av);</span><br><span class="line">    let cv = yield c(bv);</span><br><span class="line">    return cv</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¯´æ˜äº†ä¼ å‚å’Œè¿”å›å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var o = g(&quot;haha&quot;) //s = haha</span><br><span class="line">o.next() //ä¸ç”¨ä¼ å‚</span><br><span class="line">o.next(&quot;h&quot;) //av = h</span><br><span class="line">o.next(&quot;hh&quot;) //bv = hh</span><br></pre></td></tr></table></figure><p>Generator.throw å¯ä»¥åœ¨å¤–éƒ¨æŠ›å‡ºé”™è¯¯ï¼ŒGenerator å†…éƒ¨æ•è·é”™è¯¯<br>Generator.return å¯ä»¥ç›´æ¥å°† iterable æŒ‡é’ˆæŒ‡å‘æœ€åä¸€ä¸ª<br>yield* è¡¨è¾¾å¼å¯ä»¥è°ƒç”¨å¦å¤–çš„è¡¨è¾¾å¼æˆ–è€…æ–¹æ³•<br>this å¯ä»¥åœ¨ prototype ä¸­è®¾ç½®ï¼Œä½†æ˜¯ä¸èƒ½åœ¨ function ä¸­ä½¿ç”¨ this, ä¹Ÿä¸èƒ½ new</p><p><code>yield</code> æœ€ç‰›é€¼çš„åœ°æ–¹åœ¨äºå¯ä»¥æš‚åœï¼Œå› æ­¤ä»–å¯ä»¥æœ‰éå¸¸å¤šæ‰«æ“ä½œ</p><ol><li>çŠ¶æ€æœº</li><li>å¼‚æ­¥æ“ä½œåŒæ­¥è¿›è¡Œ</li><li>ä»¥iterableæ¥å£è¾“å‡º</li><li>å½“ä½œä¸€ç§æ•°æ®ç»“æ„</li><li>æµç¨‹ç®¡ç†ä¹‹ç±»çš„äº‹æƒ…</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function get(url) &#123; ... &#125; //å¼‚æ­¥è·å–æ•°æ® promise</span><br><span class="line"></span><br><span class="line">function* a(urls) &#123;</span><br><span class="line">for(let i=0; i&lt;urls.length;i++) &#123;</span><br><span class="line">let result = yield get(url);</span><br><span class="line">console.log(result);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªresult å¯ä»¥åšæŒºå¤šäº‹æƒ…çš„ï¼Œå®ç°äº†ä¸€ä¸ªçœ‹èµ·æ¥åŒæ­¥çš„æ“ä½œã€‚</p><h3 id="link"><a href="#link" class="headerlink" title="link"></a>link</h3><p><a href="https://es6.ruanyifeng.com/#docs/number">https://es6.ruanyifeng.com/#docs/number</a><br><a href="https://zhuanlan.zhihu.com/p/467585782">https://zhuanlan.zhihu.com/p/467585782</a></p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript å¼‚æ­¥ç¼–ç¨‹æœ‰å“ªäº›æ–¹å¼ï¼Ÿ</title>
      <link href="/2023/07/03/async_code/"/>
      <url>/2023/07/03/async_code/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>è¿™é‡Œæ˜¯è®¨è®ºç¼–ç¨‹æ–¹å¼ã€‚</p><p>javascript å®ç°å¼‚æ­¥ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯ä¾é </p><ol><li>setTimeout</li><li>Promise</li><li>async&#x2F;await</li><li>XMLHttpRequest</li><li>Web Workers</li><li>EventListener</li></ol><p>è¿™å‡ ç§æ–¹å¼å»å¼‚æ­¥ã€‚</p><h3 id="01-å›è°ƒ"><a href="#01-å›è°ƒ" class="headerlink" title="01, å›è°ƒ"></a>01, å›è°ƒ</h3><p>å›è°ƒæ˜¯ä¸€ç§æœ€åŸºç¡€çš„æ–¹å¼ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setTimtOut</span>(fn, time)</span><br></pre></td></tr></table></figure><p>EventListener ä¹Ÿæ˜¯é å›è°ƒè§£å†³</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">button.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, handleClick);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç‚¹å‡»äº†æŒ‰é’®&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="02-Thunk"><a href="#02-Thunk" class="headerlink" title="02. Thunk"></a>02. Thunk</h3><p>å¯ä»¥ç†è§£ä¸ºå›è°ƒçš„å˜ç§ï¼Œæˆ–è€…å·¥å‚, é—­åŒ…</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">thunk</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">cb</span>) &#123;</span><br><span class="line">        <span class="comment">//è¯·æ±‚</span></span><br><span class="line">        <span class="comment">//cb</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼çš„å¥½å¤„åœ¨äºï¼Œåˆ†å‰²å‚æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> requestA = <span class="title function_">thunk</span>(url);</span><br><span class="line"><span class="title function_">requestA</span>(<span class="function">() =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥ç›´æ¥è°ƒç”¨ <code>requestA</code>, ç›¸å½“äºå°è£…äº†ä¸€å±‚ã€‚</p><h3 id="03-äº‹ä»¶é©±åŠ¨"><a href="#03-äº‹ä»¶é©±åŠ¨" class="headerlink" title="03. äº‹ä»¶é©±åŠ¨"></a>03. äº‹ä»¶é©±åŠ¨</h3><p>å°±æ˜¯å¼€å¤´æåˆ°çš„ EventListenerã€‚</p><p>è¿™ä¸ªæ¶‰åŠåˆ° javascript ä¸€ä¸ªåŸºç¡€æ¦‚å¿µï¼Œ JavaScript æ˜¯ä¸€ç§äº‹ä»¶é©±åŠ¨çš„è¯­è¨€ã€‚</p><blockquote><p>å®ƒé€šè¿‡äº‹ä»¶æœºåˆ¶æ¥å“åº”ç”¨æˆ·çš„æ“ä½œå’Œç³»ç»Ÿçš„å˜åŒ–ã€‚<br>äº‹ä»¶å¯ä»¥æ˜¯ç”¨æˆ·æ“ä½œï¼Œå¦‚é¼ æ ‡ç‚¹å‡»ã€é”®ç›˜è¾“å…¥ã€çª—å£æ»šåŠ¨ç­‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ç³»ç»Ÿå˜åŒ–ï¼Œå¦‚ç½‘é¡µåŠ è½½å®Œæˆã€å®šæ—¶å™¨åˆ°æœŸç­‰ã€‚</p></blockquote><p>DOM äº‹ä»¶å’Œè‡ªå®šä¹‰äº‹ä»¶ï¼Œå®ƒä»¬éƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> button = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myButton&#x27;</span>);</span><br><span class="line">button.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼&#x27;</span>, event);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myEvent = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;myEvent&#x27;</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(myEvent);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœæ˜¯æœ‰æˆ‘ä»¬è‡ªå·±å»è§¦å‘ï¼Œå°±æ˜¯åŒæ­¥æ‰§è¡Œï¼Œæ¯”å¦‚é€šè¿‡ <code>dispatchEvent</code> è§¦å‘ã€‚</p><h3 id="04-è§‚å¯Ÿè€…æ¨¡å¼"><a href="#04-è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="04. è§‚å¯Ÿè€…æ¨¡å¼"></a>04. è§‚å¯Ÿè€…æ¨¡å¼</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰è§‚å¯Ÿè€…å¯¹è±¡</span></span><br><span class="line"><span class="keyword">var</span> observer = &#123;</span><br><span class="line">  <span class="attr">subscribers</span>: [],</span><br><span class="line">  <span class="attr">subscribe</span>: <span class="keyword">function</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subscribers</span>.<span class="title function_">push</span>(callback);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">unsubscribe</span>: <span class="keyword">function</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> index = <span class="variable language_">this</span>.<span class="property">subscribers</span>.<span class="title function_">indexOf</span>(callback);</span><br><span class="line">    <span class="keyword">if</span> (index !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">subscribers</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">notify</span>: <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subscribers</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">subscriber</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">subscriber</span>(data);</span><br><span class="line">      &#125;, <span class="number">0</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰äº‹ä»¶</span></span><br><span class="line"><span class="keyword">var</span> event = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;dataUpdated&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123; <span class="attr">message</span>: <span class="string">&#x27;Hello world!&#x27;</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¢é˜…äº‹ä»¶</span></span><br><span class="line">observer.<span class="title function_">subscribe</span>(<span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Received data:&#x27;</span>, data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘äº‹ä»¶</span></span><br><span class="line">observer.<span class="title function_">notify</span>(event.<span class="property">data</span>);</span><br></pre></td></tr></table></figure><p>ä¾‹å­ä¸­è¿™ä¸ªå¼‚æ­¥å…¶å®æ²¡æœ‰æ„ä¹‰ï¼Œä¸»è¦æ˜¯åº”è¯¥åœ¨ notify é€šçŸ¥ä¹‹å‰æ¥å¼‚æ­¥ï¼Œæ¯”å¦‚æ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹ç±»çš„</p><p>ä½†æ˜¯æ¨¡å¼æ˜¯è¿™ä¹ˆä¸€ä¸ªæ¨¡å¼</p><h3 id="05-promise"><a href="#05-promise" class="headerlink" title="05. promise"></a>05. promise</h3><p>å¼‚æ­¥ç¼–ç¨‹å‰ç«¯ç›®å‰æ¥è¯´æœ€ä½³è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="06-async-x2F-await"><a href="#06-async-x2F-await" class="headerlink" title="06. async&#x2F;await"></a>06. async&#x2F;await</h3><p>ä¹Ÿæ˜¯ Prmoiseï¼Œåªæ˜¯è¯­æ³•ç³–ã€‚</p><h3 id="07-yield"><a href="#07-yield" class="headerlink" title="07. yield"></a>07. yield</h3><p>å› ä¸ºå¯ä»¥æš‚åœçš„æœºåˆ¶ï¼Œå¯ä»¥å¾ˆå¥½çš„æ‰¹é‡è§¦å‘å¼‚æ­¥ä»»åŠ¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">reuslts</span>(<span class="params">urls</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> url <span class="keyword">of</span> urls) &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">request</span>(url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> r <span class="keyword">of</span> results) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦çŸ¥é“ä¸€ä¸ªæ¦‚å¿µåç¨‹</p><blockquote><p>åç¨‹ï¼ˆCoroutineï¼‰æ˜¯ä¸€ç§è®¡ç®—æœºç¨‹åºç»„ä»¶ï¼Œå®ƒå¯ä»¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æš‚åœã€æ¢å¤å’Œä¼ é€’æ§åˆ¶æƒï¼Œä»è€Œæ”¯æŒå¤šä»»åŠ¡åä½œå¹¶å‘ç¼–ç¨‹ã€‚ç®€å•æ¥è¯´ï¼Œåç¨‹æ˜¯ä¸€ç§æ›´è½»é‡çº§çš„çº¿ç¨‹ï¼Œå®ƒå¯ä»¥åƒçº¿ç¨‹ä¸€æ ·å¹¶å‘æ‰§è¡Œï¼Œä½†ç›¸æ¯”çº¿ç¨‹å ç”¨æ›´å°‘çš„èµ„æºï¼Œå¹¶ä¸”å¯ä»¥æ›´æ–¹ä¾¿åœ°å®ç°åä½œå¼å¤šä»»åŠ¡å¤„ç†ã€‚</p><p>ä¸çº¿ç¨‹ä¸åŒï¼Œåç¨‹å¹¶ä¸æ˜¯ç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç®¡ç†çš„ï¼Œè€Œæ˜¯ç”±åº”ç”¨ç¨‹åºè‡ªè¡Œç®¡ç†ã€‚åç¨‹é€šå¸¸ç”±ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼ˆGenerator Functionï¼‰å’Œä¸€ä¸ªè°ƒåº¦å™¨ï¼ˆSchedulerï¼‰ç»„æˆï¼Œç”Ÿæˆå™¨å‡½æ•°ç”¨äºå®šä¹‰åç¨‹çš„æ‰§è¡Œæµç¨‹ï¼Œè°ƒåº¦å™¨ç”¨äºæ§åˆ¶åç¨‹çš„è°ƒåº¦å’Œåä½œã€‚</p><p>åç¨‹é€šå¸¸å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li>åç¨‹å¯ä»¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æš‚åœå’Œæ¢å¤æ‰§è¡Œï¼Œè¿™ç§æ“ä½œé€šå¸¸ç§°ä¸ºæŒ‚èµ·å’Œæ¢å¤ã€‚</li><li>åç¨‹å¯ä»¥ä¿å­˜å’Œæ¢å¤è‡ªå·±çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬å˜é‡ã€æŒ‡ä»¤æŒ‡é’ˆå’Œè°ƒç”¨æ ˆç­‰ã€‚</li><li>åç¨‹é€šå¸¸ä½¿ç”¨åä½œå¼è°ƒåº¦ï¼Œå³åç¨‹ä¹‹é—´åä½œæ‰§è¡Œï¼Œä¸éœ€è¦åƒçº¿ç¨‹é‚£æ ·é€šè¿‡æ“ä½œç³»ç»Ÿå†…æ ¸è¿›è¡Œè°ƒåº¦ã€‚</li><li>åç¨‹é€šå¸¸å¯ä»¥å®ç°è½»é‡çº§çš„å¤šä»»åŠ¡å¤„ç†ï¼Œæ”¯æŒæ›´é«˜æ•ˆçš„å¹¶å‘ç¼–ç¨‹ã€‚</li></ol></blockquote></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çœ‹ node-deep-equal</title>
      <link href="/2023/07/03/node_deep_equal/"/>
      <url>/2023/07/03/node_deep_equal/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p><a href="https://github.com/inspect-js/node-deep-equal">inspect-js&#x2F;node-deep-equal</a></p><p>è¿™ä¸ªåº“å¾ˆæœ‰æ„æ€ï¼Œå› ä¸ºä»–éœ€è¦åšæ·±å±‚æ¬¡çš„å¯¹æ¯”ï¼Œæ‰€ä»¥æ‰€æœ‰çš„ javascript ç±»å‹éƒ½å›Šæ‹¬äº†ï¼Œåº”è¯¥å¦‚ä½•åˆ¤æ–­å’Œå¯¹æ¯”</p><p>å®ƒçš„æ ¸å¿ƒæ–¹æ³• <code>internalDeepEqual</code>, ä¼ å…¥(A,B,Opt,Channel)</p><p>A,B æ˜¯éœ€è¦å¯¹æ¯”çš„å¯¹è±¡ï¼Œ Optç”¨æ¥åŒºåˆ† Object.is or &#x3D;&#x3D;&#x3D;, Channel ä¸€ä¸ªå­—å…¸</p><ol><li>Object.is or &#x3D;&#x3D;&#x3D; åˆ¤æ–­ Aï¼ŒBæ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰ retrun true.</li><li>åˆ¤æ–­ Aï¼ŒBæ˜¯å¦æ˜¯åŸºç¡€ç±»å‹ï¼Œå¹¶ä¸” typeof çš„å€¼æ˜¯å¦ä¸€è‡´ï¼Œä»–è¿™é‡Œå¤„ç†äº† new Number(1), new String(â€œ1â€) è¿™äº›æƒ…å†µï¼Œåªæ˜¯åˆ¤æ–­ç±»å‹æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œ return false</li><li>A,B æœ‰ä¸€ä¸ªå¯èƒ½æ˜¯ undefinedï¼Œ null æˆ–è€… ä¸¤è¾¹éƒ½ä¸æ˜¯ typeof A !&#x3D;&#x3D; object çš„æƒ…å†µä¸‹ï¼Œç›´æ¥é€šè¿‡ Object.is or &#x3D;&#x3D;&#x3D; æ¥å¯¹æ¯”</li><li>ä¸Šé¢3ä¸­æƒ…å†µç›´æ¥å¤„ç†äº†åŸºç¡€ç±»å‹ï¼Œéobjectçš„æƒ…å†µä¸‹</li><li>å°† Aï¼ŒBåŠ å…¥å­—å…¸ï¼Œå¹¶ä¸”åšåˆ¤æ–­</li><li>è¿›å…¥ objEquiv(A, B, opts, channel); è¿›è¡Œ Object çš„å¯¹æ¯”ã€‚</li></ol><p><strong>objEquiv</strong></p><ol><li>typeof è¿”å›å€¼å¯¹æ¯”</li><li>Object.prototype.toString(A or B) å¯¹æ¯”</li><li>isArguments ç±»å‹åˆ¤æ–­ </li><li>isArray ç±»å‹åˆ¤æ–­ return false</li><li>instanceof Error ç±»å‹åˆ¤æ–­ return false</li><li>å¦‚æœéƒ½æ˜¯Errorå¯¹è±¡ï¼Œå¯¹æ¯” name å’Œ message return false </li><li>isRegex ç±»å‹åˆ¤æ–­ return false </li><li>å¯¹æ¯” Regex.source &amp; Regex.prototype.flags return false</li><li>isDate ç±»å‹åˆ¤æ–­ return false</li><li>å¯¹æ¯” Date.prototype.getTime return false</li><li>Object.getPrototypeOf å¯¹æ¯”åŸå‹é“¾ return false</li><li>whichTypedArray åˆ¤æ–­ return false</li><li>isBuffer ç±»å‹åˆ¤æ–­ return false</li><li>åˆ¤æ–­ Buffer length æˆ–è€… å¾ªç¯åˆ¤æ–­ä¸¤ä¸ªbufferå†…å®¹ return true or false</li><li>isArrayBuffer ç±»å‹åˆ¤æ–­ return false</li><li>åˆ¤æ–­ ArrayBuffer é•¿åº¦æ˜¯å¦ä¸€è‡´ return false</li><li>return typeof Uint8Array &#x3D;&#x3D;&#x3D; â€œfunctionâ€ &amp;&amp; internalDeepEqual(new Uint8Array(a), new Uint8Array(b), opts, channel)</li><li>isSharedArrayBuffer ç±»å‹åˆ¤æ–­ å’Œ isArrayBuffer è¿‡ç¨‹ä¸€æ ·</li><li>objectKeys</li><li>åˆ¤æ–­é•¿åº¦</li><li>æ•´ç†é¡ºåº sort</li><li>å¾ªç¯åˆ¤æ–­</li><li>whichCollection  åˆ¤æ–­æ˜¯å¦æ˜¯ set,map,WeakMap,WeakSet é›†åˆç±»å‹åˆ¤æ–­</li><li>ç±»å‹åˆ¤æ–­</li><li>å¾ªç¯é€’å½’åˆ¤æ–­ Set,Map å†…å®¹ï¼Œreturn true or false</li><li>return true;</li></ol><h3 id="01-å…³äº-Error-çš„æ¡ä»¶åˆ¤æ–­çš„é—®é¢˜"><a href="#01-å…³äº-Error-çš„æ¡ä»¶åˆ¤æ–­çš„é—®é¢˜" class="headerlink" title="01. å…³äº Error çš„æ¡ä»¶åˆ¤æ–­çš„é—®é¢˜"></a>01. å…³äº Error çš„æ¡ä»¶åˆ¤æ–­çš„é—®é¢˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var aIsError = a instanceof Error;</span><br><span class="line">var bIsError = b instanceof Error;</span><br><span class="line">if (aIsError !== bIsError) &#123;</span><br><span class="line">  return false;</span><br><span class="line">&#125;</span><br><span class="line">if (aIsError || bIsError) &#123;</span><br><span class="line">  if (a.name !== b.name || a.message !== b.message) &#123;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#x2F;&#x2F;1. A other B other<br>&#x2F;&#x2F;2. A Error B other<br>&#x2F;&#x2F;3. A other B Error<br>&#x2F;&#x2F;4. A Error B Error</p><p>2,3 çš„æƒ…å†µä¸å­˜åœ¨ï¼Œå› ä¸ºç›´æ¥è¿”å› false,åœ¨ä¹‹å‰çš„ä»£ç ä¸­ä¹Ÿç›´æ¥è¿”å› false<br>1, å¦‚æœéƒ½æ˜¯ other ä¼šç›´æ¥è·³è¿‡<br>4, å¦‚æœ Error name &amp; message ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šè¿”å› false.</p><p>ä¸ºä»€ä¹ˆè¿˜éœ€è¦ç»§ç»­è¿›è¡Œåˆ¤æ–­ï¼Œæ¯”å¦‚ isRegex, ä»¥åŠä¹‹åçš„ä»£ç ï¼Œè€Œä¸æ˜¯ç›´æ¥ return true.</p><p>å› ä¸ºåç»­å¹¶æ²¡æœ‰ç»§ç»­é’ˆå¯¹ <code>Error</code> å¯¹è±¡æ¥è¿›è¡Œåˆ¤æ–­çš„äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å§‹å§‹ç»ˆä¼šæ‰§è¡Œåˆ°æœ€åä¸€æ­¥, return true</p><p>æ ¹æ® <code>javascript Error</code> æ–‡æ¡£ <a href="https://developer.mozilla.org/en-US/docs/web/javascript/reference/global_objects/error">Error</a></p><p>è™½ç„¶ Error æœ¬èº«è¿˜æ˜¯æœ‰å¾ˆå¤šå±æ€§ï¼Œä½†æ˜¯å…¶å®å€¼çš„åˆ¤æ–­çš„ï¼Œname &amp; message &amp; stack</p><blockquote><p>Error.prototype.stack Non-standard<br>A non-standard property for a stack trace.</p></blockquote><p>æ‰€ä»¥ name &amp; message ç›¸ç­‰çš„è¯ï¼Œåº”è¯¥å¯ä»¥ç¡®å®šæ˜¯åŒä¸€ç§é”™è¯¯ã€‚</p><h3 id="02-channelçš„ä½¿ç”¨é—®é¢˜"><a href="#02-channelçš„ä½¿ç”¨é—®é¢˜" class="headerlink" title="02. channelçš„ä½¿ç”¨é—®é¢˜"></a>02. channelçš„ä½¿ç”¨é—®é¢˜</h3><p><code>side-channel</code> æ˜¯ WeakMap || Map || Object çš„ä¸€ç§å°è£…ï¼Œæ ¹æ®ä¼ å…¥å‚æ•°çš„ä¸ä¸€è‡´ï¼Œé€‰æ‹©ä¸åŒçš„å­—å…¸ã€‚</p><p>çœ‹ä¸€æ®µä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var hasActual = channel.has(actual);</span><br><span class="line">  var hasExpected = channel.has(expected);</span><br><span class="line">  var sentinel;</span><br><span class="line">  if (hasActual &amp;&amp; hasExpected) &#123;</span><br><span class="line">    if (channel.get(actual) === channel.get(expected)) &#123;</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    sentinel = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  if (!hasActual) &#123;</span><br><span class="line">    channel.set(actual, sentinel);</span><br><span class="line">  &#125;</span><br><span class="line">  if (!hasExpected) &#123;</span><br><span class="line">    channel.set(expected, sentinel);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // eslint-disable-next-line no-use-before-define</span><br><span class="line">  return objEquiv(actual, expected, opts, channel);</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä»£ç ï¼Œ channel åªå®ä¾‹åŒ–è¿‡ä¸€æ¬¡ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡ï¼Œå‡ºç°å®Œå…¨ç›¸åŒçš„ Keyï¼Œé‚£ä¹ˆå°±ä¼šå‡ºé—®é¢˜ã€‚</p><h3 id="03-åŒ…å«åŸºæœ¬ç±»å‹çš„åˆ¤æ–­"><a href="#03-åŒ…å«åŸºæœ¬ç±»å‹çš„åˆ¤æ–­" class="headerlink" title="03. åŒ…å«åŸºæœ¬ç±»å‹çš„åˆ¤æ–­"></a>03. åŒ…å«åŸºæœ¬ç±»å‹çš„åˆ¤æ–­</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let o1 = new Number(1);</span><br><span class="line">let o2 = new Number(2);</span><br></pre></td></tr></table></figure><p>å¯¹äºè¿™ä¸ªåŒ…æ¥è¯´æ˜¯è¿”å›trueçš„ï¼Œå› ä¸ºæ²¡æœ‰é’ˆå¯¹è¿™ä¸ªçš„å¤„ç†ã€‚</p><p>ä½†æ˜¯ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let o1 = new String(`one`) </span><br><span class="line">let o2 = new String(`two`)</span><br></pre></td></tr></table></figure><p>å´å¯ä»¥ï¼Œé‚£æ˜¯å› ä¸ºï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªåˆ¤æ–­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object.keys(o1)</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œå¯¹æ¯”ã€‚</p><p>æ‰€ä»¥æŒ‰ç…§è¿™ä¸ªé€»è¾‘ï¼Œnew boolean ä¹Ÿæ˜¯æ— æ³•åˆ¤æ–­çš„ã€‚</p><p>å…¶ä»–çš„åŸºç¡€ç±»å‹ï¼Œå› ä¸ºä¸èƒ½ new, æ‰€ä»¥æ²¡æœ‰é—®é¢˜</p><h3 id="link"><a href="#link" class="headerlink" title="link"></a>link</h3><ol><li><a href="https://developer.mozilla.org/en-US/docs/web/javascript/reference/global_objects/error">Error</a></li><li><a href="https://github.com/ljharb/side-channel">side-channel</a></li><li><a href="https://www.npmjs.com/package/deep-equal">deep-equal</a></li></ol></div>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> çœ‹æºç  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue errorCaptured vs onErrorCaptured</title>
      <link href="/2023/07/02/vue_errorCaptured_onErrorCaptured/"/>
      <url>/2023/07/02/vue_errorCaptured_onErrorCaptured/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>beforeCreate -&gt; setup()<br>created -&gt; setup()<br>beforeMount -&gt; onBeforeMount<br>mounted -&gt; onMounted<br>beforeUpdate -&gt; onBeforeUpdate<br>updated -&gt; onUpdated<br>beforeDestroy -&gt; onBeforeUnmount<br>destroyed -&gt; onUnmounted<br>activated -&gt; onActivated<br>deactivated -&gt; onDeactivated<br><strong>errorCaptured -&gt; onErrorCaptured</strong></p><h3 id="1-onErrorCaptured"><a href="#1-onErrorCaptured" class="headerlink" title="1. onErrorCaptured"></a>1. onErrorCaptured</h3></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> vue2 </tag>
            
            <tag> typescript </tag>
            
            <tag> ç”Ÿå‘½å‘¨æœŸ </tag>
            
            <tag> errorCaptured </tag>
            
            <tag> onErrorCaptured </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue deactivated vs onDeactivated</title>
      <link href="/2023/07/02/vue_deactivated/"/>
      <url>/2023/07/02/vue_deactivated/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>beforeCreate -&gt; setup()<br>created -&gt; setup()<br>beforeMount -&gt; onBeforeMount<br>mounted -&gt; onMounted<br>beforeUpdate -&gt; onBeforeUpdate<br>updated -&gt; onUpdated<br>beforeDestroy -&gt; onBeforeUnmount<br>destroyed -&gt; onUnmounted<br>activated -&gt; onActivated<br><strong>deactivated -&gt; onDeactivated</strong><br>errorCaptured -&gt; onErrorCaptured</p><h3 id="1-onDeactivated"><a href="#1-onDeactivated" class="headerlink" title="1. onDeactivated"></a>1. onDeactivated</h3><p>å…ˆè¯´è¯´è°ƒç”¨æµç¨‹</p><p>è§¦å‘ <strong>set &#x3D;&gt; trigger &#x3D;&gt; effect.scheduler() &#x3D;&gt; queueJob(update) &#x3D;&gt; queue.push(job); &#x3D;&gt; flushJobs(æ‰§è¡Œé˜Ÿåˆ—, æ‰§è¡Œå®Œæˆä»¥å) &#x3D;&gt; flushPostFlushCbs &#x3D;&gt; è§¦å‘å›è°ƒ</strong></p><p>åŠ å…¥é’©å­ <strong>set &#x3D;&gt; trigger &#x3D;&gt; effect.scheduler() &#x3D;&gt; queueJob(update) &#x3D;&gt; queue.push(job); &#x3D;&gt; flushJobs(æ‰§è¡Œé˜Ÿåˆ—) &#x3D;&gt; patch(ä¸åœçš„é€’å½’) &#x3D;&gt; unmount &#x3D;&gt;  parentComponent.ctx.deactivate(vnode)</strong></p><p>è¿™æ˜¯å¦å¤–ä¸€å¥— Vue3 é’©å­è§¦å‘æ–¹æ³•ï¼Œä¹Ÿæ˜¯æˆ‘åç»­æ‰æ³¨æ„åˆ°çš„ï¼Œéœ€è¦è¡¥å……åœ¨ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸæµç¨‹ã€‚</p><p><a href="/tblog/2023/06/29/vue3_keep_alive/">keep-alive</a></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">sharedContext.<span class="property">deactivate</span> = <span class="function">(<span class="params">vnode: VNode</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//è·å–å½“å‰ Vnode ç»„ä»¶</span></span><br><span class="line">  <span class="keyword">const</span> instance = vnode.<span class="property">component</span>! </span><br><span class="line">  <span class="comment">//ç§»åŠ¨èŠ‚ç‚¹åˆ° storageContainer</span></span><br><span class="line">  <span class="title function_">move</span>(vnode, storageContainer, <span class="literal">null</span>, <span class="title class_">MoveType</span>.<span class="property">LEAVE</span>, parentSuspense)</span><br><span class="line">  <span class="comment">// åŠ å…¥é˜Ÿåˆ—</span></span><br><span class="line">  <span class="title function_">queuePostRenderEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//deactivate é’©å­è§¦å‘</span></span><br><span class="line">    <span class="keyword">if</span> (instance.<span class="property">da</span>) &#123;</span><br><span class="line">      <span class="title function_">invokeArrayFns</span>(instance.<span class="property">da</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//onVnodeUnmounted é’©å­</span></span><br><span class="line">    <span class="keyword">const</span> vnodeHook = vnode.<span class="property">props</span> &amp;&amp; vnode.<span class="property">props</span>.<span class="property">onVnodeUnmounted</span></span><br><span class="line">    <span class="keyword">if</span> (vnodeHook) &#123;</span><br><span class="line">      <span class="title function_">invokeVNodeHook</span>(vnodeHook, instance.<span class="property">parent</span>, vnode)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æ ‡è®° deactived</span></span><br><span class="line">    instance.<span class="property">isDeactivated</span> = <span class="literal">true</span></span><br><span class="line">  &#125;, parentSuspense)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ‰§è¡Œæ¨¡å¼ï¼Œæ›´æ–°, active ç­‰ç­‰éƒ½æ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯éƒ½æ˜¯å®Œå…¨æ‰§è¡Œå®Œæˆä¹‹åï¼Œåœ¨æœ€åè°ƒç”¨ã€‚</p><h3 id="Vue2-x-deactivated"><a href="#Vue2-x-deactivated" class="headerlink" title="Vue2.x deactivated"></a>Vue2.x deactivated</h3><p>è°ƒç”¨è·¯å¾„ç±»ä¼¼</p><p>è§¦å‘ <strong>set &#x3D;&gt; dep &#x3D;&gt; watcher &#x3D;&gt; è°ƒåº¦é˜Ÿåˆ— &#x3D;&gt; watcher.run() &#x3D;&gt; updateComponent &#x3D;&gt; patch &#x3D;&gt; removeVnodes &#x3D;&gt; invokeDestroyHook</strong> è§¦å‘ <code>hooks</code>ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> vue2 </tag>
            
            <tag> typescript </tag>
            
            <tag> ç”Ÿå‘½å‘¨æœŸ </tag>
            
            <tag> deactivated </tag>
            
            <tag> onDeactivated </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue actived vs onActivated</title>
      <link href="/2023/07/02/vue_active/"/>
      <url>/2023/07/02/vue_active/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h3 id="1-Vue3-x-onActivated"><a href="#1-Vue3-x-onActivated" class="headerlink" title="1. Vue3.x onActivated"></a>1. Vue3.x onActivated</h3><p><code>keep-alive</code>  çš„æºç ä¹‹å‰çœ‹äº†å¤§æ¦‚çœ‹è¿‡ï¼Œå¯ä»¥çœ‹è¿™é‡Œ <a href="/tblog/2023/06/29/vue3_keep_alive/">keep-alive</a></p><p><code>active</code> ä¼šåœ¨ <code>processComponent</code> å½“ä¸­è°ƒç”¨</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">processComponent</span> = (<span class="params">n1, n2, container, anchor, parentComponent, parentSuspense, isSVG, slotScopeIds, optimized</span>) =&gt; &#123;</span><br><span class="line">    n2.<span class="property">slotScopeIds</span> = slotScopeIds;</span><br><span class="line">    <span class="keyword">if</span> (n1 == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n2.<span class="property">shapeFlag</span> &amp; <span class="number">512</span> <span class="comment">/* ShapeFlags.COMPONENT_KEPT_ALIVE */</span>) &#123;</span><br><span class="line">            parentComponent.<span class="property">ctx</span>.<span class="title function_">activate</span>(n2, container, anchor, isSVG, optimized);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">mountComponent</span>(n2, container, anchor, parentComponent, parentSuspense, isSVG, optimized);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">updateComponent</span>(n1, n2, optimized);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯é€šè¿‡ component is çš„è§¦å‘åˆ° update &#x3D;&gt; patch ç„¶åå¯ä»¥è§¦å‘åˆ°è¿™é‡Œã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">sharedContext.<span class="property">activate</span> = <span class="function">(<span class="params">vnode, container, anchor, isSVG, optimized</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> instance = vnode.<span class="property">component</span>!</span><br><span class="line">  <span class="title function_">move</span>(vnode, container, anchor, <span class="title class_">MoveType</span>.<span class="property">ENTER</span>, parentSuspense)</span><br><span class="line">  <span class="comment">// in case props have changed</span></span><br><span class="line">  <span class="title function_">patch</span>(</span><br><span class="line">    instance.<span class="property">vnode</span>,</span><br><span class="line">    vnode,</span><br><span class="line">    container,</span><br><span class="line">    anchor,</span><br><span class="line">    instance,</span><br><span class="line">    parentSuspense,</span><br><span class="line">    isSVG,</span><br><span class="line">    vnode.<span class="property">slotScopeIds</span>,</span><br><span class="line">    optimized</span><br><span class="line">  )</span><br><span class="line">  <span class="title function_">queuePostRenderEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    instance.<span class="property">isDeactivated</span> = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">if</span> (instance.<span class="property">a</span>) &#123;</span><br><span class="line">      <span class="title function_">invokeArrayFns</span>(instance.<span class="property">a</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> vnodeHook = vnode.<span class="property">props</span> &amp;&amp; vnode.<span class="property">props</span>.<span class="property">onVnodeMounted</span></span><br><span class="line">    <span class="keyword">if</span> (vnodeHook) &#123;</span><br><span class="line">      <span class="title function_">invokeVNodeHook</span>(vnodeHook, instance.<span class="property">parent</span>, vnode)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, parentSuspense)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (__DEV__ || __FEATURE_PROD_DEVTOOLS__) &#123;</span><br><span class="line">    <span class="comment">// Update components tree</span></span><br><span class="line">    <span class="title function_">devtoolsComponentAdded</span>(instance)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠå½“å‰èŠ‚ç‚¹ç§»åŠ¨åˆ° <code>container</code> å½“ä¸­ï¼Œç„¶å <code>patch</code> æ–°æ—§èŠ‚ç‚¹ï¼Œè§¦å‘ <code>active hook</code>ã€‚</p><p>å…·ä½“å…³äºç¼“å­˜å’Œå…¶ä»–æ–¹æ³•å°±çœ‹ <a href="/tblog/2023/06/29/vue3_keep_alive/">keep-alive</a></p><p>å¦å¤–è¿˜æœ‰ä¸€å¤„è§¦å‘ç‚¹åœ¨ setupRenderEffect</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (</span><br><span class="line">  initialVNode.<span class="property">shapeFlag</span> &amp; <span class="title class_">ShapeFlags</span>.<span class="property">COMPONENT_SHOULD_KEEP_ALIVE</span> ||</span><br><span class="line">  (parent &amp;&amp;</span><br><span class="line">    <span class="title function_">isAsyncWrapper</span>(parent.<span class="property">vnode</span>) &amp;&amp;</span><br><span class="line">    parent.<span class="property">vnode</span>.<span class="property">shapeFlag</span> &amp; <span class="title class_">ShapeFlags</span>.<span class="property">COMPONENT_SHOULD_KEEP_ALIVE</span>)</span><br><span class="line">) &#123;</span><br><span class="line">  instance.<span class="property">a</span> &amp;&amp; <span class="title function_">queuePostRenderEffect</span>(instance.<span class="property">a</span>, parentSuspense)</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    __COMPAT__ &amp;&amp;</span><br><span class="line">    <span class="title function_">isCompatEnabled</span>(<span class="title class_">DeprecationTypes</span>.<span class="property">INSTANCE_EVENT_HOOKS</span>, instance)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="title function_">queuePostRenderEffect</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> instance.<span class="title function_">emit</span>(<span class="string">&#x27;hook:activated&#x27;</span>),</span><br><span class="line">      parentSuspense</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Vue2-x-actived"><a href="#Vue2-x-actived" class="headerlink" title="Vue2.x actived"></a>Vue2.x actived</h3><p><strong>src\core\components\keep-alive.ts</strong></p><p>å°±æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œè‡ªå®šä¹‰æ˜¯ç»„å»ºï¼Œç„¶åè‡ªå·±å†™äº†ä¸€ä¸ª <code>render</code>, æ–¹æ³•æœ‰ç±»ä¼¼ï¼ŒåŸºæœ¬é€»è¾‘ä¸€æ ·ï¼Œåªæ˜¯ <strong>Vue3.x</strong> æ˜¯ç”¨ <strong>setup</strong> æ¥å†™ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œå¯æ˜¯è¿™é‡Œä¼¼ä¹ä¸ç”Ÿå‘½å‘¨æœŸæ— å…³ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>active</code> æ˜¯åœ¨ <code>patch</code> å½“ä¸­è°ƒç”¨çš„å…¨å±€ç”Ÿå‘½å‘¨æœŸ</p><p>é‚£ä¹ˆ actived æ˜¯æ€ä¹ˆè§¦å‘çš„ ï¼Ÿ</p><p><strong>Vue.prototype._update</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">vm</span>: <span class="title class_">Component</span> = <span class="variable language_">this</span></span><br><span class="line"><span class="keyword">const</span> prevEl = vm.<span class="property">$el</span></span><br><span class="line"><span class="keyword">const</span> prevVnode = vm.<span class="property">_vnode</span></span><br><span class="line"><span class="keyword">const</span> restoreActiveInstance = <span class="title function_">setActiveInstance</span>(vm)</span><br><span class="line">vm.<span class="property">_vnode</span> = vnode</span><br><span class="line"><span class="comment">// Vue.prototype.__patch__ is injected in entry points</span></span><br><span class="line"><span class="comment">// based on the rendering backend used.</span></span><br><span class="line"><span class="keyword">if</span> (!prevVnode) &#123;</span><br><span class="line">  <span class="comment">// initial render</span></span><br><span class="line">  vm.<span class="property">$el</span> = vm.<span class="title function_">__patch__</span>(vm.<span class="property">$el</span>, vnode, hydrating, <span class="literal">false</span> <span class="comment">/* removeOnly */</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// updates</span></span><br><span class="line">  vm.<span class="property">$el</span> = vm.<span class="title function_">__patch__</span>(prevVnode, vnode)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>initComponent</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initComponent</span> (vnode, insertedVnodeQueue) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isDef</span>(vnode.<span class="property">data</span>.<span class="property">pendingInsert</span>)) &#123;</span><br><span class="line">    insertedVnodeQueue.<span class="property">push</span>.<span class="title function_">apply</span>(insertedVnodeQueue, vnode.<span class="property">data</span>.<span class="property">pendingInsert</span>);</span><br><span class="line">    vnode.<span class="property">data</span>.<span class="property">pendingInsert</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  vnode.<span class="property">elm</span> = vnode.<span class="property">componentInstance</span>.<span class="property">$el</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isPatchable</span>(vnode)) &#123;</span><br><span class="line">    <span class="title function_">invokeCreateHooks</span>(vnode, insertedVnodeQueue);</span><br><span class="line">    <span class="title function_">setScope</span>(vnode);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// empty component root.</span></span><br><span class="line">    <span class="comment">// skip all element-related modules except for ref (#3455)</span></span><br><span class="line">    <span class="title function_">registerRef</span>(vnode);</span><br><span class="line">    <span class="comment">// make sure to invoke the insert hook</span></span><br><span class="line">    insertedVnodeQueue.<span class="title function_">push</span>(vnode);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´é€šè¿‡ <strong>Object.defineProperty &#x3D;&gt; set &#x3D;&gt; dep &#x3D;&gt; è§¦å‘ watcher &#x3D;&gt; è§¦å‘æ›´æ–° &#x3D;&gt; _update &#x3D;&gt; patch &#x3D;&gt; initComponent &#x3D;&gt; ç„¶ååŠ å…¥é˜Ÿåˆ—</strong></p><p>æœ€ååœ¨ patch ç»“æŸä»¥åï¼Œç»Ÿä¸€è°ƒç”¨.</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">invokeInsertHook</span>(vnode, insertedVnodeQueue, isInitialPatch);</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> vue2 </tag>
            
            <tag> typescript </tag>
            
            <tag> keep-alive </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue3 keep-alive</title>
      <link href="/2023/06/29/vue3_keep_alive/"/>
      <url>/2023/06/29/vue3_keep_alive/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="1-Vue3-x-keep-alive-æºç "><a href="#1-Vue3-x-keep-alive-æºç " class="headerlink" title="1. Vue3.x keep-alive æºç "></a>1. Vue3.x keep-alive æºç </h1><p><strong>packages&#x2F;runtime-core&#x2F;src&#x2F;components&#x2F;KeepAlive.ts</strong></p><p>çœ‹æºç çŸ¥é“ keepalive åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½</p><p>setup å‡½æ•°ï¼Œé‡Œé¢å®šä¹‰äº† activateï¼Œdeactivateï¼Œunmountï¼ŒpruneCacheï¼ŒpruneCacheEntryï¼Œmatchesï¼Œmoveï¼Œä»¥åŠç”Ÿå‘½å‘¨æœŸå‡½æ•°æ³¨å†Œå’Œè°ƒç”¨ã€‚</p><h3 id="1-1-setup"><a href="#1-1-setup" class="headerlink" title="1.1 setup"></a>1.1 setup</h3><p>setup ä¼šåœ¨åˆ›å»ºçš„æ—¶å€™æ‰§è¡Œï¼Œä»–ä¸»è¦åŒ…å«äº†ä»¥ä¸‹åŠŸèƒ½</p><p>å®šä¹‰äº†ä¸‰ä¸ªå˜é‡</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">cache</span>: <span class="title class_">Cache</span> = <span class="keyword">new</span> <span class="title class_">Map</span>() <span class="comment">//ç¼“å­˜</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">keys</span>: <span class="title class_">Keys</span> = <span class="keyword">new</span> <span class="title class_">Set</span>() <span class="comment">//å­—å…¸ï¼Œå­˜æ”¾key</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">current</span>: <span class="title class_">VNode</span> | <span class="literal">null</span> = <span class="literal">null</span> <span class="comment">//å½“å‰çš„ç»„ä»¶</span></span><br></pre></td></tr></table></figure><p>ä»ä¸Šä¸‹æ–‡ä¸­æ‹¿åˆ°äº†å‡ ä¸ªæ–¹æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="attr">renderer</span>: &#123;</span><br><span class="line">    <span class="attr">p</span>: patch,</span><br><span class="line">    <span class="attr">m</span>: move,</span><br><span class="line">    <span class="attr">um</span>: _unmount,</span><br><span class="line">    <span class="attr">o</span>: &#123; createElement &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; = sharedContext</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®¹å™¨ <code>const storageContainer = createElement(&#39;div&#39;)</code></p><p>ç„¶ååˆ›å»º <code>activate &amp; deactivate</code> ä¸¤ä¸ªæ–¹æ³•åˆ° <code>sharedContext</code> å½“ä¸­ï¼Œ<code>sharedContext = instance.ctx as KeepAliveContext</code>ï¼Œä¹Ÿå°±æ˜¯å½“å‰ç»„ä»¶(<strong>keepalive</strong>)çš„ä¸Šä¸‹æ–‡ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sharedContext.<span class="property">activate</span> = <span class="function">(<span class="params">...</span>) =&gt;</span> &#123; ... &#125;</span><br><span class="line">sharedContext.<span class="property">deactivate</span> = <span class="function">(<span class="params">...</span>) =&gt;</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ›å»º <code>unmount</code> æ–¹æ³•, å¸è½½ç»„ä»¶</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unmount</span>(<span class="params">vnode: VNode</span>) &#123;</span><br><span class="line">  <span class="comment">// reset the shapeFlag so it can be properly unmounted</span></span><br><span class="line">  <span class="title function_">resetShapeFlag</span>(vnode)</span><br><span class="line">  <span class="title function_">_unmount</span>(vnode, instance, parentSuspense, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>pruneCache</code> ç”¨äºæ¸…ç†ç¼“å­˜ä¸­çš„ç»„ä»¶</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">pruneCache</span>(<span class="params">filter?: (name: <span class="built_in">string</span>) =&gt; <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">  cache.<span class="title function_">forEach</span>(<span class="function">(<span class="params">vnode, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> name = <span class="title function_">getComponentName</span>(vnode.<span class="property">type</span> <span class="keyword">as</span> <span class="title class_">ConcreteComponent</span>)</span><br><span class="line">    <span class="keyword">if</span> (name &amp;&amp; (!filter || !<span class="title function_">filter</span>(name))) &#123;</span><br><span class="line">      <span class="title function_">pruneCacheEntry</span>(key)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>pruneCacheEntry</code> æ¸…ç†ä¸€ä¸ªæŒ‡å®šçš„ç¼“å­˜ </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">pruneCacheEntry</span>(<span class="params">key: CacheKey</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> cached = cache.<span class="title function_">get</span>(key) <span class="keyword">as</span> <span class="title class_">VNode</span></span><br><span class="line">  <span class="keyword">if</span> (!current || !<span class="title function_">isSameVNodeType</span>(cached, current)) &#123;</span><br><span class="line">    <span class="title function_">unmount</span>(cached)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (current) &#123;</span><br><span class="line">    <span class="comment">// current active instance should no longer be kept-alive.</span></span><br><span class="line">    <span class="comment">// we can&#x27;t unmount it now but it might be later, so reset its flag now.</span></span><br><span class="line">    <span class="title function_">resetShapeFlag</span>(current)</span><br><span class="line">  &#125;</span><br><span class="line">  cache.<span class="title function_">delete</span>(key)</span><br><span class="line">  keys.<span class="title function_">delete</span>(key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›‘å¬ <code>include</code> å’Œ <code>exclude</code> å±æ€§çš„å˜åŒ–ï¼Œæ ¹æ®å˜åŒ–é‡æ–°æ¸…ç†ç¼“å­˜</p><p>ç¼“å­˜å­æ ‘ï¼Œå¦‚æœ <code>pendingCacheKey</code> æœ‰å€¼ï¼Œåœ¨ <code>Mounted</code>, <code>Updated</code> è¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸä¼šè§¦å‘çš„æ—¶å€™è°ƒç”¨ ç¼“å­˜å­æ ‘çš„æ–¹æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">pendingCacheKey</span>: <span class="title class_">CacheKey</span> | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">cacheSubtree</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (pendingCacheKey != <span class="literal">null</span>) &#123;</span><br><span class="line">    cache.<span class="title function_">set</span>(pendingCacheKey, <span class="title function_">getInnerChild</span>(instance.<span class="property">subTree</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">onMounted</span>(cacheSubtree)</span><br><span class="line"><span class="title function_">onUpdated</span>(cacheSubtree)</span><br></pre></td></tr></table></figure><p>ç„¶åè¿”å›ä¸€ä¸ªæ–¹æ³•ï¼Œç›¸å½“äºä¸€ä¸ªé—­åŒ…, åœ¨æ”¾å›çš„æ–¹æ³•é‡Œé¢</p><p>æ‹¿åˆ°æ’æ§½é‡Œé¢çš„ç»„ä»¶ï¼Œç»„ä»¶æ²¡æœ‰æˆ–è€…å¤šä»¥ä¸€ä¸ªï¼ŒæŠ¥é”™ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!slots.<span class="property">default</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> children = slots.<span class="title function_">default</span>()</span><br><span class="line"><span class="keyword">const</span> rawVNode = children[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p>å†æ‹¿åˆ°å¯¹åº”çš„æ–¹æ³• <code>const &#123; include, exclude, max &#125; = props</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (</span><br><span class="line">  (include &amp;&amp; (!name || !<span class="title function_">matches</span>(include, name))) ||</span><br><span class="line">  (exclude &amp;&amp; name &amp;&amp; <span class="title function_">matches</span>(exclude, name))</span><br><span class="line">) &#123;</span><br><span class="line">  current = vnode</span><br><span class="line">  <span class="keyword">return</span> rawVNode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±ä¸æ˜¯å¾ˆæ‡‚äº†ï¼Œå› ä¸ºåœ¨æˆ‘çš„é€»è¾‘é‡Œé¢ï¼ŒæŒ‰ç…§ä»–çš„è¿™ä¸ªæ¡ä»¶ï¼Œåº”è¯¥æ˜¯ä¸ä½¿ç”¨æˆ–è€…ä¸æ¸²æŸ“ï¼Œä½†æ˜¯ä»–è¿™è¾¹çš„é€»è¾‘å…¶å®æ˜¯ï¼Œæ»¡è¶³è¿™ä¸ªæ¡ä»¶ç«‹åˆ»æ¸²æŸ“ï¼Œä¸ä½¿ç”¨ç¼“å­˜ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯åˆ¤æ–­æ˜¯å¦ç¼“å­˜çš„é—®é¢˜</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¿™é‡Œæ‹¿åˆ° key, ç„¶åè·å–ç¼“å­˜</span></span><br><span class="line"><span class="keyword">const</span> key = vnode.<span class="property">key</span> == <span class="literal">null</span> ? comp : vnode.<span class="property">key</span></span><br><span class="line"><span class="keyword">const</span> cachedVNode = cache.<span class="title function_">get</span>(key)</span><br><span class="line"><span class="comment">// å°†å½“å‰çš„é”®èµ‹å€¼ç»™å¾…ç¼“å­˜çš„é”®ï¼Œä¸Šé¢è¯´æ˜äº†ï¼Œè¿™é‡Œä¼šè§¦å‘é’©å­å‡½æ•°ä¸­çš„å­æ ‘ç¼“å­˜</span></span><br><span class="line">pendingCacheKey = key</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cachedVNode) &#123;</span><br><span class="line">  <span class="comment">//å¦‚æœæœ‰ç¼“å­˜ï¼Œå¤ç”¨ç¼“å­˜</span></span><br><span class="line">  vnode.<span class="property">el</span> = cachedVNode.<span class="property">el</span></span><br><span class="line">  vnode.<span class="property">component</span> = cachedVNode.<span class="property">component</span></span><br><span class="line">  <span class="comment">//è¿™é‡Œæ˜¯åŠ¨ç”»çš„å¤„ç†ï¼Œè§¦å‘è¿‡æ¸¡åŠ¨ç”»çš„é’©å­</span></span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">transition</span>) &#123;</span><br><span class="line">    <span class="title function_">setTransitionHooks</span>(vnode, vnode.<span class="property">transition</span>!)</span><br><span class="line">  &#125;</span><br><span class="line">  vnode.<span class="property">shapeFlag</span> |= <span class="title class_">ShapeFlags</span>.<span class="property">COMPONENT_KEPT_ALIVE</span></span><br><span class="line">  <span class="comment">//æ›´æ–°key</span></span><br><span class="line">  keys.<span class="title function_">delete</span>(key)</span><br><span class="line">  keys.<span class="title function_">add</span>(key)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">//å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼ŒåŠ å…¥keyï¼Œåˆ¤æ–­maxæ•°é‡ï¼Œåˆ é™¤å¤šä½™çš„ç¼“å­˜ã€‚</span></span><br><span class="line">  keys.<span class="title function_">add</span>(key)</span><br><span class="line">  <span class="keyword">if</span> (max &amp;&amp; keys.<span class="property">size</span> &gt; <span class="built_in">parseInt</span>(max <span class="keyword">as</span> <span class="built_in">string</span>, <span class="number">10</span>)) &#123;</span><br><span class="line">    <span class="title function_">pruneCacheEntry</span>(keys.<span class="title function_">values</span>().<span class="title function_">next</span>().<span class="property">value</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯ <code>keep-alive setup</code> çš„å…¨è²Œäº†, ä¸»è¦å°±æ˜¯å£°æ˜ä¸€äº›æ–¹æ³•ï¼Œä¸»è¦æ˜¯ active, deActive, å’Œå¸è½½ç»„ä»¶ï¼Œç¼“å­˜ç®¡ç†çš„ä¸€äº›æ–¹æ³•ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºåˆ›å»ºå¤„ç†æ’æ§½ä¸­çš„æ–°ç»„ä»¶ã€‚</p><h3 id="2-deactivate"><a href="#2-deactivate" class="headerlink" title="2. deactivate"></a>2. deactivate</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">sharedContext.<span class="property">deactivate</span> = <span class="function">(<span class="params">vnode: VNode</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//è·å–å½“å‰ Vnode ç»„ä»¶</span></span><br><span class="line">  <span class="keyword">const</span> instance = vnode.<span class="property">component</span>! </span><br><span class="line">  <span class="comment">//ç§»åŠ¨èŠ‚ç‚¹åˆ° storageContainer</span></span><br><span class="line">  <span class="title function_">move</span>(vnode, storageContainer, <span class="literal">null</span>, <span class="title class_">MoveType</span>.<span class="property">LEAVE</span>, parentSuspense)</span><br><span class="line">  <span class="comment">// å¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line">  <span class="title function_">queuePostRenderEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//deactivate é’©å­è§¦å‘</span></span><br><span class="line">    <span class="keyword">if</span> (instance.<span class="property">da</span>) &#123;</span><br><span class="line">      <span class="title function_">invokeArrayFns</span>(instance.<span class="property">da</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//onVnodeUnmounted é’©å­</span></span><br><span class="line">    <span class="keyword">const</span> vnodeHook = vnode.<span class="property">props</span> &amp;&amp; vnode.<span class="property">props</span>.<span class="property">onVnodeUnmounted</span></span><br><span class="line">    <span class="keyword">if</span> (vnodeHook) &#123;</span><br><span class="line">      <span class="title function_">invokeVNodeHook</span>(vnodeHook, instance.<span class="property">parent</span>, vnode)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æ ‡è®° deactived</span></span><br><span class="line">    instance.<span class="property">isDeactivated</span> = <span class="literal">true</span></span><br><span class="line">  &#125;, parentSuspense)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (__DEV__ || __FEATURE_PROD_DEVTOOLS__) &#123;</span><br><span class="line">    <span class="comment">// Update components tree</span></span><br><span class="line">    <span class="title function_">devtoolsComponentAdded</span>(instance)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ <code>deactivate</code> å¹¶æ²¡æœ‰åˆ é™¤èŠ‚ç‚¹ï¼Œè€Œæ˜¯ç§»åŠ¨åˆ°äº† <code>storageContainer</code>, ç„¶åè°ƒç”¨é’©å­ã€‚</p><p>è¿™é‡Œæˆ‘æœ‰ä¸€ä¸ªç–‘é—®, Vue å¦‚ä½•ç”Ÿæˆä¸¤ä¸ªç»„ä»¶ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// render</span></span><br><span class="line"><span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">  <span class="title function_">startMeasure</span>(instance, <span class="string">`render`</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> nextTree = <span class="title function_">renderComponentRoot</span>(instance)</span><br><span class="line"><span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">  <span class="title function_">endMeasure</span>(instance, <span class="string">`render`</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> prevTree = instance.<span class="property">subTree</span></span><br><span class="line">instance.<span class="property">subTree</span> = nextTree</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">  <span class="title function_">startMeasure</span>(instance, <span class="string">`patch`</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">patch</span>(</span><br><span class="line">  prevTree,</span><br><span class="line">  nextTree,</span><br><span class="line">  <span class="comment">// parent may have changed if it&#x27;s in a teleport</span></span><br><span class="line">  <span class="title function_">hostParentNode</span>(prevTree.<span class="property">el</span>!)!,</span><br><span class="line">  <span class="comment">// anchor may have changed if it&#x27;s in a fragment</span></span><br><span class="line">  <span class="title function_">getNextHostNode</span>(prevTree),</span><br><span class="line">  instance,</span><br><span class="line">  parentSuspense,</span><br><span class="line">  isSVG</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æ–°ç”Ÿæˆçš„å­æ ‘å’Œè€çš„å­æ ‘è¿›è¡Œå¯¹æ¯”ï¼Œç„¶åè§£å†³</p><p>æ€»æ˜¯è¯´å­æ ‘, subTree, é‚£ä¹ˆå’Œ vnode æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿéƒ½æ˜¯è™šæ‹ŸèŠ‚ç‚¹ã€‚</p><ul><li>instance.subTree è¡¨ç¤ºç»„ä»¶çš„å­æ ‘çš„æ ¹èŠ‚ç‚¹çš„è™šæ‹ŸèŠ‚ç‚¹ã€‚</li><li>instance.vnode è¡¨ç¤ºæ•´ä¸ªç»„ä»¶çš„æ ¹èŠ‚ç‚¹çš„è™šæ‹ŸèŠ‚ç‚¹ã€‚</li></ul><p>åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿä¸€ä¸ªæ˜¯å­æ ‘ï¼Œä¸€ä¸ªæ˜¯å½“å‰èŠ‚ç‚¹ï¼Œå­æ ‘åŒ…å«å½“å‰èŠ‚ç‚¹ï¼Œä¹ŸåŒ…å«å­ç»„ä»¶çš„ã€‚</p><h3 id="3-active"><a href="#3-active" class="headerlink" title="3. active"></a>3. active</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">sharedContext.<span class="property">activate</span> = <span class="function">(<span class="params">vnode, container, anchor, isSVG, optimized</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> instance = vnode.<span class="property">component</span>!</span><br><span class="line">  <span class="title function_">move</span>(vnode, container, anchor, <span class="title class_">MoveType</span>.<span class="property">ENTER</span>, parentSuspense)</span><br><span class="line">  <span class="comment">// in case props have changed</span></span><br><span class="line">  <span class="title function_">patch</span>(</span><br><span class="line">instance.<span class="property">vnode</span>,</span><br><span class="line">vnode,</span><br><span class="line">container,</span><br><span class="line">anchor,</span><br><span class="line">instance,</span><br><span class="line">parentSuspense,</span><br><span class="line">isSVG,</span><br><span class="line">vnode.<span class="property">slotScopeIds</span>,</span><br><span class="line">optimized</span><br><span class="line">  )</span><br><span class="line">  <span class="title function_">queuePostRenderEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">instance.<span class="property">isDeactivated</span> = <span class="literal">false</span></span><br><span class="line"><span class="keyword">if</span> (instance.<span class="property">a</span>) &#123;</span><br><span class="line">  <span class="title function_">invokeArrayFns</span>(instance.<span class="property">a</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> vnodeHook = vnode.<span class="property">props</span> &amp;&amp; vnode.<span class="property">props</span>.<span class="property">onVnodeMounted</span></span><br><span class="line"><span class="keyword">if</span> (vnodeHook) &#123;</span><br><span class="line">  <span class="title function_">invokeVNodeHook</span>(vnodeHook, instance.<span class="property">parent</span>, vnode)</span><br><span class="line">&#125;</span><br><span class="line">  &#125;, parentSuspense)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (__DEV__ || __FEATURE_PROD_DEVTOOLS__) &#123;</span><br><span class="line"><span class="comment">// Update components tree</span></span><br><span class="line"><span class="title function_">devtoolsComponentAdded</span>(instance)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ instance.vnode å…¶å®æ˜¯ä¸Šä¸€ä¸ªç»„ä»¶ï¼Œvnode æ˜¯éœ€è¦æ¸²æŸ“çš„ç»„ä»¶.</p><p>move ä¼šæŠŠ <code>vnode</code> é€šè¿‡ <code>dom beforeInsert</code> åˆ° <code>container</code></p><p>patch ä¼šæŠŠ <code>vnode.el = instance.vnode.el</code> &amp;&amp; <code>instance.vnode = vnode</code></p><h3 id="4-include-exclude-max"><a href="#4-include-exclude-max" class="headerlink" title="4. include, exclude, max"></a>4. include, exclude, max</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (</span><br><span class="line">(include &amp;&amp; (!name || !<span class="title function_">matches</span>(include, name))) ||</span><br><span class="line">(exclude &amp;&amp; name &amp;&amp; <span class="title function_">matches</span>(exclude, name))</span><br><span class="line">) &#123;</span><br><span class="line">current = vnode</span><br><span class="line"><span class="keyword">return</span> rawVNode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>include å’Œ exclude, max æ˜¯åœ¨ keep-live setup å‡½æ•°çš„è¿”å›çš„å‡½æ•°ä¸­, æ ¹æ® includeï¼Œexclude æ¥åˆ¤æ–­æ˜¯å¦ç¼“å­˜</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">keys.<span class="title function_">add</span>(key)</span><br><span class="line"><span class="comment">// prune oldest entry</span></span><br><span class="line"><span class="keyword">if</span> (max &amp;&amp; keys.<span class="property">size</span> &gt; <span class="built_in">parseInt</span>(max <span class="keyword">as</span> <span class="built_in">string</span>, <span class="number">10</span>)) &#123;</span><br><span class="line">  <span class="title function_">pruneCacheEntry</span>(keys.<span class="title function_">values</span>().<span class="title function_">next</span>().<span class="property">value</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>max ä¼šåœ¨éœ€è¦ç¼“å­˜ä¹‹å‰ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ¸…ç†ç¼“å­˜ã€‚</p><h3 id="5-å¦‚ä½•ç¼“å­˜"><a href="#5-å¦‚ä½•ç¼“å­˜" class="headerlink" title="5. å¦‚ä½•ç¼“å­˜"></a>5. å¦‚ä½•ç¼“å­˜</h3><p>å…³é”®åœ¨äº <code>pendingCacheKey</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cache sub tree after render</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">pendingCacheKey</span>: <span class="title class_">CacheKey</span> | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">cacheSubtree</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// fix #1621, the pendingCacheKey could be 0</span></span><br><span class="line">  <span class="keyword">if</span> (pendingCacheKey != <span class="literal">null</span>) &#123;</span><br><span class="line">cache.<span class="title function_">set</span>(pendingCacheKey, <span class="title function_">getInnerChild</span>(instance.<span class="property">subTree</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">onMounted</span>(cacheSubtree)</span><br><span class="line"><span class="title function_">onUpdated</span>(cacheSubtree)</span><br></pre></td></tr></table></figure><p>å½“ç»„ä»¶è§¦å‘é’©å­çš„æ—¶å€™ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦è§¦å‘é’©å­ä¸­çš„ç¼“å­˜ã€‚</p><p>å¦‚æœ </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(include &amp;&amp; (!name || !<span class="title function_">matches</span>(include, name))) ||</span><br><span class="line">(exclude &amp;&amp; name &amp;&amp; <span class="title function_">matches</span>(exclude, name))</span><br></pre></td></tr></table></figure><p>ä¸é€šè¿‡çš„è¯ï¼Œå°±æ— æ³•æ‰§è¡Œ <code>pendingCacheKey = key</code> å’Œ <code>keys.add(key)</code>.</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ keep-alive ä¸‹ï¼Œç»„ä»¶æ¸²æŸ“æˆ–è€…è·Ÿæ–°å®Œæˆåï¼Œä¼šå¼€å§‹ç¼“å­˜ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> vue2 </tag>
            
            <tag> typescript </tag>
            
            <tag> keep-alive </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue3 reactive</title>
      <link href="/2023/06/29/vue3_reactive/"/>
      <url>/2023/06/29/vue3_reactive/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h1><p>è¦äº†è§£è¿™ä¸ªä¸œè¥¿ï¼Œä½ èµ·ç éœ€è¦å¯¹ Proxy å’Œ Reflect æœ‰æœ€åŸºæœ¬çš„äº†è§£</p><p>å…¶æ¬¡ï¼Œæˆ‘æ˜¯çœŸçš„è®¨åŒä¸‰ç›®è¡¨è¾¾å¼åµŒå¥—ã€‚</p><h3 id="01-createReactiveObject"><a href="#01-createReactiveObject" class="headerlink" title="01. createReactiveObject"></a>01. createReactiveObject</h3><p>å…¥å£æ–¹æ³•æ˜¯ <code>createReactiveObject</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createReactiveObject</span>(<span class="params"></span></span><br><span class="line"><span class="params">  target: Target,</span></span><br><span class="line"><span class="params">  isReadonly: <span class="built_in">boolean</span>,</span></span><br><span class="line"><span class="params">  baseHandlers: ProxyHandler&lt;<span class="built_in">any</span>&gt;,</span></span><br><span class="line"><span class="params">  collectionHandlers: ProxyHandler&lt;<span class="built_in">any</span>&gt;,</span></span><br><span class="line"><span class="params">  proxyMap: <span class="built_in">WeakMap</span>&lt;Target, <span class="built_in">any</span>&gt;</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isObject</span>(target)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`value cannot be made reactive: <span class="subst">$&#123;<span class="built_in">String</span>(target)&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// target is already a Proxy, return it.</span></span><br><span class="line">  <span class="comment">// exception: calling readonly() on a reactive object</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    target[<span class="title class_">ReactiveFlags</span>.<span class="property">RAW</span>] &amp;&amp;</span><br><span class="line">    !(isReadonly &amp;&amp; target[<span class="title class_">ReactiveFlags</span>.<span class="property">IS_REACTIVE</span>])</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// target already has corresponding Proxy</span></span><br><span class="line">  <span class="keyword">const</span> existingProxy = proxyMap.<span class="title function_">get</span>(target)</span><br><span class="line">  <span class="keyword">if</span> (existingProxy) &#123;</span><br><span class="line">    <span class="keyword">return</span> existingProxy</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// only specific value types can be observed.</span></span><br><span class="line">  <span class="keyword">const</span> targetType = <span class="title function_">getTargetType</span>(target)</span><br><span class="line">  <span class="keyword">if</span> (targetType === <span class="title class_">TargetType</span>.<span class="property">INVALID</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(</span><br><span class="line">    target,</span><br><span class="line">    targetType === <span class="title class_">TargetType</span>.<span class="property">COLLECTION</span> ? collectionHandlers : baseHandlers</span><br><span class="line">  )</span><br><span class="line">  proxyMap.<span class="title function_">set</span>(target, proxy)</span><br><span class="line">  <span class="keyword">return</span> proxy</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>!isObject(target)</code> ä¸æ˜¯ <code>Object</code> è¿”å›</p><p><code>target[ReactiveFlags.RAW] &amp;&amp; !(isReadonly &amp;&amp; target[ReactiveFlags.IS_REACTIVE])</code><br><code>target</code> åŒ…å« <code>ReactiveFlags.RAW</code> å¹¶ä¸” ä¸æ˜¯ <code>readonly</code> æˆ– <code>target</code> ä¸åŒ…å« <code>ReactiveFlags.IS_REACTIV</code> è¿”å› target</p><blockquote><p>target å·²ç»æ˜¯ Proxyï¼Œè¿”å›å®ƒã€‚<br>å¼‚å¸¸ï¼šåœ¨ååº”å¯¹è±¡ä¸Šè°ƒç”¨ readonly()</p></blockquote><p>æ¥ä¸‹æ¥åˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨è¿™ä¸ª <code>proxy</code>, åœ¨ <code>proxyMap</code> ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥è¿”å›ã€‚</p><p>ç„¶ååˆ¤æ–­å…è®¸ proxy çš„ç±»å‹</p><blockquote><p>only specific value types can be observed.</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">targetTypeMap</span>(<span class="params">rawType: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (rawType) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Object&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Array&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">TargetType</span>.<span class="property">COMMON</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Map&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Set&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;WeakMap&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;WeakSet&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">TargetType</span>.<span class="property">COLLECTION</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">TargetType</span>.<span class="property">INVALID</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getTargetType</span>(<span class="params">value: Target</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> value[<span class="title class_">ReactiveFlags</span>.<span class="property">SKIP</span>] || !<span class="title class_">Object</span>.<span class="title function_">isExtensible</span>(value)</span><br><span class="line">    ? <span class="title class_">TargetType</span>.<span class="property">INVALID</span></span><br><span class="line">    : <span class="title function_">targetTypeMap</span>(<span class="title function_">toRawType</span>(value))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»–ä¼šæŠŠä¼ å…¥åˆ†ç±»ï¼Œåˆ¤å®šæ¥æ”¶çš„ç±»å‹ï¼Œä¸æ˜¯ <code>SKIP</code> æˆ–è€…ä¸èƒ½ æ“ä½œçš„å€¼ï¼Œç„¶åé€šè¿‡ <code>Object.toString().call</code> åˆ¤å®šç±»å‹ï¼Œå¹¶ä¸”è¿”å› <code>TargetType</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(</span><br><span class="line">    target,</span><br><span class="line">    targetType === <span class="title class_">TargetType</span>.<span class="property">COLLECTION</span> ? collectionHandlers : baseHandlers</span><br><span class="line">)</span><br><span class="line">proxyMap.<span class="title function_">set</span>(target, proxy)</span><br><span class="line"><span class="keyword">return</span> proxy</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ¯”è¾ƒç®€å•å°±æ˜¯ä»£ç†ï¼Œå¹¶ä¸”åŠ å…¥ä»£ç†çš„ <code>Map</code></p><h3 id="02-handler"><a href="#02-handler" class="headerlink" title="02. handler"></a>02. handler</h3><p><code>reactive</code>, <code>shallowReactive</code>, <code>readonly</code>, <code>shallowReadonly</code> éƒ½æ˜¯åœ¨è¿™é‡Œåˆ›å»ºçš„, ä»£ç éƒ½æ˜¯é€šè¿‡ <code>createReactiveObject</code> åˆ›å»º, ä¾‹å¦‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">target: <span class="built_in">object</span></span>) &#123;</span><br><span class="line">  <span class="comment">// if trying to observe a readonly proxy, return the readonly version.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isReadonly</span>(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createReactiveObject</span>(</span><br><span class="line">    target,</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">    mutableHandlers,</span><br><span class="line">    mutableCollectionHandlers,</span><br><span class="line">    reactiveMap</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>mutableHandlers</code> &amp; <code>mutableCollectionHandlers</code>, å…ˆçœ‹ <code>mutableHandlers</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">mutableHandlers</span>: <span class="title class_">ProxyHandler</span>&lt;<span class="built_in">object</span>&gt; = &#123;</span><br><span class="line">  get,</span><br><span class="line">  set,</span><br><span class="line">  deleteProperty,</span><br><span class="line">  has,</span><br><span class="line">  ownKeys</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="04-haddler-get"><a href="#04-haddler-get" class="headerlink" title="04. haddler get"></a>04. haddler get</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createGetter</span>(<span class="params">isReadonly = <span class="literal">false</span>, shallow = <span class="literal">false</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">target: Target, key: <span class="built_in">string</span> | <span class="built_in">symbol</span>, receiver: <span class="built_in">object</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="title class_">ReactiveFlags</span>.<span class="property">IS_REACTIVE</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> !isReadonly</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="title class_">ReactiveFlags</span>.<span class="property">IS_READONLY</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> isReadonly</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="title class_">ReactiveFlags</span>.<span class="property">IS_SHALLOW</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> shallow</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">      key === <span class="title class_">ReactiveFlags</span>.<span class="property">RAW</span> &amp;&amp;</span><br><span class="line">      receiver ===</span><br><span class="line">        (isReadonly</span><br><span class="line">          ? shallow</span><br><span class="line">            ? shallowReadonlyMap</span><br><span class="line">            : readonlyMap</span><br><span class="line">          : shallow</span><br><span class="line">          ? shallowReactiveMap</span><br><span class="line">          : reactiveMap</span><br><span class="line">        ).<span class="title function_">get</span>(target)</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> target</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> targetIsArray = <span class="title function_">isArray</span>(target)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isReadonly) &#123;</span><br><span class="line">      <span class="keyword">if</span> (targetIsArray &amp;&amp; <span class="title function_">hasOwn</span>(arrayInstrumentations, key)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(arrayInstrumentations, key, receiver)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&#x27;hasOwnProperty&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> hasOwnProperty</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> res = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isSymbol</span>(key) ? builtInSymbols.<span class="title function_">has</span>(key) : <span class="title function_">isNonTrackableKeys</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isReadonly) &#123;</span><br><span class="line">      <span class="title function_">track</span>(target, <span class="title class_">TrackOpTypes</span>.<span class="property">GET</span>, key)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (shallow) &#123;</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isRef</span>(res)) &#123;</span><br><span class="line">      <span class="comment">// ref unwrapping - skip unwrap for Array + integer key.</span></span><br><span class="line">      <span class="keyword">return</span> targetIsArray &amp;&amp; <span class="title function_">isIntegerKey</span>(key) ? res : res.<span class="property">value</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isObject</span>(res)) &#123;</span><br><span class="line">      <span class="comment">// Convert returned value into a proxy as well. we do the isObject check</span></span><br><span class="line">      <span class="comment">// here to avoid invalid value warning. Also need to lazy access readonly</span></span><br><span class="line">      <span class="comment">// and reactive here to avoid circular dependency.</span></span><br><span class="line">      <span class="keyword">return</span> isReadonly ? <span class="title function_">readonly</span>(res) : <span class="title function_">reactive</span>(res)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> set = <span class="comment">/*#__PURE__*/</span> <span class="title function_">createSetter</span>()</span><br><span class="line"><span class="keyword">const</span> shallowSet = <span class="comment">/*#__PURE__*/</span> <span class="title function_">createSetter</span>(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure><p><code>createGetter</code> æ˜¯ä¸€ä¸ª <code>get</code> å·¥å‚, ç”¨äºä¸ªå„ç§ get åˆ›å»ºã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (key === <span class="title class_">ReactiveFlags</span>.<span class="property">IS_REACTIVE</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> !isReadonly</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="title class_">ReactiveFlags</span>.<span class="property">IS_READONLY</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> isReadonly</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="title class_">ReactiveFlags</span>.<span class="property">IS_SHALLOW</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> shallow</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">    key === <span class="title class_">ReactiveFlags</span>.<span class="property">RAW</span> &amp;&amp;</span><br><span class="line">    receiver ===</span><br><span class="line">    (isReadonly</span><br><span class="line">        ? shallow</span><br><span class="line">        ? shallowReadonlyMap</span><br><span class="line">        : readonlyMap</span><br><span class="line">        : shallow</span><br><span class="line">        ? shallowReactiveMap</span><br><span class="line">        : reactiveMap</span><br><span class="line">    ).<span class="title function_">get</span>(target)</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€äº›ç‰¹æ®Šå€¼ï¼Œè¿›è¡Œç‰¹æ®Šçš„è¿”å›ï¼Œæœ€åä¸€ä¸ªåˆ¤æ–­æ˜¯å¦‚æœé€šè¿‡ <code>isReadonly</code> &amp; <code>shallow</code>,æ¥åˆ¤æ–­åº”è¯¥ç”¨å“ªä¸ª <code>Map</code> æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è¿”å›ç¼“å­˜ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> targetIsArray = <span class="title function_">isArray</span>(target)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!isReadonly) &#123;</span><br><span class="line">    <span class="keyword">if</span> (targetIsArray &amp;&amp; <span class="title function_">hasOwn</span>(arrayInstrumentations, key)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(arrayInstrumentations, key, receiver)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&#x27;hasOwnProperty&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> hasOwnProperty</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æ˜¯ <code>readonly</code>, æ˜¯ <code>array</code> å¹¶ä¸” <code>arrayInstrumentations</code> åŒ…å« <code>key</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(arrayInstrumentations, key, receiver)</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ key &#x3D;&#x3D;&#x3D; â€˜hasOwnPropertyâ€™, åˆ™è¿”å›ä½¿ç”¨è¿™ä¸ªæ–¹æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hasOwnProperty</span>(<span class="params"><span class="variable language_">this</span>: <span class="built_in">object</span>, key: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> obj = <span class="title function_">toRaw</span>(<span class="variable language_">this</span>)</span><br><span class="line">  <span class="title function_">track</span>(obj, <span class="title class_">TrackOpTypes</span>.<span class="property">HAS</span>, key)</span><br><span class="line">  <span class="keyword">return</span> obj.<span class="title function_">hasOwnProperty</span>(key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦è¯´çš„æ˜¯ <code>arrayInstrumentations</code>, ä»–åŠ«æŒäº†è®¾è®¡è€…æƒ³è¦ä»£ç†çš„æ–¹æ³•</p><blockquote><p>è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºäº†æ‹¦æˆªä¸€äº›å¯¹æ•°ç»„è¿›è¡Œæ“ä½œçš„æ–¹æ³•ï¼Œä¾‹å¦‚ pushã€popã€shift ç­‰ï¼Œä»¥åŠä¸€äº›æŸ¥è¯¢æ•°ç»„çš„æ–¹æ³•ï¼Œä¾‹å¦‚ includesã€indexOfã€lastIndexOf ç­‰ã€‚å½“å¯¹è¿™äº›æ–¹æ³•è¿›è¡Œæ“ä½œæ—¶ï¼Œä¼šè°ƒç”¨ track æ–¹æ³•æ¥æ”¶é›†æ•°ç»„çš„ä¾èµ–å…³ç³»ï¼Œå¹¶åœ¨éœ€è¦æ—¶é€šè¿‡ trigger æ–¹æ³•è§¦å‘é‡æ–°æ¸²æŸ“è§†å›¾ã€‚</p><p>åŒæ—¶ï¼Œå½“è°ƒç”¨è¿™äº›æ–¹æ³•æ—¶ä¹Ÿéœ€è¦æ³¨æ„é¿å…æ— é™å¾ªç¯çš„é—®é¢˜ï¼Œå› ä¸ºä¸€äº›æ•°ç»„æ“ä½œå¯èƒ½ä¼šå¯¼è‡´é•¿åº¦æ”¹å˜ï¼Œä»è€Œå¯¼è‡´é‡æ–°è§¦å‘è¿™äº›æ–¹æ³•ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯¹äºé•¿åº¦å˜åŒ–çš„æ“ä½œæ–¹æ³•ï¼Œä¾‹å¦‚ pushã€popã€shift ç­‰ï¼Œä¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰æš‚åœä¾èµ–è¿½è¸ªï¼Œæ‰§è¡Œå®Œæ¯•åå†æ¢å¤ä¾èµ–è¿½è¸ªã€‚</p><p>æœ€ç»ˆï¼ŒcreateArrayInstrumentations æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«é’ˆå¯¹æ•°ç»„å¯¹è±¡çš„ä»£ç†æ–¹æ³•ï¼Œä¾‹å¦‚ pushã€popã€shiftã€unshiftã€spliceã€includesã€indexOfã€lastIndexOf ç­‰ã€‚è¿™äº›æ–¹æ³•è¢«ç”¨äºåœ¨ reactiveã€shallowReactiveã€readonly å’Œ shallowReadonly ç­‰å“åº”å¼æ•°æ®ç±»å‹ä¸­å¯¹æ•°ç»„å¯¹è±¡è¿›è¡Œæ‹¦æˆªå’Œä»£ç†ã€‚</p></blockquote><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createArrayInstrumentations</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">instrumentations</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="title class_">Function</span>&gt; = &#123;&#125;</span><br><span class="line">  <span class="comment">// instrument identity-sensitive Array methods to account for possible reactive</span></span><br><span class="line">  <span class="comment">// values</span></span><br><span class="line">  ;([<span class="string">&#x27;includes&#x27;</span>, <span class="string">&#x27;indexOf&#x27;</span>, <span class="string">&#x27;lastIndexOf&#x27;</span>] <span class="keyword">as</span> <span class="keyword">const</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    instrumentations[key] = <span class="keyword">function</span> (<span class="params"><span class="variable language_">this</span>: <span class="built_in">unknown</span>[], ...args: <span class="built_in">unknown</span>[]</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> arr = <span class="title function_">toRaw</span>(<span class="variable language_">this</span>) <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = <span class="variable language_">this</span>.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">        <span class="title function_">track</span>(arr, <span class="title class_">TrackOpTypes</span>.<span class="property">GET</span>, i + <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// we run the method using the original args first (which may be reactive)</span></span><br><span class="line">      <span class="keyword">const</span> res = arr[key](...args)</span><br><span class="line">      <span class="keyword">if</span> (res === -<span class="number">1</span> || res === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="comment">// if that didn&#x27;t work, run it again using raw values.</span></span><br><span class="line">        <span class="keyword">return</span> arr[key](...args.<span class="title function_">map</span>(toRaw))</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// instrument length-altering mutation methods to avoid length being tracked</span></span><br><span class="line">  <span class="comment">// which leads to infinite loops in some cases (#2137)</span></span><br><span class="line">  ;([<span class="string">&#x27;push&#x27;</span>, <span class="string">&#x27;pop&#x27;</span>, <span class="string">&#x27;shift&#x27;</span>, <span class="string">&#x27;unshift&#x27;</span>, <span class="string">&#x27;splice&#x27;</span>] <span class="keyword">as</span> <span class="keyword">const</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    instrumentations[key] = <span class="keyword">function</span> (<span class="params"><span class="variable language_">this</span>: <span class="built_in">unknown</span>[], ...args: <span class="built_in">unknown</span>[]</span>) &#123;</span><br><span class="line">      <span class="title function_">pauseTracking</span>()</span><br><span class="line">      <span class="keyword">const</span> res = (<span class="title function_">toRaw</span>(<span class="variable language_">this</span>) <span class="keyword">as</span> <span class="built_in">any</span>)[key].<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">      <span class="title function_">resetTracking</span>()</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> instrumentations</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ŠåŠéƒ¨åˆ†æ˜¯å°† æä¾› <code>[&#39;includes&#39;, &#39;indexOf&#39;, &#39;lastIndexOf&#39;]</code> æ–¹æ³•çš„åŠ«æŒï¼Œæ·»åŠ  <code>tarck</code> ä¹‹åè¿”å›ã€‚</p><p>ä¸‹åŠéƒ¨åˆ†åœ¨ <code>[&#39;push&#39;, &#39;pop&#39;, &#39;shift&#39;, &#39;unshift&#39;, &#39;splice&#39;]</code> æ‰§è¡Œçš„æ—¶å€™æš‚åœå’Œæ¢å¤ <code>track</code> </p><p>åœ¨å®Œæˆäº†ç±»æ•°ç»„çš„åŠ«æŒå, <code>const res = Reflect.get(target, key, receiver)</code> é€šè¿‡åå°„è·å–æœ¬åº”è¯¥å–åˆ°çš„å€¼ã€‚</p><p>æ¥ä¸‹æ¥ <code>if (isSymbol(key) ? builtInSymbols.has(key) : isNonTrackableKeys(key)) &#123;</code> </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> builtInSymbols = <span class="keyword">new</span> <span class="title class_">Set</span>(</span><br><span class="line">  <span class="comment">/*#__PURE__*/</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(<span class="title class_">Symbol</span>)</span><br><span class="line">    <span class="comment">// ios10.x Object.getOwnPropertyNames(Symbol) can enumerate &#x27;arguments&#x27; and &#x27;caller&#x27;</span></span><br><span class="line">    <span class="comment">// but accessing them on Symbol leads to TypeError because Symbol is a strict mode</span></span><br><span class="line">    <span class="comment">// function</span></span><br><span class="line">    .<span class="title function_">filter</span>(<span class="function"><span class="params">key</span> =&gt;</span> key !== <span class="string">&#x27;arguments&#x27;</span> &amp;&amp; key !== <span class="string">&#x27;caller&#x27;</span>)</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> (<span class="title class_">Symbol</span> <span class="keyword">as</span> <span class="built_in">any</span>)[key])</span><br><span class="line">    .<span class="title function_">filter</span>(isSymbol)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isNonTrackableKeys = <span class="comment">/*#__PURE__*/</span> <span class="title function_">makeMap</span>(<span class="string">`__proto__,__v_isRef,__isVue`</span>)</span><br></pre></td></tr></table></figure><p>ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥åˆ¤æ–­å…³é”®å­—ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!isReadonly) &#123;</span><br><span class="line">    <span class="title function_">track</span>(target, <span class="title class_">TrackOpTypes</span>.<span class="property">GET</span>, key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (shallow) &#123;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isRef</span>(res)) &#123;</span><br><span class="line">    <span class="comment">// ref unwrapping - skip unwrap for Array + integer key.</span></span><br><span class="line">    <span class="keyword">return</span> targetIsArray &amp;&amp; <span class="title function_">isIntegerKey</span>(key) ? res : res.<span class="property">value</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isObject</span>(res)) &#123;</span><br><span class="line">    <span class="comment">// Convert returned value into a proxy as well. we do the isObject check</span></span><br><span class="line">    <span class="comment">// here to avoid invalid value warning. Also need to lazy access readonly</span></span><br><span class="line">    <span class="comment">// and reactive here to avoid circular dependency.</span></span><br><span class="line">    <span class="keyword">return</span> isReadonly ? <span class="title function_">readonly</span>(res) : <span class="title function_">reactive</span>(res)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯åˆ¤æ–­å’Œè¿½è¸ªï¼Œå®šä¹‰å…¶ä»–çš„è¿”å›æˆ–è€…è¿”å›çš„åŒ…è£…ã€‚</p><p><strong>é‡æ–°å›é¡¾ä¸€ä¸‹ï¼Œè¿™ä¸ªæ–¹æ³•åšäº†ä»€ä¹ˆ</strong></p><ol><li>åˆ¤æ–­ key <code>IS_REACTIVE</code> or <code>IS_READONLY</code> or <code>IS_SHALLOW</code> è¿”å›å¯¹åº”å€¼</li><li>æ ¹æ®å‚æ•°æŸ¥æ‰¾ç¼“å­˜ï¼Œæœ‰ç¼“å­˜è¿”å›ç¼“å­˜</li><li>!Readonly å¹¶ä¸”æ˜¯ æ•°ç»„ï¼Œå¹¶ä¸”æ˜¯è¿™äº› key [â€˜includesâ€™, â€˜indexOfâ€™, â€˜lastIndexOfâ€™]ï¼Œ[â€˜pushâ€™, â€˜popâ€™, â€˜shiftâ€™, â€˜unshiftâ€™, â€˜spliceâ€™] é€šè¿‡ arrayInstrumentations æ¥åŠ«æŒå’Œè¿½è¸ªã€‚</li><li>é€šè¿‡åå°„æ‹¿åˆ°å€¼</li><li>åˆ¤æ–­ key is Symbolï¼Œ å¦‚æœæ˜¯å±äºæŸäº› Symbol å±æ€§æˆ–è€… <code>__proto__,__v_isRef,__isVue</code>ï¼Œ ç›´æ¥è¿”å›</li><li>!Readonly æƒ…å†µåŠ å…¥ track</li><li>!!shallow è¿”å›å€¼</li><li>!!ref .value è¿”å›å€¼</li><li>!!object è¿”å›å€¼ä¹Ÿè¦åŒ…è£…æˆå“åº”å¼</li><li>è¿”å›</li></ol><p>é€šè¿‡æºç åˆ†æä¸€ä¸‹å·®åˆ«</p><p>readonly ä¸åŠ å…¥ track, å…è®¸ get, è¿”å›å€¼ä¹Ÿè¦åŒ…è£…æˆ readonly(res)<br>shallow + readonly, ä¸åŠ å…¥ track, å…è®¸getï¼Œä¸å¤„ç†è¿”å›å€¼<br>reactive åŠ å…¥ track, å…è®¸get, è¿”å›å€¼ reactive(res)<br>shallow + reactive, åŠ å…¥ track, å…è®¸get, è¿”å›å€¼ä¸å¤„ç†ã€‚</p><p>è¿˜å¯ä»¥çœ‹åˆ°å…³äº</p><p>è¿™é‡Œå°±æ˜¯ä¸€ä¸ª <code>get</code>, å…¶ä»– get å¤§éƒ½ä¹Ÿæ˜¯ç”±è¿™ä¸ªå·¥å‚æ¥ç»„æˆã€‚è¿™å·®ä¸åœ¨äºå‚æ•°çš„å·®åˆ«ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const get = /*#__PURE__*/ createGetter()</span><br><span class="line">const shallowGet = /*#__PURE__*/ createGetter(false, true)</span><br><span class="line">const readonlyGet = /*#__PURE__*/ createGetter(true)</span><br><span class="line">const shallowReadonlyGet = /*#__PURE__*/ createGetter(true, true)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªè§„åˆ™ï¼Œå¯¹åº”ç€ <strong>vue</strong> çš„åˆ¤æ–­</p><blockquote><p>isReadonly &amp;&amp; shallow &#x3D; shallowReadonly<br>isReadonly &amp;&amp; !shallow &#x3D; readonly<br>!isReadonly &amp;&amp; shallow &#x3D; shallow<br>!isReadonly &amp;&amp; !shallow &#x3D; reactiveMap</p></blockquote><h3 id="05-handler-set"><a href="#05-handler-set" class="headerlink" title="05. handler set"></a>05. handler set</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createSetter</span>(<span class="params">shallow = <span class="literal">false</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params"></span></span><br><span class="line"><span class="params">    target: <span class="built_in">object</span>,</span></span><br><span class="line"><span class="params">    key: <span class="built_in">string</span> | <span class="built_in">symbol</span>,</span></span><br><span class="line"><span class="params">    value: <span class="built_in">unknown</span>,</span></span><br><span class="line"><span class="params">    receiver: <span class="built_in">object</span></span></span><br><span class="line"><span class="params">  </span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> oldValue = (target <span class="keyword">as</span> <span class="built_in">any</span>)[key]</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isReadonly</span>(oldValue) &amp;&amp; <span class="title function_">isRef</span>(oldValue) &amp;&amp; !<span class="title function_">isRef</span>(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!shallow) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="title function_">isShallow</span>(value) &amp;&amp; !<span class="title function_">isReadonly</span>(value)) &#123;</span><br><span class="line">        oldValue = <span class="title function_">toRaw</span>(oldValue)</span><br><span class="line">        value = <span class="title function_">toRaw</span>(value)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="title function_">isArray</span>(target) &amp;&amp; <span class="title function_">isRef</span>(oldValue) &amp;&amp; !<span class="title function_">isRef</span>(value)) &#123;</span><br><span class="line">        oldValue.<span class="property">value</span> = value</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// in shallow mode, objects are set as-is regardless of reactive or not</span></span><br><span class="line">      <span class="comment">// åœ¨æµ…å±‚æ¨¡å¼ä¸‹ï¼Œæ— è®ºååº”ä¸å¦ï¼Œå¯¹è±¡éƒ½æŒ‰åŸæ ·è®¾ç½®</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> hadKey =</span><br><span class="line">      <span class="title function_">isArray</span>(target) &amp;&amp; <span class="title function_">isIntegerKey</span>(key)</span><br><span class="line">        ? <span class="title class_">Number</span>(key) &lt; target.<span class="property">length</span></span><br><span class="line">        : <span class="title function_">hasOwn</span>(target, key)</span><br><span class="line">    <span class="keyword">const</span> result = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, value, receiver)</span><br><span class="line">    <span class="comment">// don&#x27;t trigger if target is something up in the prototype chain of original</span></span><br><span class="line">    <span class="keyword">if</span> (target === <span class="title function_">toRaw</span>(receiver)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!hadKey) &#123;</span><br><span class="line">        <span class="title function_">trigger</span>(target, <span class="title class_">TriggerOpTypes</span>.<span class="property">ADD</span>, key, value)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">hasChanged</span>(value, oldValue)) &#123;</span><br><span class="line">        <span class="title function_">trigger</span>(target, <span class="title class_">TriggerOpTypes</span>.<span class="property">SET</span>, key, value, oldValue)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>set</code> ç›¸å¯¹ç®€å•ä¸€äº›</p><ol><li>æ‹¿åˆ°è€å€¼</li><li>!!readonly retrun false</li><li>isRef(oldValue) &amp;&amp; !isRef(value) return false</li><li>!shallow ä¸æ˜¯ shallow ä¹Ÿä¸æ˜¯ readonly, èµ‹å€¼ oldValueï¼Œ value.</li><li>!shallow ä¸æ˜¯æ•°ç»„ï¼ŒisRef(oldValue) &amp;&amp; !isRef(value) oldValue.value &#x3D; value</li><li>haskey éªŒè¯äº†key æ˜¯å¦å­˜åœ¨ï¼Œä¸ç®¡æ˜¯æ•°ç»„è¿˜æ˜¯object</li><li>åå°„set, å¾—åˆ°result</li><li>å¯¹æ¯”åŸå§‹å¯¹è±¡ï¼Œå¦‚æœä¸ä¸€è‡´ä¸è§¦å‘</li><li>hadKey trigger</li><li>!hadKey &amp;&amp; æ–°æ—§å€¼ä¸ä¸€è‡´ trigger</li></ol><h3 id="06-handler-other"><a href="#06-handler-other" class="headerlink" title="06. handler other"></a>06. handler other</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deleteProperty</span>(<span class="params">target: <span class="built_in">object</span>, key: <span class="built_in">string</span> | <span class="built_in">symbol</span></span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> hadKey = <span class="title function_">hasOwn</span>(target, key)</span><br><span class="line">  <span class="keyword">const</span> oldValue = (target <span class="keyword">as</span> <span class="built_in">any</span>)[key]</span><br><span class="line">  <span class="keyword">const</span> result = <span class="title class_">Reflect</span>.<span class="title function_">deleteProperty</span>(target, key)</span><br><span class="line">  <span class="keyword">if</span> (result &amp;&amp; hadKey) &#123;</span><br><span class="line">    <span class="title function_">trigger</span>(target, <span class="title class_">TriggerOpTypes</span>.<span class="property">DELETE</span>, key, <span class="literal">undefined</span>, oldValue)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">has</span>(<span class="params">target: <span class="built_in">object</span>, key: <span class="built_in">string</span> | <span class="built_in">symbol</span></span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="title class_">Reflect</span>.<span class="title function_">has</span>(target, key)</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isSymbol</span>(key) || !builtInSymbols.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">    <span class="title function_">track</span>(target, <span class="title class_">TrackOpTypes</span>.<span class="property">HAS</span>, key)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ownKeys</span>(<span class="params">target: <span class="built_in">object</span></span>): (<span class="built_in">string</span> | <span class="built_in">symbol</span>)[] &#123;</span><br><span class="line">  <span class="title function_">track</span>(target, <span class="title class_">TrackOpTypes</span>.<span class="property">ITERATE</span>, <span class="title function_">isArray</span>(target) ? <span class="string">&#x27;length&#x27;</span> : <span class="variable constant_">ITERATE_KEY</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(target)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="07-é—®é¢˜"><a href="#07-é—®é¢˜" class="headerlink" title="07. é—®é¢˜"></a>07. é—®é¢˜</h3><p>å…³äº <code>toRaw</code> æˆ‘çŸ¥é“ä»–æ˜¯å»æ‰¾åŸç”Ÿå¯¹è±¡, ä½†æ˜¯ç¡®å®æ²¡æ‰¾åˆ°èµ‹å€¼çš„åœ°æ–¹ã€‚</p><p>è¿˜æœ‰å°±æ˜¯ä¸å¤ªæ˜ç™½ä»£ç†ä¸€äº›éå†çš„å±æ€§å¹²ä»€ä¹ˆ, æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</p><p>è¿˜æ˜¯éœ€è¦åé¢å¸¦ç€é—®é¢˜å»è¯»ä¸€ä¸‹ã€‚</p><h3 id="08-æ€»ç»“"><a href="#08-æ€»ç»“" class="headerlink" title="08. æ€»ç»“"></a>08. æ€»ç»“</h3><p>æˆ‘è¿™é‡Œå¹¶æ²¡æœ‰çœ‹ collectionHandlers.ts ä»£ç ï¼Œä¸ç„¶å†™çš„å¤ªé•¿äº†</p><p><code>reactive</code> ä¸æ”¯æŒ <code>typeof x != object</code> çš„å‚æ•°ï¼Œ åªæ¥å— <code>Objectï¼ŒArrayï¼ŒMapï¼ŒSetï¼ŒWeakMapï¼ŒWeakSet</code> ç±»å‹ï¼Œå…¶ä»–ç±»å‹ç›´æ¥ä¸åšå“åº”å¼å¤„ç†ã€‚</p><p>è¿™é‡Œè¯´æ˜äº†åŸºç¡€ç±»å‹åº”è¯¥ä½¿ç”¨ refï¼ŒéåŸºç¡€ç±»å‹åº”è¯¥ä½¿ç”¨ reactive, æŒ‰ç…§ä¹‹å‰çš„ ref çš„æºç </p><p>é€šè¿‡çœ‹ ref.ts å’Œ reactive.ts æºç çŸ¥é“äº†ä¸€äº›ä¸œè¥¿ã€‚</p><ol><li>ref get set è§¦å‘å“åº”å¼ï¼Œå¦‚æœæ”¹é‡Œé¢çš„ä¸œè¥¿ï¼Œé€šè¿‡ reactive è§¦å‘å“åº”å¼ã€‚</li><li>reactive é€šè¿‡ Proxy ä»£ç†è§¦å‘å“åº”å¼</li><li>å¸¦æœ‰ shallow è¡¨ç¤ºåªå¤„ç†æµ…å±‚ã€‚</li><li>å› ä¸ºæœºåˆ¶é—®é¢˜ï¼Œå»ºè®® ref ç”¨åŸºç¡€ç±»å‹ï¼Œå¤æ‚ç±»å‹ä½¿ç”¨ reactive</li><li>readonly æ˜¯é€šè¿‡ proxy get è¿”å› readony(v) ï¼Œsetï¼Œdelete ä»£ç†æ¥ä¿è¯åªè¯»ã€‚</li><li>reactive åªæ”¯æŒ Object, Array, Map, Set, WeakMap, WeakSet çš„å“åº”å¼ï¼Œå…¶ä»–ä¸ä¼šåŠ«æŒã€‚</li></ol></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> æºç  </tag>
            
            <tag> reactive </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue3 ref</title>
      <link href="/2023/06/29/vue3_ref/"/>
      <url>/2023/06/29/vue3_ref/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h1><h3 id="01-ä»£ç "><a href="#01-ä»£ç " class="headerlink" title="01. ä»£ç "></a>01. ä»£ç </h3><p><strong>packages\reactivity\src\ref.ts</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RefImpl</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">_value</span>: T</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">_rawValue</span>: T</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> dep?: <span class="title class_">Dep</span> = <span class="literal">undefined</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">readonly</span> __v_isRef = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">value: T, <span class="keyword">public</span> <span class="keyword">readonly</span> __v_isShallow: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_rawValue</span> = __v_isShallow ? value : <span class="title function_">toRaw</span>(value)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_value</span> = __v_isShallow ? value : <span class="title function_">toReactive</span>(value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">    <span class="title function_">trackRefValue</span>(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_value</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> <span class="title function_">value</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> useDirectValue =</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">__v_isShallow</span> || <span class="title function_">isShallow</span>(newVal) || <span class="title function_">isReadonly</span>(newVal)</span><br><span class="line">    newVal = useDirectValue ? newVal : <span class="title function_">toRaw</span>(newVal)</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">hasChanged</span>(newVal, <span class="variable language_">this</span>.<span class="property">_rawValue</span>)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_rawValue</span> = newVal</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_value</span> = useDirectValue ? newVal : <span class="title function_">toReactive</span>(newVal)</span><br><span class="line">      <span class="title function_">triggerRefValue</span>(<span class="variable language_">this</span>, newVal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯ <code>ref</code> æ ¸å¿ƒä»£ç , ä¸ç®¡æ˜¯åˆ›å»º <code>ref</code> æˆ–è€… <code>shallowRef</code> éƒ½æ˜¯é€šè¿‡ <code>RefImpl</code> å»å®ç°çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">export function shallowRef(value?: unknown) &#123;</span><br><span class="line">  return createRef(value, true)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function createRef(rawValue: unknown, shallow: boolean) &#123;</span><br><span class="line">  if (isRef(rawValue)) &#123;</span><br><span class="line">    return rawValue</span><br><span class="line">  &#125;</span><br><span class="line">  return new RefImpl(rawValue, shallow)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆçœ‹çœ‹ä»–çš„<strong>æ„é€ å‡½æ•°</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">constructor</span>(<span class="params">value: T, <span class="keyword">public</span> <span class="keyword">readonly</span> __v_isShallow: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_rawValue</span> = __v_isShallow ? value : <span class="title function_">toRaw</span>(value)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_value</span> = __v_isShallow ? value : <span class="title function_">toReactive</span>(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦çŸ¥é“ <code>toRaw</code> å’Œ <code>toReactive</code> æ˜¯åšä»€ä¹ˆçš„</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="keyword">enum</span> <span class="title class_">ReactiveFlags</span> &#123;</span><br><span class="line">  <span class="variable constant_">SKIP</span> = <span class="string">&#x27;__v_skip&#x27;</span>,</span><br><span class="line">  <span class="variable constant_">IS_REACTIVE</span> = <span class="string">&#x27;__v_isReactive&#x27;</span>,</span><br><span class="line">  <span class="variable constant_">IS_READONLY</span> = <span class="string">&#x27;__v_isReadonly&#x27;</span>,</span><br><span class="line">  <span class="variable constant_">IS_SHALLOW</span> = <span class="string">&#x27;__v_isShallow&#x27;</span>,</span><br><span class="line">  <span class="variable constant_">RAW</span> = <span class="string">&#x27;__v_raw&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Target</span> &#123;</span><br><span class="line">  [<span class="title class_">ReactiveFlags</span>.<span class="property">SKIP</span>]?: <span class="built_in">boolean</span></span><br><span class="line">  [<span class="title class_">ReactiveFlags</span>.<span class="property">IS_REACTIVE</span>]?: <span class="built_in">boolean</span></span><br><span class="line">  [<span class="title class_">ReactiveFlags</span>.<span class="property">IS_READONLY</span>]?: <span class="built_in">boolean</span></span><br><span class="line">  [<span class="title class_">ReactiveFlags</span>.<span class="property">IS_SHALLOW</span>]?: <span class="built_in">boolean</span></span><br><span class="line">  [<span class="title class_">ReactiveFlags</span>.<span class="property">RAW</span>]?: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>SKIPï¼šç”¨äºæ ‡è®°ä¸éœ€è¦ä»£ç†ä¸ºå“åº”å¼çš„å±æ€§<br>IS_REACTIVEï¼šç”¨äºæ ‡è®°å¯¹è±¡æ˜¯å¦ä¸ºå“åº”å¼çš„<br>IS_READONLYï¼šç”¨äºæ ‡è®°å¯¹è±¡æ˜¯å¦ä¸ºåªè¯»çš„<br>IS_SHALLOWï¼šç”¨äºæ ‡è®°å¯¹è±¡æ˜¯å¦è¿›è¡Œäº†æµ…å±‚ä»£ç†<br>RAWï¼šç”¨äºå­˜å‚¨å¯¹è±¡çš„åŸå§‹å€¼ï¼Œæ–¹ä¾¿åœ¨éœ€è¦æ—¶è·å–</p></blockquote><p>è¿™é‡Œç†è§£ä¸ºä¸€ä¸ªå¯¹è±¡æœ‰æ ‡è®°ï¼Œæ¯”å¦‚å¯¹è±¡æ˜¯ <code>let o = &#123; a:1 &#125;</code>ï¼Œé‚£ä¹ˆè¿™äº›æ ‡è®°ï¼Œå°±æ˜¯è¡¨ç¤ºå¯¹è±¡çš„å±æ€§ï¼Œæ„ä¹‰å¦‚ä¸Š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> toRaw&lt;T&gt;(<span class="attr">observed</span>: T): T &#123;</span><br><span class="line">  <span class="keyword">const</span> raw = observed &amp;&amp; (observed <span class="keyword">as</span> <span class="title class_">Target</span>)[<span class="title class_">ReactiveFlags</span>.<span class="property">RAW</span>]</span><br><span class="line">  <span class="keyword">return</span> raw ? <span class="title function_">toRaw</span>(raw) : observed</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>toRaw</code> å°±æ˜¯é€’å½’è·å–ç”¨äºå­˜å‚¨å¯¹è±¡çš„åŸå§‹å€¼ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯ <code>toReactive</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> toReactive = &lt;T <span class="keyword">extends</span> <span class="built_in">unknown</span>&gt;(<span class="attr">value</span>: T): <span class="function"><span class="params">T</span> =&gt;</span></span><br><span class="line">  <span class="title function_">isObject</span>(value) ? <span class="title function_">reactive</span>(value) : value</span><br></pre></td></tr></table></figure><p><strong>packages\reactivity\src\reactive.ts</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">target: <span class="built_in">object</span></span>) &#123;</span><br><span class="line">  <span class="comment">// if trying to observe a readonly proxy, return the readonly version.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isReadonly</span>(target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createReactiveObject</span>(</span><br><span class="line">    target,</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">    mutableHandlers,</span><br><span class="line">    mutableCollectionHandlers,</span><br><span class="line">    reactiveMap</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯å¦‚æœæ˜¯ä¸€ä¸ª <code>object</code> ç›´æ¥å°†å¯¹è±¡å“åº”å¼, ä¹Ÿå°±æ˜¯ <code>reactive</code>, ä¼šæŠŠå¯¹è±¡è½¬ä¸º <code>proxy</code></p><p>ç°åœ¨æˆ‘ä»¬å›åˆ°æ„é€ å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">constructor</span>(<span class="params">value: T, <span class="keyword">public</span> <span class="keyword">readonly</span> __v_isShallow: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_rawValue</span> = __v_isShallow ? value : <span class="title function_">toRaw</span>(value)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_value</span> = __v_isShallow ? value : <span class="title function_">toReactive</span>(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ <code>__v_isShallow</code> <strong>true</strong>, ä¹Ÿå°±æ˜¯ <code>shallowRef</code>, ä¸¤ä¸ªå€¼ä¼šå­˜å‚¨åŸå§‹å€¼<br>å¦‚æœæ˜¯ <code>__v_isShallow</code> <strong>false</strong>, ä¹Ÿå°±æ˜¯ <code>ref</code></p><p>this._rawValue &#x3D; valueçš„åŸå§‹å€¼<br>this._value &#x3D; è½¬æ¢ä¸º <code>reactive</code> å¯¹è±¡</p><p><strong>å–å€¼å’Œèµ‹å€¼</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">    <span class="title function_">trackRefValue</span>(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_value</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> <span class="title function_">value</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> useDirectValue =</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">__v_isShallow</span> || <span class="title function_">isShallow</span>(newVal) || <span class="title function_">isReadonly</span>(newVal)</span><br><span class="line">    newVal = useDirectValue ? newVal : <span class="title function_">toRaw</span>(newVal)</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">hasChanged</span>(newVal, <span class="variable language_">this</span>.<span class="property">_rawValue</span>)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_rawValue</span> = newVal</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_value</span> = useDirectValue ? newVal : <span class="title function_">toReactive</span>(newVal)</span><br><span class="line">        <span class="title function_">triggerRefValue</span>(<span class="variable language_">this</span>, newVal)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆå‡ºæ¥äº†ä¸¤ä¸ªæ–°çš„æ–¹æ³•ï¼Œ<code>trackRefValue</code> å’Œ <code>triggerRefValue</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">trackRefValue</span>(<span class="params">ref: RefBase&lt;<span class="built_in">any</span>&gt;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (shouldTrack &amp;&amp; activeEffect) &#123;</span><br><span class="line">    ref = <span class="title function_">toRaw</span>(ref)</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="title function_">trackEffects</span>(ref.<span class="property">dep</span> || (ref.<span class="property">dep</span> = <span class="title function_">createDep</span>()), &#123;</span><br><span class="line">        <span class="attr">target</span>: ref,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">TrackOpTypes</span>.<span class="property">GET</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;value&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">trackEffects</span>(ref.<span class="property">dep</span> || (ref.<span class="property">dep</span> = <span class="title function_">createDep</span>()))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">triggerRefValue</span>(<span class="params">ref: RefBase&lt;<span class="built_in">any</span>&gt;, newVal?: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  ref = <span class="title function_">toRaw</span>(ref)</span><br><span class="line">  <span class="keyword">const</span> dep = ref.<span class="property">dep</span></span><br><span class="line">  <span class="keyword">if</span> (dep) &#123;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="title function_">triggerEffects</span>(dep, &#123;</span><br><span class="line">        <span class="attr">target</span>: ref,</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">TriggerOpTypes</span>.<span class="property">SET</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;value&#x27;</span>,</span><br><span class="line">        <span class="attr">newValue</span>: newVal</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">triggerEffects</span>(dep)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨Vue2.0å½“ä¸­ï¼Œä¼šåœ¨ <code>Object.defineProperty</code> é€šè¿‡ <code>get</code> å’Œ <code>set</code> åŠ«æŒå»è§£å†³å“åº”å¼çš„æ ¸å¿ƒé—®é¢˜ï¼Œè‡³å°‘ç°åœ¨æ¥è¯´ <code>ref</code> å…¶å®æ˜¯é€šè¿‡è®¿é—®å™¨ä¸­æ·»åŠ ä»£ç å»è§£å†³çš„çš„, <code>get trackRefValue</code> æ”¶é›†ä¾èµ–ï¼Œ<code>set triggerEffects</code> è§¦å‘ä¾èµ–ï¼Œç„¶åå›è°ƒã€‚</p><p>é‰´äºç›®å‰ï¼Œæˆ‘è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šå…¶ä¸­å®ç°è¿‡ç¨‹ï¼Œå…ˆæš‚æ—¶ç®€å•çš„ç†è§£ä¸ºä¸‹é¢å†…å®¹</p><blockquote><p>trackRefValue å‡½æ•°ç”¨äºè¿½è¸ªå“åº”å¼å¼•ç”¨å¯¹è±¡çš„å˜åŒ–ä¾èµ–ï¼Œå°†å½“å‰æ´»åŠ¨çš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆå³å½“å‰è°ƒç”¨ trackRefValue å‡½æ•°çš„å‡½æ•°ï¼‰æ·»åŠ åˆ°å“åº”å¼å¼•ç”¨å¯¹è±¡çš„ä¾èµ–é›†åˆä¸­ã€‚åœ¨å¼•ç”¨å¯¹è±¡çš„å€¼è¢«ä¿®æ”¹æ—¶ï¼Œä¼šè§¦å‘ç›¸å…³çš„ä¾èµ–æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p><p>triggerRefValue å‡½æ•°ç”¨äºè§¦å‘å“åº”å¼å¼•ç”¨å¯¹è±¡çš„ä¾èµ–æ›´æ–°ï¼Œä¼šä¾æ¬¡æ‰§è¡Œå“åº”å¼å¼•ç”¨å¯¹è±¡çš„æ‰€æœ‰ä¾èµ–ï¼Œè°ƒç”¨å®ƒä»¬çš„å›è°ƒå‡½æ•°ï¼Œä»¥å®ç°å“åº”å¼æ•°æ®çš„è‡ªåŠ¨æ›´æ–°ã€‚åŒæ—¶ï¼Œå®ƒè¿˜ä¼šè§¦å‘ä¾èµ–äºå¼•ç”¨å¯¹è±¡çš„ computed ä»¥åŠ watchEffect ç­‰å“åº”å¼å‡½æ•°çš„æ›´æ–°ã€‚</p></blockquote><p>åœ¨å¤§æ¦‚æ¸…æ¥šäº†è¿™ä¸ªæ¦‚å¿µä»¥åï¼Œæˆ‘ä»¬å¯ä»¥å›è¿‡å¤´çœ‹è®¿é—®å™¨ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">    <span class="title function_">trackRefValue</span>(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>dep</code> ä¸­æ–°å¢ä¸€ä¸ªä¾èµ–ï¼Œç„¶åè¿”å› <code>_value</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="title function_">value</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> useDirectValue =</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">__v_isShallow</span> || <span class="title function_">isShallow</span>(newVal) || <span class="title function_">isReadonly</span>(newVal)</span><br><span class="line">    newVal = useDirectValue ? newVal : <span class="title function_">toRaw</span>(newVal)</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">hasChanged</span>(newVal, <span class="variable language_">this</span>.<span class="property">_rawValue</span>)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_rawValue</span> = newVal</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_value</span> = useDirectValue ? newVal : <span class="title function_">toReactive</span>(newVal)</span><br><span class="line">        <span class="title function_">triggerRefValue</span>(<span class="variable language_">this</span>, newVal)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­ <code>newVal</code> ï¼Œ <code>this.__v_isShallow || isShallow(newVal) || isReadonly(newVal)</code></p><blockquote><p>IS_READONLYï¼šç”¨äºæ ‡è®°å¯¹è±¡æ˜¯å¦ä¸ºåªè¯»çš„<br>IS_SHALLOWï¼šç”¨äºæ ‡è®°å¯¹è±¡æ˜¯å¦è¿›è¡Œäº†æµ…å±‚ä»£ç†</p></blockquote><p>ä¸»è¦ç”¨äºåŒºåˆ†æ˜¯å¦æ˜¯æµ…å±‚ä»£ç†ï¼Œå¦‚æœæ˜¯ <code>newVal</code> ç­‰äºæœ¬èº«ï¼Œå¦‚æœä¸æ˜¯ï¼Œé€šè¿‡ <code>toRaw</code> è¿”å›åŸå§‹å€¼</p><p>æ¥ä¸‹æ¥å¯¹æ¯”æ–°çš„å€¼å’ŒåŸå§‹å€¼æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´</p><p>å­˜å‚¨åŸå§‹å€¼ï¼Œå¹¶ä¸”æ ¹æ® useDirectValueï¼Œæ˜¯å¦å“åº”å¼å¤„ç† newVal, æœ€åè§¦å‘è¿½è¸ªï¼Œæ›´æ–°ã€‚</p><h3 id="02-æ¢³ç†"><a href="#02-æ¢³ç†" class="headerlink" title="02. æ¢³ç†"></a>02. æ¢³ç†</h3><p><code>RefImpl</code> åªæä¾› value è®¿é—®å™¨</p><p>å¦‚æœæ˜¯ shallowRef, å¹¶ä¸å¯¹å€¼åšå“åº”å¼å¤„ç†ï¼Œä»–çš„å“åº”å¼åªæ˜¯åœ¨ getï¼Œset ä¸­è¿›è¡Œä¾èµ–æ”¶é›†å’Œè§¦å‘ï¼Œä½ è¾“å…¥ä»€ä¹ˆï¼Œé‚£ä¹ˆæˆ‘æ¥æ”¶ä»€ä¹ˆï¼Œæˆ‘ä¹Ÿè¿”å›ä»€ä¹ˆã€‚</p><p>å¦‚æœæ˜¯ ref, åœ¨ shallowRef çš„åŸºç¡€ä¹‹ä¸Šï¼Œå¢åŠ äº†å¯¹äºå€¼çš„å“åº”å¼ï¼Œè¾“å…¥å€¼ï¼Œè¿”å›å“åº”å¼å¤„ç†ä»¥åçš„å€¼ï¼Œå…¶ä»–ä¸€æ ·ã€‚</p><p>æ‰€ä»¥ ref å’Œ shallowRef ä¸¤è€…çš„ç›¸åŒå’Œä¸åŒå°±å¾ˆæ˜æ˜¾äº†ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> æºç  </tag>
            
            <tag> ref </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue destroyed vs onUnmounted</title>
      <link href="/2023/06/29/vue_destroyed_onUnmounted/"/>
      <url>/2023/06/29/vue_destroyed_onUnmounted/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="vue-destroyed-vs-onUnmounted"><a href="#vue-destroyed-vs-onUnmounted" class="headerlink" title="vue destroyed vs onUnmounted"></a>vue destroyed vs onUnmounted</h1><p>beforeCreate -&gt; setup()<br>created -&gt; setup()<br>beforeMount -&gt; onBeforeMount<br>mounted -&gt; onMounted<br>beforeUpdate -&gt; onBeforeUpdate<br>updated -&gt; onUpdated<br>beforeDestroy -&gt; onBeforeUnmount<br>destroyed -&gt; onUnmounted<br>activated -&gt; onActivated<br>deactivated -&gt; onDeactivated<br>errorCaptured -&gt; onErrorCaptured</p><h3 id="Vue3-x-onUnmounted"><a href="#Vue3-x-onUnmounted" class="headerlink" title="Vue3.x onUnmounted"></a>Vue3.x onUnmounted</h3><p>é¦–å…ˆä¹‹å‰å°±çŸ¥é“äº†å¸è½½æµç¨‹æ€ä¹ˆè§¦å‘çš„</p><p>v-if çš„è¯ï¼Œ <code>proxy set =&gt; trigger =&gt; effect =&gt; effect.scheduler() =&gt; effect.run() =&gt; componentUpdateFn =&gt; patch =&gt; unmount =&gt; è§¦å‘ unmountComponent å‡½æ•°</code> </p><p>é‚£ç»§ç»­çœ‹å¸¦æ³¨é‡Šçš„ <code>unmountComponent</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">unmountComponent</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  instance: ComponentInternalInstance,</span></span><br><span class="line"><span class="params">  parentSuspense: SuspenseBoundary | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">  doRemove?: <span class="built_in">boolean</span></span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// æ£€æŸ¥ç»„ä»¶æ˜¯å¦å­˜åœ¨çƒ­æ¨¡å—æ›¿æ¢æ ‡è¯†ï¼Œå¦‚æœå­˜åœ¨åˆ™æ³¨é”€çƒ­æ¨¡å—æ›¿æ¢</span></span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; instance.<span class="property">type</span>.<span class="property">__hmrId</span>) &#123;</span><br><span class="line">    <span class="title function_">unregisterHMR</span>(instance)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä»ç»„ä»¶å®ä¾‹ä¸­è·å–ç›¸å…³å±æ€§</span></span><br><span class="line">  <span class="keyword">const</span> &#123; bum, scope, update, subTree, um &#125; = instance</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è§¦å‘ç»„ä»¶çš„ beforeUnmount é’©å­å‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (bum) &#123;</span><br><span class="line">    <span class="title function_">invokeArrayFns</span>(bum)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœå¯ç”¨äº†å…¼å®¹æ¨¡å¼ï¼Œå¹¶ä¸”è¯¥ç»„ä»¶å¯ç”¨äº†å®ä¾‹äº‹ä»¶é’©å­ï¼ˆå·²åºŸå¼ƒï¼‰</span></span><br><span class="line">  <span class="comment">// è§¦å‘ç»„ä»¶çš„ beforeDestroy äº‹ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    __COMPAT__ &amp;&amp;</span><br><span class="line">    <span class="title function_">isCompatEnabled</span>(<span class="title class_">DeprecationTypes</span>.<span class="property">INSTANCE_EVENT_HOOKS</span>, instance)</span><br><span class="line">  ) &#123;</span><br><span class="line">    instance.<span class="title function_">emit</span>(<span class="string">&#x27;hook:beforeDestroy&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœæ­¢ç»„ä»¶å®ä¾‹çš„ä½œç”¨åŸŸå†…çš„å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œ</span></span><br><span class="line">  scope.<span class="title function_">stop</span>()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœç»„ä»¶å®ä¾‹çš„æ›´æ–°å‡½æ•°å­˜åœ¨</span></span><br><span class="line">  <span class="keyword">if</span> (update) &#123;</span><br><span class="line">    <span class="comment">// å°†æ›´æ–°å‡½æ•°çš„ active å±æ€§è®¾ä¸º falseï¼Œä½¿è°ƒåº¦ç¨‹åºä¸å†è°ƒç”¨å®ƒ</span></span><br><span class="line">    update.<span class="property">active</span> = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨ unmount å‡½æ•°å¸è½½ç»„ä»¶çš„å­æ ‘</span></span><br><span class="line">    <span class="title function_">unmount</span>(subTree, instance, parentSuspense, doRemove)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è§¦å‘ç»„ä»¶çš„ unmounted é’©å­å‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (um) &#123;</span><br><span class="line">    <span class="title function_">queuePostRenderEffect</span>(um, parentSuspense)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœå¯ç”¨äº†å…¼å®¹æ¨¡å¼ï¼Œå¹¶ä¸”è¯¥ç»„ä»¶å¯ç”¨äº†å®ä¾‹äº‹ä»¶é’©å­ï¼ˆå·²åºŸå¼ƒï¼‰</span></span><br><span class="line">  <span class="comment">// è§¦å‘ç»„ä»¶çš„ destroyed äº‹ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    __COMPAT__ &amp;&amp;</span><br><span class="line">    <span class="title function_">isCompatEnabled</span>(<span class="title class_">DeprecationTypes</span>.<span class="property">INSTANCE_EVENT_HOOKS</span>, instance)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="title function_">queuePostRenderEffect</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> instance.<span class="title function_">emit</span>(<span class="string">&#x27;hook:destroyed&#x27;</span>),</span><br><span class="line">      parentSuspense</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†ç»„ä»¶å®ä¾‹çš„ isUnmounted å±æ€§è®¾ä¸º true</span></span><br><span class="line">  <span class="title function_">queuePostRenderEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    instance.<span class="property">isUnmounted</span> = <span class="literal">true</span></span><br><span class="line">  &#125;, parentSuspense)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœå¯ç”¨äº† SUSPENSE ç‰¹æ€§ï¼Œå¹¶ä¸”å­˜åœ¨çˆ¶çº§æ‚¬æŒ‚ç‚¹ã€æŒ‚èµ·åˆ†æ”¯æœªè§£å†³ã€</span></span><br><span class="line">  <span class="comment">// ç»„ä»¶å®ä¾‹å­˜åœ¨å¼‚æ­¥ä¾èµ–é¡¹ã€å¼‚æ­¥ä¾èµ–é¡¹æœªè§£å†³ï¼Œå¹¶ä¸”è¯¥ç»„ä»¶å®ä¾‹çš„ suspenseId ç­‰äº</span></span><br><span class="line">  <span class="comment">// çˆ¶çº§æ‚¬æŒ‚ç‚¹çš„ pendingIdï¼Œåˆ™å¤„ç†æ‚¬æŒ‚ç‚¹çš„ä¾èµ–é¡¹</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    __FEATURE_SUSPENSE__ &amp;&amp;</span><br><span class="line">    parentSuspense &amp;&amp;</span><br><span class="line">    parentSuspense.<span class="property">pendingBranch</span> &amp;&amp;</span><br><span class="line">    !parentSuspense.<span class="property">isUnmounted</span> &amp;&amp;</span><br><span class="line">    instance.<span class="property">asyncDep</span> &amp;&amp;</span><br><span class="line">    !instance.<span class="property">asyncResolved</span> &amp;&amp;</span><br><span class="line">    instance.<span class="property">suspenseId</span> === parentSuspense.<span class="property">pendingId</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    parentSuspense.<span class="property">deps</span>--</span><br><span class="line">    <span class="keyword">if</span> (parentSuspense.<span class="property">deps</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      parentSuspense.<span class="title function_">resolve</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯å¼€å‘ç¯å¢ƒæˆ–è€…å¯ç”¨äº†ç”Ÿäº§/å¼€å‘å·¥å…·çš„ç‰¹æ€§ï¼Œé€šçŸ¥å¼€å‘å·¥å…·è¯¥ç»„ä»¶å·²è¢«ç§»é™¤</span></span><br><span class="line">  <span class="keyword">if</span> (__DEV__ || __FEATURE_PROD_DEVTOOLS__) &#123;</span><br><span class="line">    <span class="title function_">devtoolsComponentRemoved</span>(instance)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢æ³¨é‡Šå…¶å®å·²ç»è¯´çš„å¾ˆæ¸…æ¥š</p><ol><li>scope.stop() &#x2F;&#x2F;åœæ­¢å‰¯ä½œç”¨å‡½æ•°</li><li>unmount(subTree, instance, parentSuspense, doRemove) &#x2F;&#x2F; è°ƒç”¨ unmount å‡½æ•°å¸è½½ç»„ä»¶çš„å­æ ‘</li><li>instance.isUnmounted &#x3D; true</li></ol><p>ä¸»è¦å°±è¿™å‡ ä¸ªï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ¦‚å¿µ EffectScopeï¼Œåœ¨ Vue2.x ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„æ¦‚å¿µ</p><blockquote><p>EffectScopeï¼ˆæ•ˆæœä½œç”¨åŸŸï¼‰æ˜¯ç”¨äºç®¡ç†å‰¯ä½œç”¨å‡½æ•°ï¼ˆeffectsï¼‰çš„å·¥å…·ã€‚å®ƒæä¾›äº†ä¸€ç§å°†å‰¯ä½œç”¨å‡½æ•°ç»„ç»‡åœ¨ä¸€èµ·å¹¶æ§åˆ¶å…¶æ‰§è¡Œçš„æœºåˆ¶ã€‚</p><p>åœ¨ Vue 3 ä¸­ï¼Œç»„ä»¶å†…éƒ¨çš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆå¦‚ onMountedã€onUpdatedã€onUnmounted ç­‰ï¼‰è¢«ç§°ä¸ºâ€œå‰¯ä½œç”¨â€ï¼ˆeffectsï¼‰ã€‚å‰¯ä½œç”¨å¯ä»¥æ˜¯ä¸€äº›å…·æœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼Œä¾‹å¦‚è®¢é˜…äº‹ä»¶ã€å‘é€ç½‘ç»œè¯·æ±‚ã€æ“ä½œ DOM ç­‰ã€‚</p><p>EffectScope æä¾›äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p><p>åˆ›å»ºæ•ˆæœä½œç”¨åŸŸï¼šä½¿ç”¨ createScope å‡½æ•°å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„æ•ˆæœä½œç”¨åŸŸã€‚</p><p>å¼€å§‹å’Œåœæ­¢å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œï¼šåœ¨ç»„ä»¶å®ä¾‹ä¸­ï¼Œé€šè¿‡è°ƒç”¨æ•ˆæœä½œç”¨åŸŸçš„ run æ–¹æ³•å¯ä»¥å¼€å§‹æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ï¼Œè°ƒç”¨ stop æ–¹æ³•å¯ä»¥åœæ­¢æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ã€‚</p><p>æ‰¹é‡æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ï¼šEffectScope å…è®¸å°†å¤šä¸ªå‰¯ä½œç”¨å‡½æ•°åˆ†ç»„ï¼Œç„¶åä¸€æ¬¡æ€§å¯åŠ¨å®ƒä»¬çš„æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿å®ƒä»¬æŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ‰§è¡Œã€‚</p><p>åµŒå¥—æ•ˆæœä½œç”¨åŸŸï¼šå¯ä»¥åœ¨ä¸€ä¸ªæ•ˆæœä½œç”¨åŸŸå†…åˆ›å»ºå¦ä¸€ä¸ªæ•ˆæœä½œç”¨åŸŸï¼Œå½¢æˆåµŒå¥—ç»“æ„ã€‚åµŒå¥—çš„æ•ˆæœä½œç”¨åŸŸå¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œå¯ä»¥åœ¨çˆ¶ä½œç”¨åŸŸåœæ­¢æ—¶è‡ªåŠ¨åœæ­¢ã€‚</p></blockquote><p>å¤§æ¦‚çŸ¥é“å°±è¡Œäº†ï¼Œåé¢ä¼šä¸“é—¨çœ‹ä¸€çœ‹è¿™ä¸ªï¼Œç®€å•ç†è§£å°±æ˜¯ç®¡ç†ç»„ä»¶ä¸Šçš„å‰¯ä½œç”¨å‡½æ•°ã€‚</p><p>unmount æ˜¯é€’å½’å»å¸è½½å­æ ‘ï¼Œå°±æ˜¯ä¸€ä¸ªä¸€ä¸ªå¸è½½ï¼Œrefï¼ŒKeepAliveContextï¼ŒunmountComponentï¼Œå¤„ç†SUSPENSEï¼ŒTELEPORTï¼ŒFragmentï¼ŒåŠ¨æ€å­èŠ‚ç‚¹ï¼Œå¹¶ä¸”ç›´æ¥åˆ é™¤ vnodeã€‚</p><p>è¿˜è°ƒç”¨äº†å„ç§é’©å­å‡½æ•°ï¼Œè¿™å°±æ˜¯å¤§æ¦‚çš„å¸è½½èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œå½“ç„¶è¿™é‡Œè°ˆçš„ä¸»è¦æ˜¯é’©å­å‡½æ•°ï¼Œæ‰€ä»¥å¯èƒ½ä¸­é—´å¾ˆå¤šç‚¹æ˜¯ä¸ä¼šè§¦å‘çš„ã€‚</p><h3 id="Vue2-x-destroyed"><a href="#Vue2-x-destroyed" class="headerlink" title="Vue2.x destroyed"></a>Vue2.x destroyed</h3><p>ä¹‹å‰å·²ç»çŸ¥é“äº†å¤§æ¦‚è§¦å‘æµç¨‹ <code>patch =&gt; removeNodes =&gt; Vue.prototype.$destroy</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeDestroy&#x27;</span>)</span><br><span class="line">vm.<span class="property">_isBeingDestroyed</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment">// remove self from parent</span></span><br><span class="line"><span class="keyword">const</span> parent = vm.<span class="property">$parent</span></span><br><span class="line"><span class="keyword">if</span> (parent &amp;&amp; !parent.<span class="property">_isBeingDestroyed</span> &amp;&amp; !vm.<span class="property">$options</span>.<span class="property">abstract</span>) &#123;</span><br><span class="line">  <span class="title function_">remove</span>(parent.<span class="property">$children</span>, vm)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// teardown scope. this includes both the render watcher and other</span></span><br><span class="line"><span class="comment">// watchers created</span></span><br><span class="line">vm.<span class="property">_scope</span>.<span class="title function_">stop</span>()</span><br><span class="line"><span class="comment">// remove reference from data ob</span></span><br><span class="line"><span class="comment">// frozen object may not have observer.</span></span><br><span class="line"><span class="keyword">if</span> (vm.<span class="property">_data</span>.<span class="property">__ob__</span>) &#123;</span><br><span class="line">  vm.<span class="property">_data</span>.<span class="property">__ob__</span>.<span class="property">vmCount</span>--</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// call the last hook...</span></span><br><span class="line">vm.<span class="property">_isDestroyed</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment">// invoke destroy hooks on current rendered tree</span></span><br><span class="line">vm.<span class="title function_">__patch__</span>(vm.<span class="property">_vnode</span>, <span class="literal">null</span>)</span><br><span class="line"><span class="comment">// fire destroyed hook</span></span><br><span class="line"><span class="title function_">callHook</span>(vm, <span class="string">&#x27;destroyed&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ok, ä¸å­˜åœ¨ä»€ä¹ˆå¼‚æ­¥ï¼Œå°±ç›´æ¥è§¦å‘äº†ï¼Œ é‚£æˆ‘ä»¬æ¥çœ‹ä»–åšäº†ä»€ä¹ˆï¼Ÿ</p><p>åˆ é™¤ parent.$childre å…³äºvmçš„å¼•ç”¨, remove å°±æ˜¯ä¸€ä¸ªå•çº¯çš„æ•°ç»„æ–¹æ³•.</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (parent &amp;&amp; !parent.<span class="property">_isBeingDestroyed</span> &amp;&amp; !vm.<span class="property">$options</span>.<span class="property">abstract</span>) &#123;</span><br><span class="line">  <span class="title function_">remove</span>(parent.<span class="property">$children</span>, vm)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœæ­¢ watch, _scope æ˜¯ EffectScopeï¼Œ ç„¶åè°ƒç”¨ watcher.teardown(), è°ƒç”¨ this.cleanups æ¸…ç†å‡½æ•°ï¼Œ å¦‚æœ scope åœ¨ï¼Œå°±éå†æ¸…ç†ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.<span class="property">_scope</span>.<span class="title function_">stop</span>()</span><br></pre></td></tr></table></figure><p>ä»æ•°æ®å¯¹è±¡çš„è§‚å¯Ÿè€…ï¼ˆ__ob__ï¼‰ä¸­ç§»é™¤å¯¹ç»„ä»¶çš„å¼•ç”¨ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (vm.<span class="property">_data</span>.<span class="property">__ob__</span>) &#123;</span><br><span class="line">  vm.<span class="property">_data</span>.<span class="property">__ob__</span>.<span class="property">vmCount</span>--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ vm.<strong>patch</strong> æ–¹æ³•å°†å½“å‰ç»„ä»¶çš„è™šæ‹ŸèŠ‚ç‚¹ï¼ˆ_vnodeï¼‰è®¾ç½®ä¸º nullï¼Œç”¨äºè§£é™¤ç»„ä»¶ä¸è™šæ‹Ÿ DOM çš„å…³è”</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.<span class="title function_">__patch__</span>(vm.<span class="property">_vnode</span>, <span class="literal">null</span>)</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™é‡Œç®€å•ä»‹ç»äº†ä¸€ä¸‹ Vue2,3 å¸è½½ç»„ä»¶çš„è¿‡ç¨‹ï¼Œéƒ½æ˜¯ç±»ä¼¼çš„æµç¨‹ï¼Œåªæ˜¯æ–¹æ³•æ¢äº†ï¼Œä½†æ˜¯æµç¨‹æ²¡æœ‰å˜ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> vue2 </tag>
            
            <tag> typescript </tag>
            
            <tag> ç”Ÿå‘½å‘¨æœŸ </tag>
            
            <tag> destroyed </tag>
            
            <tag> onUnmounted </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue beforeDestroy vs onBeforeUnmount</title>
      <link href="/2023/06/28/vue_beforeDestroy_onBeforeUnmount/"/>
      <url>/2023/06/28/vue_beforeDestroy_onBeforeUnmount/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="vue-beforeDestroy-vs-onBeforeUnmount"><a href="#vue-beforeDestroy-vs-onBeforeUnmount" class="headerlink" title="vue beforeDestroy vs onBeforeUnmount"></a>vue beforeDestroy vs onBeforeUnmount</h1><p>beforeCreate -&gt; setup()<br>created -&gt; setup()<br>beforeMount -&gt; onBeforeMount<br>mounted -&gt; onMounted<br>beforeUpdate -&gt; onBeforeUpdate<br>updated -&gt; onUpdated<br>beforeDestroy -&gt; onBeforeUnmount<br>destroyed -&gt; onUnmounted<br>activated -&gt; onActivated<br>deactivated -&gt; onDeactivated<br>errorCaptured -&gt; onErrorCaptured</p><h3 id="vue3-x-onBeforeUnmount"><a href="#vue3-x-onBeforeUnmount" class="headerlink" title="vue3.x onBeforeUnmount"></a>vue3.x onBeforeUnmount</h3><p>è¿™ä¸ªçš„ç”Ÿå‘½å‘¨æœŸå…¶å®å’Œ update ç±»ä¼¼ï¼Œæ³¨é”€ç»„ä»¶æˆ‘èƒ½æƒ³åˆ°çš„å°±æ˜¯ v-if, component is è¿™ä¸¤ç§åŠæ³•ã€‚</p><p>v-if é€šè¿‡ update ä¸€æ ·çš„æ–¹å¼è§¦å‘ï¼Œåªæ˜¯ patch å½“ä¸­ä¼šè°ƒç”¨ unmount ç„¶ååˆ¤æ–­åˆ°æ˜¯ç»„ä»¶ï¼Œè°ƒç”¨ unmountComponent.</p><p>component is æ–¹å¼ä¸æ¸…æ¥šï¼Œåæ­£è‚¯å®šéœ€è¦è°ƒç”¨ patchã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">unmountComponent</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  instance: ComponentInternalInstance,</span></span><br><span class="line"><span class="params">  parentSuspense: SuspenseBoundary | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">  doRemove?: <span class="built_in">boolean</span></span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (__DEV__ &amp;&amp; instance.<span class="property">type</span>.<span class="property">__hmrId</span>) &#123;</span><br><span class="line">    <span class="title function_">unregisterHMR</span>(instance)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; bum, scope, update, subTree, um &#125; = instance</span><br><span class="line"></span><br><span class="line">  <span class="comment">// beforeUnmount hook</span></span><br><span class="line">  <span class="keyword">if</span> (bum) &#123;</span><br><span class="line">    <span class="title function_">invokeArrayFns</span>(bum)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">///...</span></span><br></pre></td></tr></table></figure><p>è¿™å°±è°ƒç”¨äº†, </p><h3 id="Vue2-x-beforeDestroy"><a href="#Vue2-x-beforeDestroy" class="headerlink" title="Vue2.x beforeDestroy"></a>Vue2.x beforeDestroy</h3><p>æˆ‘è¿™è¾¹ä¹Ÿæ˜¯é€šè¿‡ v-if è§¦å‘ Object.defineProperty, ç„¶ååˆ›å»ºå“åº”å¼çš„æ—¶å€™ï¼Œåˆ›å»ºäº† Depï¼Œé€šè¿‡ Dep é€šçŸ¥ watcherã€‚</p><p>è§¦å‘ patch, ç„¶åå¯¹æ¯”</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (oldStartIdx &gt; oldEndIdx) &#123;</span><br><span class="line">  refElm = <span class="title function_">isUndef</span>(newCh[newEndIdx + <span class="number">1</span>]) ? <span class="literal">null</span> : newCh[newEndIdx + <span class="number">1</span>].<span class="property">elm</span></span><br><span class="line">  <span class="title function_">addVnodes</span>(</span><br><span class="line">    parentElm,</span><br><span class="line">    refElm,</span><br><span class="line">    newCh,</span><br><span class="line">    newStartIdx,</span><br><span class="line">    newEndIdx,</span><br><span class="line">    insertedVnodeQueue</span><br><span class="line">  )</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (newStartIdx &gt; newEndIdx) &#123;</span><br><span class="line">  <span class="title function_">removeVnodes</span>(oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶å remove æµç¨‹å¼€å§‹, æœ€åè¯è§¦å‘åˆ° <code>Vue.prototype.$destroy</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeDestroy&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Vue3.x é€šè¿‡ <code>patch =&gt; unmount =&gt; unmountComponent</code> è§¦å‘</p><p>Vue2.x é€šè¿‡ <code>patch =&gt; removeVnodes =&gt; invokeDestroyHook =&gt; Vue.prototype.$destroy</code> è§¦å‘</p><p>æˆ‘ä½¿ç”¨ v-if æµ‹è¯•ï¼Œæ‰€ä»¥éƒ½æ˜¯ç”±åŠ«æŒ(Object.defineProperty or proxy) &#x3D;&gt; Dep &#x3D;&gt; watcher or effect &#x3D;&gt; patch &#x3D;&gt; ä¸Šé¢çš„è¿‡ç¨‹ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> vue2 </tag>
            
            <tag> typescript </tag>
            
            <tag> ç”Ÿå‘½å‘¨æœŸ </tag>
            
            <tag> beforeDestroy </tag>
            
            <tag> onBeforeUnmount </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue updated vs onUpdated</title>
      <link href="/2023/06/28/vue_updated_onUpdated/"/>
      <url>/2023/06/28/vue_updated_onUpdated/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="vue-updated-vs-onUpdated"><a href="#vue-updated-vs-onUpdated" class="headerlink" title="vue updated vs onUpdated"></a>vue updated vs onUpdated</h1><p>beforeCreate -&gt; setup()<br>created -&gt; setup()<br>beforeMount -&gt; onBeforeMount<br>mounted -&gt; onMounted<br>beforeUpdate -&gt; onBeforeUpdate<br>updated -&gt; onUpdated<br>beforeDestroy -&gt; onBeforeUnmount<br>destroyed -&gt; onUnmounted<br>activated -&gt; onActivated<br>deactivated -&gt; onDeactivated<br>errorCaptured -&gt; onErrorCaptured</p><h3 id="vue3-x-onUpdate"><a href="#vue3-x-onUpdate" class="headerlink" title="vue3.x onUpdate"></a>vue3.x onUpdate</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">if</span> (!instance.<span class="property">isMounted</span>) &#123; <span class="comment">// å¦‚æœç»„ä»¶å®ä¾‹æœªæŒ‚è½½</span></span><br><span class="line">    <span class="comment">//åˆ›å»ºç»„ä»¶</span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//æ›´æ–°ç»„ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (bu) &#123; <span class="comment">// å¦‚æœ beforeUpdate é’©å­å­˜åœ¨</span></span><br><span class="line">      <span class="title function_">invokeArrayFns</span>(bu) <span class="comment">// è°ƒç”¨ invokeArrayFns å‡½æ•°ï¼Œä¾æ¬¡æ‰§è¡Œ beforeUpdate é’©å­å‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">patch</span>(</span><br><span class="line">      prevTree,</span><br><span class="line">      nextTree,</span><br><span class="line">      <span class="comment">// parent may have changed if it&#x27;s in a teleport</span></span><br><span class="line">      <span class="title function_">hostParentNode</span>(prevTree.<span class="property">el</span>!)!,</span><br><span class="line">      <span class="comment">// anchor may have changed if it&#x27;s in a fragment</span></span><br><span class="line">      <span class="title function_">getNextHostNode</span>(prevTree),</span><br><span class="line">      instance,</span><br><span class="line">      parentSuspense,</span><br><span class="line">      isSVG</span><br><span class="line">    ) <span class="comment">// æ‰§è¡Œ patch å‡½æ•°ï¼Œè¿›è¡Œ DOM çš„åˆ›å»ºæˆ–æ›´æ–°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (u) &#123; <span class="comment">// å¦‚æœ updated é’©å­å­˜åœ¨</span></span><br><span class="line">      <span class="title function_">queuePostRenderEffect</span>(u, parentSuspense) <span class="comment">// å°† updated é’©å­å‡½æ•°æ·»åŠ åˆ° post é’©å­é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">isAsyncWrapper</span>(vnode) &amp;&amp; (vnodeHook = next.<span class="property">props</span> &amp;&amp; next.<span class="property">props</span>.<span class="property">onVnodeUpdated</span>)) &#123; <span class="comment">// å¦‚æœä¸æ˜¯å¼‚æ­¥ç»„ä»¶çš„ VNodeï¼Œå¹¶ä¸”å­˜åœ¨ onVnodeUpdated é’©å­</span></span><br><span class="line">      <span class="title function_">queuePostRenderEffect</span>(</span><br><span class="line">        <span class="function">() =&gt;</span> <span class="title function_">invokeVNodeHook</span>(vnodeHook!, parent, next!, vnode),</span><br><span class="line">        parentSuspense</span><br><span class="line">      ) <span class="comment">// å°† onVnodeUpdated é’©å­å‡½æ•°æ·»åŠ åˆ° post é’©å­é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (__COMPAT__ &amp;&amp; <span class="title function_">isCompatEnabled</span>(<span class="title class_">DeprecationTypes</span>.<span class="property">INSTANCE_EVENT_HOOKS</span>, instance)) &#123; <span class="comment">// å¦‚æœå…¼å®¹æ¨¡å¼å¼€å¯ï¼Œå¹¶ä¸”å…¼å®¹é€‰é¡¹ DEPRECATION.INSTANCE_EVENT_HOOKS å¯ç”¨</span></span><br><span class="line">      <span class="title function_">queuePostRenderEffect</span>(</span><br><span class="line">        <span class="function">() =&gt;</span> instance.<span class="title function_">emit</span>(<span class="string">&#x27;hook:updated&#x27;</span>),</span><br><span class="line">        parentSuspense</span><br><span class="line">      ) <span class="comment">// å°† hook:updated äº‹ä»¶æ·»åŠ åˆ° post é’©å­é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯å† <code>patch</code> æ›´æ–°ç»„ä»¶å®Œæˆï¼Œç„¶åè°ƒç”¨ <code>beforeUpdate</code>, è¿™å°±æ˜¯é’©å­æ’å…¥çš„è¿‡ç¨‹ã€‚</p><p>è°ƒç”¨å°±è¦çœ‹ <code>ref or reactive</code>ï¼Œä¼šåœ¨ <code>set</code> çš„æ—¶å€™ <code>triggerRefValue(this, newVal);</code> ç„¶å <code>triggerEffects</code>, ç„¶åæ‰¾åˆ°<br><code>effect2.scheduler();</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> effect = (instance.<span class="property">effect</span> = <span class="keyword">new</span> <span class="title class_">ReactiveEffect</span>(</span><br><span class="line">  componentUpdateFn,</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="title function_">queueJob</span>(update),</span><br><span class="line">  instance.<span class="property">scope</span></span><br><span class="line">))</span><br></pre></td></tr></table></figure><p>okï¼Œç°åœ¨å¯ä»¥æ¥è¯´ä¸€è¯´åŸºæœ¬çš„è°ƒç”¨è¿‡ç¨‹äº†ï¼Œè¿™æ˜¯åŸºæœ¬çš„åˆ›å»º</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> effect = (instance.<span class="property">effect</span> = <span class="keyword">new</span> <span class="title class_">ReactiveEffect</span>(</span><br><span class="line">  componentUpdateFn,</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="title function_">queueJob</span>(update),</span><br><span class="line">  instance.<span class="property">scope</span></span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">update</span>: <span class="title class_">SchedulerJob</span> = (instance.<span class="property">update</span> = <span class="function">() =&gt;</span> effect.<span class="title function_">run</span>())</span><br></pre></td></tr></table></figure><p>åœ¨å†™å…¥å±æ€§çš„æ—¶å€™è§¦å‘ proxy çš„æ—¶å€™ï¼Œè§¦å‘ set </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">triggerRefValue(this, newVal);</span><br></pre></td></tr></table></figure><p>éœ€è¦çŸ¥é“ ref, reactive åœ¨åˆ›å»ºçš„æ—¶å€™æ˜¯åˆ›å»ºçš„ depï¼Œç”¨äºè®°å½•å…³è”ï¼Œæ‰€ä»¥è§¦å‘çš„æ—¶å€™ this.dep å¯ä»¥è°ƒç”¨æ‰¾åˆ°å½“å‰çš„ reactvice. </p><p>ç„¶åå°±å¯ä»¥è°ƒç”¨ <code>triggerEffect</code>, è§¦å‘ <code>effect.scheduler()</code>, ä¹Ÿå°±æ˜¯ <code>queueJob(update)</code>.</p><p>è¿™é‡Œé‡Œé¢ä¼šè§¦å‘è°ƒåº¦ä»»åŠ¡ï¼Œä¼šæŠŠ update è§¦å‘</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">queueJob</span>(<span class="params">job: SchedulerJob</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    !queue.<span class="property">length</span> ||</span><br><span class="line">    !queue.<span class="title function_">includes</span>(</span><br><span class="line">      job,</span><br><span class="line">      isFlushing &amp;&amp; job.<span class="property">allowRecurse</span> ? flushIndex + <span class="number">1</span> : flushIndex</span><br><span class="line">    )</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">if</span> (job.<span class="property">id</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">      queue.<span class="title function_">push</span>(job)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      queue.<span class="title function_">splice</span>(<span class="title function_">findInsertionIndex</span>(job.<span class="property">id</span>), <span class="number">0</span>, job)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">queueFlush</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">queueFlush</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!isFlushing &amp;&amp; !isFlushPending) &#123;</span><br><span class="line">    isFlushPending = <span class="literal">true</span></span><br><span class="line">    currentFlushPromise = resolvedPromise.<span class="title function_">then</span>(flushJobs)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè°ƒç”¨ <code>flushJobs</code>, é‡Œé¢ä¼šä¸åœçš„å¾ªç¯ <code>queue</code>, æ‰§è¡Œé‡Œé¢çš„ <code>function</code>ã€‚</p><p>åœ¨å…¨éƒ¨æ‰§è¡Œå®Œæˆä»¥åæ‰§è¡Œ <code>flushPostFlushCbs(seen)</code>ã€‚</p><p>äºæ˜¯å°±è§¦å‘åˆšæ‰æ’å…¥çš„é’©å­å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (u) &#123; <span class="comment">// å¦‚æœ updated é’©å­å­˜åœ¨</span></span><br><span class="line">  <span class="title function_">queuePostRenderEffect</span>(u, parentSuspense) <span class="comment">// å°† updated é’©å­å‡½æ•°æ·»åŠ åˆ° post é’©å­é˜Ÿåˆ—ä¸­</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="vue2-x-updated"><a href="#vue2-x-updated" class="headerlink" title="vue2.x updated"></a>vue2.x updated</h3><p>è¿™é‡Œéœ€è¦å¤§æ¦‚çŸ¥é“ Vue2 çš„ä¸€äº›æ ¸å¿ƒæ¦‚å¿µï¼Œ <code>wathcer &amp; dep</code>ï¼Œä¹Ÿå°±æ˜¯ <em>Vue2.x</em> æ›´æ–°çš„æ ¸å¿ƒæ¦‚å¿µ</p><p><a href="/tblog/2023/06/27/vue2_watch/">watcher</a>, <a href="/tblog/2023/06/27/vue2_Dep/">dep</a> è¿™ä¸¤ç¯‡æ–‡ç« æ˜¯ä¹‹å‰æˆ‘çœ‹ Vue2.x çš„æºç çš„æ—¶å€™å†™çš„ï¼ŒåŒ…å«ä»£ç æ³¨é‡Šã€‚</p><p>å¯ä»¥ç®€å•ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå‘å¸ƒ-è®¢é˜…çš„å…³ç³»ï¼Œåœ¨ä¹‹å‰çœ‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“æœ‰åœ¨åˆ›å»ºç»„ä»¶çš„å‡½æ•°ä¸­ <code>mountComponent</code> å½“ä¸­ï¼Œä¼šæ–°å»º <code>wathcer</code>.</p><p>åœ¨ç»„ä»¶çš„åˆ›å»ºå®Œæˆä»¥åï¼Œä½ è®¿é—®å±æ€§ï¼Œä¼šé€šè¿‡ <code>Object.defineProperty</code> åŠ«æŒï¼Œç„¶ååˆ›å»º Depã€‚é€šè¿‡ä¸‹é¢ä»£ç </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">addDep</span>(<span class="params">dep: Dep</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> id = dep.<span class="property">id</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">has</span>(id)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">add</span>(id)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">newDeps</span>.<span class="title function_">push</span>(dep)</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">depIds</span>.<span class="title function_">has</span>(id)) &#123;</span><br><span class="line">        dep.<span class="title function_">addSub</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œ watcher å»ºç«‹è”ç³»ã€‚</p><p>å¦‚æœå±æ€§å‘ç”Ÿå˜åŒ–ï¼Œé€šè¿‡ <code>Object.defineProperty</code> åŠ«æŒå‘ç°ï¼Œç„¶åé€šçŸ¥ depï¼Œç„¶åé€šçŸ¥ <code>watcherï¼Œwatcher.update()</code>.</p><p>ä¸ºä»€ä¹ˆè¦çŸ¥é“è¿™ä¸ªï¼Ÿ å› ä¸ºè¿™ä¸ªé’©å­å°±æ˜¯é€šè¿‡ <code>watcher.update()</code> è§¦å‘çš„ï¼Œæ€»å¾—ç®€å•çŸ¥é“ä»–æ˜¯æ€ä¹ˆè§¦å‘çš„å§ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">lazy</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">sync</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">run</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">queueWatcher</span>(<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‡’åŠ è½½å°±æ˜¯ä¸‹æ¬¡è·å–çš„æ›´æ–°ï¼Œä¸€ä¸ªåŒæ­¥ï¼Œä¸€ä¸ªå¼‚æ­¥(é˜Ÿåˆ—)ã€‚</p><p><code>queueWatcher</code> ä¸­å¾€ <code>queue.push(watcher)</code>, ç„¶åè°ƒç”¨ <code>flushSchedulerQueue</code>ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (index = <span class="number">0</span>; index &lt; queue.<span class="property">length</span>; index++) &#123;</span><br><span class="line">    watcher = queue[index]</span><br><span class="line">    <span class="keyword">if</span> (watcher.<span class="property">before</span>) &#123;</span><br><span class="line">      watcher.<span class="title function_">before</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    id = watcher.<span class="property">id</span></span><br><span class="line">    has[id] = <span class="literal">null</span></span><br><span class="line">    watcher.<span class="title function_">run</span>()</span><br><span class="line">    <span class="comment">// in dev build, check and stop circular updates.</span></span><br><span class="line">    <span class="keyword">if</span> (__DEV__ &amp;&amp; has[id] != <span class="literal">null</span>) &#123;</span><br><span class="line">      circular[id] = (circular[id] || <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">      <span class="keyword">if</span> (circular[id] &gt; <span class="variable constant_">MAX_UPDATE_COUNT</span>) &#123;</span><br><span class="line">        <span class="title function_">warn</span>(</span><br><span class="line">          <span class="string">&#x27;You may have an infinite update loop &#x27;</span> +</span><br><span class="line">            (watcher.<span class="property">user</span></span><br><span class="line">              ? <span class="string">`in watcher with expression &quot;<span class="subst">$&#123;watcher.expression&#125;</span>&quot;`</span></span><br><span class="line">              : <span class="string">`in a component render function.`</span>),</span><br><span class="line">          watcher.<span class="property">vm</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// keep copies of post queues before resetting state</span></span><br><span class="line"><span class="keyword">const</span> activatedQueue = activatedChildren.<span class="title function_">slice</span>()</span><br><span class="line"><span class="keyword">const</span> updatedQueue = queue.<span class="title function_">slice</span>()</span><br><span class="line"></span><br><span class="line"><span class="title function_">resetSchedulerState</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// call component updated and activated hooks</span></span><br><span class="line"><span class="title function_">callActivatedHooks</span>(activatedQueue)</span><br><span class="line"><span class="title function_">callUpdatedHooks</span>(updatedQueue) <span class="comment">//è§¦å‘updated</span></span><br><span class="line"><span class="title function_">cleanupDeps</span>()</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™å°±å¯ä»¥å¼€å§‹è¯´äº†</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(queue..) &#123;</span><br><span class="line">    <span class="keyword">if</span> (watcher.<span class="property">before</span>) &#123;</span><br><span class="line">      watcher.<span class="title function_">before</span>() <span class="comment">//è§¦å‘before</span></span><br><span class="line">    &#125;</span><br><span class="line">    watcher.<span class="title function_">run</span>() <span class="comment">//è§¦å‘æ›´æ–°å‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">callActivatedHooks</span>(activatedQueue) <span class="comment">//è§¦å‘ active é’©å­</span></span><br><span class="line"><span class="title function_">callUpdatedHooks</span>(updatedQueue) <span class="comment">//è§¦å‘ updateé’©å­</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°±æ˜¯æ‰§è¡Œçš„è¿‡ç¨‹,</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å¯¹æ¯” Vue2 å’Œ Vue3 çš„å®ç°ï¼Œå…¶å®æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸¤ä¸ªç‰ˆæœ¬æ ¸å¿ƒå®ç°çš„å·®åˆ«</p><p>éƒ½æ˜¯é€šè¿‡ <code>mountComponent</code> å®ç°åˆ›å»ºæ›´æ–°çš„å‡½æ•°ï¼Œä¸è¿‡ä¸€ä¸ªæ˜¯ <code>watcher</code> ä¸€ä¸ªæ˜¯ <code>effect</code>. <code>dep</code> åŠŸèƒ½æœ‰å·®å¼‚ã€‚</p><p>ç„¶åéƒ½æ˜¯é€šè¿‡ <code>set</code> çš„æ—¶å€™è§¦å‘ï¼Œ è¿™é‡ŒåŒºåˆ«åˆæ¥äº†ã€‚</p><p><strong>Vue2.x</strong> <code>set</code> é€šè¿‡åˆ›å»ºçš„ <code>dep</code> ï¼Œé€šçŸ¥å¯¹åº”çš„ <code>watcher</code>, ç„¶åè°ƒç”¨ <code>watcher.update()</code>, åœ¨è§¦å‘ <code>flushSchedulerQueue</code>ã€‚</p><p><strong>Vue3.x</strong> ä¹Ÿæ˜¯é€šè¿‡ <code>set</code> è§¦å‘ <code>triggerRefValue(this, newVal)</code>, ç„¶åæ‰¾åˆ° <code>effect.scheduler()</code>, æ‰§è¡Œ <code>update</code> å‡½æ•°ï¼Œ æ›´æ–°å‡½æ•°ï¼Œæ›´æ–°å®Œæˆä»¥åè°ƒç”¨ç”Ÿå‘½å‘¨æœŸ</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> vue2 </tag>
            
            <tag> typescript </tag>
            
            <tag> ç”Ÿå‘½å‘¨æœŸ </tag>
            
            <tag> updated </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue2.x Dep</title>
      <link href="/2023/06/27/vue2_Dep/"/>
      <url>/2023/06/27/vue2_Dep/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="vue2-x-Dep"><a href="#vue2-x-Dep" class="headerlink" title="vue2.x Dep"></a>vue2.x Dep</h1><h3 id="01-Dep"><a href="#01-Dep" class="headerlink" title="01. Dep"></a>01. Dep</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Dep</span> &#123;</span><br><span class="line">  <span class="comment">//é™æ€å±æ€§ target ç”¨æ¥å­˜æ”¾å½“å‰æ­£åœ¨è®¡ç®—çš„ Watcherã€‚</span></span><br><span class="line">  <span class="keyword">static</span> target?: <span class="title class_">DepTarget</span> | <span class="literal">null</span></span><br><span class="line">  <span class="comment">//æ„é€ å‡½æ•°ç”Ÿæˆï¼Œæ¯ä¸ªDepå®ä¾‹çš„å”¯ä¸€ID</span></span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="comment">//ç”¨æ¥å­˜æ”¾æ‰€æœ‰è®¢é˜…äº†è¯¥ Dep å®ä¾‹çš„ Watcherã€‚</span></span><br><span class="line">  <span class="attr">subs</span>: <span class="title class_">Array</span>&lt;<span class="title class_">DepTarget</span> | <span class="literal">null</span>&gt;</span><br><span class="line">  <span class="comment">//pending subs cleanup</span></span><br><span class="line">  <span class="comment">//ä¸€ä¸ªæ ‡å¿—ä½ï¼Œç”¨æ¥æ ‡è¯†æ˜¯å¦æœ‰è®¢é˜…è€…éœ€è¦è¢«æ¸…é™¤ã€‚</span></span><br><span class="line">  _pending = <span class="literal">false</span> </span><br><span class="line"></span><br><span class="line">  <span class="comment">//æ„é€ å‡½æ•°ï¼Œç”¨æ¥åˆå§‹åŒ– id å’Œ subsã€‚</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">id</span> = uid++</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span> = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æ·»åŠ è®¢é˜…è€…ï¼ŒæŠŠ Watcher æ·»åŠ åˆ° subs ä¸­ã€‚</span></span><br><span class="line">  <span class="title function_">addSub</span>(<span class="params">sub: DepTarget</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">push</span>(sub)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ç§»é™¤è®¢é˜…è€…ï¼ŒæŠŠ Watcher ä» subs ä¸­ç§»é™¤ã€‚</span></span><br><span class="line">  <span class="comment">//ç”±äºç§»é™¤è®¢é˜…è€…çš„æ“ä½œå¯èƒ½ä¼šå½±å“åˆ°éå† subsï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨äº†æ ‡è®°ä½çš„æ–¹å¼ï¼ŒæŠŠè¦ç§»é™¤çš„ Watcher æ ‡è®°ä¸º nullï¼Œç„¶ååœ¨ä¸‹ä¸€æ¬¡ scheduler flush çš„æ—¶å€™å†è¿›è¡Œæ¸…é™¤ã€‚</span></span><br><span class="line">  <span class="title function_">removeSub</span>(<span class="params">sub: DepTarget</span>) &#123;</span><br><span class="line">    <span class="comment">// #12696 deps with massive amount of subscribers are extremely slow to</span></span><br><span class="line">    <span class="comment">// clean up in Chromium</span></span><br><span class="line">    <span class="comment">// to workaround this, we unset the sub for now, and clear them on</span></span><br><span class="line">    <span class="comment">// next scheduler flush.</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span>[<span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">indexOf</span>(sub)] = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">_pending</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_pending</span> = <span class="literal">true</span></span><br><span class="line">      pendingCleanupDeps.<span class="title function_">push</span>(<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//æ”¶é›†ä¾èµ–ï¼ŒæŠŠå½“å‰çš„ Watcher æ·»åŠ åˆ°è¯¥ Dep å®ä¾‹çš„ subs ä¸­ã€‚</span></span><br><span class="line">  <span class="comment">//å¦‚æœæœ‰éœ€è¦è°ƒè¯•çš„ä¿¡æ¯ï¼ˆå¦‚ onTrack å›è°ƒå‡½æ•°ï¼‰ï¼Œåˆ™è°ƒç”¨è¯¥å›è°ƒå‡½æ•°ã€‚</span></span><br><span class="line">  <span class="title function_">depend</span>(<span class="params">info?: DebuggerEventExtraInfo</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Dep</span>.<span class="property">target</span>) &#123;</span><br><span class="line">      <span class="title class_">Dep</span>.<span class="property">target</span>.<span class="title function_">addDep</span>(<span class="variable language_">this</span>)</span><br><span class="line">      <span class="keyword">if</span> (__DEV__ &amp;&amp; info &amp;&amp; <span class="title class_">Dep</span>.<span class="property">target</span>.<span class="property">onTrack</span>) &#123;</span><br><span class="line">        <span class="title class_">Dep</span>.<span class="property">target</span>.<span class="title function_">onTrack</span>(&#123;</span><br><span class="line">          <span class="attr">effect</span>: <span class="title class_">Dep</span>.<span class="property">target</span>,</span><br><span class="line">          ...info</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//é€šçŸ¥æ›´æ–°ï¼Œå½“ä¸€ä¸ª Dep å®ä¾‹è¢«æ›´æ–°æ—¶ï¼Œå®ƒä¼šéå† subs ä¸­çš„æ‰€æœ‰ Watcherï¼Œå¹¶ä¾æ¬¡è°ƒç”¨å®ƒä»¬çš„ update æ–¹æ³•è¿›è¡Œæ›´æ–°ã€‚</span></span><br><span class="line">  <span class="comment">//åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰éœ€è¦è°ƒè¯•çš„ä¿¡æ¯ï¼ˆå¦‚ onTrigger å›è°ƒå‡½æ•°ï¼‰ï¼Œåˆ™è°ƒç”¨è¯¥å›è°ƒå‡½æ•°ã€‚</span></span><br><span class="line">  <span class="comment">//å¦‚æœé…ç½®ä¸­ä¸æ˜¯å¼‚æ­¥æ¨¡å¼ï¼Œåˆ™éœ€è¦å¯¹ subs è¿›è¡Œæ’åºä»¥ç¡®ä¿å®ƒä»¬æŒ‰æ­£ç¡®çš„é¡ºåºè§¦å‘æ›´æ–°ã€‚</span></span><br><span class="line">  <span class="title function_">notify</span>(<span class="params">info?: DebuggerEventExtraInfo</span>) &#123;</span><br><span class="line">    <span class="comment">// stabilize the subscriber list first</span></span><br><span class="line">    <span class="keyword">const</span> subs = <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">s</span> =&gt;</span> s) <span class="keyword">as</span> <span class="title class_">DepTarget</span>[]</span><br><span class="line">    <span class="keyword">if</span> (__DEV__ &amp;&amp; !config.<span class="property">async</span>) &#123;</span><br><span class="line">      <span class="comment">// subs aren&#x27;t sorted in scheduler if not running async</span></span><br><span class="line">      <span class="comment">// we need to sort them now to make sure they fire in correct</span></span><br><span class="line">      <span class="comment">// order</span></span><br><span class="line">      subs.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="property">id</span> - b.<span class="property">id</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = subs.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> sub = subs[i]</span><br><span class="line">      <span class="keyword">if</span> (__DEV__ &amp;&amp; info) &#123;</span><br><span class="line">        sub.<span class="property">onTrigger</span> &amp;&amp;</span><br><span class="line">          sub.<span class="title function_">onTrigger</span>(&#123;</span><br><span class="line">            <span class="attr">effect</span>: subs[i],</span><br><span class="line">            ...info</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      sub.<span class="title function_">update</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­çœ‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">pendingCleanupDeps</span>: <span class="title class_">Dep</span>[] = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">cleanupDeps</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; pendingCleanupDeps.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> dep = pendingCleanupDeps[i]</span><br><span class="line">    dep.<span class="property">subs</span> = dep.<span class="property">subs</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">s</span> =&gt;</span> s)</span><br><span class="line">    dep.<span class="property">_pending</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  pendingCleanupDeps.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯é…åˆ <code>removeSub</code>, è¿‡æ»¤è°ƒå·²ç»è¢« <code>removeSub</code> ç½® <code>null</code> çš„ <code>subs</code>, æŸ¥è¯¢äº† <strong>vue2</strong> æºç ï¼Œä¸»è¦åœ¨ <code>watch</code> &amp; <code>apiWatch</code> ä¸­è°ƒç”¨ï¼Œ è¿™ä¸ªè¿‡ä¼šå„¿å†æ·±ç©¶</p><p>è¿˜æœ‰å°±æ˜¯ </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The current target watcher being evaluated.</span></span><br><span class="line"><span class="comment">// This is globally unique because only one watcher</span></span><br><span class="line"><span class="comment">// can be evaluated at a time.</span></span><br><span class="line"><span class="title class_">Dep</span>.<span class="property">target</span> = <span class="literal">null</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">targetStack</span>: <span class="title class_">Array</span>&lt;<span class="title class_">DepTarget</span> | <span class="literal">null</span> | <span class="literal">undefined</span>&gt; = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">pushTarget</span>(<span class="params">target?: DepTarget | <span class="literal">null</span></span>) &#123;</span><br><span class="line">  targetStack.<span class="title function_">push</span>(target)</span><br><span class="line">  <span class="title class_">Dep</span>.<span class="property">target</span> = target</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">popTarget</span>(<span class="params"></span>) &#123;</span><br><span class="line">  targetStack.<span class="title function_">pop</span>()</span><br><span class="line">  <span class="title class_">Dep</span>.<span class="property">target</span> = targetStack[targetStack.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆå§‹åŒ– <code>Dep.target = null</code>, ç„¶åç»™äº†ä¸€ä¸ªè¿›æ ˆå‡ºæ ˆä»£ç ï¼Œè¿™ä¸ªçœ‹èµ·æ¥ç®€å•ï¼Œå…¶å®å¾ˆé‡è¦ã€‚</p><p>é¦–å…ˆè¿™ä¸ªæ˜¯ä»€ä¹ˆï¼Ÿ</p><blockquote><p>è¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ªå…¨å±€çš„Watcherè°ƒåº¦å™¨ã€‚Vueçš„æ•°æ®å“åº”å¼æœºåˆ¶ä¼šåˆ›å»ºä¸€ä¸ªWatcherå¯¹è±¡ï¼ŒWatcherä¼šåœ¨æ•°æ®å˜åŒ–æ—¶è¿›è¡Œæ›´æ–°ã€‚åœ¨Vueçš„å†…éƒ¨å®ç°ä¸­ï¼ŒDepï¼ˆDependencyï¼‰å¯¹è±¡ç”¨æ¥æ”¶é›†Watcherï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒDepä¼šé€šçŸ¥æ”¶é›†çš„æ‰€æœ‰Watcherè¿›è¡Œæ›´æ–°ã€‚</p><p>å½“ä¸€ä¸ªWatcherè¢«åˆ›å»ºæ—¶ï¼Œå®ƒä¼šè¢«è®¾ç½®ä¸ºå…¨å±€å”¯ä¸€çš„Dep.targetã€‚å½“æ•°æ®å˜åŒ–æ—¶ï¼ŒDepä¼šé€šè¿‡è°ƒç”¨Watcherçš„updateæ–¹æ³•æ¥é€šçŸ¥å®ƒè¿›è¡Œæ›´æ–°ã€‚pushTargetæ–¹æ³•å°†å½“å‰Watcherå…¥æ ˆå¹¶å°†Dep.targetè®¾ç½®ä¸ºè¯¥Watcherï¼Œè¿™æ ·åœ¨æ”¶é›†ä¾èµ–æ—¶Depä¼šå°†è¯¥WatcheråŠ å…¥åˆ°å…¶subsæ•°ç»„ä¸­ã€‚è€ŒpopTargetæ–¹æ³•åˆ™å°†Watcherå‡ºæ ˆå¹¶æ¢å¤Dep.targetä¸ºä¸Šä¸€ä¸ªWatcherï¼Œè¿™æ ·å½“æ•°æ®å˜åŒ–æ—¶å°±å¯ä»¥é€šçŸ¥åˆ°ä¸Šä¸€ä¸ªWatcherè¿›è¡Œæ›´æ–°ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æºç éœ€è¦æ›´æ–°çš„æ—¶å€™</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">pushTarget</span>(watcher);</span><br><span class="line"><span class="comment">//æ“ä½œå·²ç»åŠ«æŒè¿‡çš„å€¼ï¼Œè§¦å‘æ›´æ–°</span></span><br><span class="line"><span class="title function_">popTarget</span>(watcher);</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œ<code>targetStack</code> ä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Ÿ å› ä¸º Vue å“åº”å¼æ˜¯å¯ä»¥åµŒå¥—çš„ï¼Œå±‚å±‚åµŒå¥—ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°è¿™ä¸ªè¿›æ ˆå‡ºæ ˆæ“ä½œã€‚</p><p>ä½†æ˜¯æœ‰äº›ä»£ç ä¸­ï¼Œ<code>pushTarget()</code> , å¹¶æ²¡æœ‰åŒ…å« <code>watch</code>ï¼Œä¼ å…¥å€¼ä¸º <code>undefined</code>, æ˜¯ç”¨äºåŒºåˆ«å’Œåˆ¤æ–­</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title class_">Dep</span>.<span class="property">target</span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure><p>çœŸå®ä¼ å…¥ watch çš„æ–¹å¼æ˜¯ï¼Œé€šè¿‡ <code>watch.get</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">pushTarget</span>(<span class="variable language_">this</span>)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä¸¤è€…è¿˜æ˜¯éœ€è¦è¿èµ·æ¥çœ‹ã€‚</p><h3 id="02-æ€»ç»“"><a href="#02-æ€»ç»“" class="headerlink" title="02. æ€»ç»“"></a>02. æ€»ç»“</h3><p><code>Dep</code> ç©¶ç«Ÿå¹²äº†ä»€ä¹ˆã€‚</p><p>ä»–æ˜¯ä¸€ä¸ªæ¡¥æ¢ï¼Œå¯¹è±¡å’Œwatchä¹‹é—´çš„æ¡¥æ¢ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½åº”è¯¥æœ‰ä¸€ä¸ª Dep, ç”¨äºç®¡ç†å…³äºè¿™ä¸ªå¯¹è±¡çš„ä¾èµ–ã€‚</p><p>å£°æ˜ä¸€ä¸ª Dep ç”¨äºç®¡ç† æ•°æ®å’ŒWatchä¹‹é—´çš„ä¾èµ–ã€‚</p><p>å¹¶ä¸”ï¼Œä¹Ÿç»Ÿä¸€é€šè¿‡ Dep.target æ¥ç®¡ç†æ•´ä¸ª Vue watch çš„è°ƒåº¦ã€‚</p><ol><li>addSub æ·»åŠ watchï¼Œç”¨äºé€šçŸ¥</li><li>removeSub æ ‡è®°ä¸ºnullï¼Œscheduler flush ä¸­æ¸…ç†</li><li>depend å½“å‰ Dep æ·»åŠ åˆ° Dep.target å½“ä¸­</li><li>notify é€šçŸ¥æ‰€æœ‰çš„ sub</li></ol></div>]]></content>
      
      
      
        <tags>
            
            <tag> æºç  </tag>
            
            <tag> Vue2 </tag>
            
            <tag> Dep </tag>
            
            <tag> å“åº”å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue2.x watcher</title>
      <link href="/2023/06/27/vue2_watch/"/>
      <url>/2023/06/27/vue2_watch/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="vue2-x-watcher"><a href="#vue2-x-watcher" class="headerlink" title="vue2.x watcher"></a>vue2.x watcher</h1><h3 id="01-æºç "><a href="#01-æºç " class="headerlink" title="01. æºç "></a>01. æºç </h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Watcher</span> <span class="keyword">implements</span> <span class="title class_">DepTarget</span> &#123;</span><br><span class="line">  vm?: <span class="title class_">Component</span> | <span class="literal">null</span> <span class="comment">//ç»„ //ä»¶å®ä¾‹</span></span><br><span class="line">  <span class="attr">expression</span>: <span class="built_in">string</span> <span class="comment">//ç›‘è§†çš„è¡¨è¾¾å¼</span></span><br><span class="line">  <span class="attr">cb</span>: <span class="title class_">Function</span> <span class="comment">//å›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span> <span class="comment">//watch å”¯ä¸€id</span></span><br><span class="line">  <span class="attr">deep</span>: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦è¿›è¡Œæ·±åº¦ç›‘è§†</span></span><br><span class="line">  <span class="attr">user</span>: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦æ˜¯è‡ªå®šä¹‰watch</span></span><br><span class="line">  <span class="attr">lazy</span>: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦æ‡’æ‰§è¡Œ</span></span><br><span class="line">  <span class="attr">sync</span>: <span class="built_in">boolean</span> <span class="comment">//watch æ‰§è¡Œæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥</span></span><br><span class="line">  <span class="attr">dirty</span>: <span class="built_in">boolean</span> <span class="comment">//åœ¨ lazy = true çš„å‰æä¸‹ï¼Œå€¼æ˜¯å¦è¦é‡æ–°è®¡ç®—</span></span><br><span class="line">  <span class="attr">active</span>: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦å¤„äºæ¿€æ´»çŠ¶æ€</span></span><br><span class="line">  <span class="attr">deps</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Dep</span>&gt; <span class="comment">//ä¾èµ–åˆ—è¡¨</span></span><br><span class="line">  <span class="attr">newDeps</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Dep</span>&gt; <span class="comment">//ä¸´æ—¶ä¾èµ–åˆ—è¡¨</span></span><br><span class="line">  <span class="attr">depIds</span>: <span class="title class_">SimpleSet</span> <span class="comment">//ä¾èµ–çš„IDé›†åˆ</span></span><br><span class="line">  <span class="attr">newDepIds</span>: <span class="title class_">SimpleSet</span> <span class="comment">//ä¸´æ—¶ä¾èµ–åˆ—è¡¨ID</span></span><br><span class="line">  before?: <span class="title class_">Function</span> <span class="comment">//æ›´æ–°ä¹‹å‰çš„ hook å‡½æ•°</span></span><br><span class="line">  onStop?: <span class="title class_">Function</span> <span class="comment">//å½“å‰ watch è¢«åœæ­¢è°ƒç”¨ä»¥åçš„é’©å­å‡½æ•°</span></span><br><span class="line">  noRecurse?: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦é¿å…é€’å½’ç›‘è§†</span></span><br><span class="line">  <span class="attr">getter</span>: <span class="title class_">Function</span> <span class="comment">//è·å–å½“å‰ç›‘è§†çš„è¡¨è¾¾å¼çš„å€¼</span></span><br><span class="line">  <span class="attr">value</span>: <span class="built_in">any</span> <span class="comment">//å½“å‰å€¼</span></span><br><span class="line">  <span class="attr">post</span>: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦æ˜¯åç½® watcherï¼ˆå³æ¸²æŸ“ watcherï¼‰ï¼Ÿ</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// dev only</span></span><br><span class="line">  onTrack?: (<span class="function">(<span class="params">event: DebuggerEvent</span>) =&gt;</span> <span class="built_in">void</span>) | <span class="literal">undefined</span></span><br><span class="line">  onTrigger?: (<span class="function">(<span class="params">event: DebuggerEvent</span>) =&gt;</span> <span class="built_in">void</span>) | <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    vm: Component | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">    expOrFn: <span class="built_in">string</span> | (() =&gt; <span class="built_in">any</span>),</span></span><br><span class="line"><span class="params">    cb: <span class="built_in">Function</span>,</span></span><br><span class="line"><span class="params">    options?: WatcherOptions | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">    isRenderWatcher?: <span class="built_in">boolean</span> <span class="comment">//å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºè¿™ä¸ª watcher æ˜¯å¦æ˜¯æ¸²æŸ“å‡½æ•° watcher</span></span></span><br><span class="line"><span class="params">  </span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è°ƒç”¨ recordEffectScope å‡½æ•°è®°å½• effect scopeï¼Œå…¶ä¸­ activeEffectScope è¡¨ç¤ºå½“å‰çš„æ¿€æ´»çš„ effect scopeã€‚  </span></span><br><span class="line">    <span class="title function_">recordEffectScope</span>(</span><br><span class="line">      <span class="variable language_">this</span>,</span><br><span class="line">      <span class="comment">// if the active effect scope is manually created (not a component scope),</span></span><br><span class="line">      <span class="comment">// prioritize it</span></span><br><span class="line">      activeEffectScope &amp;&amp; !activeEffectScope.<span class="property">_vm</span></span><br><span class="line">        ? activeEffectScope</span><br><span class="line">        : vm</span><br><span class="line">        ? vm.<span class="property">_scope</span></span><br><span class="line">        : <span class="literal">undefined</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¦‚æœ vm ä¸ä¸º nullï¼Œä¸” isRenderWatcher ä¸º trueï¼Œåˆ™å°† watcher å­˜å‚¨åœ¨ vm çš„ _watcher å±æ€§ä¸­ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> ((<span class="variable language_">this</span>.<span class="property">vm</span> = vm) &amp;&amp; isRenderWatcher) &#123;</span><br><span class="line">      vm.<span class="property">_watcher</span> = <span class="variable language_">this</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// options</span></span><br><span class="line">    <span class="keyword">if</span> (options) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">deep</span> = !!options.<span class="property">deep</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">user</span> = !!options.<span class="property">user</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">lazy</span> = !!options.<span class="property">lazy</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">sync</span> = !!options.<span class="property">sync</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">before</span> = options.<span class="property">before</span></span><br><span class="line">      <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onTrack</span> = options.<span class="property">onTrack</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onTrigger</span> = options.<span class="property">onTrigger</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">deep</span> = <span class="variable language_">this</span>.<span class="property">user</span> = <span class="variable language_">this</span>.<span class="property">lazy</span> = <span class="variable language_">this</span>.<span class="property">sync</span> = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cb</span> = cb</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">id</span> = ++uid <span class="comment">// uid for batching</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">active</span> = <span class="literal">true</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">post</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="variable language_">this</span>.<span class="property">lazy</span> <span class="comment">// for lazy watchers</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">deps</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDeps</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">depIds</span> = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDepIds</span> = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expression</span> = __DEV__ ? expOrFn.<span class="title function_">toString</span>() : <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">// parse expression for getter</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isFunction</span>(expOrFn)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">getter</span> = expOrFn</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">getter</span> = <span class="title function_">parsePath</span>(expOrFn)</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">getter</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">getter</span> = noop</span><br><span class="line">        __DEV__ &amp;&amp;</span><br><span class="line">          <span class="title function_">warn</span>(</span><br><span class="line">            <span class="string">`Failed watching path: &quot;<span class="subst">$&#123;expOrFn&#125;</span>&quot; `</span> +</span><br><span class="line">              <span class="string">&#x27;Watcher only accepts simple dot-delimited paths. &#x27;</span> +</span><br><span class="line">              <span class="string">&#x27;For full control, use a function instead.&#x27;</span>,</span><br><span class="line">            vm</span><br><span class="line">          )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">lazy</span> ? <span class="literal">undefined</span> : <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Evaluate the getter, and re-collect dependencies.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">pushTarget</span>(<span class="variable language_">this</span>) <span class="comment">//è¿›æ ˆï¼Œè¡¨ç¤ºæ­£åœ¨è®¡ç®—watchçš„å€¼</span></span><br><span class="line">    <span class="keyword">let</span> value</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="variable language_">this</span>.<span class="property">vm</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      value = <span class="variable language_">this</span>.<span class="property">getter</span>.<span class="title function_">call</span>(vm, vm) <span class="comment">//è·å–å€¼</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="attr">e</span>: <span class="built_in">any</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">user</span>) &#123;</span><br><span class="line">        <span class="title function_">handleError</span>(e, vm, <span class="string">`getter for watcher &quot;<span class="subst">$&#123;<span class="variable language_">this</span>.expression&#125;</span>&quot;`</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> e</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// &quot;touch&quot; every property so they are all tracked as</span></span><br><span class="line">      <span class="comment">// dependencies for deep watching</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">deep</span>) &#123; <span class="comment">//å¦‚æœè¦æ·±å…¥ç›‘è§†</span></span><br><span class="line">        <span class="comment">//traverse å‡½æ•°æ˜¯ç”¨æ¥éå†ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„çš„æ‰€æœ‰å­å±æ€§ï¼Œä»¥ä¾¿åœ¨è¿›è¡Œâ€œæ·±åº¦è§‚æµ‹â€ï¼ˆdeep watchï¼‰æ—¶èƒ½å¤Ÿå°†è¿™äº›å­å±æ€§å…¨éƒ¨æ³¨å†Œä¸ºä¾èµ–å…³ç³»ã€‚</span></span><br><span class="line">        <span class="comment">//traverse å‡½æ•°æ¥æ”¶ä¸€ä¸ª val å‚æ•°ï¼Œä»£è¡¨éœ€è¦éå†çš„å¯¹è±¡æˆ–æ•°ç»„ã€‚å‡½æ•°ä¸­é¦–å…ˆä¼šå¯¹ val è¿›è¡Œä¸€äº›åˆ¤æ–­ï¼Œä¾‹å¦‚å¦‚æœ val ä¸æ˜¯æ•°ç»„æˆ–å¯¹è±¡ï¼Œæˆ–è€…æ˜¯è¢«å†»ç»“çš„å¯¹è±¡ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ª VNodeï¼Œå°±ç›´æ¥è¿”å›ï¼Œä¸éœ€è¦ç»§ç»­éå†ã€‚</span></span><br><span class="line">        <span class="comment">//æ¥ä¸‹æ¥ä¼šåˆ¤æ–­ val æ˜¯å¦æ˜¯ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œå¦‚æœæ˜¯ï¼Œå°±ä¼šå°†å®ƒæ‰€å…³è”çš„ä¾èµ–çš„ id åŠ å…¥åˆ° seen é›†åˆä¸­ã€‚è¿™é‡Œçš„ seen é›†åˆæ˜¯ç”¨æ¥å»é‡çš„ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¿è¯åœ¨éå†ä¸€ä¸ªå¯¹è±¡æ—¶ä¸ä¼šå‡ºç°å¾ªç¯ä¾èµ–çš„æƒ…å†µã€‚ </span></span><br><span class="line">        <span class="comment">//æœ€åï¼Œå¦‚æœ val æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå°±å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ é€’å½’è°ƒç”¨ _traverse å‡½æ•°è¿›è¡Œéå†ï¼›å¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°±å¯¹å¯¹è±¡ä¸­çš„æ¯ä¸ªå±æ€§é€’å½’è°ƒç”¨ _traverse å‡½æ•°è¿›è¡Œéå†ã€‚å¦‚æœ val æ˜¯ä¸€ä¸ª Ref å¯¹è±¡ï¼Œåˆ™éå†å®ƒçš„ value å±æ€§ã€‚</span></span><br><span class="line">        <span class="comment">//è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯éå†ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ•°ç»„çš„æ‰€æœ‰å±æ€§æˆ–å…ƒç´ ï¼Œå¹¶ä¸”å°†éå†åˆ°çš„æ‰€æœ‰å±æ€§æˆ–å…ƒç´ éƒ½æ”¶é›†ä¸ºå“åº”å¼ä¾èµ–ï¼Œè¿™æ ·å½“å…¶ä¸­ä»»æ„ä¸€ä¸ªå±æ€§æˆ–å…ƒç´ å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒVue å°±èƒ½å¤ŸçŸ¥é“è¿™ä¸ªå˜åŒ–ï¼Œå¹¶ä¸”åŠæ—¶é€šçŸ¥è§†å›¾è¿›è¡Œæ›´æ–°ã€‚</span></span><br><span class="line">        <span class="title function_">traverse</span>(value) </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">popTarget</span>() <span class="comment">//å‡ºæ ˆ</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">cleanupDeps</span>() <span class="comment">//æ¸…é™¤æ‰€æœ‰Deps</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Add a dependency to this directive.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">addDep</span>(<span class="params">dep: Dep</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> id = dep.<span class="property">id</span></span><br><span class="line">    <span class="comment">//å¦‚æœä¸´æ—¶çš„IDé›†åˆæ²¡æœ‰åŒ…å«è¿™ä¸ªID</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">has</span>(id)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">add</span>(id) <span class="comment">//åŠ å…¥</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">newDeps</span>.<span class="title function_">push</span>(dep) <span class="comment">//åŠ å…¥ä¸´æ—¶ä¾èµ–çš„é›†åˆ</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">depIds</span>.<span class="title function_">has</span>(id)) &#123; <span class="comment">//å¦‚æœä¾èµ–IDé›†åˆé‡Œé¢,æ²¡æœ‰</span></span><br><span class="line">        dep.<span class="title function_">addSub</span>(<span class="variable language_">this</span>) <span class="comment">//åœ¨Depä¸­åŠ å…¥è¿™ä¸ªwatch</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Clean up for dependency collection.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">cleanupDeps</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éå†depsï¼Œå¦‚æœæ²¡æœ‰åœ¨ newDepIds ï¼Œåˆ é™¤å½“å‰è¿™ä¸ª watch å®ä¾‹ã€‚</span></span><br><span class="line">    <span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="property">length</span></span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      <span class="keyword">const</span> dep = <span class="variable language_">this</span>.<span class="property">deps</span>[i]</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">has</span>(dep.<span class="property">id</span>)) &#123;</span><br><span class="line">        dep.<span class="title function_">removeSub</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°† newDepIds å’Œ newDeps èµ‹å€¼ç»™ depIds å’Œ deps ï¼Œä¸´æ—¶åˆ—è¡¨æ¸…ç©º</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">tmp</span>: <span class="built_in">any</span> = <span class="variable language_">this</span>.<span class="property">depIds</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">depIds</span> = <span class="variable language_">this</span>.<span class="property">newDepIds</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDepIds</span> = tmp</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">clear</span>()</span><br><span class="line">    tmp = <span class="variable language_">this</span>.<span class="property">deps</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">deps</span> = <span class="variable language_">this</span>.<span class="property">newDeps</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDeps</span> = tmp</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDeps</span>.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Subscriber interface.</span></span><br><span class="line"><span class="comment">   * Will be called when a dependency changes.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="comment">//åˆ¤æ–­lazy å¦‚æœæ˜¯ï¼Œdirty = trueï¼Œè¡¨ç¤ºå‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰é‡æ–°è®¡ç®—ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">lazy</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">sync</span>) &#123;</span><br><span class="line">      <span class="comment">//å¦‚æœ sync = trueï¼ŒåŒæ­¥æ‰§è¡Œï¼Œè°ƒç”¨run</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">run</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//å¦‚æœæ˜¯å¼‚æ­¥æ‰§è¡Œï¼ŒåŠ å…¥é˜Ÿåˆ—ã€‚</span></span><br><span class="line">      <span class="title function_">queueWatcher</span>(<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Scheduler job interface.</span></span><br><span class="line"><span class="comment">   * Will be called by the scheduler.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯ active</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">active</span>) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//è°ƒç”¨ get è·å– value</span></span><br><span class="line">      <span class="keyword">const</span> value = <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        <span class="comment">//å½“ æ–°æ—§ value ä¸ä¸€è‡´</span></span><br><span class="line">        <span class="comment">//å½“ æ–°å€¼ æ˜¯object</span></span><br><span class="line">        <span class="comment">//æˆ–è€…æ·±åº¦éå† deep = true</span></span><br><span class="line">        value !== <span class="variable language_">this</span>.<span class="property">value</span> ||</span><br><span class="line">        <span class="comment">// Deep watchers and watchers on Object/Arrays should fire even</span></span><br><span class="line">        <span class="comment">// when the value is the same, because the value may</span></span><br><span class="line">        <span class="comment">// have mutated.</span></span><br><span class="line">        <span class="title function_">isObject</span>(value) ||</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">deep</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="comment">// set new value</span></span><br><span class="line">        <span class="keyword">const</span> oldValue = <span class="variable language_">this</span>.<span class="property">value</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿™é‡Œå°±æ˜¯å›è°ƒï¼Œç”¨æˆ·è‡ªå®šä¹‰å› ä¸ºéœ€è¦æ–¹ä¾¿è°ƒè¯•ï¼Œæ‰€ä»¥ç”¨è¿™ç§æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">user</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> info = <span class="string">`callback for watcher &quot;<span class="subst">$&#123;<span class="variable language_">this</span>.expression&#125;</span>&quot;`</span></span><br><span class="line">          <span class="title function_">invokeWithErrorHandling</span>(</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cb</span>,</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">vm</span>,</span><br><span class="line">            [value, oldValue],</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">vm</span>,</span><br><span class="line">            info</span><br><span class="line">          )</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">cb</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, value, oldValue)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Evaluate the value of the watcher.</span></span><br><span class="line"><span class="comment">   * This only gets called for lazy watchers.</span></span><br><span class="line"><span class="comment">   * è¯„ä¼° watcher çš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">   * åªæœ‰æ‡’æƒ°çš„ watcher æ‰ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">   * è¿™ä¸ªéœ€è¦ç»“åˆåˆšæ‰çš„ upadte æ¥çœ‹ï¼Œå¦‚æœ this.lazy = true. é‚£ä¹ˆ dirty = trueï¼Œ ç„¶åæ‰§è¡Œè¿™ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">evaluate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Depend on all deps collected by this watcher.</span></span><br><span class="line"><span class="comment">   * æŠŠ deps å…¨éƒ¨éå†ï¼Œ depends å…¨éƒ¨æ‰§è¡Œåˆ°å½“å‰ Dep.target ä¸­</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">depend</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="property">length</span></span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">deps</span>[i].<span class="title function_">depend</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Remove self from all dependencies&#x27; subscriber list.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">teardown</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//_isBeingDestroyedï¼Œç”¨äºæ ‡è¯†è¯¥å®ä¾‹æ˜¯å¦æ­£åœ¨è¢«é”€æ¯ã€‚å½“è¿™ä¸ªæ ‡è®°ä¸º true æ—¶ï¼ŒVue ä¼šåœæ­¢ç»§ç»­è§‚å¯Ÿæ•°æ®ï¼Œå¹¶ä¸”åœ¨ä¸€äº›é’©å­å‡½æ•°ä¸­ï¼Œå¯èƒ½éœ€è¦åˆ¤æ–­è¿™ä¸ªæ ‡è®°æ¥å†³å®šæ˜¯å¦æ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚é¿å…åœ¨ç»„ä»¶å·²ç»è¢«é”€æ¯åè¿˜æ‰§è¡Œä¸€äº›å¼‚æ­¥æ“ä½œï¼Œä»è€Œé¿å…å¯èƒ½çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">vm</span> &amp;&amp; !<span class="variable language_">this</span>.<span class="property">vm</span>.<span class="property">_isBeingDestroyed</span>) &#123;</span><br><span class="line">      <span class="title function_">remove</span>(<span class="variable language_">this</span>.<span class="property">vm</span>.<span class="property">_scope</span>.<span class="property">effects</span>, <span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ˜¯å¦æ˜¯æ¿€æ´»çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">active</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="property">length</span></span><br><span class="line">      <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">        <span class="comment">//æ¸…é™¤æ‰€æœ‰å¼•ç”¨</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">deps</span>[i].<span class="title function_">removeSub</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//è®¾ç½®ä¸æ¿€æ´»</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">active</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//è§¦å‘é’©å­</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">onStop</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">onStop</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="02-æ€»ç»“"><a href="#02-æ€»ç»“" class="headerlink" title="02. æ€»ç»“"></a>02. æ€»ç»“</h3><p>watch åšäº†ä»€ä¹ˆï¼Ÿ</p><blockquote><p>ç”¨äºç›‘å¬ä¸€ä¸ªæ•°æ®å¯¹è±¡çš„å˜åŒ–ï¼Œå¹¶åœ¨å˜åŒ–æ—¶æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p><p>åœ¨åˆå§‹åŒ–æ—¶ï¼Œwatcher ä¼šæ”¶é›†ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯å°†å½“å‰çš„ watcher å¯¹è±¡èµ‹å€¼ç»™å½“å‰è®¿é—®çš„æ•°æ®å¯¹è±¡çš„ dep å®ä¾‹ï¼Œä»è€Œå»ºç«‹æ•°æ®å¯¹è±¡å’Œ watcher çš„å…³è”å…³ç³»ã€‚å½“æ•°æ®å¯¹è±¡çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œdep å®ä¾‹ä¼šé€šçŸ¥æ‰€æœ‰çš„ watcherï¼Œwatcher ä¼šé‡æ–°æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p><p>åœ¨æ‰§è¡Œå›è°ƒå‡½æ•°ä¹‹å‰ï¼Œwatcher è¿˜ä¼šè¿›è¡Œä¸€äº›ä¼˜åŒ–å¤„ç†ï¼Œæ¯”å¦‚åˆ¤æ–­å½“å‰å›è°ƒå‡½æ•°æ˜¯å¦æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå¦‚æœæ˜¯åˆ™å°†å…¶åŠ å…¥åˆ°å¼‚æ­¥é˜Ÿåˆ—ä¸­ï¼Œä»è€Œé¿å…è¿ç»­å¤šæ¬¡çš„æ›´æ–°æ“ä½œï¼Œæé«˜æ€§èƒ½ã€‚åŒæ—¶ï¼Œwatcher è¿˜æ”¯æŒä¸€äº›é«˜çº§ç‰¹æ€§ï¼Œæ¯”å¦‚ computedã€watchEffect ç­‰ã€‚</p></blockquote><p><code>get</code> æ–¹æ³•ä¸»ä½œç”¨è·å–è¡¨è¾¾å¼çš„å€¼ï¼Œå…¶ä¸­åŒ…å« Dep.target è¿›æ ˆå’Œå‡ºæ ˆçš„æ“ä½œï¼Œå¹¶ä¸”éå†è·å–çš„å€¼çš„æ‰€æœ‰å±æ€§ï¼Œå°†å…¶å“åº”å¼ã€‚</p><ol><li>pushTarget</li><li>è·å–è¡¨è¾¾å¼ value</li><li>traverse(value) è¿½ç§æ‰€æœ‰å±æ€§ï¼Œå“åº”å¼alue</li><li>popTarget() &#x2F;&#x2F;å‡ºæ ˆ</li><li>this.cleanupDeps() &#x2F;&#x2F;æ¸…ç†</li></ol><p><code>addDep</code> å¦‚æœä¸´æ—¶IDçš„é›†åˆæ²¡æœ‰åŒ…å«è¿™ä¸ªDepï¼Œé‚£ä¹ˆåœ¨ä¸´æ—¶IDé›†åˆä»¥åŠä¸´æ—¶é›†åˆä¸­åŠ å…¥ï¼Œç»§ç»­åˆ¤æ–­ï¼Œå¦‚æœä¾èµ–IDé›†åˆ(ä¸æ˜¯ä¸´æ—¶)æ²¡æœ‰åŒ…å«è¿™ä¸ªIDï¼Œé‚£ä¹ˆè¿™ä¸ªDep.addSub(this)</p><p><code>update</code> æ›´æ–°ï¼Œ3ç§æ›´æ–°</p><ol><li>æ‡’æ›´æ–° &#x3D;&gt; ditry &#x3D; true</li><li>!!sync &#x3D;&gt; run()</li><li>!sync &#x3D;&gt; è¿›å…¥é˜Ÿåˆ—</li></ol><p><code>evaluate</code> è·å– value èµ‹å€¼ï¼Œdirty &#x3D; falseã€‚</p><p><code>run</code> å¦‚æœæ˜¯å¦æ˜¯ <code>active</code>ï¼Œè·å–å€¼ï¼Œå¹¶ä¸”è°ƒç”¨ callbcak</p><p><code>depend</code> æŠŠ deps å…¨éƒ¨éå†ï¼Œ depends å…¨éƒ¨æ‰§è¡Œåˆ°å½“å‰ Dep.target ä¸­</p><p><code>teardown</code> æ¸…é™¤å…³äºè¿™ä¸ª dep ä¸­æ‰€æœ‰çš„å½“å‰ watcherã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> æºç  </tag>
            
            <tag> vue2 </tag>
            
            <tag> wather </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue beforeUpdate</title>
      <link href="/2023/06/26/vue_beforeUpdate/"/>
      <url>/2023/06/26/vue_beforeUpdate/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="beforeUpdate-vs-onBeforeUpdate"><a href="#beforeUpdate-vs-onBeforeUpdate" class="headerlink" title="beforeUpdate vs onBeforeUpdate"></a>beforeUpdate vs onBeforeUpdate</h1><p>beforeCreate -&gt; setup()<br>created -&gt; setup()<br>beforeMount -&gt; onBeforeMount<br>mounted -&gt; onMounted<br>beforeUpdate -&gt; onBeforeUpdate<br>updated -&gt; onUpdated<br>beforeDestroy -&gt; onBeforeUnmount<br>destroyed -&gt; onUnmounted<br>activated -&gt; onActivated<br>deactivated -&gt; onDeactivated<br>errorCaptured -&gt; onErrorCaptured</p><h3 id="vue3-x-onBeforeUpdate"><a href="#vue3-x-onBeforeUpdate" class="headerlink" title="vue3.x onBeforeUpdate"></a>vue3.x onBeforeUpdate</h3><p>æœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥è°ƒç”¨ <code>onBeforeUpdate</code></p><p>ç¬¬ä¸€ä¸ªæ˜¯åœ¨ç»„ä»¶æ¸²æŸ“å‡½æ•°ä¸­ <code>setupRenderEffect</code>, é‡Œé¢åˆ›å»ºäº† <code>componentUpdateFn</code> å‡½æ•°ï¼Œäº¤ç»™å‰¯ä½œç”¨å‡½æ•°ç›‘æ§ã€‚</p><p>ä¸­é—´ç¬¬ä¸€è¡Œä»£ç å°±æ˜¯å»åˆ¤æ–­</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!instance.<span class="property">isMounted</span>) &#123; <span class="comment">// å¦‚æœç»„ä»¶å®ä¾‹æœªæŒ‚è½½</span></span><br><span class="line"><span class="comment">//åˆ›å»ºç»„ä»¶</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//æ›´æ–°ç»„ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´æ–°ç»„ä»¶ä¸­çš„å°±æ˜¯ä¼šè°ƒç”¨ <code>beforeUpdate</code>.</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; next, bu, u, parent, vnode &#125; = instance</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (bu) &#123; <span class="comment">// å¦‚æœ beforeUpdate é’©å­å­˜åœ¨</span></span><br><span class="line">  <span class="title function_">invokeArrayFns</span>(bu) <span class="comment">// è°ƒç”¨ invokeArrayFns å‡½æ•°ï¼Œä¾æ¬¡æ‰§è¡Œ beforeUpdate é’©å­å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œ <code>beforeMount</code> ä¸€æ ·ï¼Œç«‹å³è§¦å‘ã€‚</p><h3 id="Vue2-x-beforeUpdate"><a href="#Vue2-x-beforeUpdate" class="headerlink" title="Vue2.x beforeUpdate"></a>Vue2.x beforeUpdate</h3><p>é€»è¾‘ç±»ä¼¼ï¼Œéƒ½æ˜¯åœ¨ mountComponent çš„æ—¶å€™ç›‘è§†ç»„ä»¶ï¼Œç„¶åè§¦å‘æ›´æ–°.</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Watcher</span>(</span><br><span class="line">  vm,</span><br><span class="line">  updateComponent,</span><br><span class="line">  noop,</span><br><span class="line">  watcherOptions,</span><br><span class="line">  <span class="literal">true</span> <span class="comment">/* isRenderWatcher */</span></span><br><span class="line">)</span><br><span class="line">hydrating = <span class="literal">false</span></span><br></pre></td></tr></table></figure><p><code>updateComponent</code> å°±æ˜¯æ›´æ–°å‡½æ•°ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª <code>watcherOptions</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">watcherOptions</span>: <span class="title class_">WatcherOptions</span> = &#123;</span><br><span class="line">  <span class="title function_">before</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (vm.<span class="property">_isMounted</span> &amp;&amp; !vm.<span class="property">_isDestroyed</span>) &#123;</span><br><span class="line">      <span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeUpdate&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“é‡åˆ°æ›´æ–°è§¦å‘ï¼Œç„¶åè§¦å‘é’©å­ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>éƒ½æ˜¯åœ¨ <code>mountComponent</code> åˆ›å»ºç»„ä»¶çš„æ—¶å€™å¤„ç†æ›´æ–°é€»è¾‘ã€‚</p><p><strong>Vue2.x</strong> é€šè¿‡ <code>watch options before</code> è§¦å‘</p><p><strong>Vue3.x</strong> é€šè¿‡ <code>effect</code> è§¦å‘ <code>updateComponent</code> è§¦å‘ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> vue2 </tag>
            
            <tag> typescript </tag>
            
            <tag> ç”Ÿå‘½å‘¨æœŸ </tag>
            
            <tag> beforeUpdate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue mounted</title>
      <link href="/2023/06/26/vue_mounted/"/>
      <url>/2023/06/26/vue_mounted/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="Vue-mounted"><a href="#Vue-mounted" class="headerlink" title="Vue mounted"></a>Vue mounted</h1><h3 id="1-Vue2-mounted"><a href="#1-Vue2-mounted" class="headerlink" title="1. Vue2 mounted"></a>1. Vue2 mounted</h3><p>åœ¨ <code>beforeMount</code> ä¹‹ååšäº†ä»€ä¹ˆï¼Ÿ</p><ol><li>åˆ›å»ºäº† <code>updateComponent</code> å‡½æ•°ï¼Œè°ƒç”¨ <code>vm._update(vm._render, hydrating);</code></li><li>åˆ›å»º <code>watcher</code>, ç›‘è§†<code>vm</code>, å‘ç”Ÿå˜åŒ–è°ƒç”¨ <code>updateComponent</code>ï¼Œ åœ¨æ‰§è¡Œä¹‹å‰è°ƒç”¨ <code>beforeUpdate</code></li><li>è°ƒç”¨ <code>preWatchers</code></li><li>å¦‚æœåˆ›å»ºæˆåŠŸï¼Œè°ƒç”¨ <code>mounted</code></li></ol><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¿…é¡»çŸ¥é“ <strong>Vue2</strong> <code>watcher</code> æ˜¯ä»€ä¹ˆ?</p><blockquote><p>åœ¨ Vue 2.x ä¸­ï¼ŒWatcher çš„ä½œç”¨æ˜¯å»ºç«‹æ•°æ®çš„å“åº”å¼ä¾èµ–å…³ç³»å¹¶åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶æ›´æ–°ç›¸å…³çš„è§†å›¾ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šæ ¹æ® vm å±æ€§å˜åŒ–ï¼Œè°ƒç”¨ updateComponentï¼Œåœ¨ <code>new watcher(...)</code> çš„æ—¶å€™ï¼Œä¼šç«‹åˆ»è°ƒç”¨ä¸€æ¬¡ã€‚</p><p>æŒ‰ç…§ä»£ç é€»è¾‘æ¥è¯´</p><p>new Wather(â€¦) ç¬¬ä¸€æ¬¡è°ƒç”¨æ¸²æŸ“ç»„ä»¶, è°ƒç”¨ </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">updateComponent = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">vm.<span class="title function_">_update</span>(vm.<span class="title function_">_render</span>(), hydrating)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Watcher</span>(</span><br><span class="line">  vm,</span><br><span class="line">  updateComponent,</span><br><span class="line">  noop,</span><br><span class="line">  watcherOptions,</span><br><span class="line">  <span class="literal">true</span> <span class="comment">/* isRenderWatcher */</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">watcherOptions</span>: <span class="title class_">WatcherOptions</span> = &#123;</span><br><span class="line"><span class="title function_">before</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (vm.<span class="property">_isMounted</span> &amp;&amp; !vm.<span class="property">_isDestroyed</span>) &#123;</span><br><span class="line"><span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeUpdate&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (vm.<span class="property">$vnode</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">  vm.<span class="property">_isMounted</span> = <span class="literal">true</span></span><br><span class="line">  <span class="title function_">callHook</span>(vm, <span class="string">&#x27;mounted&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§¦å‘å®Œæˆ <code>updateComponent</code> ç„¶åé¡ºåºè°ƒç”¨ <code>mounted</code>. å½“ <code>vm</code> è§¦å‘æ›´æ–°ï¼Œ<code>_isMouted = true</code>ï¼Œå¯ä»¥è§¦å‘ <code>beforeUpdate</code>.</p><p>ä½†æ˜¯å®é™…ä¸Šï¼Œå¹¶ä¸æ˜¯è¿™æ ·ï¼Œä¸Šé¢æ˜¯æˆ‘ç†è§£çš„ä»£ç é€»è¾‘ï¼Œä½†æ˜¯å¦‚æœæ˜¯è¿™æ ·é¡ºåºå°±æœ‰é—®é¢˜ï¼Œè€Œä¸”å®é™…æµ‹è¯•ä¸æ˜¯è¿™æ ·ã€‚</p><p>æ‰€ä»¥è¦çŸ¥é“ mounted æ€ä¹ˆè§¦å‘ï¼Œå°±éœ€è¦ææ¸…æ¥š <code>render</code> å’Œ <code>update</code> çš„è¯¦ç»†é€»è¾‘</p><p><code>render</code> æ–¹æ³•å°±æ˜¯åœ¨ <code>renderMixin</code> å½“ä¸­  </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_render</span> = <span class="keyword">function</span> (<span class="params"></span>): <span class="title class_">VNode</span> &#123; <span class="comment">//...</span></span><br></pre></td></tr></table></figure><p>å°±æ˜¯è°ƒç”¨é€šè¿‡ä½ æ¨¡æ¿ä¸­è§£æå‡ºæ¥çš„ <code>render</code> å‡½æ•°, è§£ææ¨¡æ¿ä¸ºä¸€ä¸ª <code>vnode</code>ï¼Œè®¾ç½®äº†ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œè®¾ç½®å±æ€§</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vm.<span class="property">$vnode</span> = _parentVnode!</span><br><span class="line">vnode.<span class="property">parent</span> = _parentVnode</span><br></pre></td></tr></table></figure><p>æ€»ä¹‹å°±æ˜¯è¿”å›ä¸€ä¸ª <code>vnode</code>. å¹¶ä¸”è®¾ç½®äº† <code>vm</code> &amp; <code>vnode</code> å±æ€§ã€‚</p><p>ç»§ç»­æ¥çœ‹ _update, ä»–é€šè¿‡è°ƒç”¨ createElm æ¥åˆ›å»ºèŠ‚ç‚¹ã€‚é‡ç‚¹åœ¨åˆ›å»ºå®Œæˆä»¥åï¼Œä»–é€šè¿‡ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¥è°ƒç”¨ <code>vnode.data.hook.insert</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">invokeInsertHook</span>(vnode, insertedVnodeQueue, isInitialPatch)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">invokeInsertHook</span>(<span class="params">vnode, queue, initial</span>) &#123;</span><br><span class="line">  <span class="comment">// delay insert hooks for component root nodes, invoke them after the</span></span><br><span class="line">  <span class="comment">// element is really inserted</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isTrue</span>(initial) &amp;&amp; <span class="title function_">isDef</span>(vnode.<span class="property">parent</span>)) &#123;</span><br><span class="line">    vnode.<span class="property">parent</span>.<span class="property">data</span>.<span class="property">pendingInsert</span> = queue</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; queue.<span class="property">length</span>; ++i) &#123;</span><br><span class="line">      queue[i].<span class="property">data</span>.<span class="property">hook</span>.<span class="title function_">insert</span>(queue[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>initial</code> æ˜¯ç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºã€‚</p><p>queue æ˜¯ insertedVnodeQueueã€‚ insertedVnodeQueue æ˜¯å·²ç»æ’å…¥äº† <code>Vnode</code> é˜Ÿåˆ—, å¯ä»¥ç†è§£ä¸ºåˆ›å»ºå®Œæˆ <code>vnode</code>ï¼Œä¼š <code>push</code> åˆ°é‡Œé¢.</p><p>ç„¶åè¿™ä¸ªç»„ä»¶æ‰€æœ‰çš„ç»„ä»¶åˆ›å»ºå®Œæˆä»¥åï¼Œå°±ä¼šå¼€å§‹è°ƒç”¨è¿™ä¸ªé˜Ÿåˆ— <code>insertedVnodeQueueï¼Œç„¶åè°ƒç”¨</code> <code>vnode.data.hook.insert</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">insert</span>(<span class="params">vnode: MountedComponentVNode</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; context, componentInstance &#125; = vnode</span><br><span class="line">  <span class="keyword">if</span> (!componentInstance.<span class="property">_isMounted</span>) &#123;</span><br><span class="line">    componentInstance.<span class="property">_isMounted</span> = <span class="literal">true</span></span><br><span class="line">    <span class="title function_">callHook</span>(componentInstance, <span class="string">&#x27;mounted&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">data</span>.<span class="property">keepAlive</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (context.<span class="property">_isMounted</span>) &#123;</span><br><span class="line">      <span class="comment">// vue-router#1212</span></span><br><span class="line">      <span class="comment">// During updates, a kept-alive component&#x27;s child components may</span></span><br><span class="line">      <span class="comment">// change, so directly walking the tree here may call activated hooks</span></span><br><span class="line">      <span class="comment">// on incorrect children. Instead we push them into a queue which will</span></span><br><span class="line">      <span class="comment">// be processed after the whole patch process ended.</span></span><br><span class="line">      <span class="title function_">queueActivatedComponent</span>(componentInstance)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">activateChildComponent</span>(componentInstance, <span class="literal">true</span> <span class="comment">/* direct */</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å½“æ‰€æœ‰çš„å­èŠ‚ç‚¹éƒ½è°ƒç”¨ insert, ç„¶åæœ€åè°ƒç”¨æ ¹èŠ‚ç‚¹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (vm.<span class="property">$vnode</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">  vm.<span class="property">_isMounted</span> = <span class="literal">true</span></span><br><span class="line">  <span class="title function_">callHook</span>(vm, <span class="string">&#x27;mounted&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> vm</span><br></pre></td></tr></table></figure><p>åˆ›å»ºï¼Œå¹¶ä¸”æ¸²æŸ“å®Œæˆæ‰€æœ‰ vnode ä»¥åï¼Œ ä¾ç…§æ¬¡åºè°ƒç”¨ mounted.</p><p>æ‰€ä»¥ä¼šé€ æˆä¸€ç§ç»“æœ</p><h3 id="2-vue3-x-mounted"><a href="#2-vue3-x-mounted" class="headerlink" title="2. vue3.x mounted"></a>2. vue3.x mounted</h3><p>æˆ‘ä»¬ä»å‰é¢çš„æ–‡ç« å¯ä»¥çŸ¥é“ï¼ŒVue3.x å¦‚ä½•æ³¨å†Œå’Œè°ƒç”¨ç”Ÿå‘½å‘¨æœŸçš„, åœ°å€åœ¨è¿™é‡Œ <a href="/tblog/2023/06/20/vue_lifecycle/">Vue lifecycle å®ç°</a>.</p><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä»–åœ¨å“ªé‡Œè°ƒç”¨ï¼Œå¹¶ä¸”åœ¨è°ƒç”¨ä¹‹å‰åšäº†ä»€ä¹ˆï¼Ÿ</p><p>åœ¨ componentUpdateFn ä¸­è°ƒç”¨</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; bm, m, parent &#125; = instance <span class="comment">//å–å‡ºéœ€è¦çš„ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (bm) &#123; <span class="comment">// å¦‚æœ beforeMount é’©å­å­˜åœ¨</span></span><br><span class="line">  <span class="title function_">invokeArrayFns</span>(bm) <span class="comment">// è°ƒç”¨ invokeArrayFns å‡½æ•°ï¼Œä¾æ¬¡æ‰§è¡Œ beforeMount é’©å­å‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (m) &#123; <span class="comment">// å¦‚æœ mounted é’©å­å­˜åœ¨</span></span><br><span class="line">  <span class="title function_">queuePostRenderEffect</span>(m, parentSuspense) <span class="comment">// å°† mounted é’©å­å‡½æ•°æ·»åŠ åˆ° post é’©å­é˜Ÿåˆ—ä¸­</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>queuePostRenderEffect</code> ä¼šè°ƒç”¨ <code>queuePostFlushCb</code>ï¼Œç„¶åå‘ <code>pendingPostFlushCbs.push(m)</code>.</p><p>ç„¶åä¼šåœ¨ <code>render</code> å®Œæˆä»¥åè°ƒç”¨ <code>pendingPostFlushCbs</code>ï¼Œå¾ªç¯è§¦å‘äº‹ä»¶ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">render</span>: <span class="title class_">RootRenderFunction</span> = <span class="function">(<span class="params">vnode, container, isSVG</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (vnode == <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (container.<span class="property">_vnode</span>) &#123;</span><br><span class="line">    <span class="title function_">unmount</span>(container.<span class="property">_vnode</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="title function_">patch</span>(container.<span class="property">_vnode</span> || <span class="literal">null</span>, vnode, container, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, isSVG) <span class="comment">//åˆ›å»º</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">flushPreFlushCbs</span>() <span class="comment">//é¢„äº‹ä»¶</span></span><br><span class="line"><span class="title function_">flushPostFlushCbs</span>() <span class="comment">//è°ƒç”¨äº‹ä»¶</span></span><br><span class="line">container.<span class="property">_vnode</span> = vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>patch å°±æ˜¯åˆ›å»ºæˆ–è€…æ›´æ–° vnode çš„æ–¹æ³•ã€‚</p><p>æ ¹æ®ä¸Šé¢çš„ä»£ç ä¼šå¾—åˆ°çš„ç»“æœå°±æ˜¯ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">parent vnode beforeMount trigger</span><br><span class="line">child vnode beforeMount trigger</span><br><span class="line">child vnode mounted trigger</span><br><span class="line">parent vnode mounted trigger</span><br></pre></td></tr></table></figure><p>å’Œ Vue2.x ä¸€æ ·ï¼Œè¿™å°±æ˜¯ <code>onMounted</code> çš„è°ƒç”¨, é‚£ä¹ˆç»§ç»­çœ‹ <code>beforeMount</code> åˆ° <code>Mounted</code> ä¹‹é—´åšäº†ä»€ä¹ˆ.</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (bm) &#123;</span><br><span class="line">  <span class="title function_">invokeArrayFns</span>(bm)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä» <code>beforeMount</code> å¼€å§‹, ç›´æ¥ <code>invokeArrayFns</code> æ˜¯ç›´æ¥è°ƒç”¨ï¼Œä¸å­˜åœ¨å»¶è¿Ÿ.</p><p>å¦‚æœä¸æ˜¯ ssr çš„è¯ï¼Œç›´æ¥è°ƒç”¨ patch åˆ›å»ºç»„ä»¶, å°†å­æ ‘çš„ el å±æ€§èµ‹å€¼ç»™åˆå§‹ VNode çš„ el å±æ€§</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">patch</span>(</span><br><span class="line"><span class="literal">null</span>,</span><br><span class="line">subTree,</span><br><span class="line">container,</span><br><span class="line">anchor,</span><br><span class="line">instance,</span><br><span class="line">parentSuspense,</span><br><span class="line">isSVG</span><br><span class="line">)</span><br><span class="line">initialVNode.<span class="property">el</span> = subTree.<span class="property">el</span></span><br></pre></td></tr></table></figure><p>å¦‚æœé’©å­å­˜åœ¨åŠ å…¥é˜Ÿåˆ—</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (m) &#123; </span><br><span class="line">  <span class="title function_">queuePostRenderEffect</span>(m, parentSuspense) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åç›´æ¥è°ƒç”¨ <code>vnode</code> å†…éƒ¨çš„ <code>mounted hook</code> å’Œ <strong>Vue2.x</strong> å†™æ³•çš„å…¼å®¹æ€§</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!isAsyncWrapperVNode &amp;&amp; (vnodeHook = props &amp;&amp; props.<span class="property">onVnodeMounted</span>)) &#123; <span class="comment">// å¦‚æœä¸æ˜¯å¼‚æ­¥ç»„ä»¶çš„åŒ…è£… VNodeï¼Œå¹¶ä¸”å­˜åœ¨ onVnodeMounted é’©å­</span></span><br><span class="line">  <span class="keyword">const</span> scopedInitialVNode = initialVNode</span><br><span class="line">  <span class="title function_">queuePostRenderEffect</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="title function_">invokeVNodeHook</span>(vnodeHook!, parent, scopedInitialVNode),</span><br><span class="line">    parentSuspense</span><br><span class="line">  ) <span class="comment">// å°† onVnodeMounted é’©å­å‡½æ•°æ·»åŠ åˆ° post é’©å­é˜Ÿåˆ—ä¸­</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">  __COMPAT__ &amp;&amp;</span><br><span class="line">  <span class="title function_">isCompatEnabled</span>(<span class="title class_">DeprecationTypes</span>.<span class="property">INSTANCE_EVENT_HOOKS</span>, instance)</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="title function_">queuePostRenderEffect</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> instance.<span class="title function_">emit</span>(<span class="string">&#x27;hook:mounted&#x27;</span>),</span><br><span class="line">    parentSuspense</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åˆå¤„ç†äº† active äº‹ä»¶ï¼ˆè¿™ä¸ªåé¢å†è®²ï¼‰ï¼Œå¹¶ä¸”è®¾ç½® <code>instance.isMounted = true</code>.</p><p>å†è¿™ä¸ªè¿‡ç¨‹ä¸­ä½ ä¼šå‘è§‰ï¼Œå…¶å®å°±æ˜¯æ‰§è¡Œäº† <code>patch</code> åˆ›å»ºæˆ–è€…æ›´æ–°äº†çœŸå® domï¼Œç„¶åè§¦å‘.</p><p>æ‰€ä»¥è¿‡ç¨‹ï¼Œæµç¨‹å°±æ˜¯å½“åˆšå¼€å§‹ mount &#x3D;&gt; render &#x3D;&gt; patch &#x3D;&gt; ç„¶åæ ¹æ® vnode ä¸åœçš„åˆ¤æ–­å¾ªç¯ï¼Œé€’å½’ï¼Œä¸åœçš„åˆ›å»ºçœŸå®domã€‚</p><p>ç­‰çœŸå®åˆ›å»ºå®Œæˆæ‰§è¡Œåé¢çš„ä»£ç </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">render</span>: <span class="title class_">RootRenderFunction</span> = <span class="function">(<span class="params">vnode, container, isSVG</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (vnode == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (container.<span class="property">_vnode</span>) &#123;</span><br><span class="line">      <span class="title function_">unmount</span>(container.<span class="property">_vnode</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">patch</span>(container.<span class="property">_vnode</span> || <span class="literal">null</span>, vnode, container, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, isSVG)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">flushPreFlushCbs</span>() <span class="comment">//</span></span><br><span class="line">  <span class="title function_">flushPostFlushCbs</span>() <span class="comment">//æ‰§è¡Œåˆšæ‰æ’å…¥çš„é’©å­</span></span><br><span class="line">  container.<span class="property">_vnode</span> = vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3. æ€»ç»“"></a>3. æ€»ç»“</h3><p>å…¶å®åˆ›å»ºé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸå°±èµ°åˆ°è¿™é‡Œäº†ã€‚</p><p>setup &#x3D;&gt; onBeforeMount &#x3D;&gt; onMounted</p><p>beforeCreate &#x3D;&gt; created &#x3D;&gt; beforeMount &#x3D;&gt; mounted</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> vue2 </tag>
            
            <tag> typescript </tag>
            
            <tag> ç”Ÿå‘½å‘¨æœŸ </tag>
            
            <tag> mounted </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue beforeMount vs onBeforeMount</title>
      <link href="/2023/06/24/vue_beforeMount_onBeforeMount/"/>
      <url>/2023/06/24/vue_beforeMount_onBeforeMount/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="Vue-beforeMount-vs-onBeforeMount"><a href="#Vue-beforeMount-vs-onBeforeMount" class="headerlink" title="Vue beforeMount vs onBeforeMount"></a>Vue beforeMount vs onBeforeMount</h1><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">beforeCreate -&gt; <span class="title function_">setup</span>()</span><br><span class="line">created -&gt; <span class="title function_">setup</span>()</span><br><span class="line">beforeMount -&gt; onBeforeMount</span><br><span class="line">mounted -&gt; onMounted</span><br><span class="line">beforeUpdate -&gt; onBeforeUpdate</span><br><span class="line">updated -&gt; onUpdated</span><br><span class="line">beforeDestroy -&gt; onBeforeUnmount</span><br><span class="line">destroyed -&gt; onUnmounted</span><br><span class="line">activated -&gt; onActivated</span><br><span class="line">deactivated -&gt; onDeactivated</span><br><span class="line">errorCaptured -&gt; onErrorCaptured</span><br></pre></td></tr></table></figure><h3 id="1-beforeMount"><a href="#1-beforeMount" class="headerlink" title="1. beforeMount"></a>1. beforeMount</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">callHook</span>(vm, <span class="string">&#x27;created&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (vm.<span class="property">$options</span>.<span class="property">el</span>) &#123;</span><br><span class="line">    vm.$mount(vm.<span class="property">$options</span>.<span class="property">el</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$mount</span> = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">  el?: <span class="built_in">string</span> | Element,</span></span><br><span class="line"><span class="params">  hydrating?: <span class="built_in">boolean</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Component</span> &#123;</span><br><span class="line">  el = el &amp;&amp; inBrowser ? <span class="title function_">query</span>(el) : <span class="literal">undefined</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">mountComponent</span>(<span class="variable language_">this</span>, el, hydrating)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mountComponent</span>(<span class="params"></span></span><br><span class="line"><span class="params">  vm: Component,</span></span><br><span class="line"><span class="params">  el: Element | <span class="literal">null</span> | <span class="literal">undefined</span>,</span></span><br><span class="line"><span class="params">  hydrating?: <span class="built_in">boolean</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Component</span> &#123;</span><br><span class="line">  vm.<span class="property">$el</span> = el</span><br><span class="line">  <span class="keyword">if</span> (!vm.<span class="property">$options</span>.<span class="property">render</span>) &#123;</span><br><span class="line">    <span class="comment">// @ts-expect-error invalid type</span></span><br><span class="line">    vm.<span class="property">$options</span>.<span class="property">render</span> = createEmptyVNode</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeMount&#x27;</span>)</span><br><span class="line">  <span class="comment">//todo...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªæ˜¯å®¶æŸ¥äº† <code>el</code> æ˜¯å¦åœ¨ï¼Œ æ£€æŸ¥äº† <code>vm</code> ä¸­ $<code>options</code> ä¸­æ˜¯å¦æœ‰ <code>render</code>, å¦‚æœæ²¡æœ‰ç»‘å®šä¸€ä¸ªç©ºèŠ‚ç‚¹åˆ° <code>options</code> å½“ä¸­.</p><p>é¦–å…ˆä½ éœ€è¦çŸ¥é“ render æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ</p><blockquote><p>åœ¨Vue.jsä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼æ¥å®šä¹‰ç»„ä»¶çš„è§†å›¾ï¼š</p><p>æ¨¡æ¿æ–¹å¼ï¼šä½¿ç”¨Vueçš„æ¨¡æ¿è¯­æ³•ï¼Œå°†HTMLä»£ç ä¸Vueå®ä¾‹çš„æ•°æ®è¿›è¡Œç»‘å®šã€‚ä½ å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æŒ‡ä»¤ã€è¡¨è¾¾å¼å’Œå…¶ä»–ç‰¹æ€§æ¥å®ç°æ•°æ®çš„æ¸²æŸ“å’Œäº¤äº’ã€‚</p><p>renderå‡½æ•°æ–¹å¼ï¼šä½¿ç”¨JavaScriptç¼–å†™renderå‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼ˆVNodeï¼‰ï¼Œæè¿°äº†ç»„ä»¶çš„DOMç»“æ„ã€‚renderå‡½æ•°æä¾›äº†æ›´çµæ´»å’ŒåŠ¨æ€çš„æ–¹å¼æ¥ç”Ÿæˆç»„ä»¶çš„è§†å›¾ï¼Œä½ å¯ä»¥åœ¨å‡½æ•°ä¸­ä½¿ç”¨JavaScriptçš„è¯­æ³•å’Œé€»è¾‘æ¥å¤„ç†æ•°æ®æ¸²æŸ“ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯æœ‰ä¸ªæ–¹æ³•è‡ªå·±æ¥å†™æ¨¡ç‰ˆç±»ä¼¼äºè¿™ç§</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Counter</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">render</span>(<span class="params">h</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [</span><br><span class="line">      <span class="title function_">h</span>(<span class="string">&#x27;span&#x27;</span>, <span class="string">&#x27;Count: &#x27;</span> + <span class="variable language_">this</span>.<span class="property">count</span>),</span><br><span class="line">      <span class="title function_">h</span>(<span class="string">&#x27;button&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">on</span>: &#123;</span><br><span class="line">          <span class="attr">click</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">count</span>++;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="string">&#x27;Increment&#x27;</span>)</span><br><span class="line">    ]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´è‡ªå·±å»å†™è™šæ‹ŸdomèŠ‚ç‚¹ï¼Œåªæ˜¯æˆ‘æ²¡æœ‰åœ¨å®é™…åº”ç”¨ä¸­æœ‰ç”¨åˆ°è¿™ä¸ªã€‚</p><p>å¯èƒ½æ˜¯æ¯”è¾ƒå¤æ‚çš„æƒ…å†µï¼Œæ¯”å¦‚æ€§èƒ½ä¼˜åŒ–ï¼Œç‰¹åˆ«å¤æ‚çš„æƒ…å†µï¼Œæˆ–è€…è‡ªå®šä¹‰ç»„ä»¶å§ã€‚</p><h3 id="2-onBeforeMount"><a href="#2-onBeforeMount" class="headerlink" title="2. onBeforeMount"></a>2. onBeforeMount</h3><p>ä¹‹å‰å¤§æ¦‚çœ‹äº† <strong>Vue3</strong> çš„ç”Ÿå‘½å‘¨æœŸ, åœ°å€åœ¨è¿™é‡Œ <a href="/tblog/2023/06/20/vue_lifecycle/">Vue lifecycle å®ç°</a></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">setupRenderEffect</span>: <span class="title class_">SetupRenderEffectFn</span> = <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  instance,</span></span></span><br><span class="line"><span class="params"><span class="function">  initialVNode,</span></span></span><br><span class="line"><span class="params"><span class="function">  container,</span></span></span><br><span class="line"><span class="params"><span class="function">  anchor,</span></span></span><br><span class="line"><span class="params"><span class="function">  parentSuspense,</span></span></span><br><span class="line"><span class="params"><span class="function">  isSVG,</span></span></span><br><span class="line"><span class="params"><span class="function">  optimized</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">componentUpdateFn</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!instance.<span class="property">isMounted</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">vnodeHook</span>: <span class="title class_">VNodeHook</span> | <span class="literal">null</span> | <span class="literal">undefined</span></span><br><span class="line">      <span class="keyword">const</span> &#123; el, props &#125; = initialVNode</span><br><span class="line">      <span class="keyword">const</span> &#123; bm, m, parent &#125; = instance</span><br><span class="line">      <span class="keyword">const</span> isAsyncWrapperVNode = <span class="title function_">isAsyncWrapper</span>(initialVNode)</span><br><span class="line"></span><br><span class="line">      <span class="title function_">toggleRecurse</span>(instance, <span class="literal">false</span>)</span><br><span class="line">      <span class="comment">// beforeMount hook</span></span><br><span class="line">      <span class="keyword">if</span> (bm) &#123;</span><br><span class="line">        <span class="title function_">invokeArrayFns</span>(bm)</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p><code>invokeArrayFns</code> å°±æ˜¯éå†ç„¶åä¼ å…¥å‚æ•°, è¿™é‡Œçš„ <code>bm</code> å…¶å®å°±æ˜¯ <code>beforeMount</code> çš„æšä¸¾å€¼ã€‚</p><p>åœ¨æ‰§è¡Œå®Œæˆ <code>setup</code> å‡½æ•°ä»¥åï¼Œå¹¶ä¸”å¤„ç†å®Œæˆ <code>SUSPENSE</code> ä¹‹åï¼Œè°ƒç”¨ <code>setupRenderEffectï¼Œå°±å¼€å§‹æ‰§è¡Œ</code> <code>beforeMount</code></p><h3 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3. æ€»ç»“"></a>3. æ€»ç»“</h3><p>Vue 2.x åœ¨ åˆå¹¶ <code>options</code>ï¼Œ è§£æå®Œ <code>render, evnet, data, methods</code> ä¹‹ç±»çš„ï¼Œå¹¶ä¸”åˆ¤æ–­å®Œæˆ <code>el</code> (å°±æ˜¯)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beforeCreate =&gt; Created =&gt; beforeMount</span><br></pre></td></tr></table></figure><p>Vue3.x åœ¨ä¹Ÿæ˜¯å…ˆåˆå¹¶ <code>options</code>, æ‰§è¡Œå®Œæˆ <code>setup</code> å‡½æ•°ï¼Œå¤„ç†å®Œæˆ <code>SUSPENSEï¼Œ</code> ä¹‹åè°ƒç”¨ <code>beforeMount</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setup =&gt; beforeMount</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> vue2 </tag>
            
            <tag> typescript </tag>
            
            <tag> ç”Ÿå‘½å‘¨æœŸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue3 effect</title>
      <link href="/2023/06/21/vue3_effect/"/>
      <url>/2023/06/21/vue3_effect/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="vue3-effect"><a href="#vue3-effect" class="headerlink" title="vue3 effect"></a>vue3 effect</h1><h3 id="01-track"><a href="#01-track" class="headerlink" title="01. track"></a>01. track</h3><p>ä»¥å“åº”å¼ä»£ç ä¸ºä¾‹å­</p><p><strong>packages&#x2F;reactivity&#x2F;src&#x2F;baseHandlers.ts</strong> ä¸­ <code>createGetter</code> è¯¥æ–¹æ³•ä¸º <code>Proxy</code> æä¾› <code>Getter</code> çš„å·¥å‚æ–¹æ³•</p><p>åœ¨åˆ¤æ–­ï¼Œç‰¹æ®Šè¿”å›å®Œæˆä¹‹åï¼Œä¼šè¿›è¡Œ <code>track</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!isReadonly) &#123;</span><br><span class="line">    <span class="title function_">track</span>(target, <span class="title class_">TrackOpTypes</span>.<span class="property">GET</span>, key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>packages&#x2F;reactivity&#x2F;src&#x2F;effect.ts 214</strong></p><p>é¦–å…ˆä¼šåˆ¤æ–­ <code>houldTrack &amp;&amp; activeEffect</code>, è¿™é‡Œé»˜è®¤å®ƒä¸ºtrueï¼Œå› ä¸ºè¦è§£é‡Šæ˜¯å¦ä¸ºtrueï¼Œéœ€è¦çŸ¥é“åˆ›å»ºå’Œç»‘å®šçš„æµç¨‹ï¼Œä»¥åŠå®ƒçš„è§„åˆ™ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (shouldTrack &amp;&amp; activeEffect) &#123; ... &#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€šè¿‡ target æŸ¥æ‰¾ targetMap è·å– depsMap</span></span><br><span class="line"><span class="keyword">let</span> depsMap = targetMap.<span class="title function_">get</span>(target)</span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰ï¼Œæ–°å»ºMapï¼Œå¹¶ä¸”èµ‹å€¼ depsMap</span></span><br><span class="line"><span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    targetMap.<span class="title function_">set</span>(target, (depsMap = <span class="keyword">new</span> <span class="title class_">Map</span>()))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//depsMap é€šè¿‡ Key è·å–ã€‚</span></span><br><span class="line"><span class="keyword">let</span> dep = depsMap.<span class="title function_">get</span>(key)</span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Depï¼Œ Dep æ˜¯ Set &amp; TrackedMarkers</span></span><br><span class="line"><span class="keyword">if</span> (!dep) &#123;</span><br><span class="line">    depsMap.<span class="title function_">set</span>(key, (dep = <span class="title function_">createDep</span>()))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·Ÿè¸ª Effects</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦éœ€è¦ track</span></span><br><span class="line"><span class="comment">//ç›¸äº’å¼•ç”¨</span></span><br><span class="line"><span class="title function_">trackEffects</span>(dep, eventInfo)</span><br></pre></td></tr></table></figure><p><code>targetMap</code> </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">KeyToDepMap</span> = <span class="title class_">Map</span>&lt;<span class="built_in">any</span>, <span class="title class_">Dep</span>&gt;</span><br><span class="line"><span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>&lt;<span class="built_in">any</span>, <span class="title class_">KeyToDepMap</span>&gt;()</span><br></pre></td></tr></table></figure><p>å®šä¹‰ <code>target =&gt; key =&gt; Dep</code> çš„ä¸€ä¸ªæ˜ å°„è¡¨ï¼Œé€šè¿‡ä»–æ¥å­˜å‚¨ä¹‹é—´çš„å…³ç³»ã€‚<br>å…¶ä¸­ <code>KeyToDepMap</code> å°±æ˜¯ <code>depsMap</code>, æœ€ç»ˆå­˜å‚¨ <code>Dep</code></p><p>Dep æ˜¯ä¸€ä¸ª </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">Dep</span> = <span class="title class_">Set</span>&lt;<span class="title class_">ReactiveEffect</span>&gt; &amp; <span class="title class_">TrackedMarkers</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">TrackedMarkers</span> = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * wasTracked</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">w</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * newTracked</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">n</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>trackEffects</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">trackEffects</span>(<span class="params"></span></span><br><span class="line"><span class="params">  dep: Dep,</span></span><br><span class="line"><span class="params">  debuggerEventExtraInfo?: DebuggerEventExtraInfo</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">let</span> shouldTrack = <span class="literal">false</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="comment">//å…ˆä¸ç”¨çº ç»“ä»–æ€ä¹ˆç®—çš„</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦è¶…è¿‡æœ€å¤§æ•°å€¼</span></span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰è¶…è¿‡ï¼Œå°±æ˜¯éƒ¨åˆ†æ¸…ç†</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦è¢«å…¶ä»– ReactiveEffect è®¿é—®</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">dep.<span class="title function_">add</span>(activeEffect!) <span class="comment">//depå¢åŠ  Effect</span></span><br><span class="line">activeEffect!.<span class="property">deps</span>.<span class="title function_">push</span>(dep) <span class="comment">//activeEffect.depså¢åŠ dep</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€éƒ¨åˆ†å°±æ˜¯å¢åŠ  track çš„ä»£ç ï¼Œæ€»ä¹‹å°±æ˜¯åœ¨ <code>dep</code> å’Œ <code>effect</code> ç›¸äº’å…³è”, dep åœ¨ targetMap ä¸­ã€‚</p><h3 id="02-triggger"><a href="#02-triggger" class="headerlink" title="02. triggger"></a>02. triggger</h3><p><code>triggger function</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">trigger</span>(<span class="params"></span></span><br><span class="line"><span class="params">  target: <span class="built_in">object</span>,</span></span><br><span class="line"><span class="params">  <span class="keyword">type</span>: TriggerOpTypes,</span></span><br><span class="line"><span class="params">  key?: <span class="built_in">unknown</span>,</span></span><br><span class="line"><span class="params">  newValue?: <span class="built_in">unknown</span>,</span></span><br><span class="line"><span class="params">  oldValue?: <span class="built_in">unknown</span>,</span></span><br><span class="line"><span class="params">  oldTarget?: <span class="built_in">Map</span>&lt;<span class="built_in">unknown</span>, <span class="built_in">unknown</span>&gt; | <span class="built_in">Set</span>&lt;<span class="built_in">unknown</span>&gt;</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å¦‚æœæ²¡æœ‰ä» targetMap.get è·å–åˆ°ï¼Œæ²¡æœ‰ track</span></span><br><span class="line">  <span class="keyword">const</span> depsMap = targetMap.<span class="title function_">get</span>(target)</span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    <span class="comment">// never been tracked</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//Dep[]</span></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">deps</span>: (<span class="title class_">Dep</span> | <span class="literal">undefined</span>)[] = []</span><br><span class="line">  <span class="comment">//å¦‚æœ type æ˜¯ CLEARï¼Œè¡¨ç¤ºæ¸…ç©ºé›†åˆï¼Œå°† depsMap ä¸­æ‰€æœ‰çš„ä¾èµ–é¡¹éƒ½åŠ å…¥åˆ° deps ä¸­</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="title class_">TriggerOpTypes</span>.<span class="property">CLEAR</span>) &#123;</span><br><span class="line">    <span class="comment">// collection being cleared</span></span><br><span class="line">    <span class="comment">// trigger all effects for target</span></span><br><span class="line">    deps = [...depsMap.<span class="title function_">values</span>()]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//å¦‚æœ key æ˜¯ lengthï¼Œå¹¶ä¸” target æ˜¯æ•°ç»„ï¼Œåˆ™è¡¨ç¤ºæ•°ç»„é•¿åº¦å‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦è§¦å‘æ•°ç»„çš„ä¾èµ–é¡¹æ›´æ–°ã€‚</span></span><br><span class="line">  <span class="comment">//æ‰¾åˆ° depsMap ä¸­ key ç­‰äº length æˆ–è€…å¤§äºç­‰äºæ–°é•¿åº¦çš„ä¾èµ–é¡¹ï¼Œå¹¶å°†å…¶åŠ å…¥åˆ° deps ä¸­ã€‚</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">&#x27;length&#x27;</span> &amp;&amp; <span class="title function_">isArray</span>(target)) &#123;</span><br><span class="line">    <span class="keyword">const</span> newLength = <span class="title class_">Number</span>(newValue)</span><br><span class="line">    depsMap.<span class="title function_">forEach</span>(<span class="function">(<span class="params">dep, key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&#x27;length&#x27;</span> || key &gt;= newLength) &#123;</span><br><span class="line">        deps.<span class="title function_">push</span>(dep)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// schedule runs for SET | ADD | DELETE</span></span><br><span class="line">    <span class="comment">//key !== undefined</span></span><br><span class="line">    <span class="keyword">if</span> (key !== <span class="built_in">void</span> <span class="number">0</span>) &#123;</span><br><span class="line">      deps.<span class="title function_">push</span>(depsMap.<span class="title function_">get</span>(key))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// also run for iteration key on ADD | DELETE | Map.SET</span></span><br><span class="line">    <span class="comment">// å¯¹äº SETã€ADDã€DELETE ä¸‰ç§æƒ…å†µï¼Œæ ¹æ® key ä» depsMap ä¸­è·å–ä¾èµ–é¡¹ depï¼Œå¹¶å°†å…¶åŠ å…¥åˆ° deps ä¸­</span></span><br><span class="line">    <span class="keyword">switch</span> (<span class="keyword">type</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="title class_">TriggerOpTypes</span>.<span class="property">ADD</span>:</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">isArray</span>(target)) &#123;</span><br><span class="line">          <span class="comment">//å¯¹äº ADD æ“ä½œï¼Œå¦‚æœ target ä¸æ˜¯æ•°ç»„ï¼Œåˆ™éœ€è¦è§¦å‘ ITERATE_KEY å’Œ MAP_KEY_ITERATE_KEY ä¸¤ä¸ªè¿­ä»£ä¾èµ–é¡¹æ›´æ–°</span></span><br><span class="line">          deps.<span class="title function_">push</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">ITERATE_KEY</span>))</span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">isMap</span>(target)) &#123;</span><br><span class="line">            deps.<span class="title function_">push</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">MAP_KEY_ITERATE_KEY</span>))</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚æœ target æ˜¯æ•°ç»„ï¼Œä¸” key æ˜¯æ•´æ•°ï¼Œåˆ™éœ€è¦è§¦å‘æ•°ç»„é•¿åº¦çš„ä¾èµ–é¡¹æ›´æ–°ã€‚ </span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isIntegerKey</span>(key)) &#123;</span><br><span class="line">          <span class="comment">// new index added to array -&gt; length changes</span></span><br><span class="line">          deps.<span class="title function_">push</span>(depsMap.<span class="title function_">get</span>(<span class="string">&#x27;length&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="title class_">TriggerOpTypes</span>.<span class="property">DELETE</span>:</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">isArray</span>(target)) &#123;</span><br><span class="line">          <span class="comment">//å¦‚æœ target ä¸æ˜¯æ•°ç»„ï¼Œåˆ™éœ€è¦è§¦å‘ ITERATE_KEY</span></span><br><span class="line">          deps.<span class="title function_">push</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">ITERATE_KEY</span>))</span><br><span class="line">          <span class="comment">//å¦‚æœæ˜¯Mapï¼ŒMAP_KEY_ITERATE_KEY</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">isMap</span>(target)) &#123;</span><br><span class="line">            deps.<span class="title function_">push</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">MAP_KEY_ITERATE_KEY</span>))</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="title class_">TriggerOpTypes</span>.<span class="property">SET</span>:</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isMap</span>(target)) &#123;</span><br><span class="line">          deps.<span class="title function_">push</span>(depsMap.<span class="title function_">get</span>(<span class="variable constant_">ITERATE_KEY</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> eventInfo = __DEV__</span><br><span class="line">    ? &#123; target, <span class="keyword">type</span>, key, newValue, oldValue, oldTarget &#125;</span><br><span class="line">    : <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//å¦‚æœåªæœ‰ä¸€ä¸ª depï¼Œç›´æ¥æ›´æ–°</span></span><br><span class="line">  <span class="comment">//å¦‚æœå¤šä¸ª åˆ™éœ€è¦å°†æ‰€æœ‰ä¾èµ–é¡¹çš„ ReactiveEffect å¯¹è±¡åˆå¹¶æˆä¸€ä¸ªæ–°çš„ ReactiveEffect å¯¹è±¡ï¼Œå†æ›´æ–°</span></span><br><span class="line">  <span class="keyword">if</span> (deps.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (deps[<span class="number">0</span>]) &#123;</span><br><span class="line">      <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">        <span class="title function_">triggerEffects</span>(deps[<span class="number">0</span>], eventInfo)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">triggerEffects</span>(deps[<span class="number">0</span>])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">effects</span>: <span class="title class_">ReactiveEffect</span>[] = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> dep <span class="keyword">of</span> deps) &#123;</span><br><span class="line">      <span class="keyword">if</span> (dep) &#123;</span><br><span class="line">        effects.<span class="title function_">push</span>(...dep)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="title function_">triggerEffects</span>(<span class="title function_">createDep</span>(effects), eventInfo)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">triggerEffects</span>(<span class="title function_">createDep</span>(effects))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥ä»£ç å¾ˆå¤šï¼Œå…¶å®åšäº†å‡ ä»¶äº‹ã€‚</p><ol><li>å¤„ç† type.clear</li><li>å¤„ç† arr &amp; key &#x3D; length or number çš„é—®é¢˜</li><li>deps &#x3D; Dep[], å¦‚æœ Key !&#x3D; undefined æŠŠå¯¹åº” keyï¼Œä»¥åŠæ ¹æ®type è·å–å¯¹åº”Dep</li><li>triggerEffects å¤„ç†</li></ol><p><strong>triggerEffects</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">triggerEffects</span>(<span class="params"></span></span><br><span class="line"><span class="params">  dep: Dep | ReactiveEffect[],</span></span><br><span class="line"><span class="params">  debuggerEventExtraInfo?: DebuggerEventExtraInfo</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// spread into array for stabilization</span></span><br><span class="line">  <span class="keyword">const</span> effects = <span class="title function_">isArray</span>(dep) ? dep : [...dep]</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> effect <span class="keyword">of</span> effects) &#123;</span><br><span class="line">    <span class="keyword">if</span> (effect.<span class="property">computed</span>) &#123;</span><br><span class="line">      <span class="title function_">triggerEffect</span>(effect, debuggerEventExtraInfo)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> effect <span class="keyword">of</span> effects) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!effect.<span class="property">computed</span>) &#123;</span><br><span class="line">      <span class="title function_">triggerEffect</span>(effect, debuggerEventExtraInfo)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡éå† <code>dep</code>, <code>triggerEffect(effect)</code>, å…ˆå¤„ç† <code>computed</code>, ç„¶åé <code>computed</code></p><p><strong>triggerEffect</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">triggerEffect</span>(<span class="params"></span></span><br><span class="line"><span class="params">  effect: ReactiveEffect,</span></span><br><span class="line"><span class="params">  debuggerEventExtraInfo?: DebuggerEventExtraInfo</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (effect !== activeEffect || effect.<span class="property">allowRecurse</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__ &amp;&amp; effect.<span class="property">onTrigger</span>) &#123;</span><br><span class="line">      effect.<span class="title function_">onTrigger</span>(<span class="title function_">extend</span>(&#123; effect &#125;, debuggerEventExtraInfo))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (effect.<span class="property">scheduler</span>) &#123;</span><br><span class="line">      effect.<span class="title function_">scheduler</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      effect.<span class="title function_">run</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§¦å‘ <code>ReactiveEffect</code> æœ‰ <code>scheduler</code> ä¼˜å…ˆ <code>scheduler</code>ï¼Œæ²¡æœ‰ <code>run</code></p><h3 id="track-amp-trigger-æ€»ç»“"><a href="#track-amp-trigger-æ€»ç»“" class="headerlink" title="track &amp; trigger æ€»ç»“"></a>track &amp; trigger æ€»ç»“</h3><ol><li>trackï¼Œåˆ›å»ºDepï¼Œå¹¶ä¸”æ”¾å…¥ targetMap &amp; desMap, Dep æ·»åŠ  activeEffectï¼Œ activeEffect.deps.push(dep)</li><li>trigger, è·å– target çš„ depsMap, æ’é™¤ type.clear &amp; key &#x3D; length &amp; number, å¦‚æœæœ‰key ä» depsMap è·å–, ç„¶åå†æŠŠå¯¹åº”typeçš„ä¸€äº›å›ºå®škeyï¼Œä¹Ÿè·å–å‡ºæ¥ï¼Œç„¶å effect.scheduler or run, computed ä¼˜å…ˆã€‚</li></ol><h3 id="03-reactiveEffect-æºç "><a href="#03-reactiveEffect-æºç " class="headerlink" title="03. reactiveEffect æºç "></a>03. reactiveEffect æºç </h3><p>ä¹‹å‰è¯´äº†è¿™ä¹ˆå¤šï¼Œå…¶å® track å’Œ trigger éƒ½æ˜¯ä¸ºäº†è§¦å‘ reactiveEffect æ›´æ–°ï¼Œé‚£ä¹ˆç»§ç»­çœ‹ä¸€ä¸‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ReactiveEffect ç±»å®šä¹‰</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ReactiveEffect</span>&lt;T = <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="comment">// æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆå§‹ä¸º true</span></span><br><span class="line">  active = <span class="literal">true</span></span><br><span class="line">  <span class="comment">// å½“å‰ ReactiveEffect å®ä¾‹çš„ä¾èµ–é¡¹æ•°ç»„</span></span><br><span class="line">  <span class="attr">deps</span>: <span class="title class_">Dep</span>[] = []</span><br><span class="line">  <span class="comment">// å½“å‰ ReactiveEffect å®ä¾‹çš„çˆ¶çº§ ReactiveEffect å®ä¾‹ï¼Œç”¨äºè§£å†³é€’å½’è°ƒç”¨çš„é—®é¢˜</span></span><br><span class="line">  <span class="attr">parent</span>: <span class="title class_">ReactiveEffect</span> | <span class="literal">undefined</span> = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯ä»¥åœ¨åˆ›å»ºä¹‹åé™„åŠ </span></span><br><span class="line">  computed?: <span class="title class_">ComputedRefImpl</span>&lt;T&gt;</span><br><span class="line">  <span class="comment">// å…è®¸é€’å½’è°ƒç”¨</span></span><br><span class="line">  allowRecurse?: <span class="built_in">boolean</span></span><br><span class="line">  <span class="comment">// å»¶è¿Ÿåœæ­¢ï¼Œç”¨äºé¿å…å› åˆ é™¤å½“å‰ ReactiveEffect å®ä¾‹æ—¶å¼•èµ·çš„å¹¶å‘é—®é¢˜</span></span><br><span class="line">  <span class="keyword">private</span> deferStop?: <span class="built_in">boolean</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å½“ ReactiveEffect å®ä¾‹åœæ­¢æ—¶è°ƒç”¨çš„å‡½æ•°</span></span><br><span class="line">  onStop?: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// ä»…åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œç”¨äºè·Ÿè¸ªä¾èµ–é¡¹è¿½è¸ªäº‹ä»¶</span></span><br><span class="line">  onTrack?: <span class="function">(<span class="params">event: DebuggerEvent</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// ä»…åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œç”¨äºè·Ÿè¸ªè§¦å‘äº‹ä»¶</span></span><br><span class="line">  onTrigger?: <span class="function">(<span class="params">event: DebuggerEvent</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ReactiveEffect æ„é€ å‡½æ•°</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">public</span> fn: () =&gt; T, <span class="comment">// å½“å‰ ReactiveEffect å®ä¾‹çš„æ‰§è¡Œå‡½æ•°</span></span></span><br><span class="line"><span class="params">    <span class="keyword">public</span> scheduler: EffectScheduler | <span class="literal">null</span> = <span class="literal">null</span>, <span class="comment">// ç”¨äºæŒ‡å®šæ›´æ–°ç­–ç•¥</span></span></span><br><span class="line"><span class="params">    scope?: EffectScope <span class="comment">// ç”¨äºæŒ‡å®šä½œç”¨åŸŸ</span></span></span><br><span class="line"><span class="params">  </span>) &#123;</span><br><span class="line">    <span class="title function_">recordEffectScope</span>(<span class="variable language_">this</span>, scope) <span class="comment">// è®°å½•å½“å‰ ReactiveEffect å®ä¾‹çš„ä½œç”¨åŸŸ</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿è¡Œ ReactiveEffect å®ä¾‹</span></span><br><span class="line">  <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">active</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">fn</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ˜¯å¦å·²ç»è¿½è¸ªäº†å½“å‰ ReactiveEffect å®ä¾‹</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">parent</span>: <span class="title class_">ReactiveEffect</span> | <span class="literal">undefined</span> = activeEffect</span><br><span class="line">    <span class="keyword">let</span> lastShouldTrack = shouldTrack</span><br><span class="line">    <span class="keyword">while</span> (parent) &#123;</span><br><span class="line">      <span class="keyword">if</span> (parent === <span class="variable language_">this</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      parent = parent.<span class="property">parent</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// è®¾ç½®çˆ¶çº§ ReactiveEffect å®ä¾‹ï¼Œå¹¶å°†å½“å‰å®ä¾‹è®¾ç½®ä¸º activeEffect</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">parent</span> = activeEffect</span><br><span class="line">      activeEffect = <span class="variable language_">this</span></span><br><span class="line">      shouldTrack = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆå§‹åŒ– depMarkersï¼Œç”¨äºæ€§èƒ½ä¼˜åŒ–</span></span><br><span class="line">      trackOpBit = <span class="number">1</span> &lt;&lt; ++effectTrackDepth</span><br><span class="line">      <span class="keyword">if</span> (effectTrackDepth &lt;= maxMarkerBits) &#123;</span><br><span class="line">        <span class="title function_">initDepMarkers</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">cleanupEffect</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ‰§è¡Œ ReactiveEffect å®ä¾‹çš„å‡½æ•°</span></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">fn</span>()</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// ç»“æŸè¿½è¸ª depMarkers</span></span><br><span class="line">      <span class="keyword">if</span> (effectTrackDepth &lt;= maxMarkerBits) &#123;</span><br><span class="line">        <span class="title function_">finalizeDepMarkers</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      trackOpBit = <span class="number">1</span> &lt;&lt; --effectTrackDepth</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ¢å¤ä¸Šä¸€ä¸ªæ´»åŠ¨çš„ ReactiveEffect å®ä¾‹</span></span><br><span class="line">      activeEffect = <span class="variable language_">this</span>.<span class="property">parent</span></span><br><span class="line">      shouldTrack = lastShouldTrack</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">parent</span> = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœ deferStop å±æ€§ä¸º trueï¼Œåˆ™åˆ é™¤å½“å‰ ReactiveEffect å®ä¾‹</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">deferStop</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">stop</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">stop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰å‰¯ä½œç”¨å‡½æ•°æ­£åœ¨æ‰§è¡Œï¼Œæ ‡è®°ä¸ºå»¶è¿Ÿæ¸…ç†</span></span><br><span class="line">    <span class="keyword">if</span> (activeEffect === <span class="variable language_">this</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">deferStop</span> = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">active</span>) &#123; <span class="comment">// å¦‚æœå½“å‰å‰¯ä½œç”¨å‡½æ•°æœªæ‰§è¡Œä¸”ä»ç„¶æ´»è·ƒ</span></span><br><span class="line">        <span class="title function_">cleanupEffect</span>(<span class="variable language_">this</span>) <span class="comment">// æ¸…é™¤å‰¯ä½œç”¨å‡½æ•°ä¸å…¶ä¾èµ–é¡¹ä¹‹é—´çš„å…³è”å…³ç³»</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">onStop</span>) &#123; <span class="comment">// å¦‚æœæœ‰åœæ­¢å›è°ƒå‡½æ•°ï¼Œè°ƒç”¨åœæ­¢å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">onStop</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">active</span> = <span class="literal">false</span> <span class="comment">// æ ‡è®°å½“å‰å‰¯ä½œç”¨å‡½æ•°ä¸ºä¸æ´»è·ƒçŠ¶æ€</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æä¾›äº†3ä¸ªæ–¹æ³•ï¼Œæ„é€ ï¼Œ<code>run</code>ï¼Œ<code>stop</code></p><ol><li>æ„é€ å‡½æ•°ï¼Œ å°±æ˜¯å¦‚æœ <code>!!scope</code>, <code>scope.effects.push(this)</code>, è¿˜æœ‰ä¸€ä¸ª <code>EffectScope</code>ï¼Œå°±æ˜¯è¿™ä¸ª <code>scope</code>ï¼Œç”¨äºç®¡ç† <code>reactiveEffect</code>, è¿™é‡ŒæŠŠä»–æ”¾è¿›ç®¡ç†é‡Œé¢å»</li><li>run å¯ä»¥ç®€å•çš„ç†è§£ä¸ºæ‰§è¡Œæ„é€ å‡½æ•°ä¼ å…¥çš„ <code>Fn</code> å‡½æ•°<br>  2.1 å¤æ‚ä¸€ç‚¹è¯´ï¼Œå½“ <code>!active</code>, ç›´æ¥è°ƒç”¨ <code>fn</code><br>  2.2 æ£€æŸ¥ parent æ˜¯å¦å­˜åœ¨å¾ªç¯å¼•ç”¨<br>  2.3 è®¾ç½®å‚æ•°ï¼Œ<code>parent = activeEffect, activeEffect = this, shouldTrack = true</code><br>  2.4 <code>fn()</code><br>  2.5 æ¢å¤å‚æ•° <code>activeEffect = this.parentï¼ŒshouldTrack = lastShouldTrackï¼Œthis.parent = undefined</code></li></ol><p>è¿™é‡Œæœ‰ä¸€ä¸ªæ¦‚å¿µ</p><blockquote><p>depMarkers æ˜¯ä¸€ä¸ªç”¨äºè¿½è¸ªä¾èµ–å…³ç³»çš„æ ‡è®°å¯¹è±¡ï¼Œç”¨äºåœ¨ reactive effect ä¸­è®°å½•å“ªäº›ä¾èµ–é¡¹å·²è¢«è¿½è¸ªè¿‡ã€‚å®ƒæœ‰ä¸¤ä¸ªå±æ€§ w å’Œ nï¼Œåˆ†åˆ«ä»£è¡¨äº† â€œwasTrackedâ€ å’Œ â€œnewTrackedâ€ã€‚</p><p>åœ¨ reactive effect ä¸­ï¼ŒdepMarkers è¢«ç”¨æ¥åˆ¤æ–­æŸä¸ªä¾èµ–é¡¹æ˜¯å¦å·²è¢«è¿½è¸ªï¼Œä»¥åŠåœ¨è¿½è¸ªå®Œæ‰€æœ‰ä¾èµ–é¡¹åæ˜¯å¦æœ‰æ–°çš„ä¾èµ–é¡¹è¢«è¿½è¸ªã€‚å¦‚æœä¸€ä¸ªä¾èµ–é¡¹åœ¨ reactive effect ä¸­è¢«è¿½è¸ªè¿‡ï¼Œå®ƒçš„ w ä½ä¼šè¢«è®¾ç½®ä¸º 1ï¼Œå¦‚æœåœ¨å½“å‰è¿½è¸ªè¿‡ç¨‹ä¸­æœ‰æ–°çš„ä¾èµ–é¡¹è¢«è¿½è¸ªï¼Œå®ƒçš„ n ä½ä¼šè¢«è®¾ç½®ä¸º 1ã€‚</p><p>é€šè¿‡ depMarkers ä¸­çš„è¿™äº›æ ‡è®°ï¼ŒVue3 å¯ä»¥åœ¨ reactive effect ä¸­è·Ÿè¸ªä¾èµ–é¡¹çš„å˜åŒ–ï¼Œå¹¶ä¸”åªä¼šåœ¨å¿…è¦çš„æ—¶å€™é‡æ–°è¿è¡Œ reactive effectã€‚è¿™æ ·å¯ä»¥æé«˜æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚</p></blockquote><p>è¿™é‡Œå…ˆä¸å±•å¼€äº†</p><ol start="3"><li><code>stop</code> å°±æ˜¯æ¸…ç† <code>effect</code> å’Œ <code>dep</code> çš„å…³è”ï¼Œå…¨éƒ¨<code>delete</code>ï¼Œ<code>active</code> è®¾ç½®ä¸º <code>false</code></li></ol><h3 id="04-æ€ä¹ˆè°ƒç”¨-reactiveEffect"><a href="#04-æ€ä¹ˆè°ƒç”¨-reactiveEffect" class="headerlink" title="04. æ€ä¹ˆè°ƒç”¨ reactiveEffect"></a>04. æ€ä¹ˆè°ƒç”¨ reactiveEffect</h3><p>è¿™é‡Œæˆ‘äº§ç”Ÿäº†ä¸€ä¸ªç–‘æƒ‘ï¼Œåœ¨è¿™ä¸ªè§¦å‘çš„è¿‡ç¨‹ä¸­ï¼ŒactiveEffect, æ˜¯ä»€ä¹ˆæ—¶å€™å®ä¾‹åŒ–çš„ï¼Ÿæˆ‘æŸ¥çœ‹äº†æ‰€æœ‰å…³äº <code>activeEffect</code> çš„å¼•ç”¨ã€‚</p><p>åªæœ‰åœ¨ <code>reactiveEffect.run</code> ä¸­æ‰æœ‰è®¾ç½®</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">parent</span> = activeEffect</span><br><span class="line">activeEffect = <span class="variable language_">this</span></span><br><span class="line">shouldTrack = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">activeEffect = <span class="variable language_">this</span>.<span class="property">parent</span></span><br><span class="line">shouldTrack = lastShouldTrack</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">parent</span> = <span class="literal">undefined</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´å½“ä¸€ä¸ª, æˆ‘ä»¬å¯ä»¥ç†è§£ <code>reactiveEffect</code> æ˜¯ä¸€ä¸ªæ ‘ï¼Œä¿è¯è¿è¡Œæ—¶å€™ç±»ä¼¼äºå…ˆè¿›åå‡ºã€‚</p><p>è¿™é‡Œè§£é‡Šäº†ä¸ºä»€ä¹ˆ <code>activeEffect</code> ä¼šä¿è¯æœ‰å€¼çš„åŸå› ã€‚</p><p>å¦å¤–æˆ‘ä»¬æ€»æ˜¯éœ€è¦å…ˆè°ƒç”¨ <code>reactiveEffect</code>, æ‰ä¼šæœ‰ç¬¬ä¸€æ¬¡çš„å€¼, è¿™é‡Œæ˜¯åœ¨åˆå§‹åŒ–ç»„ä»¶æˆ–è€…æ›´æ–°ç»„ä»¶çš„æ—¶å€™</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create reactive effect for rendering</span></span><br><span class="line"><span class="keyword">const</span> effect = (instance.<span class="property">effect</span> = <span class="keyword">new</span> <span class="title class_">ReactiveEffect</span>(</span><br><span class="line">  componentUpdateFn,</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="title function_">queueJob</span>(update),</span><br><span class="line">  instance.<span class="property">scope</span> <span class="comment">// track it in component&#x27;s effect scope</span></span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">update</span>: <span class="title class_">SchedulerJob</span> = (instance.<span class="property">update</span> = <span class="function">() =&gt;</span> effect.<span class="title function_">run</span>())</span><br><span class="line">update.<span class="property">id</span> = instance.<span class="property">uid</span></span><br><span class="line"><span class="comment">// allowRecurse</span></span><br><span class="line"><span class="comment">// #1801, #2043 component render effects should allow recursive updates</span></span><br><span class="line"><span class="title function_">toggleRecurse</span>(instance, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">  effect.<span class="property">onTrack</span> = instance.<span class="property">rtc</span></span><br><span class="line">    ? <span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">invokeArrayFns</span>(instance.<span class="property">rtc</span>!, e)</span><br><span class="line">    : <span class="built_in">void</span> <span class="number">0</span></span><br><span class="line">  effect.<span class="property">onTrigger</span> = instance.<span class="property">rtg</span></span><br><span class="line">    ? <span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">invokeArrayFns</span>(instance.<span class="property">rtg</span>!, e)</span><br><span class="line">    : <span class="built_in">void</span> <span class="number">0</span></span><br><span class="line">  update.<span class="property">ownerInstance</span> = instance</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">update</span>()</span><br></pre></td></tr></table></figure><h3 id="05-æ€»ç»“ã€‚"><a href="#05-æ€»ç»“ã€‚" class="headerlink" title="05. æ€»ç»“ã€‚"></a>05. æ€»ç»“ã€‚</h3><p>reactiveEffect æ˜¯å“åº”å¼çš„æ ¸å¿ƒä»£ç ï¼Œæ‰€æœ‰çš„å€¼éƒ½é€šè¿‡ä»–æ¥æ‰§è¡Œå“åº”å¼ï¼Œé€šè¿‡ <code>run</code> or <code>stop</code> æ¥æ§åˆ¶æ‰§è¡Œæˆ–è€…åœæ­¢ã€‚</p><p>é€šè¿‡ targetMap æ¥å­˜å‚¨ reactiveEffect.</p><p>targetMap &#x3D;&gt; depsMap &#x3D;&gt; Dep &#x3D;&gt; reactiveEffect.</p><p>é€šè¿‡ track æ–¹æ³•æ¥åˆ›å»º Depï¼Œå¹¶ä¸”å’Œå½“å‰çš„ reactivEffect äº§ç”Ÿå…³è”ï¼Œ </p><p><code>activeEffect.deps.push(dep)</code> </p><p><code>dep.add(activeEffect)</code></p><p>é€šè¿‡ trigger æ–¹æ³•ï¼Œæ¥æ‰¾åˆ°å¯¹åº”çš„ reactiveEffect, ä¸ä»…ä»…åŒ…å«å½“å‰ key çš„ï¼Œè¿˜åŒ…å«å¯¹ç”¨æ“ä½œç±»å‹çš„ reactiveEffect </p><p>ç„¶åç»Ÿä¸€å»è§¦å‘ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> effect </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ç« ç›®å½•</title>
      <link href="/2023/06/20/category/"/>
      <url>/2023/06/20/category/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="æ–‡ç« ç›®å½•"><a href="#æ–‡ç« ç›®å½•" class="headerlink" title="æ–‡ç« ç›®å½•"></a>æ–‡ç« ç›®å½•</h1><h3 id="è‡ªå·±å†™çš„"><a href="#è‡ªå·±å†™çš„" class="headerlink" title="è‡ªå·±å†™çš„"></a>è‡ªå·±å†™çš„</h3><ul><li><a href="https://www.npmjs.com/package/t_valid_type">npmjsåº“ t_valid_type</a></li><li><a href="https://github.com/tanlanchou/indexdb_book_store">indexDBæœ¬åœ°å›¾ä¹¦é¦†</a></li></ul><h3 id="æ‚é¡¹"><a href="#æ‚é¡¹" class="headerlink" title="æ‚é¡¹"></a>æ‚é¡¹</h3><ul><li><a href="/tblog/2024/02/23/%E5%89%8D%E7%AB%AF%E5%9F%8B%E7%82%B9/">å‰ç«¯åŸ‹ç‚¹</a></li><li><a href="/tblog/2024/02/23/rss%E6%95%B0%E6%8D%AE%E5%AF%B9%E6%AF%94/">rss æ•°æ®å¯¹æ¯”</a></li><li><a href="/tblog/2024/02/23/nestjs-modules-mailer/">nestjs mailer</a></li><li><a href="/tblog/2023/12/07/zaxiang/front_docker_env/">å‰ç«¯ docker é¡¹ç›®å¦‚ä½•åŠ¨æ€åŠ è½½ç¯å¢ƒå˜é‡</a></li><li><a href="/tblog/2023/08/27/sudo_npm_install/">ä¸ºä»€ä¹ˆ npm install éœ€è¦ sudo</a></li><li><a href="/tblog/2023/08/29/wsl_can_not_boot/">windows docker å®‰è£…é‡åˆ°çš„å‘</a></li></ul><h3 id="Vue3"><a href="#Vue3" class="headerlink" title="Vue3"></a>Vue3</h3><ul><li><a href="/tblog/2023/08/27/vue3_plugin/">vue3 createVNode &amp; render</a></li><li><a href="/tblog/2023/07/31/vue3_setup/">setupæºç </a></li><li><a href="/tblog/2023/07/08/nextTick/">nextTickæºç </a></li><li><a href="/tblog/2023/07/08/Vue3_queue/">ä»»åŠ¡è°ƒåº¦æºç è§£æ</a></li><li><a href="/tblog/2023/07/06/Vue3_Suspense/">defineAsyncComponent &amp; Suspense ä½¿ç”¨å’Œæºç åˆ†æ</a></li><li><a href="/tblog/2023/06/21/vue3_effect/">effectæºç </a></li><li><a href="/tblog/2023/06/29/vue3_ref/">refæºç </a></li><li><a href="/tblog/2023/06/29/vue3_reactive/">reactiveæºç </a></li><li><a href="/tblog/2023/06/29/vue3_keep_alive/">keep-aliveæºç </a></li></ul><h3 id="Vueå¯¹æ¯”"><a href="#Vueå¯¹æ¯”" class="headerlink" title="Vueå¯¹æ¯”"></a>Vueå¯¹æ¯”</h3><ol><li><a href="/tblog/2023/06/20/vue_lifecycle/">Vue lifecycle å®ç°</a></li><li><a href="/tblog/2023/06/20/vue_setup_created_before_created/">beforeCreate, created vs setup</a></li><li><a href="/tblog/2023/06/24/vue_beforeMount_onBeforeMount/">beforeMount vs onBeforeMount</a></li><li><a href="/tblog/2023/06/26/vue_mounted/">mounted vs onMounted</a></li><li><a href="/tblog/2023/06/26/vue_beforeUpdate/">beforeUpdate vs onBeforeUpdate</a></li><li><a href="/tblog/2023/06/28/vue_updated_onUpdated/">updated vs onUpdated</a></li><li><a href="/tblog/2023/06/28/vue_beforeDestroy_onBeforeUnmount/">beforeDestroy vs onBeforeUnmount</a></li><li><a href="/tblog/2023/06/29/vue_destroyed_onUnmounted/">destroyed vs onUnmounted</a></li><li><a href="/tblog/2023/07/02/vue_active/">actived vs onActivated</a></li><li><a href="/tblog/2023/07/02/vue_deactivated/">deactivated vs onDeactivated</a></li></ol><h3 id="javascriptæœ€åŸºç¡€"><a href="#javascriptæœ€åŸºç¡€" class="headerlink" title="javascriptæœ€åŸºç¡€"></a>javascriptæœ€åŸºç¡€</h3><ul><li><a href="/tblog/2023/12/01/javascript/url_open_software/">hrefæ‰“å¼€æœ¬åœ°è½¯ä»¶</a></li><li><a href="/tblog/2023/11/02/%5BQ103%5DIndexDB_Base/">Q102 indexDB API</a></li><li><a href="/tblog/2023/09/02/%5BQ102%5Djavascript_this_link/">Q101 this å‡½æ•°æŒ‡å‘é—®é¢˜</a></li><li><a href="/tblog/2023/08/20/%5BQ001%5DArrowFunctionvsFunction/">ç®­å¤´å‡½æ•°æœ‰prototypeå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</a></li><li><a href="/tblog/2023/07/09/browser_event/">æµè§ˆå™¨äº‹ä»¶æµ</a></li><li><a href="/tblog/2023/07/08/clipboard/">æµè§ˆå™¨å¤åˆ¶</a></li><li><a href="/tblog/2023/07/07/web_fetch/">fetch ç®€å•ä»‹ç»</a></li><li><a href="/tblog/2023/06/15/async&defer/">async &amp; defer</a></li><li><a href="/tblog/2023/07/03/node_deep_equal/">çœ‹ node-deep-equal</a></li><li><a href="/tblog/2023/07/03/async_code/">javascript å¼‚æ­¥ç¼–ç¨‹æœ‰å“ªäº›æ–¹å¼ï¼Ÿ</a></li><li><a href="/tblog/2023/07/03/baseEs6/">es6 æ›´æ–°æ€»ç»“</a></li><li><a href="/tblog/2023/07/03/closures_and_scopes/">ä½œç”¨åŸŸå’Œé—­åŒ…</a></li><li><a href="/tblog/2023/07/03/deepClone/">æ·±æ‹·è´æ–¹æ³•ä¼˜ç¼ºç‚¹æ€»ç»“å’Œè‡ªå·±å†™çš„æ€è·¯</a></li><li><a href="/tblog/2023/07/03/eventLoop/">æµè§ˆå™¨äº‹ä»¶å¾ªç¯æ€»ç»“</a></li><li><a href="/tblog/2023/07/03/js_new/">javascript new åšäº†ä»€ä¹ˆï¼Ÿ</a></li><li><a href="/tblog/2023/07/03/js_type_check/">javascript ç±»å‹åˆ¤æ–­æ–¹æ³•æ€»ç»“</a></li><li><a href="/tblog/2023/07/03/undefined_void_0/">ä¸ºä»€ä¹ˆè¦ç”¨ void 0 ä»£æ›¿ undefined</a></li><li><a href="/tblog/2023/07/12/es6_array/">Array</a></li></ul><h3 id="webåŸºç¡€å’ŒåŸºç¡€css"><a href="#webåŸºç¡€å’ŒåŸºç¡€css" class="headerlink" title="webåŸºç¡€å’ŒåŸºç¡€css"></a>webåŸºç¡€å’ŒåŸºç¡€css</h3><ul><li><a href="/tblog/2023/12/14/browser/cache/">æµè§ˆå™¨ç¼“å­˜å¤§èµ</a></li><li><a href="/tblog/2023/09/01/%5BQ101%5DFlex_attr/">flex å±æ€§è¯¦è§£</a></li><li><a href="/tblog/2023/07/06/web_img_lazy_loading/">å›¾ç‰‡æ‡’åŠ è½½4ç§æ–¹æ¡ˆ</a></li><li><a href="/tblog/2023/06/15/browser_parsing/">æµè§ˆå™¨è§£æè¿‡ç¨‹</a></li><li><a href="/tblog/2023/06/15/graphql/">graphgl</a></li><li><a href="/tblog/2023/06/15/debounce_throttle/">é˜²æŠ–å’ŒèŠ‚æµ</a></li><li><a href="/tblog/2023/07/03/BFC/">BFC å¸ƒå±€æ¨¡å‹</a></li><li><a href="/tblog/2023/07/03/Implementation_Methods_for_Horizontal_and_Vertical_Centering/">css å‚ç›´å±…ä¸­æ–¹æ¡ˆ</a></li><li><a href="/tblog/2023/07/03/IFC/">IFC å¸ƒå±€æ¨¡å‹</a></li><li><a href="/tblog/2023/07/03/repaint_reflow/">é‡ç»˜å’Œå›æµçš„åŸºæœ¬æ¦‚å¿µ</a></li></ul><h3 id="electron"><a href="#electron" class="headerlink" title="electron"></a>electron</h3><ul><li><a href="/tblog/2023/12/07/electron/electron_caiken_01/">electron urlå¯åŠ¨å’Œæ‰“åŒ…</a></li></ul><h3 id="vue2-xæºç "><a href="#vue2-xæºç " class="headerlink" title="vue2.xæºç "></a>vue2.xæºç </h3><ul><li><a href="/tblog/2023/08/19/Vue_extends/">extend</a></li><li><a href="/tblog/2023/06/27/vue2_watch/">watcher</a></li><li><a href="/tblog/2023/06/27/vue2_Dep/">dep</a></li><li><a href="/tblog/2023/08/19/Vue_extends/">vue2 extend</a></li></ul><h3 id="åšç‚¹é¢˜"><a href="#åšç‚¹é¢˜" class="headerlink" title="åšç‚¹é¢˜"></a>åšç‚¹é¢˜</h3><ul><li><a href="/tblog/2023/12/07/shuati/001_bind/">001</a></li><li><a href="/tblog/2023/07/08/%5BQ017%5DHow_does_css_achieve_a_fixed_300px_on_the_left_and_an_daptive_layout_on_the_right/">css å¦‚ä½•å®ç°å·¦ä¾§å›ºå®š 300pxï¼Œå³ä¾§è‡ªé€‚åº”çš„å¸ƒå±€</a></li></ul></div>]]></content>
      
      
      
        <tags>
            
            <tag> ç›®å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue lifecycle å®ç°</title>
      <link href="/2023/06/20/vue_lifecycle/"/>
      <url>/2023/06/20/vue_lifecycle/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="Vue-lifecycle-å®ç°"><a href="#Vue-lifecycle-å®ç°" class="headerlink" title="Vue lifecycle å®ç°"></a>Vue lifecycle å®ç°</h1><h3 id="1-Vue2-x"><a href="#1-Vue2-x" class="headerlink" title="1. Vue2.x"></a>1. Vue2.x</h3><p>åœ¨çœ‹ Vue2.x æºç çš„æ—¶å€™ï¼Œæ€»ä¼šçœ‹åˆ°ä¸‹é¢ç±»ä¼¼ä»£ç </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeCreate&#x27;</span>, <span class="literal">undefined</span>, <span class="literal">false</span> <span class="comment">/* setContext */</span>)</span><br><span class="line"><span class="title function_">callHook</span>(vm, <span class="string">&#x27;created&#x27;</span>)</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ callHook æºç </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">callHook</span>(<span class="params"></span></span><br><span class="line"><span class="params">  vm: Component,</span></span><br><span class="line"><span class="params">  hook: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  args?: <span class="built_in">any</span>[],</span></span><br><span class="line"><span class="params">  setContext = <span class="literal">true</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// #7573 disable dep collection when invoking lifecycle hooks</span></span><br><span class="line">  <span class="comment">// æ¨å…¥è°ƒç”¨æ ˆ</span></span><br><span class="line">  <span class="title function_">pushTarget</span>()</span><br><span class="line">  <span class="keyword">const</span> prev = currentInstance</span><br><span class="line">  setContext &amp;&amp; <span class="title function_">setCurrentInstance</span>(vm)</span><br><span class="line">  <span class="keyword">const</span> handlers = vm.<span class="property">$options</span>[hook]</span><br><span class="line">  <span class="keyword">const</span> info = <span class="string">`<span class="subst">$&#123;hook&#125;</span> hook`</span></span><br><span class="line">  <span class="keyword">if</span> (handlers) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, j = handlers.<span class="property">length</span>; i &lt; j; i++) &#123;</span><br><span class="line">      <span class="title function_">invokeWithErrorHandling</span>(handlers[i], vm, args || <span class="literal">null</span>, vm, info)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">_hasHookEvent</span>) &#123;</span><br><span class="line">    vm.$emit(<span class="string">&#x27;hook:&#x27;</span> + hook)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//è¿™é‡Œæ˜¯è®¾ç½®å½“å‰ä¸Šä¸‹æ–‡</span></span><br><span class="line">  setContext &amp;&amp; <span class="title function_">setCurrentInstance</span>(prev)</span><br><span class="line">  <span class="comment">//è®¾ç½®è°ƒç”¨æ ˆ</span></span><br><span class="line">  <span class="title function_">popTarget</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ å…¥ <code>hook</code> åç§°ï¼Œä»å½“å‰ <code>vm</code> è·å–åˆ° <code>handlers</code>ï¼Œç„¶åéå†è°ƒç”¨ <code>invokeWithErrorHandling</code>ï¼Œ æ‰§è¡Œ <code>hook</code> å¹¶ä¸”æ•è·é”™è¯¯</p><p>å¦‚æœ okï¼Œè§¦å‘ <code>vm.$emit(&#39;hook:&#39; + hook)</code>ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„é—®é¢˜å°±æ˜¯åœ¨å“ªé‡Œè§£æçš„ï¼Ÿ</p><p>å…¶å®å°±æ˜¯åœ¨åˆå¹¶ <code>options</code> çš„æ—¶å€™ æŠŠ <code>vm.constructor.options</code> åˆå¹¶åˆ° <code>vm.$options</code> å½“ä¸­ï¼Œå°±å¯ä»¥è°ƒç”¨äº†</p><h3 id="2-Vue3-x"><a href="#2-Vue3-x" class="headerlink" title="2. Vue3.x"></a>2. Vue3.x</h3><p><strong>packages\runtime-core\src\apiLifecycle.ts</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> onBeforeMount = <span class="title function_">createHook</span>(<span class="title class_">LifecycleHooks</span>.<span class="property">BEFORE_MOUNT</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createHook = &lt;T <span class="keyword">extends</span> <span class="title class_">Function</span> = <span class="function">() =&gt;</span> <span class="built_in">any</span>&gt;<span class="function">(<span class="params">lifecycle: LifecycleHooks</span>) =&gt;</span></span><br><span class="line">  <span class="function">(<span class="params">hook: T, target: ComponentInternalInstance | <span class="literal">null</span> = currentInstance</span>) =&gt;</span></span><br><span class="line">    <span class="comment">// post-create lifecycle registrations are noops during SSR (except for serverPrefetch)</span></span><br><span class="line">    (!isInSSRComponentSetup || lifecycle === <span class="title class_">LifecycleHooks</span>.<span class="property">SERVER_PREFETCH</span>) &amp;&amp;</span><br><span class="line">    <span class="title function_">injectHook</span>(lifecycle, <span class="function">(<span class="params">...args: <span class="built_in">unknown</span>[]</span>) =&gt;</span> <span class="title function_">hook</span>(...args), target)</span><br></pre></td></tr></table></figure><p>åˆ†ä¸€ä¸‹æ–­å°±æ˜¯ </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="attr">lifecycle</span>: <span class="title class_">LifecycleHooks</span>) =&gt; &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="function">(<span class="params">hook: T, target: ComponentInternalInstance | <span class="literal">null</span> = currentInstance</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(!isInSSRComponentSetup || lifecycle === <span class="title class_">LifecycleHooks</span>.<span class="property">SERVER_PREFETCH</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">injectHook</span>(lifecycle, <span class="function">(<span class="params">...args: <span class="built_in">unknown</span>[]</span>) =&gt;</span> <span class="title function_">hook</span>(...args), target)</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯é—­åŒ…ï¼Œæˆ–è€…è¯´æ˜¯å·¥å‚å‡½æ•°ï¼Œç”¨æ¥è°ƒç”¨ hookã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å‡ºå‡½æ•° injectHook</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">injectHook</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="comment">// ç”Ÿå‘½å‘¨æœŸé’©å­çš„ç±»å‹</span></span></span><br><span class="line"><span class="params">  <span class="keyword">type</span>: LifecycleHooks,</span></span><br><span class="line"><span class="params">  <span class="comment">// è¦æ³¨å…¥çš„é’©å­å‡½æ•°ï¼Œç±»å‹ä¸º Function å¹¶ä¸”å…·æœ‰ä¸€ä¸ªå¯é€‰çš„ __weh å±æ€§</span></span></span><br><span class="line"><span class="params">  hook: <span class="built_in">Function</span> &amp; &#123; __weh?: <span class="built_in">Function</span> &#125;,</span></span><br><span class="line"><span class="params">  <span class="comment">// è¦æ³¨å…¥åˆ°çš„ç»„ä»¶å®ä¾‹ï¼Œç±»å‹ä¸º ComponentInternalInstance æˆ–è€… nullï¼Œé»˜è®¤ä¸º currentInstance</span></span></span><br><span class="line"><span class="params">  target: ComponentInternalInstance | <span class="literal">null</span> = currentInstance,</span></span><br><span class="line"><span class="params">  <span class="comment">// æ˜¯å¦å°†é’©å­å‡½æ•°æ·»åŠ åˆ°é’©å­æ•°ç»„çš„å¼€å¤´ï¼Œé»˜è®¤ä¸º false</span></span></span><br><span class="line"><span class="params">  prepend: <span class="built_in">boolean</span> = <span class="literal">false</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Function</span> | <span class="literal">undefined</span> &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœ target å­˜åœ¨ï¼Œåˆ™ç»§ç»­æ‰§è¡Œæ³¨å…¥é€»è¾‘ï¼Œå¦åˆ™åœ¨å¼€å‘ç¯å¢ƒä¸‹å‘å‡ºè­¦å‘Š</span></span><br><span class="line">  <span class="keyword">if</span> (target) &#123;</span><br><span class="line">    <span class="comment">// è·å–å¯¹åº”ç”Ÿå‘½å‘¨æœŸç±»å‹çš„é’©å­æ•°ç»„ hooksï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„å¹¶èµ‹å€¼ç»™ target[type]</span></span><br><span class="line">    <span class="keyword">const</span> hooks = target[<span class="keyword">type</span>] || (target[<span class="keyword">type</span>] = [])</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¹ä¼ å…¥çš„é’©å­å‡½æ•° hook è¿›è¡Œå°è£…</span></span><br><span class="line">    <span class="keyword">const</span> wrappedHook =</span><br><span class="line">      <span class="comment">// å¦‚æœé’©å­å‡½æ•°å·²ç»è¢«å°è£…è¿‡ï¼ˆå­˜åœ¨ __weh å±æ€§ï¼‰ï¼Œåˆ™ç›´æ¥ä½¿ç”¨å°è£…åçš„å‡½æ•°</span></span><br><span class="line">      hook.<span class="property">__weh</span> ||</span><br><span class="line">      <span class="comment">// å¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ä½œä¸ºå°è£…åçš„é’©å­å‡½æ•°</span></span><br><span class="line">      (hook.<span class="property">__weh</span> = <span class="function">(<span class="params">...args: <span class="built_in">unknown</span>[]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥ target æ˜¯å¦å·²ç»è¢«å¸è½½ï¼Œå¦‚æœæ˜¯åˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (target.<span class="property">isUnmounted</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æš‚åœä¾èµ–è¿½è¸ª</span></span><br><span class="line">        <span class="title function_">pauseTracking</span>()</span><br><span class="line">        <span class="comment">// è®¾ç½®å½“å‰çš„ç»„ä»¶å®ä¾‹ä¸º target</span></span><br><span class="line">        <span class="title function_">setCurrentInstance</span>(target)</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ callWithAsyncErrorHandling è°ƒç”¨é’©å­å‡½æ•°ï¼Œå¹¶ä¼ å…¥ç›¸åº”çš„å‚æ•° args</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="title function_">callWithAsyncErrorHandling</span>(hook, target, <span class="keyword">type</span>, args)</span><br><span class="line">        <span class="comment">// å–æ¶ˆå½“å‰ç»„ä»¶å®ä¾‹çš„è®¾ç½®</span></span><br><span class="line">        <span class="title function_">unsetCurrentInstance</span>()</span><br><span class="line">        <span class="comment">// é‡ç½®ä¾èµ–è¿½è¸ªçŠ¶æ€</span></span><br><span class="line">        <span class="title function_">resetTracking</span>()</span><br><span class="line">        <span class="comment">// è¿”å›é’©å­å‡½æ•°çš„æ‰§è¡Œç»“æœ res</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ® prepend å‚æ•°çš„å€¼ï¼Œå°†å°è£…åçš„é’©å­å‡½æ•°æ·»åŠ åˆ° hooks æ•°ç»„çš„å¼€å¤´æˆ–æœ«å°¾</span></span><br><span class="line">    <span class="keyword">if</span> (prepend) &#123;</span><br><span class="line">      hooks.<span class="title function_">unshift</span>(wrappedHook)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      hooks.<span class="title function_">push</span>(wrappedHook)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›å°è£…åçš„é’©å­å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> wrappedHook</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœ target ä¸å­˜åœ¨ï¼Œä¸”æ˜¯å¼€å‘ç¯å¢ƒï¼Œåˆ™å‘å‡ºè­¦å‘Š</span></span><br><span class="line">    <span class="keyword">const</span> apiName = <span class="title function_">toHandlerKey</span>(<span class="title class_">ErrorTypeStrings</span>[<span class="keyword">type</span>].<span class="title function_">replace</span>(<span class="regexp">/ hook$/</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    <span class="title function_">warn</span>(</span><br><span class="line">      <span class="comment">// è¾“å‡ºè­¦å‘Šä¿¡æ¯</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ <code>inject</code> ä¼šç»™ <code>target</code> æ³¨å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°å¯ä»¥ç›´æ¥æ‰§è¡Œ <code>hook</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onBeforeMount, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå“åº”å¼æ•°æ®</span></span><br><span class="line">    <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ç»„ä»¶æŒ‚è½½ä¹‹å‰æ‰§è¡Œçš„é€»è¾‘</span></span><br><span class="line">    <span class="title function_">onBeforeMount</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ç»„ä»¶æŒ‚è½½ä¹‹å‰&#x27;</span>);</span><br><span class="line">      <span class="comment">// æ‰§è¡Œå…¶ä»–æ“ä½œ...</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ok, åˆ°è¿™é‡Œæ˜ç™½äº†ç”Ÿå‘½å‘¨æœŸæ˜¯å¦‚ä½•æ³¨å…¥çš„ï¼Œé‚£ä¹ˆ <strong>Vue3</strong> ç”Ÿå‘½å‘¨æœŸå¦‚ä½•è°ƒç”¨å‘¢ï¼Ÿï¼Œä»¥ <code>beforeMount</code> ä¸ºä¾‹å­</p><p>è¿™ä¸ªæ—¶å€™æ‰¾åˆ°äº† <code>setupRenderEffect</code> ä¹Ÿå°±æ˜¯æ¸²æŸ“ <code>setup</code> çš„å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> effect = (instance.<span class="property">effect</span> = <span class="keyword">new</span> <span class="title class_">ReactiveEffect</span>(</span><br><span class="line">    componentUpdateFn, <span class="comment">//è°ƒç”¨ instance.emit(&#x27;hook:beforeMount&#x27;)</span></span><br><span class="line">    <span class="function">() =&gt;</span> <span class="title function_">queueJob</span>(update),</span><br><span class="line">    instance.<span class="property">scope</span> <span class="comment">// track it in component&#x27;s effect scope</span></span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">update</span>: <span class="title class_">SchedulerJob</span> = (instance.<span class="property">update</span> = <span class="function">() =&gt;</span> effect.<span class="title function_">run</span>())</span><br><span class="line">update.<span class="property">id</span> = instance.<span class="property">uid</span></span><br><span class="line"><span class="title function_">update</span>()</span><br></pre></td></tr></table></figure><p>å¦å¤–é™¤äº†è¿™æ ·æ³¨å†Œä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç›´æ¥è¿™æ ·è°ƒç”¨</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">invokeDirectiveHook</span>(vnode, <span class="literal">null</span>, parentComponent, <span class="string">&#x27;beforeMount&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ä¼šç›´æ¥è§¦å‘ï¼Œè€Œä¸éœ€è¦ç­‰å¾…äº‹ä»¶ã€‚</p><h3 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3. æ€»ç»“"></a>3. æ€»ç»“</h3><p>Vue2.x Vue3.x ç”Ÿå‘½å‘¨æœŸçš„æ³¨å…¥å’Œè°ƒç”¨ï¼Œæœ¬è´¨ä¸Šæ²¡ä»€ä¹ˆåŒºåˆ«ã€‚</p><p>éƒ½æ˜¯æŒ‚åœ¨åœ¨å½“å‰ä¸Šä¸‹æ–‡ï¼ŒåŒºåˆ«åªæ˜¯é€šçŸ¥æ–¹å¼ï¼Œä¸€ä¸ªç›´æ¥è°ƒç”¨ï¼Œä¸€ä¸ªé€šè¿‡ <code>emit</code> æ¥è§¦å‘</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> vue3 </tag>
            
            <tag> vue2 </tag>
            
            <tag> typescript </tag>
            
            <tag> ç”Ÿå‘½å‘¨æœŸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>beforeCreate, created vs setup</title>
      <link href="/2023/06/20/vue_setup_created_before_created/"/>
      <url>/2023/06/20/vue_setup_created_before_created/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="beforeCreate-created-vs-setup"><a href="#beforeCreate-created-vs-setup" class="headerlink" title="beforeCreate, created vs setup"></a>beforeCreate, created vs setup</h1><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">beforeCreate -&gt; <span class="title function_">setup</span>()</span><br><span class="line">created -&gt; <span class="title function_">setup</span>()</span><br><span class="line">beforeMount -&gt; onBeforeMount</span><br><span class="line">mounted -&gt; onMounted</span><br><span class="line">beforeUpdate -&gt; onBeforeUpdate</span><br><span class="line">updated -&gt; onUpdated</span><br><span class="line">beforeDestroy -&gt; onBeforeUnmount</span><br><span class="line">destroyed -&gt; onUnmounted</span><br><span class="line">activated -&gt; onActivated</span><br><span class="line">deactivated -&gt; onDeactivated</span><br><span class="line">errorCaptured -&gt; onErrorCaptured</span><br></pre></td></tr></table></figure><p>æœ‰è¿™ä¹ˆå¤šç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªå¯¹æ¯”ã€‚</p><h3 id="1-beforeCreate"><a href="#1-beforeCreate" class="headerlink" title="1. beforeCreate"></a>1. beforeCreate</h3><p>vue2.x æ ¸å¿ƒä»£ç ä¸€ç›´åœ¨è¿™ä¸ªä½ç½® <strong>src\core\instance\init.ts</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">initMixin</span>(<span class="params">Vue: <span class="keyword">typeof</span> Component</span>) &#123;</span><br><span class="line">  <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_init</span> = <span class="keyword">function</span> (<span class="params">options?: Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">vm</span>: <span class="title class_">Component</span> = <span class="variable language_">this</span></span><br><span class="line">    <span class="comment">// a uid</span></span><br><span class="line">    vm.<span class="property">_uid</span> = uid++</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> startTag, endTag</span><br><span class="line">    <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">    <span class="keyword">if</span> (__DEV__ &amp;&amp; config.<span class="property">performance</span> &amp;&amp; mark) &#123;</span><br><span class="line">      startTag = <span class="string">`vue-perf-start:<span class="subst">$&#123;vm._uid&#125;</span>`</span></span><br><span class="line">      endTag = <span class="string">`vue-perf-end:<span class="subst">$&#123;vm._uid&#125;</span>`</span></span><br><span class="line">      <span class="title function_">mark</span>(startTag)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a flag to mark this as a Vue instance without having to do instanceof</span></span><br><span class="line">    <span class="comment">// check</span></span><br><span class="line">    vm.<span class="property">_isVue</span> = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// avoid instances from being observed</span></span><br><span class="line">    vm.<span class="property">__v_skip</span> = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// effect scope</span></span><br><span class="line">    vm.<span class="property">_scope</span> = <span class="keyword">new</span> <span class="title class_">EffectScope</span>(<span class="literal">true</span> <span class="comment">/* detached */</span>)</span><br><span class="line">    vm.<span class="property">_scope</span>.<span class="property">_vm</span> = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// merge options</span></span><br><span class="line">    <span class="keyword">if</span> (options &amp;&amp; options.<span class="property">_isComponent</span>) &#123;</span><br><span class="line">      <span class="comment">// optimize internal component instantiation</span></span><br><span class="line">      <span class="comment">// since dynamic options merging is pretty slow, and none of the</span></span><br><span class="line">      <span class="comment">// internal component options needs special treatment.</span></span><br><span class="line">      <span class="title function_">initInternalComponent</span>(vm, options <span class="keyword">as</span> <span class="built_in">any</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      vm.<span class="property">$options</span> = <span class="title function_">mergeOptions</span>(</span><br><span class="line">        <span class="title function_">resolveConstructorOptions</span>(vm.<span class="property">constructor</span> <span class="keyword">as</span> <span class="built_in">any</span>),</span><br><span class="line">        options || &#123;&#125;,</span><br><span class="line">        vm</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="title function_">initProxy</span>(vm)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      vm.<span class="property">_renderProxy</span> = vm</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// expose real self</span></span><br><span class="line">    vm.<span class="property">_self</span> = vm</span><br><span class="line">    <span class="title function_">initLifecycle</span>(vm)</span><br><span class="line">    <span class="title function_">initEvents</span>(vm)</span><br><span class="line">    <span class="title function_">initRender</span>(vm)</span><br><span class="line">    <span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeCreate&#x27;</span>, <span class="literal">undefined</span>, <span class="literal">false</span> <span class="comment">/* setContext */</span>)</span><br><span class="line">    <span class="title function_">initInjections</span>(vm) <span class="comment">// resolve injections before data/props</span></span><br><span class="line">    <span class="title function_">initState</span>(vm)</span><br><span class="line">    <span class="title function_">initProvide</span>(vm) <span class="comment">// resolve provide after data/props</span></span><br><span class="line">    <span class="title function_">callHook</span>(vm, <span class="string">&#x27;created&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">    <span class="keyword">if</span> (__DEV__ &amp;&amp; config.<span class="property">performance</span> &amp;&amp; mark) &#123;</span><br><span class="line">      vm.<span class="property">_name</span> = <span class="title function_">formatComponentName</span>(vm, <span class="literal">false</span>)</span><br><span class="line">      <span class="title function_">mark</span>(endTag)</span><br><span class="line">      <span class="title function_">measure</span>(<span class="string">`vue <span class="subst">$&#123;vm._name&#125;</span> init`</span>, startTag, endTag)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (vm.<span class="property">$options</span>.<span class="property">el</span>) &#123;</span><br><span class="line">      vm.$mount(vm.<span class="property">$options</span>.<span class="property">el</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒåŒ…å«äº†</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeCreate&#x27;</span>, <span class="literal">undefined</span>, <span class="literal">false</span> <span class="comment">/* setContext */</span>)</span><br><span class="line"><span class="title function_">callHook</span>(vm, <span class="string">&#x27;created&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹ <code>beforeCreate</code> åšäº†ä»€ä¹ˆ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// merge options</span></span><br><span class="line"><span class="comment">// å¯ä»¥ç®€å•çš„ç†è§£ä¸º2ç§æƒ…å†µ</span></span><br><span class="line"><span class="comment">// 1. æ ¹ç»„ä»¶åˆå¹¶ï¼Œä½  new Vueçš„å‚æ•°ï¼Œmixinï¼Œapi éƒ½åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„ $options</span></span><br><span class="line"><span class="comment">// 2. å­ç»„ä»¶åˆå¹¶ï¼ŒæŠŠçˆ¶ç»„ä»¶çš„ event, props éœ€è¦ä¼ é€’çš„ä¸œè¥¿åˆå¹¶ã€‚</span></span><br><span class="line"><span class="keyword">if</span> (options &amp;&amp; options.<span class="property">_isComponent</span>) &#123;</span><br><span class="line">    <span class="comment">// optimize internal component instantiation</span></span><br><span class="line">    <span class="comment">// since dynamic options merging is pretty slow, and none of the</span></span><br><span class="line">    <span class="comment">// internal component options needs special treatment.</span></span><br><span class="line">    <span class="title function_">initInternalComponent</span>(vm, options <span class="keyword">as</span> <span class="built_in">any</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    vm.<span class="property">$options</span> = <span class="title function_">mergeOptions</span>(</span><br><span class="line">    <span class="title function_">resolveConstructorOptions</span>(vm.<span class="property">constructor</span> <span class="keyword">as</span> <span class="built_in">any</span>),</span><br><span class="line">    options || &#123;&#125;,</span><br><span class="line">    vm</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”¨äºåˆå§‹åŒ–ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªç»„ä»¶å®ä¾‹ vm ä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨è¯¥ç»„ä»¶å®ä¾‹ä¸Šè®¾ç½®ä¸€äº›å±æ€§å’ŒçŠ¶æ€ã€‚</span></span><br><span class="line"><span class="comment">//æ€»ä½“æ¥è¯´å°±æ˜¯åˆå§‹åŒ–å½“å‰ç»„ä»¶çš„å¾ˆå¤šå±æ€§</span></span><br><span class="line"><span class="title function_">initLifecycle</span>(vm)</span><br><span class="line"><span class="comment">//äº‹ä»¶æ³¨å†Œ</span></span><br><span class="line"><span class="comment">//æŠŠçˆ¶ç»„ä»¶çš„ _parentListeners ä¼ é€’ç»™å½“å‰ç»„ä»¶ç›‘å¬</span></span><br><span class="line"><span class="title function_">initEvents</span>(vm)</span><br><span class="line"><span class="comment">//è§£ææ’æ§½</span></span><br><span class="line"><span class="comment">//ç»‘å®šcreateElement ç»„ä»¶å®ä¾‹</span></span><br><span class="line"><span class="comment">//è·å– $attrs &amp; $listenters, å¹¶ä¸”å“åº”å¼</span></span><br><span class="line"><span class="title function_">initRender</span>(vm)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ beforeCreate ä¹‹å‰åšäº† options,events,lifecycle, renderçš„ä¸€äº›å‡½æ•°ã€‚</p><h3 id="2-beforeCreate-èƒ½åšäº›ä»€ä¹ˆï¼Ÿ"><a href="#2-beforeCreate-èƒ½åšäº›ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2. beforeCreate èƒ½åšäº›ä»€ä¹ˆï¼Ÿ"></a>2. beforeCreate èƒ½åšäº›ä»€ä¹ˆï¼Ÿ</h3><p>èƒ½åšäº›ä»€ä¹ˆè‚¯å®šæ˜¯åŸºäº options,events,lifecycle, renderã€‚</p><ol><li>è®¿é—®ç»„ä»¶å®ä¾‹çš„é…ç½®é¡¹å’Œå±æ€§ï¼Œä¹Ÿå°±æ˜¯åˆå¹¶çš„ options.</li><li>å› ä¸ºåªæ˜¯åŠ è½½äº†å±æ€§ï¼Œäº‹ä»¶ç­‰ç­‰å‰ç½®çš„ä¸œè¥¿ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œèº«ä»½éªŒè¯ï¼Œåˆå§‹å€¼ï¼Œä¿®æ”¹å±æ€§ï¼ŒåŠ è½½æ•°æ®ä¹‹ç±»çš„æ“ä½œ</li><li>æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ event</li></ol><p>å…¶ä»–çš„éƒ½ä¸èƒ½è®¿é—®ã€‚</p><h3 id="3-created"><a href="#3-created" class="headerlink" title="3. created"></a>3. created</h3><p>beforeCreated åœ¨é’©å­æ‰§è¡Œå®Œæˆä»¥å</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//è§£ævm.$options.inject</span></span><br><span class="line"><span class="comment">//defineReactive å“åº”å¼</span></span><br><span class="line"><span class="title function_">initInjections</span>(vm) <span class="comment">// resolve injections before data/props</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//if (opts.props) initProps(vm, opts.props)</span></span><br><span class="line"><span class="comment">//if (opts.methods) initMethods(vm, opts.methods)</span></span><br><span class="line"><span class="comment">//if (opts.data) initData(vm)</span></span><br><span class="line"><span class="comment">//if (opts.computed) initComputed(vm, opts.computed)</span></span><br><span class="line"><span class="comment">//if (opts.watch &amp;&amp; opts.watch !== nativeWatch) initWatch(vm, opts.watch)</span></span><br><span class="line"><span class="comment">//å°±æ˜¯æŠŠè¿™äº›è§£æå‡ºæ¥ï¼Œç„¶åå“åº”å¼ï¼ŒæŒ‚è½½åœ¨vmä¸Š</span></span><br><span class="line"><span class="title function_">initState</span>(vm)</span><br><span class="line"></span><br><span class="line"><span class="comment">//è§£æ resolveProvided(vm)</span></span><br><span class="line"><span class="comment">//å“åº”å¼ Object.defineProperty</span></span><br><span class="line"><span class="title function_">initProvide</span>(vm) <span class="comment">// resolve provide after data/props</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯åœ¨æ‰§è¡Œ Created ä¹‹å‰ï¼Œè§£æå‡º <code>props, methods, data, computed, watch, inject, provide</code>.</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ Created ä¹‹åå°±å¯ä»¥è®¿é—®è¿™äº›æ•°æ®äº†ã€‚</p><h3 id="4-created-èƒ½åšä»€ä¹ˆï¼Ÿ"><a href="#4-created-èƒ½åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="4. created èƒ½åšä»€ä¹ˆï¼Ÿ"></a>4. created èƒ½åšä»€ä¹ˆï¼Ÿ</h3><ol><li>è·å–ç»„ä»¶æ•°æ®ã€‚</li><li>è®¿é—®ç»„ä»¶çš„ DOM å…ƒç´ ï¼Œç»„ä»¶çš„æ¨¡æ¿å·²ç»è¢«ç¼–è¯‘ä¸º DOM å…ƒç´ ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ this.$el æ¥è®¿é—®ç»„ä»¶çš„æ ¹å…ƒç´ ã€‚ä½ å¯ä»¥æ‰§è¡Œä¸€äº›éœ€è¦æ“ä½œå®é™… DOM çš„ä»»åŠ¡ï¼Œä¾‹å¦‚æ“ä½œå…ƒç´ å±æ€§ã€æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ç­‰ã€‚</li><li>è°ƒç”¨æ–¹æ³•ã€‚</li></ol><h3 id="5-setup"><a href="#5-setup" class="headerlink" title="5. setup"></a>5. setup</h3><p>åœ¨çœ‹ç”Ÿå‘½å‘¨æœŸé’©å­ä¹‹å‰ï¼Œè¿˜æ˜¯éœ€è¦çŸ¥é“å¤§æ¦‚ Vue3 åˆ›å»ºç»„ä»¶çš„åŸºæœ¬æµç¨‹ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–ç»„ä»¶å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">instance</span>: <span class="title class_">ComponentInternalInstance</span> =</span><br><span class="line">  compatMountInstance ||</span><br><span class="line">  (initialVNode.<span class="property">component</span> = <span class="title function_">createComponentInstance</span>(</span><br><span class="line">    initialVNode,</span><br><span class="line">    parentComponent,</span><br><span class="line">    parentSuspense</span><br><span class="line">  ))</span><br><span class="line"></span><br><span class="line"><span class="comment">// inject renderer internals for keepAlive</span></span><br><span class="line"><span class="comment">// å°†é»˜è®¤çš„æ¸²æŸ“æ–¹æ³•ï¼ŒåŠ å…¥åˆ° KeepAliveContext å½“ç„¶çš„ render å½“ä¸­</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isKeepAlive</span>(initialVNode)) &#123;</span><br><span class="line">  ;(instance.<span class="property">ctx</span> <span class="keyword">as</span> <span class="title class_">KeepAliveContext</span>).<span class="property">renderer</span> = internals</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// resolve props and slots for setup context</span></span><br><span class="line"><span class="comment">// å…¶å®ä¸ä»…ä»…æ˜¯è§£æï¼Œè¿˜æ‰§è¡Œäº† setupå‡½æ•°</span></span><br><span class="line"><span class="title function_">setupComponent</span>(instance)</span><br><span class="line"></span><br><span class="line"><span class="comment">// setup() is async. This component relies on async logic to be resolved</span></span><br><span class="line"><span class="comment">// before proceeding</span></span><br><span class="line"><span class="comment">// å¤„ç†å¼‚æ­¥é€»è¾‘çš„æƒ…å†µï¼Œéœ€è¦ç­‰å¾… setup() å‡½æ•°å®Œæˆåå†ç»§ç»­  </span></span><br><span class="line"><span class="keyword">if</span> (__FEATURE_SUSPENSE__ &amp;&amp; instance.<span class="property">asyncDep</span>) &#123;</span><br><span class="line">  parentSuspense &amp;&amp; parentSuspense.<span class="title function_">registerDep</span>(instance, setupRenderEffect)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Give it a placeholder if this is not hydration</span></span><br><span class="line">  <span class="comment">// TODO handle self-defined fallback</span></span><br><span class="line">  <span class="keyword">if</span> (!initialVNode.<span class="property">el</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> placeholder = (instance.<span class="property">subTree</span> = <span class="title function_">createVNode</span>(<span class="title class_">Comment</span>))</span><br><span class="line">    <span class="title function_">processCommentNode</span>(<span class="literal">null</span>, placeholder, container!, anchor)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰§è¡Œç»„ä»¶çš„æ¸²æŸ“æ•ˆæœå‡½æ•°è¿›è¡Œæ¸²æŸ“</span></span><br><span class="line"><span class="title function_">setupRenderEffect</span>(</span><br><span class="line">  instance,</span><br><span class="line">  initialVNode,</span><br><span class="line">  container,</span><br><span class="line">  anchor,</span><br><span class="line">  parentSuspense,</span><br><span class="line">  isSVG,</span><br><span class="line">  optimized</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªç»„ä»¶æœ‰ä»€ä¹ˆæµç¨‹ï¼Ÿ</p><ol><li>è·å–ç»„ä»¶å®ä¾‹</li><li>å°†é»˜è®¤çš„æ¸²æŸ“æ–¹æ³•ï¼ŒåŠ å…¥åˆ° KeepAliveContext å½“ç„¶çš„ render å½“ä¸­</li><li>è§£æå’Œæ‰§è¡Œ setup</li><li>å¤„ç† setup å¼‚æ­¥æƒ…å†µ</li><li>æ¸²æŸ“</li></ol><p>é‚£æˆ‘ä»¬ç»§ç»­çœ‹ <code>setupComponent</code> å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setupComponent</span>(<span class="params"></span></span><br><span class="line"><span class="params">  instance: ComponentInternalInstance,</span></span><br><span class="line"><span class="params">  isSSR = <span class="literal">false</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  isInSSRComponentSetup = isSSR</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; props, children &#125; = instance.<span class="property">vnode</span></span><br><span class="line">  <span class="keyword">const</span> isStateful = <span class="title function_">isStatefulComponent</span>(instance)</span><br><span class="line">  <span class="comment">//è§£æprops &amp; slots</span></span><br><span class="line">  <span class="title function_">initProps</span>(instance, props, isStateful, isSSR)</span><br><span class="line">  <span class="title function_">initSlots</span>(instance, children)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å¦‚æœæ˜¯æœ‰çŠ¶æ€ç»„ä»¶ï¼Œæ‰§è¡Œ setup</span></span><br><span class="line">  <span class="keyword">const</span> setupResult = isStateful</span><br><span class="line">    ? <span class="title function_">setupStatefulComponent</span>(instance, isSSR)</span><br><span class="line">    : <span class="literal">undefined</span></span><br><span class="line">  isInSSRComponentSetup = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">return</span> setupResult</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰§è¡Œsetup</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setupStatefulComponent</span>(<span class="params"></span></span><br><span class="line"><span class="params">  instance: ComponentInternalInstance,</span></span><br><span class="line"><span class="params">  isSSR: <span class="built_in">boolean</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Component</span> = instance.<span class="property">type</span> <span class="keyword">as</span> <span class="title class_">ComponentOptions</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 0. create render proxy property access cache</span></span><br><span class="line">  instance.<span class="property">accessCache</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line">  <span class="comment">// 1. create public instance / render proxy</span></span><br><span class="line">  <span class="comment">// also mark it raw so it&#x27;s never observed</span></span><br><span class="line">  instance.<span class="property">proxy</span> = <span class="title function_">markRaw</span>(<span class="keyword">new</span> <span class="title class_">Proxy</span>(instance.<span class="property">ctx</span>, <span class="title class_">PublicInstanceProxyHandlers</span>))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. call setup()</span></span><br><span class="line">  <span class="keyword">const</span> &#123; setup &#125; = <span class="title class_">Component</span></span><br><span class="line">  <span class="keyword">if</span> (setup) &#123;</span><br><span class="line">    <span class="keyword">const</span> setupContext = (instance.<span class="property">setupContext</span> =</span><br><span class="line">      setup.<span class="property">length</span> &gt; <span class="number">1</span> ? <span class="title function_">createSetupContext</span>(instance) : <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setCurrentInstance</span>(instance)</span><br><span class="line">    <span class="title function_">pauseTracking</span>()</span><br><span class="line">    <span class="keyword">const</span> setupResult = <span class="title function_">callWithErrorHandling</span>(</span><br><span class="line">      setup,</span><br><span class="line">      instance,</span><br><span class="line">      <span class="title class_">ErrorCodes</span>.<span class="property">SETUP_FUNCTION</span>,</span><br><span class="line">      [__DEV__ ? <span class="title function_">shallowReadonly</span>(instance.<span class="property">props</span>) : instance.<span class="property">props</span>, setupContext]</span><br><span class="line">    )</span><br><span class="line">    <span class="title function_">resetTracking</span>()</span><br><span class="line">    <span class="title function_">unsetCurrentInstance</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isPromise</span>(setupResult)) &#123;</span><br><span class="line">      setupResult.<span class="title function_">then</span>(unsetCurrentInstance, unsetCurrentInstance)</span><br><span class="line">      <span class="keyword">if</span> (isSSR) &#123;</span><br><span class="line">        <span class="comment">// return the promise so server-renderer can wait on it</span></span><br><span class="line">        <span class="keyword">return</span> setupResult</span><br><span class="line">          .<span class="title function_">then</span>(<span class="function">(<span class="params">resolvedResult: <span class="built_in">unknown</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">handleSetupResult</span>(instance, resolvedResult, isSSR)</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">handleError</span>(e, instance, <span class="title class_">ErrorCodes</span>.<span class="property">SETUP_FUNCTION</span>)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (__FEATURE_SUSPENSE__) &#123;</span><br><span class="line">        <span class="comment">// async setup returned Promise.</span></span><br><span class="line">        <span class="comment">// bail here and wait for re-entry.</span></span><br><span class="line">        instance.<span class="property">asyncDep</span> = setupResult</span><br><span class="line">        <span class="keyword">if</span> (__DEV__ &amp;&amp; !instance.<span class="property">suspense</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> name = <span class="title class_">Component</span>.<span class="property">name</span> ?? <span class="string">&#x27;Anonymous&#x27;</span></span><br><span class="line">          <span class="title function_">warn</span>(</span><br><span class="line">            <span class="string">`Component &lt;<span class="subst">$&#123;name&#125;</span>&gt;: setup function returned a promise, but no `</span> +</span><br><span class="line">              <span class="string">`&lt;Suspense&gt; boundary was found in the parent component tree. `</span> +</span><br><span class="line">              <span class="string">`A component with async setup() must be nested in a &lt;Suspense&gt; `</span> +</span><br><span class="line">              <span class="string">`in order to be rendered.`</span></span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">        <span class="title function_">warn</span>(</span><br><span class="line">          <span class="string">`setup() returned a Promise, but the version of Vue you are using `</span> +</span><br><span class="line">            <span class="string">`does not support it yet.`</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">handleSetupResult</span>(instance, setupResult, isSSR)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">finishComponentSetup</span>(instance, isSSR)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•è¯´å°±æ˜¯è®¾ç½®ä¸Šä¸‹æ–‡ï¼Œæ‰§è¡Œ <code>setupï¼Œè·å–</code> <code>setup</code> è¿”å›å€¼ï¼Œåˆ¤æ–­æ˜¯å¦å¼‚æ­¥è¿”å›ï¼Œè°ƒç”¨ <code>handleSetupResult</code></p><p>&#96;&#96; å°±æ˜¯åˆ¤æ–­è¿”å›ç±»å‹ï¼Œè¿›è¡Œä¸åŒçš„å¤„ç†</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">isFunction</span>(setupResult) <span class="comment">//è¿”å›æ¸²æŸ“å‡½æ•°</span></span><br><span class="line"><span class="title function_">isObject</span>(setupResult) <span class="comment">//è¿”å›ç»‘å®šå¯¹è±¡ï¼Œç»‘å®šåˆ° setupState å½“ä¸­</span></span><br></pre></td></tr></table></figure><p>ç„¶åè°ƒç”¨ <code>finishComponentSetup</code>ï¼Œ è¿™é‡Œå…¶å®ä¸»è¦æ˜¯å¤„ç†æ¸²æŸ“å‡½æ•°å’Œå…¼å®¹æ¨¡å¼(å…¼å®¹Vue2.xå†™æ³•)ã€‚</p><p>åœ¨è¿™é‡ŒåŸºæœ¬æ˜ç™½äº†ç»„ä»¶åˆ›å»ºæœŸé—´åšäº†ä»€ä¹ˆï¼Ÿ</p><ol><li>éœ€è¦åˆ›å»ºç»„ä»¶çš„åœ°æ–¹è°ƒç”¨ <code>patch</code></li><li>æ ¹æ®èŠ‚ç‚¹ç±»å‹(shapeFlag &amp; 6 &#x2F;* ShapeFlags.COMPONENT *&#x2F;), åˆ¤æ–­éœ€è¦è°ƒç”¨ <code>processComponentã€‚</code></li><li>ç„¶åè°ƒç”¨ <code>mountComponent</code> åˆ›å»ºèŠ‚ç‚¹</li><li>åˆ¤æ–­æ˜¯å¦æ˜¯ <code>keepAliveï¼Œå†™å…¥</code> <code>keepAlive</code> ä¸“é—¨çš„ <code>render</code></li><li>æ‰§è¡Œ <code>setupComponent(instance);</code> è§£æå’Œæ‰§è¡Œ <code>setup</code><br>  5.1 è§£æ <code>props</code>, <code>slot</code><br>  5.2 è®¾ç½® <code>setup</code> æ‰§è¡Œä¸Šä¸‹æ–‡<br>  5.3 æ‰§è¡Œ <code>setup</code><br>  5.4 å¤„ç†è¿”å›å€¼<br>  5.5 åˆ›å»º <code>render</code> å‡½æ•°</li><li>å¤„ç† <code>setup</code> å¼‚æ­¥è°ƒç”¨æƒ…å†µ</li><li>æ¸²æŸ“</li></ol><h3 id="6-setup-å‡½æ•°èƒ½è®¿é—®ä»€ä¹ˆï¼Ÿ"><a href="#6-setup-å‡½æ•°èƒ½è®¿é—®ä»€ä¹ˆï¼Ÿ" class="headerlink" title="6. setup å‡½æ•°èƒ½è®¿é—®ä»€ä¹ˆï¼Ÿ"></a>6. setup å‡½æ•°èƒ½è®¿é—®ä»€ä¹ˆï¼Ÿ</h3><p>è¿™é‡Œæœ‰å‡ ä¸ªé—®é¢˜ï¼Œåœ¨åˆšæ‰çœ‹ <strong>vue2.x</strong> æºç çš„æ—¶å€™ï¼Œä¸ä»…ä»…æœ‰è¿™äº›ä¸œè¥¿ï¼Œ</p><p>åœ¨ <code>beforeCreate</code> çš„æ—¶å€™æœ‰ <code>optionsï¼ŒinitLifecycleï¼ŒinitEventsï¼ŒinitRender</code><br>åœ¨ <code>created</code> çš„æ—¶å€™å¯ä»¥è®¿é—®ï¼Œ<code>props, methods, data, computed, watch, inject, provide</code></p><p>è¿™äº›æ²¡æœ‰å¯ä»¥ç†è§£ <code>methods, data, computed, watch</code>ï¼Œå› ä¸ºä»–å·²ç»åœ¨ <code>setup</code> å‡½æ•°å½“ä¸­äº†ï¼Œé‚£ä¹ˆï¼Ÿå…¶ä»–çš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬åº”è¯¥å¦‚ä½•è®¿é—®ï¼Ÿ</p><p>æ‹¿ options æ¥è¯´</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getCurrentInstance &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> instance = <span class="title function_">getCurrentInstance</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;instance???&#x27;</span>, instance.<span class="property">appContext</span>.<span class="property">config</span>.<span class="property">globalProperties</span>)</span><br></pre></td></tr></table></figure><p>initRender åœ¨è§£æå’Œæ‰§è¡Œ setup ä¼šåˆå§‹åŒ–ã€‚</p><p><code>$attrs</code> åœ¨ <code>createSetupContext</code> ä¸­è§£æï¼Œç„¶åä¼ å…¥ <code>callWithErrorHandling</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> setupContext = (instance.<span class="property">setupContext</span> =</span><br><span class="line">  setup.<span class="property">length</span> &gt; <span class="number">1</span> ? <span class="title function_">createSetupContext</span>(instance) : <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">setCurrentInstance</span>(instance)</span><br><span class="line"><span class="title function_">pauseTracking</span>()</span><br><span class="line"><span class="keyword">const</span> setupResult = <span class="title function_">callWithErrorHandling</span>(</span><br><span class="line">  setup,</span><br><span class="line">  instance,</span><br><span class="line">  <span class="title class_">ErrorCodes</span>.<span class="property">SETUP_FUNCTION</span>,</span><br><span class="line">  [__DEV__ ? <span class="title function_">shallowReadonly</span>(instance.<span class="property">props</span>) : instance.<span class="property">props</span>, setupContext]</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><code>initEvents</code> ä¸»è¦æ˜¯è§£å†³çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹çš„é€šä¿¡ï¼ˆé€šè¿‡äº‹ä»¶é€šä¿¡ï¼‰, </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;child v-on=<span class="string">`customEvent`</span>&gt;something&lt;/child&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//child</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">triggerEvent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> payload = <span class="string">&#x27;Hello from child component!&#x27;</span>;</span><br><span class="line">  <span class="title function_">emit</span>(<span class="string">&#x27;customEvent&#x27;</span>, payload);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>initEvents</code> &amp; <code>$attrs</code> çš„æºç éƒ½åœ¨ <code>createSetupContext</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">attrs</span>: <span class="title class_">Data</span></span><br><span class="line"><span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">  <span class="comment">// We use getters in dev in case libs like test-utils overwrite instance</span></span><br><span class="line">  <span class="comment">// properties (overwrites should not be done in prod)</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">freeze</span>(&#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">attrs</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> attrs || (attrs = <span class="title function_">createAttrsProxy</span>(instance))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">slots</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">shallowReadonly</span>(instance.<span class="property">slots</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">emit</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">event: <span class="built_in">string</span>, ...args: <span class="built_in">any</span>[]</span>) =&gt;</span> instance.<span class="title function_">emit</span>(event, ...args)</span><br><span class="line">    &#125;,</span><br><span class="line">    expose</span><br><span class="line">  &#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">attrs</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> attrs || (attrs = <span class="title function_">createAttrsProxy</span>(instance))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">slots</span>: instance.<span class="property">slots</span>,</span><br><span class="line">    <span class="attr">emit</span>: instance.<span class="property">emit</span>,</span><br><span class="line">    expose</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>inject, provide</code> </p><p><strong>packages\runtime-core\src\apiInject.ts</strong></p><p>å…¶å®å°±æ˜¯ çˆ¶ç»„ä»¶è°ƒç”¨ <code>provide</code>, ä¸ºå½“å‰ç»„ä»¶çš„ <code>provides</code> å±æ€§æ·»åŠ  <code>key value</code>.</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> provides = currentInstance.<span class="property">provides</span></span><br><span class="line"><span class="comment">// by default an instance inherits its parent&#x27;s provides object</span></span><br><span class="line"><span class="comment">// but when it needs to provide values of its own, it creates its</span></span><br><span class="line"><span class="comment">// own provides object using parent provides object as prototype.</span></span><br><span class="line"><span class="comment">// this way in `inject` we can simply look up injections from direct</span></span><br><span class="line"><span class="comment">// parent and let the prototype chain do the work.</span></span><br><span class="line"><span class="keyword">const</span> parentProvides =</span><br><span class="line">  currentInstance.<span class="property">parent</span> &amp;&amp; currentInstance.<span class="property">parent</span>.<span class="property">provides</span></span><br><span class="line"><span class="keyword">if</span> (parentProvides === provides) &#123;</span><br><span class="line">  provides = currentInstance.<span class="property">provides</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(parentProvides)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// TS doesn&#x27;t allow symbol as index type</span></span><br><span class="line">provides[key <span class="keyword">as</span> <span class="built_in">string</span>] = value</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå­ç»„ä»¶çš„æ—¶å€™ä¼šè°ƒç”¨</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">provides</span>: parent ? parent.<span class="property">provides</span> : <span class="title class_">Object</span>.<span class="title function_">create</span>(appContext.<span class="property">provides</span>),</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦ <code>inject</code>ï¼Œå°±æ˜¯æ²¿ç€å‘ä¸Šæ‰¾ã€‚</p><h3 id="7-å·®åˆ«ã€‚"><a href="#7-å·®åˆ«ã€‚" class="headerlink" title="7. å·®åˆ«ã€‚"></a>7. å·®åˆ«ã€‚</h3><p>åœ¨æˆ‘çœ‹æ¥ï¼Œå¯ä»¥ç†è§£ä¸ºæ²¡æœ‰ <code>beforeCreate</code> è¿™ä¸ªç”Ÿå‘½å‘¨æœŸäº†, å¯ä»¥ç†è§£ä¸º <code>setup = created</code>. è¯¥è§£æçš„éƒ½è§£æå¥½äº†.</p><h3 id="8-æ€»ç»“"><a href="#8-æ€»ç»“" class="headerlink" title="8. æ€»ç»“"></a>8. æ€»ç»“</h3><p><code>beforeCreate</code> å¯ä»¥è®¿é—® <code>options, event, render</code> å‡½æ•°ç­‰ç­‰ã€‚</p><p><code>created</code> å¯ä»¥è®¿é—®åˆ° <code>dataï¼Œmethodï¼Œinjectï¼Œprovideï¼Œattrsï¼Œlistener</code> ç­‰ç­‰</p><p><code>setup</code> ç­‰äºä¸Šé¢çš„éƒ½èƒ½è®¿é—®.</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> setup </tag>
            
            <tag> Vue3.x </tag>
            
            <tag> Vue2.x </tag>
            
            <tag> beforeCreate </tag>
            
            <tag> created </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>async &amp; defer</title>
      <link href="/2023/06/15/async&amp;defer/"/>
      <url>/2023/06/15/async&amp;defer/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="async-amp-defer"><a href="#async-amp-defer" class="headerlink" title="async &amp; defer"></a>async &amp; defer</h1><h3 id="1-åŸºç¡€çŸ¥è¯†"><a href="#1-åŸºç¡€çŸ¥è¯†" class="headerlink" title="1. åŸºç¡€çŸ¥è¯†"></a>1. åŸºç¡€çŸ¥è¯†</h3><p>ä»ä¹‹å‰æˆ‘å­¦ä¹ çš„æµè§ˆå™¨è§£æè¿‡ç¨‹ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œæµè§ˆå™¨é¡ºåºè§£æï¼Œé‡åˆ°javascriptï¼Œå°±ä¼šé˜»å¡ï¼Œå¹¶ä¸”ä¼šæ‰§è¡Œ javascript, ä¹Ÿä¼šé˜»å¡</p><p>æˆ‘ä»¬åšä¸€ä¸ªç®€å•çš„æµ‹è¯•</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;ved=2ahUKEwjBkb65gsX_AhXnQPUHHasODVkQFnoECBYQAQ&amp;url=https%3A%2F%2Fcloud.google.com%2Fcdn%3Fhl%3Dzh-cn&amp;usg=AOvVaw3iWKHtZqUXGJwR-4dEGXk8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æˆ‘åŠ å…¥äº†ä¸€æ®µ google çš„è¿æ¥, :)</p><p>è‚¯å®šä¸èƒ½è®¿é—®ï¼Œæ‰€ä»¥è¯´ï¼Œæµè§ˆå™¨åœ¨è¶…æ—¶ä¹‹å‰ä¸‹é¢çš„æ‰€æœ‰ä»£ç éƒ½æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å°† script æ”¾åœ¨ </body> ä¹‹å‰ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;ved=2ahUKEwjBkb65gsX_AhXnQPUHHasODVkQFnoECBYQAQ&amp;url=https%3A%2F%2Fcloud.google.com%2Fcdn%3Fhl%3Dzh-cn&amp;usg=AOvVaw3iWKHtZqUXGJwR-4dEGXk8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¥½å¤„æ˜¯å¯ä»¥æœ‰2ç‚¹</p><ol><li>é¢„è§£æå™¨å¯ä»¥æå‰åŠ è½½ï¼Œè™½ç„¶ script ä¸æ˜¯å¼‚æ­¥çš„ï¼Œä½†æ˜¯å®é™…å°±æ˜¯å¼‚æ­¥çš„ã€‚</li><li>å°±ç®—é˜»å¡äº†ï¼Œè‡³å°‘å‰é¢çš„ä»£ç  cssï¼Œhtml æ˜¯å¯ä»¥åŠ è½½çš„</li></ol><h3 id="2-async"><a href="#2-async" class="headerlink" title="2. async"></a>2. async</h3><ol><li>å½“ script å…ƒç´ ä½¿ç”¨ async å±æ€§æ—¶ï¼Œè„šæœ¬çš„åŠ è½½å’Œæ‰§è¡Œå°†æ˜¯å¼‚æ­¥çš„ã€‚</li><li>å¼‚æ­¥åŠ è½½çš„è„šæœ¬ä¸ä¼šé˜»å¡ HTML é¡µé¢çš„è§£æå’Œæ¸²æŸ“è¿‡ç¨‹ã€‚</li><li>è„šæœ¬çš„åŠ è½½å’Œæ‰§è¡Œé¡ºåºä¸å®ƒä»¬åœ¨ HTML ä¸­çš„é¡ºåºæ— å…³ï¼Œå“ªä¸ªè„šæœ¬å…ˆåŠ è½½å®Œæˆå°±å…ˆæ‰§è¡Œã€‚</li><li>å¼‚æ­¥è„šæœ¬åŠ è½½å®Œæˆåä¼šç«‹å³æ‰§è¡Œï¼Œä¸ç®¡ HTML é¡µé¢çš„åŠ è½½çŠ¶æ€ã€‚</li><li>å¦‚æœå¤šä¸ªå¼‚æ­¥è„šæœ¬ç›¸äº’ä¾èµ–ï¼Œæ‰§è¡Œé¡ºåºå¯èƒ½ä¼šå—åˆ°å½±å“ã€‚</li></ol><p>çœ‹äº†è¿™ä¸ªæè¿°ï¼Œå°±å¼€å§‹ç–‘æƒ‘, æˆ‘ä»¬çŸ¥é“åŠ è½½æ˜¯å¼‚æ­¥çš„ï¼Œè¿™ä¸ªæˆ‘å¯ä»¥ç†è§£ï¼Œé‚£ä¹ˆæ‰§è¡Œä¸ºä»€ä¹ˆæ˜¯å¼‚æ­¥çš„ï¼Ÿ</p><p>å› ä¸ºåœ¨ä¹‹å‰çš„å­¦ä¹ å½“ä¸­ï¼Œä¸»çº¿ç¨‹è§£æhtmlï¼Œé‡åˆ° script å¼€å§‹åŠ è½½å’Œæ‰§è¡Œ(äº¤ç»™jså¼•æ“)ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ˜¯åŒæ­¥çš„ï¼Œå¹¶ä¸”ä¼šåœæ­¢æ¸²æŸ“é¡µé¢ã€‚</p><p>åŸå› æ˜¯å› ä¸º jså¼•æ“å’Œæ¸²æŸ“çº¿ç¨‹æ˜¯äº’æ–¥çš„ï¼Œjsä¸­ä»»ä½•æ“ä½œdomï¼Œcssçš„ä»£ç ï¼Œéƒ½å¯èƒ½å¯¼è‡´å›æµæˆ–è€…é‡ç»˜ã€‚</p><p>äºæ˜¯æˆ‘åœ¨ä¸€æ®µæˆ‘æµ‹è¯•çš„htmlä¸­åŠ å…¥äº†ä¸€æ®µä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;./javascript/test.js&quot;</span> <span class="keyword">async</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> d = (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">getTime</span>();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">200000000</span>;i++) &#123;</span><br><span class="line">     b += i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">getTime</span>() - d);</span><br></pre></td></tr></table></figure><p>å¾—å‡ºäº†ä¸€ä¸ªç»“è®ºï¼ŒåŠ è½½æ˜¯å¼‚æ­¥çš„ï¼Œæ‰§è¡Œæ˜¯åŒæ­¥çš„(chatgptå®³äººå•Šâ€¦)</p><p>å› ä¸ºåŠ è½½çš„æ—¶å€™å¹¶æ²¡æœ‰å½±å“å…¶ä»–jsçš„æ‰§è¡Œï¼Œç„¶è€ŒåŠ è½½å®Œæˆç«‹åˆ»å¼€å§‹æ‰§è¡Œï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">19999999867108864 test.js:7</span><br><span class="line">6647 test.js:8</span><br></pre></td></tr></table></figure><p>ä¸­é—´è¿™6ç§’å¹¶æ²¡æœ‰æ‰§è¡Œå…¶ä»–jsä»£ç ï¼Œäºæ˜¯è¯´æ˜äº†ä¸€åˆ‡ã€‚</p><p>å†æµ‹è¯•ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯å…ˆåˆ°å…ˆå¾—</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;./javascript/test.js&quot;</span> <span class="keyword">async</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./javascript/test1.js&quot;</span> <span class="attr">async</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`-------------test start---------------`</span>)</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> d = (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">getTime</span>();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">200000000</span>;i++) &#123;</span><br><span class="line">     b += i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">getTime</span>() - d);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`-------------test end---------------`</span>)</span><br></pre></td></tr></table></figure><p>å¤åˆ¶äº†ä¸€ä»½ <strong>test.js</strong> ä»£ç , å¹¶ä¸”æ–°å¢äº†è¾“å‡ºï¼Œä½†æ˜¯ä¸€ç›´æ˜¯ <strong>test.js</strong> å…ˆæ‰§è¡Œ, åˆç»™ <strong>test.js</strong> å¢åŠ äº†å¤§é‡æ³¨é‡Šï¼Œå¯¼è‡´ä»–åŠ è½½é€Ÿåº¦å˜æ…¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-------------test1 start--------------- test1.js:8 1 </span><br><span class="line">19999999867108864 test1.js:9 1 </span><br><span class="line">6677 test1.js:10 </span><br><span class="line">-------------test1 end--------------- test.js:1 </span><br><span class="line">-------------test start--------------- test.js:7 </span><br><span class="line">19999999867108864 test.js:8 </span><br><span class="line">7001 test.js:9 </span><br><span class="line">-------------test end---------------</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç½‘é€Ÿå†³å®šä¸€åˆ‡ï¼ŒåŠ è½½å®Œæˆåç«‹åˆ»æ‰§è¡Œï¼Œå…ˆåˆ°å…ˆå¾—ï¼ŒåŠ è½½å¼‚æ­¥ï¼Œæ‰§è¡ŒåŒæ­¥ã€‚</p><h3 id="3-defer"><a href="#3-defer" class="headerlink" title="3. defer"></a>3. defer</h3><ul><li>å½“ <script> å…ƒç´ ä½¿ç”¨ defer å±æ€§æ—¶ï¼Œè„šæœ¬çš„åŠ è½½å’Œæ‰§è¡ŒåŒæ­¥ã€‚</li><li>å»¶è¿ŸåŠ è½½çš„è„šæœ¬ä¸ä¼šé˜»å¡ HTML é¡µé¢çš„è§£æï¼Œä½†ä¼šåœ¨ HTML é¡µé¢è§£æå®Œæ¯•åæŒ‰ç…§å®ƒä»¬åœ¨ HTML ä¸­çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</li><li>å»¶è¿Ÿè„šæœ¬åœ¨ DOMContentLoaded äº‹ä»¶è§¦å‘ä¹‹å‰å®ŒæˆåŠ è½½å’Œæ‰§è¡Œï¼Œå³åœ¨æ–‡æ¡£è§£ææœŸé—´æ‰§è¡Œã€‚</li><li>å¦‚æœå¤šä¸ªå»¶è¿Ÿè„šæœ¬ç›¸äº’ä¾èµ–ï¼Œæ‰§è¡Œé¡ºåºä¼šæŒ‰ç…§å®ƒä»¬åœ¨ HTML ä¸­çš„é¡ºåºæ¥æ‰§è¡Œã€‚</li></ul><blockquote><p>HTML é¡µé¢è§£æå®Œæ¯•å</p></blockquote><p>äºæ˜¯æˆ‘ç¬¬ä¸€ååº”æ˜¯åŠ å…¥ä¸€ä¸ªäº‹ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// åœ¨è¿™é‡Œæ‰§è¡Œåˆå§‹åŒ–æ“ä½œå’Œæ“ä½œ DOM çš„ä»£ç </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¯æƒœçš„æ˜¯ï¼Œä¸¤ä¸ªjsåœ¨è¿™ä¸ªäº‹ä»¶ä¹‹å‰å·²ç»æ‰§è¡Œäº†, ä¸€æ—¶åŠä¼šå„¿æƒ³ä¸å‡ºæœ‰ä»€ä¹ˆèƒ½å¤Ÿæµ‹è¯•ï¼Œäºæ˜¯æˆ‘åœ¨æœ€åçš„éƒ¨åˆ†åŠ å…¥äº†è¾“å‡ºä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`end`</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœæ˜¯ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">console.log(`end`);</span><br><span class="line">javascript defer è¾“å‡º</span><br><span class="line">console.log(`trigger DOMContentLoaded`)</span><br></pre></td></tr></table></figure><p>åŸºæœ¬ç¡®å®šäº†æ˜¯åœ¨è§£æå®Œæˆä»¥åè§£æï¼Œç„¶ååˆè¯•äº†è¯• <code>async</code>, ä¼šåœ¨ <code>DOMContentLoaded</code> ä¹‹å‰è§¦å‘ï¼Œé¡ºä¾¿æµ‹è¯•äº†ä¸€ä¸‹æ˜¯å¦ä¼šåŠ è½½å®Œæˆä¹‹åä¸­æ–­è§£æï¼Œç«‹åˆ»æ‰§è¡Œã€‚</p><p>äºæ˜¯åŠ å…¥äº†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;è¿™æ˜¯ä¸€ä¸ªéœ€è¦å¾ˆé•¿æ—¶é—´åŠ è½½çš„<span class="variable constant_">HTML</span>é¡µé¢&lt;/h1&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>ä¸‹é¢æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ–‡æœ¬åŒºåŸŸï¼š<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">rows</span>=<span class="string">&quot;100&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  ...å¤§é‡æ–‡å­—</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>æœç„¶ä¼˜å…ˆæ‰§è¡Œäº† <code>async</code> çš„ <strong>js</strong>.</p><h3 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3. æ€»ç»“"></a>3. æ€»ç»“</h3><p>async å’Œ defer éƒ½æ˜¯å¼‚æ­¥åŠ è½½ï¼Œasync åŠ è½½å®Œæˆä¹‹åç«‹åˆ»æ‰§è¡Œï¼Œä¸­æ–­ä¸»çº¿ç¨‹è§£æã€‚ defer ç­‰å¾…ä¸»çº¿ç¨‹è§£æå®Œæˆä¹‹åï¼ŒæŒ‰é¡ºåºè§£æã€‚</p><p>è¿™å°±æ˜¯ä»–ä»¬çš„ä½œç”¨å’Œæœ€å¤§çš„åŒºåˆ«ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ <code>&lt;scrip asycn&gt;&lt;/script&gt;</code> è¿™æ ·æ˜¯ä¸æ”¯æŒçš„ï¼Œéœ€è¦å¼•å…¥å¤–éƒ¨è„šæœ¬.</p><h3 id="4-èµ„æ–™"><a href="#4-èµ„æ–™" class="headerlink" title="4. èµ„æ–™"></a>4. èµ„æ–™</h3><p><a href="https://zh.javascript.info/script-async-defer">è„šæœ¬ï¼šasyncï¼Œdefer</a></p><p>defer å±æ€§ï¼š</p><p>å½“ <script> å…ƒç´ ä½¿ç”¨ defer å±æ€§æ—¶ï¼Œè„šæœ¬çš„åŠ è½½å’Œæ‰§è¡Œä¹Ÿæ˜¯å¼‚æ­¥çš„ã€‚<br>å»¶è¿ŸåŠ è½½çš„è„šæœ¬ä¸ä¼šé˜»å¡ HTML é¡µé¢çš„è§£æï¼Œä½†ä¼šåœ¨ HTML é¡µé¢è§£æå®Œæ¯•åæŒ‰ç…§å®ƒä»¬åœ¨ HTML ä¸­çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚<br>å»¶è¿Ÿè„šæœ¬åœ¨ DOMContentLoaded äº‹ä»¶è§¦å‘ä¹‹å‰å®ŒæˆåŠ è½½å’Œæ‰§è¡Œï¼Œå³åœ¨æ–‡æ¡£è§£ææœŸé—´æ‰§è¡Œã€‚<br>å¦‚æœå¤šä¸ªå»¶è¿Ÿè„šæœ¬ç›¸äº’ä¾èµ–ï¼Œæ‰§è¡Œé¡ºåºä¼šæŒ‰ç…§å®ƒä»¬åœ¨ HTML ä¸­çš„é¡ºåºæ¥æ‰§è¡Œã€‚<br>ç¤ºä¾‹ï¼š</p><p>html<br>Copy code</p><script src="script1.js" defer></script><script src="script2.js" defer></script><p>åŒºåˆ«ï¼š</p><p>async å±æ€§è¡¨ç¤ºè„šæœ¬çš„åŠ è½½å’Œæ‰§è¡Œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡é¡µé¢çš„æ¸²æŸ“ã€‚è„šæœ¬åŠ è½½å®Œæˆåç«‹å³æ‰§è¡Œï¼Œä¸è€ƒè™‘å®ƒä»¬åœ¨ HTML ä¸­çš„é¡ºåºï¼Œå¯èƒ½ä¼šå¯¼è‡´è„šæœ¬ä¹‹é—´çš„ä¾èµ–å…³ç³»é—®é¢˜ã€‚<br>defer å±æ€§è¡¨ç¤ºè„šæœ¬çš„åŠ è½½æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡é¡µé¢çš„æ¸²æŸ“ï¼Œä½†è„šæœ¬çš„æ‰§è¡Œä¼šåœ¨ HTML é¡µé¢è§£æå®Œæ¯•åæŒ‰é¡ºåºæ‰§è¡Œï¼Œå¯ä»¥ä¿æŒè„šæœ¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
            <tag> async </tag>
            
            <tag> defer </tag>
            
            <tag> æµè§ˆå™¨æ€§èƒ½ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>typescript ç±»å‹æœ‰å“ªäº›ï¼Ÿ</title>
      <link href="/2023/06/15/typescript_type/"/>
      <url>/2023/06/15/typescript_type/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="typescript-ç±»å‹æœ‰å“ªäº›ï¼Ÿ"><a href="#typescript-ç±»å‹æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="typescript ç±»å‹æœ‰å“ªäº›ï¼Ÿ"></a>typescript ç±»å‹æœ‰å“ªäº›ï¼Ÿ</h1><h3 id="1-åŸºæœ¬ç±»å‹"><a href="#1-åŸºæœ¬ç±»å‹" class="headerlink" title="1. åŸºæœ¬ç±»å‹"></a>1. åŸºæœ¬ç±»å‹</h3><ul><li>number </li><li>string</li><li>null</li><li>undefined</li><li>bealean</li><li>bigInt</li><li>symbol</li></ul><p>è¿™æ˜¯åŸºç¡€ç±»å‹ï¼Œç°åœ¨çš„ <code>javascript</code> ä¹Ÿæ”¯æŒå¯¹åº”ç±»å‹ï¼Œå…ˆä¸èµ˜è¿°äº†ã€‚</p><h3 id="2-æ•°ç»„ç±»å‹"><a href="#2-æ•°ç»„ç±»å‹" class="headerlink" title="2. æ•°ç»„ç±»å‹"></a>2. æ•°ç»„ç±»å‹</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">build</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="attr">arr1</span>: T[];</span><br><span class="line">    <span class="attr">arr2</span>: <span class="title class_">Array</span>&lt;T&gt;();</span><br><span class="line">    <span class="attr">arr3</span>: <span class="built_in">string</span>[];</span><br><span class="line">    <span class="attr">arr4</span>: <span class="built_in">symbol</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> o = <span class="keyword">new</span> build&lt;<span class="built_in">string</span>&gt;();</span><br></pre></td></tr></table></figure><p>typescript æ”¯æŒå‚æ•°æ•°ç»„</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [];</span><br><span class="line"><span class="keyword">let</span> arr1 = <span class="built_in">never</span>[];</span><br></pre></td></tr></table></figure><p>æ˜¯ç­‰ä»·çš„ã€‚</p><p>æ•°ç»„è¿˜æœ‰ä¸€ä¸ªç‰¹åˆ«çš„<strong>å…ƒç»„ç±»å‹</strong></p><blockquote><p>[T1, T2, â€¦]ï¼šè¡¨ç¤ºå…·æœ‰å›ºå®šé•¿åº¦å’Œç‰¹å®šé¡ºåºçš„å…ƒç´ ç±»å‹ä¸º T1, T2, â€¦ çš„å…ƒç»„ã€‚</p></blockquote><p>å¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œå›ºå®šé¡ºåºçš„æ•°ç»„ï¼Œ[string, number, type, interface].</p><h3 id="3-å¯¹è±¡ç±»å‹"><a href="#3-å¯¹è±¡ç±»å‹" class="headerlink" title="3. å¯¹è±¡ç±»å‹"></a>3. å¯¹è±¡ç±»å‹</h3><p>object ç±»å‹ï¼Œè¡¨ç¤ºä¸€åˆ‡éåŸå§‹ç±»å‹ï¼Œé™¤äº† null or undefined. æ¯”å¦‚ {}, æ¯”å¦‚ Date() å¾€å¤§äº†è¯´éƒ½æ˜¯ object.</p><p>{} or Reacord&lt;k, v&gt;. è¡¨ç¤ºä»»æ„å¯¹è±¡ç±»å‹</p><p>type or interface æ˜¯è‡ªå®šä¹‰ç±»å‹</p><h3 id="4-å‡½æ•°ç±»å‹"><a href="#4-å‡½æ•°ç±»å‹" class="headerlink" title="4. å‡½æ•°ç±»å‹"></a>4. å‡½æ•°ç±»å‹</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">() =&gt; &#123;&#125;;</span><br></pre></td></tr></table></figure><h3 id="5-æšä¸¾"><a href="#5-æšä¸¾" class="headerlink" title="5. æšä¸¾"></a>5. æšä¸¾</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> a &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-class"><a href="#6-class" class="headerlink" title="6. class"></a>6. class</h3><h3 id="7-æ³›å‹"><a href="#7-æ³›å‹" class="headerlink" title="7. æ³›å‹"></a>7. æ³›å‹</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>&lt;T&gt;</span><br><span class="line">T[]</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">a</span>&lt;T&gt;</span><br><span class="line"><span class="keyword">type</span> a&lt;T&gt; = ...</span><br><span class="line">inferce a&lt;T&gt; = &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³›å‹å’Œtypeçš„å¾ˆå¤šä¿®é¥°ç¬¦ç»„åˆèµ·æ¥æœ‰å¥‡æ•ˆ.</p><h3 id="8-å…¶ä»–"><a href="#8-å…¶ä»–" class="headerlink" title="8. å…¶ä»–"></a>8. å…¶ä»–</h3><p>any: ä»»æ„ç±»å‹ï¼Œä»–ä¼šå¿½ç•¥ç±»å‹æ£€æŸ¥ï¼Œå°±è·Ÿ javascript ä¸€æ ·ä½¿ç”¨ï¼Œè¢«å®˜æ–¹ä¸æ¨èä½¿ç”¨ã€‚<br>unknow: æ•ˆæœç±»ä¼¼ï¼Œä½†æ˜¯æ›´æ¨èä½¿ç”¨, å› ä¸ºä»–å¿…é¡»ä½¿ç”¨é¢å¤–çš„ç±»å‹æ£€æŸ¥æ¥ç¡®å®šã€‚</p><p>ä¸¾ä¸ªä¾‹å­</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">c</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">d</span>: <span class="built_in">any</span> = <span class="title function_">c</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d.<span class="title function_">toLocaleLowerCase</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">e</span>: <span class="built_in">unknown</span> = <span class="title function_">c</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="title function_">toLocaleLowerCase</span>()); <span class="comment">//æŠ¥é”™</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> e === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="title function_">toLocaleLowerCase</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜ç™½å·®åˆ«äº†æŠŠï¼Œä»–æ›´å®‰å…¨çš„åŸå› åœ¨äºï¼Œä»–å¿…é¡»è¿›è¡Œä¸€æ¬¡ç±»å‹æ£€æŸ¥ã€‚</p><p>void è¡¨ç¤ºæ–¹æ³•çš„è¿”å›ç±»å‹ï¼Œè™½ç„¶ typescript å…è®¸ä¸‹é¢ä»£ç </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>):<span class="built_in">void</span> &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> b = <span class="title function_">a</span>();</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å®é™…ä¸Šä¸æ¨èã€‚</p><p>never è¡¨ç¤ºç±»å‹é€šå¸¸ç”¨äºè¡¨ç¤ºä¸å¯åˆ°è¾¾çš„ä»£ç è·¯å¾„ï¼Œä¾‹å¦‚æŠ›å‡ºå¼‚å¸¸ã€æ­»å¾ªç¯æˆ–ç±»å‹æ¨æ–­å¤±è´¥ç­‰æƒ…å†µã€‚</p><h3 id="9-æ€»ç»“"><a href="#9-æ€»ç»“" class="headerlink" title="9. æ€»ç»“"></a>9. æ€»ç»“</h3><p>åŸºç¡€ç±»å‹</p><ul><li>number</li><li>string</li><li>bealean</li><li>null</li><li>undefined</li><li>symbol</li><li>bigInt</li></ul><p>æ•°ç»„ç±»å‹</p><ul><li>T[]</li><li>Array</li></ul><p>å‡½æ•°ç±»å‹</p><ul><li>function() {}</li><li>() &#x3D;&gt; {}</li></ul><p>å¤æ‚ç±»å‹</p><ul><li>{}</li><li>object</li><li>record</li><li>type</li><li>interface</li></ul><p>å…¶ä»–ç±»å‹</p><ul><li>any</li><li>unknow</li><li>never</li><li>void</li></ul><p>æ³›å‹ T<br>class<br>æšä¸¾</p><p>å› ä¸ºæœ€è¿‘è¦å¼€å§‹å†™ typescript åšä¸€ä¸ªç®€å•çš„å¤ä¹ ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> typescript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>type å’Œ interface åŒºåˆ«</title>
      <link href="/2023/06/15/type_interface/"/>
      <url>/2023/06/15/type_interface/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="type-å’Œ-interface-åŒºåˆ«"><a href="#type-å’Œ-interface-åŒºåˆ«" class="headerlink" title="type å’Œ interface åŒºåˆ«"></a>type å’Œ interface åŒºåˆ«</h1><h3 id="1-ç»§æ‰¿"><a href="#1-ç»§æ‰¿" class="headerlink" title="1. ç»§æ‰¿"></a>1. ç»§æ‰¿</h3><p>interface å¯ä»¥é€šè¿‡ implements å®ç°ç»§æ‰¿ï¼Œç„¶è€Œ type ç†è®ºä¸Šä¸èƒ½ç»§æ‰¿ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">String</span>;</span><br><span class="line">    <span class="attr">sex</span>: <span class="title class_">Number</span>;</span><br><span class="line">    <span class="keyword">readonly</span> <span class="attr">id</span>: <span class="title class_">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Speak</span> &#123;</span><br><span class="line">    <span class="title function_">say</span>(<span class="attr">to</span>: <span class="built_in">number</span>): <span class="title class_">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> <span class="keyword">extends</span> <span class="title class_">Animal</span>, <span class="title class_">Speak</span> &#123; &#125;</span><br></pre></td></tr></table></figure><p><code>class</code> å°±å¯ä»¥ç»§æ‰¿ <code>interface</code> å–å®ç°æ–¹æ³•.</p><p>type æƒ³è¦ç»§æ‰¿ï¼Œå¯ä»¥é€šè¿‡äº¤å‰ç±»å‹å¯ä»¥å®ç°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Animal1</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">String</span>;</span><br><span class="line">    <span class="attr">sex</span>: <span class="title class_">Number</span>;</span><br><span class="line">    <span class="keyword">readonly</span> <span class="attr">id</span>: <span class="title class_">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Speak1</span> &#123;</span><br><span class="line">    <span class="title function_">say</span>(<span class="attr">to</span>: <span class="built_in">number</span>): <span class="title class_">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Person1</span> = <span class="title class_">Animal1</span> &amp; <span class="title class_">Speak1</span>;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥å®ç°ç›¸åŒæ•ˆæœ</p><h3 id="2-åˆå¹¶"><a href="#2-åˆå¹¶" class="headerlink" title="2. åˆå¹¶"></a>2. åˆå¹¶</h3><p>å¦‚æœä¸¤ä¸ªåŒåçš„ interface å¯ä»¥ç›´æ¥åˆå¹¶ï¼Œå¦‚æœé‡è§é‡åçš„å±æ€§ï¼Œä»¥åé¢çš„ä¸ºå‡†ï¼Œtype ä¸è¡Œï¼Œåªä¼šæŠ¥é”™ã€‚</p><p>type ä¸è¡Œï¼Œä»–ä¸èƒ½å®ç°è¿™ç§æ“ä½œã€‚</p><h3 id="3-æ³›å‹"><a href="#3-æ³›å‹" class="headerlink" title="3. æ³›å‹"></a>3. æ³›å‹</h3><p>æ¥å£å’Œç±»å‹éƒ½å¯ä»¥å®ç°æ³›å‹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Box</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="attr">value</span>: T;</span><br><span class="line">    <span class="title function_">getInfo</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Box1</span>&lt;T&gt; = &#123;</span><br><span class="line">    <span class="attr">value</span>: T;</span><br><span class="line">    <span class="title function_">getInfo</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-è”åˆç±»å‹ï¼Œäº¤å‰ç±»å‹"><a href="#4-è”åˆç±»å‹ï¼Œäº¤å‰ç±»å‹" class="headerlink" title="4. è”åˆç±»å‹ï¼Œäº¤å‰ç±»å‹"></a>4. è”åˆç±»å‹ï¼Œäº¤å‰ç±»å‹</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyType</span> = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myVar</span>: <span class="title class_">MyType</span>;</span><br><span class="line">myVar = <span class="string">&quot;Hello&quot;</span>; <span class="comment">// ç±»å‹ä¸º string</span></span><br><span class="line">myVar = <span class="number">123</span>; <span class="comment">// ç±»å‹ä¸º number</span></span><br></pre></td></tr></table></figure><p>è”åˆç±»å‹å°±æ˜¯éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä¸è¿‡ interface ä¹Ÿå¯ä»¥</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IMyType</span> &#123;</span><br><span class="line">    <span class="attr">myType</span>:  <span class="built_in">string</span> | <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº¤å‰ç±»å‹ä¹Ÿä¸€æ ·ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Employee</span> = &#123;</span><br><span class="line">  <span class="attr">company</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">position</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">EmployeeWithPerson</span> = <span class="title class_">Person</span> &amp; <span class="title class_">Employee</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">employee</span>: <span class="title class_">EmployeeWithPerson</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line">  <span class="attr">company</span>: <span class="string">&quot;ABC Inc.&quot;</span>,</span><br><span class="line">  <span class="attr">position</span>: <span class="string">&quot;Manager&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IEmployeeWithPerson</span> &#123;</span><br><span class="line">    <span class="attr">company</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">position</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">employee</span>: <span class="title class_">IEmployeeWithPerson</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">30</span>,</span><br><span class="line">  <span class="attr">company</span>: <span class="string">&quot;ABC Inc.&quot;</span>,</span><br><span class="line">  <span class="attr">position</span>: <span class="string">&quot;Manager&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ•ˆæœç±»ä¼¼ï¼Œä½†æ˜¯æ˜æ˜¾ type æ›´çµæ´»ï¼Œå¯ä»¥éšæ„ç»„è£…ï¼Œä»»æ„åŠ è½½ã€‚</p><h3 id="5-å®šä¹‰æ•°ç»„é¡ºåº"><a href="#5-å®šä¹‰æ•°ç»„é¡ºåº" class="headerlink" title="5. å®šä¹‰æ•°ç»„é¡ºåº"></a>5. å®šä¹‰æ•°ç»„é¡ºåº</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> a &#123; <span class="title function_">a</span>(); &#125;</span><br><span class="line"><span class="keyword">interface</span> b &#123; <span class="title function_">b</span>(); &#125;</span><br><span class="line"><span class="keyword">type</span> list = [a, b];</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> c &#123;</span><br><span class="line">    <span class="attr">c</span>: [a, b]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-typeof"><a href="#6-typeof" class="headerlink" title="6. typeof"></a>6. typeof</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> element = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;testA&#x27;</span>);</span><br><span class="line"><span class="keyword">type</span> d = <span class="keyword">typeof</span> element; <span class="comment">//htmlElement || null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> d1 &#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="keyword">typeof</span> element</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h3><p>å…¶å®ä¸»è¦åŒºåˆ«åœ¨äºç»§æ‰¿ä¸Šï¼Œè¿˜æœ‰æ¥å£åˆå¹¶ä¸Šã€‚</p><p>ç†è®ºä¸Š type èƒ½å¤Ÿå®ç°çš„ interface éƒ½å¯ä»¥å®ç°ï¼Œå·®åˆ«åªæ˜¯åœ¨äº</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> a &#123;</span><br><span class="line">    <span class="attr">b</span>: ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> b = ...</span><br></pre></td></tr></table></figure><p>ä»ç»§æ‰¿ä¸Šæ¥è¯´ï¼Œä¸€ä¸ªæ˜¯ extends implements ç»§æ‰¿ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡è”åˆç±»å‹ï¼Œäº¤å‰ç±»å‹å®ç°ï¼Œæ–¹æ³•ä¸ä¸€æ ·ï¼Œä½†æ˜¯å¯ä»¥å®ç°ç›¸åŒæ•ˆæœã€‚</p><p>interface å¯ä»¥ä½¿ç”¨åˆå¹¶ï¼Œ type å…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨äº¤å‰ç±»å‹æ¥è§£å†³é—®é¢˜ã€‚</p><p>å…¶å®æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œinterface éœ€è¦å¤–é¢åŒ…ä¸€ä¸ªå£³å­ï¼Œä¹Ÿå°±æ˜¯åˆå§‹ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯ type å¯ä»¥ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç±»å‹å­˜åœ¨, ä¹Ÿå°±æ˜¯ç±»å‹ã€‚</p><p>æœŸé—´ï¼Œä¸ç®¡æ˜¯ä½¿ç”¨ å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹æ¨¡æ¿ï¼Œè¿˜æ˜¯æ˜ å°„ç±»å‹ï¼Œè¿˜æ˜¯ typofï¼Œæ¡ä»¶ç±»å‹ ç­‰ç­‰æ–¹å¼ï¼Œè™½ç„¶ä¸èƒ½ç›´æ¥å¯¹ interface ä½¿ç”¨ï¼Œä½†æ˜¯å¯ä»¥å¯¹ interface ä¸‹é¢çš„å±æ€§ä½¿ç”¨ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> typescript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨è§£æè¿‡ç¨‹</title>
      <link href="/2023/06/15/browser_parsing/"/>
      <url>/2023/06/15/browser_parsing/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="æµè§ˆå™¨è§£æè¿‡ç¨‹"><a href="#æµè§ˆå™¨è§£æè¿‡ç¨‹" class="headerlink" title="æµè§ˆå™¨è§£æè¿‡ç¨‹"></a>æµè§ˆå™¨è§£æè¿‡ç¨‹</h1><p>ç”¨æˆ·è¾“å…¥ç½‘å€æˆ–è€…ç‚¹é“¾æ¥<br>é€šè¿‡DNSæ‰¾åˆ°IP<br>é€šè¿‡TCPå‘èµ·è¯·æ±‚ï¼Œä¸‰æ¬¡æ¡æ‰‹<br>å‘èµ·è¯·æ±‚(get,postâ€¦)<br>è·å–HTTPè¯·æ±‚çš„å›æ‰§ï¼Œæ‹¿åˆ°header,content<br>æ‹¿åˆ°Contentå¼€å§‹è§£æ<br>è§£ædomæ ‘<br>è§£æccsæ ‘<br>å½¢æˆ renderTree<br>æ‰§è¡Œjavascript<br>å›æµï¼Œè®¡ç®—å‡ºæ‰€æœ‰domä½ç½®<br>é‡ç»˜ï¼Œç»˜åˆ¶æ‰€æœ‰dom<br>äº¤ç»™ GPU</p><p>è¿™æ˜¯æˆ‘ç†è§£çš„æµè§ˆå™¨è§£æè¿‡ç¨‹ï¼Œæ ¹æ®æ–‡æ¡£è¯¦ç»†å­¦ä¹ ä¸€ä¸‹</p><h3 id="1-DNS-æŸ¥è¯¢"><a href="#1-DNS-æŸ¥è¯¢" class="headerlink" title="1. DNS æŸ¥è¯¢"></a>1. DNS æŸ¥è¯¢</h3><blockquote><p>æµè§ˆå™¨å‘åç§°æœåŠ¡å™¨å‘èµ· DNS æŸ¥è¯¢è¯·æ±‚ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ª IP åœ°å€</p></blockquote><p>ä¸€èˆ¬æ˜¯ä¸€å±‚ä¸€å±‚ç½‘ä¸Šæ‰¾ </p><p>æµè§ˆå™¨ç¼“å­˜ &#x3D;&gt; è®¡ç®—æœºç¼“å­˜ &#x3D;&gt; æœ¬åœ°hostsæ–‡ä»¶ &#x3D;&gt; DNSè§£æå™¨ &#x3D;&gt; æ ¹åŸŸåæœåŠ¡å™¨ &#x3D;&gt; é¡¶çº§åŸŸåæœåŠ¡å™¨ &#x3D;&gt; æƒå¨åŸŸåæœåŠ¡å™¨.</p><p>å…¶å®å¦‚æœåˆ°äº†æœ¬åœ°hostsæ–‡ä»¶è¿™ä¸€æ­¥ï¼Œå°±è„±ç¦»äº†æˆ‘ä»¬æ§åˆ¶äº†ã€‚</p><p>æˆ‘å°è¯•åœ¨ edge æµè§ˆå™¨ edge:&#x2F;&#x2F;flags ä¸­æ‰¾dnsé€‰é¡¹ï¼Œå¯æƒœæ²¡æœ‰æ‰¾åˆ°ï¼Œå€’æ˜¯åœ¨ firfox ä¸­æ‰¾åˆ°äº†é€‰é¡¹</p><ul><li>network.dnsCacheExpirationï¼šæ­¤é…ç½®é¡¹æ§åˆ¶ DNS ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚é»˜è®¤å€¼ä¸º 60 ç§’ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚</li><li>network.dnsCacheEntriesï¼šæ­¤é…ç½®é¡¹æŒ‡å®š DNS ç¼“å­˜çš„æœ€å¤§æ¡ç›®æ•°ã€‚é»˜è®¤å€¼ä¸º 400ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚</li><li>network.dnsCacheExpirationGracePeriodï¼šæ­¤é…ç½®é¡¹å®šä¹‰äº† DNS ç¼“å­˜çš„è¿‡æœŸæ—¶é—´å»¶è¿Ÿï¼Œä»¥ç§’ä¸ºå•ä½ã€‚é»˜è®¤å€¼ä¸º 60 ç§’ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚</li></ul><p>è®¡ç®—æœºç¼“å­˜</p><ul><li>Windowsæ“ä½œç³»ç»Ÿï¼šDNSç¼“å­˜æ—¶é—´å¯ä»¥åœ¨æ³¨å†Œè¡¨ä¸­è¿›è¡Œè®¾ç½®ï¼Œè·¯å¾„ä¸ºHKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Dnscache\Parametersï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªé”®åä¸º MaxCacheTtlï¼Œè¡¨ç¤ºæœ€å¤§ç¼“å­˜æ—¶é—´ã€‚</li><li>macOSæ“ä½œç³»ç»Ÿï¼šDNSç¼“å­˜æ—¶é—´å¯ä»¥é€šè¿‡ sudo killall -HUP mDNSResponder å‘½ä»¤æ¥åˆ·æ–°ï¼Œåˆ·æ–°åçš„ç¼“å­˜æ—¶é—´ç”±æ“ä½œç³»ç»Ÿè‡ªåŠ¨å†³å®šã€‚</li><li>Linuxæ“ä½œç³»ç»Ÿï¼šDNSç¼“å­˜æ—¶é—´å¯ä»¥åœ¨ &#x2F;etc&#x2F;resolv.conf æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œå…¶ä¸­çš„ options éƒ¨åˆ†å¯ä»¥è®¾ç½®ç¼“å­˜æ—¶é—´ã€‚</li></ul><p>hosts æ¯ä¸ªæ“ä½œç³»ç»Ÿéƒ½æœ‰ï¼Œè‡ªå·±è®¾ç½®å³å¯</p><h3 id="2-TCP-æ¡æ‰‹-amp-TLS-åå•†"><a href="#2-TCP-æ¡æ‰‹-amp-TLS-åå•†" class="headerlink" title="2. TCP æ¡æ‰‹ &amp; TLS åå•†"></a>2. TCP æ¡æ‰‹ &amp; TLS åå•†</h3><p>è¿™ä¸ªæ¶‰åŠåˆ° http å»ºç«‹è¯·æ±‚çš„ä¸‰æ¬¡æ¡æ‰‹çš„é—®é¢˜ï¼Œä»¥åŠhttpsåå•†çš„é—®é¢˜ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºè¯·æ±‚ï¼Œä¸äº†è§£ç»†èŠ‚</p><blockquote><p>ç»è¿‡ 8 æ¬¡å¾€è¿”ï¼Œæµè§ˆå™¨ç»ˆäºå¯ä»¥å‘å‡ºè¯·æ±‚ã€‚</p></blockquote><ul><li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼ˆSYNï¼‰ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªåŒæ­¥ï¼ˆSYNï¼‰è¯·æ±‚ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯æƒ³è¦å»ºç«‹è¿æ¥ã€‚è¿™ä¸ªè¯·æ±‚åŒ…å«ä¸€ä¸ªéšæœºç”Ÿæˆçš„åˆå§‹åºåˆ—å·ï¼ˆISNï¼‰ç”¨äºåç»­çš„æ•°æ®ä¼ è¾“ã€‚</li><li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ˆSYN + ACKï¼‰ï¼šæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œä¼šå‘é€ä¸€ä¸ªåŒæ­¥å’Œç¡®è®¤ï¼ˆSYN + ACKï¼‰å“åº”ã€‚æœåŠ¡å™¨å“åº”ä¸­åŒ…å«äº†ç¡®è®¤å·ï¼ˆACKï¼‰å­—æ®µï¼Œç”¨äºç¡®è®¤å®¢æˆ·ç«¯çš„åˆå§‹åºåˆ—å·ï¼Œå¹¶ä¸”ä¹ŸåŒ…å«äº†è‡ªå·±ç”Ÿæˆçš„åˆå§‹åºåˆ—å·ï¼ˆISNï¼‰ã€‚</li><li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ˆACKï¼‰ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”åï¼Œä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªç¡®è®¤ï¼ˆACKï¼‰æ¶ˆæ¯ï¼Œç¡®è®¤æœåŠ¡å™¨çš„åˆå§‹åºåˆ—å·ã€‚</li></ul><p><strong>https</strong></p><ul><li>å®¢æˆ·ç«¯å‘èµ·è¿æ¥ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·HTTPSè¯·æ±‚ã€‚URLä¸­çš„åè®®å¤´ä¸ºâ€https:&#x2F;&#x2F;â€œï¼Œé»˜è®¤ä½¿ç”¨ç«¯å£å·443è¿›è¡Œè¿æ¥ã€‚</li><li>æœåŠ¡å™¨è¯ä¹¦éªŒè¯ï¼šæœåŠ¡å™¨å°†è‡ªå·±çš„æ•°å­—è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚è¯¥è¯ä¹¦åŒ…å«äº†æœåŠ¡å™¨çš„å…¬é’¥ä»¥åŠå…¶ä»–èº«ä»½éªŒè¯ä¿¡æ¯ã€‚</li><li>å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¯ä¹¦åï¼Œä¼šè¿›è¡Œè¯ä¹¦çš„éªŒè¯è¿‡ç¨‹ã€‚è¿™åŒ…æ‹¬æ£€æŸ¥è¯ä¹¦çš„åˆæ³•æ€§ã€æ˜¯å¦è¿‡æœŸã€æ˜¯å¦ç”±å—ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ç­¾å‘ç­‰ã€‚</li><li>å¯†é’¥äº¤æ¢ï¼šå¦‚æœæœåŠ¡å™¨çš„è¯ä¹¦éªŒè¯é€šè¿‡ï¼Œå®¢æˆ·ç«¯ä¼šç”Ÿæˆä¸€ä¸ªç”¨äºåŠ å¯†é€šä¿¡çš„éšæœºå¯¹ç§°å¯†é’¥ã€‚è¯¥å¯†é’¥ç”¨æœåŠ¡å™¨çš„å…¬é’¥è¿›è¡ŒåŠ å¯†åå‘é€ç»™æœåŠ¡å™¨ã€‚</li><li>æœåŠ¡å™¨è§£å¯†å¯†é’¥ï¼šæœåŠ¡å™¨ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å®¢æˆ·ç«¯å‘é€çš„å¯†é’¥ï¼Œè·å–åˆ°å¯¹ç§°å¯†é’¥ã€‚</li><li>æ•°æ®ä¼ è¾“ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨å¯¹ç§°å¯†é’¥å¯¹åç»­çš„æ•°æ®è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ã€‚</li></ul><h3 id="3-tcpæ…¢å¯åŠ¨"><a href="#3-tcpæ…¢å¯åŠ¨" class="headerlink" title="3. tcpæ…¢å¯åŠ¨"></a>3. tcpæ…¢å¯åŠ¨</h3><p>æ…¢å¯åŠ¨æ˜¯æˆ‘ç¬¬ä¸€æ¬¡äº†è§£çš„æ¦‚å¿µï¼Œåœ¨ä¸äº†è§£å®ç°ç»†èŠ‚çš„å‰æä¸‹ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·çš„</p><p>æ¯ä¸ªäººçš„ç½‘ç»œï¼Œå¸¦å®½æƒ…å†µä¸ä¸€æ ·ï¼Œå‘é€èƒ½åŠ›å’Œæ¥æ”¶èƒ½åŠ›ä¸ä¸€æ ·ï¼Œ</p><p>å‡è®¾ä¸¤å°æœºå™¨ Aï¼ŒBï¼Œ</p><p>A æ¥æ”¶èƒ½åŠ› 30, å‘é€èƒ½åŠ› 50<br>B æ¥æ”¶èƒ½åŠ› 30, å‘é€èƒ½åŠ› 50.</p><p>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ B &#x3D;&gt; A, Aæ˜¯ä¼šä¸¢åŒ…çš„ï¼Œå› ä¸ºä»–æ— æ³•ä¸€æ¬¡æ€§æ¥æ”¶50,ä»–æœ€å¤§æ˜¯30</p><blockquote><p>å› ä¸ºä¸æ¸…æ¥šå®æ—¶çš„ç®¡é“ä¼ è¾“èƒ½åŠ›ï¼Œäºæ˜¯åœ¨åˆšå¼€å§‹ä¼ é€æ•°æ®çš„æ—¶å€™ï¼Œä»ä¸€ä¸ªå¾ˆå°çš„å•ä½å€¼åšå°è¯•ï¼›åœ¨ä¹‹åçš„ä¼ é€è¿‡ç¨‹ä¸­ï¼Œé€æ¸ç¿»å€å¢å¤§ä¼ é€æ•°æ®å•ä½å€¼ã€‚é‡åˆ°å¤±è´¥çš„æƒ…å†µï¼Œå°±ç«‹é©¬å‡å°ä¼ é€æ•°æ®å•ä½å€¼ã€‚ </p></blockquote><h3 id="4-æ„å»º-DOM-æ ‘"><a href="#4-æ„å»º-DOM-æ ‘" class="headerlink" title="4. æ„å»º DOM æ ‘"></a>4. æ„å»º DOM æ ‘</h3><p>å†™è¿‡htmlå°±çŸ¥é“ï¼Œå®ƒæ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼Œå°±æ˜¯ä¸€ç³»åˆ—çš„æ ‡ç­¾ç»„æˆï¼Œå¯ä»¥å½¢æˆæ ‘å½¢ç»“æ„ã€‚</p><p>æˆ‘ä»¬è¯·æ±‚ä»¥åæ”¶åˆ°å­—èŠ‚ &#x3D;&gt; å­—ç¬¦ä¸² &#x3D;&gt; token &#x3D;&gt; node &#x3D;&gt; dom</p><p><code>&lt;html&gt;</code> æ ¹èŠ‚ç‚¹ï¼Œä»¥ä»–ä¸ºèµ·ç‚¹å¼€å§‹è§£æï¼Œæœ€åå½¢æˆä¸€ä¸ªdomæ ‘ã€‚</p><p><a href="/img/dom.gif" title="alt text" class="gallery-item" style="box-shadow: none;"> <img src="/img/dom.gif" alt="alt text"></a></p><p>ç±»ä¼¼äºä¸Šé¢è¿™ç§ç»“æ„ã€‚</p><h3 id="5-script-é˜»å¡"><a href="#5-script-é˜»å¡" class="headerlink" title="5. script é˜»å¡"></a>5. script é˜»å¡</h3><blockquote><p>å½“è§£æå™¨å‘ç°éé˜»å¡èµ„æºï¼Œä¾‹å¦‚ä¸€å¼ å›¾ç‰‡ï¼Œæµè§ˆå™¨ä¼šè¯·æ±‚è¿™äº›èµ„æºå¹¶ä¸”ç»§ç»­è§£æã€‚å½“é‡åˆ°ä¸€ä¸ª CSS æ–‡ä»¶æ—¶ï¼Œè§£æä¹Ÿå¯ä»¥ç»§ç»­è¿›è¡Œï¼Œä½†æ˜¯å¯¹äº script æ ‡ç­¾ï¼ˆç‰¹åˆ«æ˜¯æ²¡æœ‰ async æˆ–è€… defer å±æ€§çš„ï¼‰ä¼šé˜»å¡æ¸²æŸ“å¹¶åœæ­¢ HTML çš„è§£æã€‚å°½ç®¡æµè§ˆå™¨çš„é¢„åŠ è½½æ‰«æå™¨åŠ é€Ÿäº†è¿™ä¸ªè¿‡ç¨‹ï¼Œä½†è¿‡å¤šçš„è„šæœ¬ä»ç„¶æ˜¯ä¸€ä¸ªé‡è¦çš„ç“¶é¢ˆã€‚</p></blockquote><p>script æ ‡ç­¾æ˜ç¡®ä¼šé˜»æ­¢è§£æ, ä½†æ˜¯ä¹Ÿæœ‰åŒºåˆ«</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;test_one&quot;</span>&gt;content one&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>());</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`è·å–åˆ°äº† test_one`</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">`test_one`</span>));</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">200000</span>; i++) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> a = i;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>());</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;test_two&quot;</span>&gt;</span>content two<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¾ˆæ˜ç¡®æ˜¯æ‰§è¡Œå®Œæˆ script ä»¥åï¼Œå†ç»§ç»­è§£æï¼Œä½†æ˜¯æœ‰åŒºåˆ«ï¼Œä¸Šé¢è¿™ç§å†™æ³•æ˜¯ç›´æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">content one</span><br><span class="line">content two</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘æ–°å»ºä¸€ä¸ª parse.js, å¹¶ä¸”ä¿®æ”¹ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;test_one&quot;&gt;content one&lt;/div&gt;</span><br><span class="line">&lt;script src=&quot;parse.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;div id=&quot;test_two&quot;&gt;content two&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå°±æ˜¯å…ˆå‡ºç° content oneï¼Œ ç„¶åç­‰ js æ‰§è¡Œå®Œæˆï¼Œ å†å‡ºç° content twoã€‚</p><blockquote><p>é˜»å¡æ¸²æŸ“å¹¶ä¸æ˜¯é¡µé¢ä¸æ¸²æŸ“ï¼Œå¦‚æœé¡µé¢éè¦ç­‰åˆ°jsåŠ è½½æ‰§è¡Œå®Œæ¯•ä¹‹åå†æ¸²æŸ“ï¼Œé‚£ç”¨æˆ·ç­‰å¾…æ—¶é—´ä¹Ÿå¤ªé•¿äº†ã€‚æµè§ˆå™¨çš„è®¾è®¡è‚¯å®šä¼šå°½æ—©è®©ç”¨æˆ·çœ‹åˆ°é¡µé¢ï¼Œå› æ­¤é‡åˆ° script æ ‡ç­¾æ—¶ï¼Œä¼šè§¦å‘ä¸€æ¬¡Paintï¼Œæµè§ˆå™¨ä¼šå°† script æ ‡ç­¾ä¹‹å‰çš„å…ƒç´ æ¸²æŸ“å‡ºæ¥ã€‚</p></blockquote><p>æœ‰ç‚¹ç±»ä¼¼äºå¼ºåˆ¶åŒæ­¥å¸ƒå±€, å°±æ˜¯å› ä¸º javascript çš„æ‰§è¡Œï¼Œå¯¼è‡´äº†å¼ºè¡Œè·³è¿‡æˆ–è€…æå‰äº†æ­¥éª¤ã€‚</p><p>ç»è¿‡æµ‹è¯•ï¼Œscript åœ¨ä¸åŠ  async or defer çš„å‰æä¸‹ï¼Œ éƒ½ä¼šé˜»æ­¢è§£æï¼Œåœ¨ headerï¼Œinline script ä¸­ä¼šæ‰§è¡Œæ‰€æœ‰ js åç»§ç»­è§£æï¼Œå¦‚æœæ˜¯åœ¨ body ä¸­å¼•å…¥ jsï¼Œä¼šè§¦å‘ Paint.</p><h3 id="6-é¢„åŠ è½½æ‰«æå™¨"><a href="#6-é¢„åŠ è½½æ‰«æå™¨" class="headerlink" title="6. é¢„åŠ è½½æ‰«æå™¨"></a>6. é¢„åŠ è½½æ‰«æå™¨</h3><p>å’Œ htmlè§£æå™¨ï¼Œæœ‰ä¸€ä¸ªå¹¶è¡Œçš„é¢„è§£æå™¨ã€‚</p><blockquote><p>å½“æµè§ˆå™¨è¿›è¡Œ HTML è§£ææ—¶ï¼Œå®ƒå¯ä»¥å¯åŠ¨ä¸€ä¸ªé¢å¤–çš„é¢„æµ‹æ€§ HTML è§£æå™¨ã€‚è¿™ä¸ªé¢„æµ‹æ€§è§£æå™¨ä¸æ™®é€šçš„ HTML è§£æå™¨ç±»ä¼¼ï¼Œéµå¾ªç›¸åŒçš„è§„åˆ™å’Œæ ‘æ„å»ºç®—æ³•ã€‚ä½†æ˜¯ï¼Œé¢„æµ‹æ€§è§£æå™¨ä¸ä¼šå½±å“æ™®é€šè§£æå™¨çš„çŠ¶æ€å’Œæ–‡æ¡£æœ¬èº«ã€‚</p></blockquote><p>ä¸ç”¨å»çº ç»“ä»–æ€ä¹ˆè§£æçš„ï¼Œä½†æ˜¯éœ€è¦çŸ¥é“ä»–å…³æ³¨å“ªäº›èŠ‚ç‚¹</p><blockquote><p>A element.base</p><p>A element whose attribute is in the Content security policy state.metahttp-equiv</p><p>A element whose attribute is an ASCII case-insensitive match for â€œâ€.metanamereferrer</p><p>A element whose attribute is an ASCII case-insensitive match for â€œâ€. (This can affect whether a media query list matches the environment.) [CSSDEVICEADAPT]metanameviewport</p></blockquote><p>æˆ‘å¾ˆç–‘æƒ‘ï¼Œä¼¼ä¹æ²¡æœ‰link or scriptï¼Œæˆ–è€… image ä¹‹ç±»çš„ï¼Œä½†æ˜¯æŸ¥å¯»æ–‡ç« éƒ½è¯´åŒ…å«äº† link å’Œ script.</p><blockquote><p>å¯¹äºå¸¦æœ‰ async å±æ€§çš„ script æ ‡ç­¾ï¼Œæµè§ˆå™¨é€šå¸¸ä¸ä¼šè¿›è¡Œé¢„è§£æï¼Œè€Œæ˜¯å¹¶è¡ŒåŠ è½½å’Œæ‰§è¡Œã€‚å¯¹äºå¸¦æœ‰ defer å±æ€§çš„è„šæœ¬ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šé¢„è§£æï¼Œä½†ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯åœ¨æ–‡æ¡£è§£æå®ŒæˆåæŒ‰é¡ºåºæ‰§è¡Œã€‚</p></blockquote><p>å…ˆçŸ¥é“æ¦‚å¿µå³å¯ï¼Œåç»­å¯ä»¥åšå®éªŒã€‚</p><h3 id="7-CSSDOM"><a href="#7-CSSDOM" class="headerlink" title="7. CSSDOM"></a>7. CSSDOM</h3><blockquote><p>DOM å’Œ CSSOM æ˜¯ä¸¤æ£µæ ‘ã€‚å®ƒä»¬æ˜¯ç‹¬ç«‹çš„æ•°æ®ç»“æ„ã€‚æµè§ˆå™¨å°† CSS è§„åˆ™è½¬æ¢ä¸ºå¯ä»¥ç†è§£å’Œä½¿ç”¨çš„æ ·å¼æ˜ å°„ã€‚æµè§ˆå™¨éå† CSS ä¸­çš„æ¯ä¸ªè§„åˆ™é›†ï¼Œæ ¹æ® CSS é€‰æ‹©å™¨åˆ›å»ºå…·æœ‰çˆ¶ã€å­å’Œå…„å¼Ÿå…³ç³»çš„èŠ‚ç‚¹æ ‘ã€‚</p></blockquote><p>åœ¨æµè§ˆå™¨è§£æ HTML æ–‡æ¡£æ—¶ï¼Œé‡åˆ°å¤–éƒ¨ CSS æ ·å¼è¡¨ï¼ˆé€šè¿‡ link æ ‡ç­¾å¼•å…¥ï¼‰ä¼šè§¦å‘ CSSOM çš„æ„å»ºã€‚æµè§ˆå™¨ä¼šå¼‚æ­¥ä¸‹è½½å¹¶è§£æå¤–éƒ¨æ ·å¼è¡¨ï¼Œç”Ÿæˆå¯¹åº”çš„ CSSOM æ ‘ã€‚åŒæ—¶ï¼Œæµè§ˆå™¨ä¼šç»§ç»­è§£æ HTMLï¼Œæ„å»º DOM æ ‘ã€‚è¿™æ„å‘³ç€ CSSOM çš„æ„å»ºå’Œ DOM æ ‘çš„æ„å»ºæ˜¯åŒæ—¶è¿›è¡Œçš„ï¼Œäº’ä¸é˜»å¡ã€‚</p><p>ç„¶è€Œï¼Œåœ¨è§£æè¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°å†…è”çš„ style æ ‡ç­¾æˆ–è€…å†…è”æ ·å¼å±æ€§ï¼Œæµè§ˆå™¨ä¼šç«‹å³å¤„ç†å®ƒä»¬ï¼Œç”Ÿæˆå¯¹åº”çš„ CSSOM èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ° CSSOM æ ‘ä¸­ã€‚å› æ­¤ï¼Œåœ¨é‡åˆ°å†…è”æ ·å¼æ—¶ï¼ŒCSSOM çš„æ„å»ºå¯èƒ½ä¼šåœ¨ DOM æ ‘æ„å»ºä¹‹å‰å®Œæˆã€‚</p><h3 id="8-JavaScript-ç¼–è¯‘"><a href="#8-JavaScript-ç¼–è¯‘" class="headerlink" title="8. JavaScript ç¼–è¯‘"></a>8. JavaScript ç¼–è¯‘</h3><blockquote><p>JavaScript è¢«è§£é‡Šã€ç¼–è¯‘ã€è§£æå’Œæ‰§è¡Œã€‚è„šæœ¬è¢«è§£æä¸ºæŠ½è±¡è¯­æ³•æ ‘ã€‚ä¸€äº›æµè§ˆå™¨å¼•æ“ä½¿ç”¨æŠ½è±¡è¯­æ³•æ ‘å¹¶å°†å…¶ä¼ é€’åˆ°è§£é‡Šå™¨ä¸­ï¼Œè¾“å‡ºåœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œçš„å­—èŠ‚ç </p></blockquote><h3 id="9-æ„å»ºè¾…åŠ©åŠŸèƒ½æ ‘"><a href="#9-æ„å»ºè¾…åŠ©åŠŸèƒ½æ ‘" class="headerlink" title="9. æ„å»ºè¾…åŠ©åŠŸèƒ½æ ‘"></a>9. æ„å»ºè¾…åŠ©åŠŸèƒ½æ ‘</h3><h3 id="10-render-tree"><a href="#10-render-tree" class="headerlink" title="10. render tree"></a>10. render tree</h3><blockquote><p>DOM å’Œ CSSOM ç»„åˆæˆä¸€ä¸ª Render æ ‘, è®¡ç®—æ ·å¼æ ‘æˆ–æ¸²æŸ“æ ‘ä» DOM æ ‘çš„æ ¹å¼€å§‹æ„å»ºï¼Œéå†æ¯ä¸ªå¯è§èŠ‚ç‚¹</p></blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>display: none</code> æ˜¯ä¸ä¼šæ¸²æŸ“åœ¨ render tree å½“ä¸­çš„ï¼Œä½†æ˜¯ <code>visibility: hidden</code> æ˜¯ä¼šå‡ºç°çš„ã€‚</p><p>åœ¨èµ„æ–™ä¸­è¯´æ˜äº†å“ªäº›æ˜¯é»˜è®¤åŒ…å« <code>display:none</code>, æ¯”å¦‚ script.</p><p>render tree å°±æ˜¯ domæ ‘ æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ¹é…ä¸Š ccsomã€‚</p><h3 id="11-Layout-å®šä½"><a href="#11-Layout-å®šä½" class="headerlink" title="11. Layout(å®šä½)"></a>11. Layout(å®šä½)</h3><p>ä¹Ÿå°±æ˜¯å›æµï¼Œç¬¬ä¸€æ¬¡å«å®šä½</p><blockquote><p>æ¸²æŸ“æ ‘ä¸Šè¿è¡Œå¸ƒå±€ä»¥è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å‡ ä½•ä½“ã€‚å¸ƒå±€æ˜¯ç¡®å®šå‘ˆç°æ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å®½åº¦ã€é«˜åº¦å’Œä½ç½®ï¼Œä»¥åŠç¡®å®šé¡µé¢ä¸Šæ¯ä¸ªå¯¹è±¡çš„å¤§å°å’Œä½ç½®çš„è¿‡ç¨‹ã€‚å›æµæ˜¯å¯¹é¡µé¢çš„ä»»ä½•éƒ¨åˆ†æˆ–æ•´ä¸ªæ–‡æ¡£çš„ä»»ä½•åç»­å¤§å°å’Œä½ç½®çš„ç¡®å®šã€‚</p></blockquote><h3 id="12-ç»˜åˆ¶"><a href="#12-ç»˜åˆ¶" class="headerlink" title="12. ç»˜åˆ¶"></a>12. ç»˜åˆ¶</h3><p>ä¹Ÿå°±æ˜¯é‡ç»˜ã€‚</p><p>è¿™è¾¹æœ‰ä¸€ä¸ªåˆ†å±‚çš„æœºåˆ¶ </p><blockquote><p>ç»˜åˆ¶å¯ä»¥å°†å¸ƒå±€æ ‘ä¸­çš„å…ƒç´ åˆ†è§£ä¸ºå¤šä¸ªå±‚ã€‚å°†å†…å®¹æå‡åˆ° GPU ä¸Šçš„å±‚ï¼ˆè€Œä¸æ˜¯ CPU ä¸Šçš„ä¸»çº¿ç¨‹ï¼‰å¯ä»¥æé«˜ç»˜åˆ¶å’Œé‡æ–°ç»˜åˆ¶æ€§èƒ½ã€‚æœ‰ä¸€äº›ç‰¹å®šçš„å±æ€§å’Œå…ƒç´ å¯ä»¥å®ä¾‹åŒ–ä¸€ä¸ªå±‚ï¼ŒåŒ…æ‹¬ video å’Œ canvasï¼Œä»»ä½• CSS å±æ€§ä¸º opacity ã€3D transformã€will-change çš„å…ƒç´ ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–å…ƒç´ ã€‚è¿™äº›èŠ‚ç‚¹å°†ä¸å­èŠ‚ç‚¹ä¸€èµ·ç»˜åˆ¶åˆ°å®ƒä»¬è‡ªå·±çš„å±‚ä¸Šï¼Œé™¤éå­èŠ‚ç‚¹ç”±äºä¸Šè¿°ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰åŸå› éœ€è¦è‡ªå·±çš„å±‚ã€‚</p></blockquote><p>ç„¶ååˆå¹¶ç»™GPUã€‚</p><blockquote><p>åˆ†å±‚ç¡®å®å¯ä»¥æé«˜æ€§èƒ½ï¼Œä½†æ˜¯å®ƒä»¥å†…å­˜ç®¡ç†ä¸ºä»£ä»·ï¼Œå› æ­¤ä¸åº”ä½œä¸º web æ€§èƒ½ä¼˜åŒ–ç­–ç•¥çš„ä¸€éƒ¨åˆ†è¿‡åº¦ä½¿ç”¨ã€‚</p></blockquote><h3 id="13-äº¤äº’"><a href="#13-äº¤äº’" class="headerlink" title="13. äº¤äº’"></a>13. äº¤äº’</h3><p>æ–‡æ¡£ä¸­æå‡ºäº†å¦‚æœ javascript å¦‚æœå¾ˆå¤§æˆ–è€…ä¸‹è½½æ—¶é—´å¾ˆé•¿ï¼Œå¯èƒ½ä¼šå¯¼è‡´äº¤äº’æ— æ³•ä½¿ç”¨ã€‚</p><blockquote><p>ä¸»çº¿ç¨‹åœ¨è¿™æ®µæ—¶é—´å†…å®Œå…¨è¢«å ç”¨ï¼Œå¯¹å•å‡»äº‹ä»¶æˆ–å±å¹•ç‚¹å‡»æ²¡æœ‰å“åº”ã€‚</p></blockquote><h3 id="14-javascript-æµç¨‹ã€‚"><a href="#14-javascript-æµç¨‹ã€‚" class="headerlink" title="14. javascript æµç¨‹ã€‚"></a>14. javascript æµç¨‹ã€‚</h3><p>ä¸€èˆ¬æ¥è¯´</p><blockquote><p>JavaScriptçš„åŠ è½½ã€è§£æä¸æ‰§è¡Œä¼šé˜»å¡æ–‡æ¡£çš„è§£æï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ„é€ DOMæ—¶ï¼ŒHTMLè§£æå™¨è‹¥æ˜¯é‡åˆ°äº†JavaScriptï¼Œé‚£ä¹ˆå®ƒä¼šæš‚åœæ–‡æ¡£çš„è§£æï¼Œå°†æ§åˆ¶æƒäº¤ç»™JavaScriptå¼•æ“ï¼Œç­‰JavaScriptå¼•æ“è¿è¡Œå®Œæ¯•ï¼Œæµè§ˆå™¨å†ä»ä¸­æ–­çš„åœ°æ–¹æ¢å¤ç»§ç»­è§£ææ–‡æ¡£ã€‚</p></blockquote><p>ç†è®ºä¸Šæ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ˜¯é¢„è§£æå™¨å­˜åœ¨ï¼Œjavascriptçš„åŠ è½½å’Œè§£ææ˜¯å’Œ domæ ‘è§£ææ˜¯å¹¶è¡Œçš„</p><p>æˆ‘åšäº†ä¸€ä¸ªç®€å•æµ‹è¯•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;test_one&quot;</span>&gt;</span>content one<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;test_two&quot;</span>&gt;</span>content two<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">200000000</span>; i++) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> a = i;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">alert</span>(<span class="string">&quot;test 02&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">200000000</span>; i++) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> a = i;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">alert</span>(<span class="string">&quot;test 03&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;parse.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯äºåŠ è½½å®Œæˆäº† <code>parse.js</code>, ä½†æ˜¯æ‰§è¡Œé¡ºåºè¿˜æ˜¯é¡ºåºçš„ã€‚</p><h3 id="15-link"><a href="#15-link" class="headerlink" title="15. link"></a>15. link</h3><blockquote><p>ç†è®ºä¸Šï¼Œæ—¢ç„¶æ ·å¼è¡¨ä¸æ”¹å˜ DOM æ ‘ï¼Œä¹Ÿå°±æ²¡æœ‰å¿…è¦åœä¸‹æ–‡æ¡£çš„è§£æç­‰å¾…å®ƒä»¬ï¼Œ<br>ç„¶è€Œï¼Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼ŒJavaScript è„šæœ¬æ‰§è¡Œæ—¶å¯èƒ½åœ¨æ–‡æ¡£çš„è§£æè¿‡ç¨‹ä¸­è¯·æ±‚æ ·å¼ä¿¡æ¯ï¼Œ<br>å¦‚æœæ ·å¼è¿˜æ²¡æœ‰åŠ è½½å’Œè§£æï¼Œè„šæœ¬å°†å¾—åˆ°é”™è¯¯çš„å€¼ï¼Œæ˜¾ç„¶è¿™å°†ä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜ã€‚</p><p>æ‰€ä»¥å¦‚æœæµè§ˆå™¨å°šæœªå®Œæˆ CSSOM çš„ä¸‹è½½å’Œæ„å»ºï¼Œ<br>è€Œæˆ‘ä»¬å´æƒ³åœ¨æ­¤æ—¶è¿è¡Œè„šæœ¬ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°†å»¶è¿Ÿ JavaScript è„šæœ¬æ‰§è¡Œå’Œæ–‡æ¡£çš„è§£æï¼Œç›´è‡³å…¶å®Œæˆ CSSOM çš„ä¸‹è½½å’Œæ„å»ºã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¼šå…ˆä¸‹è½½å’Œæ„å»º CSSOMï¼Œç„¶åå†æ‰§è¡Œ JavaScriptï¼Œæœ€åå†ç»§ç»­æ–‡æ¡£çš„è§£æã€‚</p></blockquote><h3 id="14-æ€»ç»“"><a href="#14-æ€»ç»“" class="headerlink" title="14. æ€»ç»“"></a>14. æ€»ç»“</h3><p>DNSæŸ¥å¯» &#x3D;&gt; TCP &#x3D;&gt; HTTP &#x3D;&gt; ä¸æœåŠ¡å™¨äº¤äº’(è·å–å­—èŠ‚) &#x3D;&gt; è§£æ &#x3D;&gt; è§£ædomæ ‘(å¦‚ä½•è§£æåˆ°CSSï¼Œå¹¶è¡Œè§£æcssom) &#x3D;&gt; åˆå¹¶ç”Ÿæˆ render tree &#x3D;&gt; å®šä½ &#x3D;&gt; ç»˜åˆ¶</p><p>å…·ä½“æ€§èƒ½ä¼˜åŒ–åé¢å†çœ‹</p><h3 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h3><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Performance/How_browsers_work">æ¸²æŸ“é¡µé¢ï¼šæµè§ˆå™¨çš„å·¥ä½œåŸç†</a></li><li><a href="https://juejin.cn/post/6844904064522649614">webæ€§èƒ½ä¼˜åŒ–(äºŒ)ï¼šé’ˆå¯¹TCPä¼ è¾“è¿‡ç¨‹ä¸­çš„å µå¡</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/TCP_slow_start">TCP slow start</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Performance/Critical_rendering_path">å…³é”®æ¸²æŸ“è·¯å¾„</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DOMTokenList">DOMTokenList</a></li><li><a href="https://juejin.cn/post/6844903936877395981">scriptå’Œlinkæ ‡ç­¾å¯¹DOMè§£æå’Œæ¸²æŸ“çš„å½±å“</a></li><li><a href="https://html.spec.whatwg.org/multipage/parsing.html#speculative-html-parsing">13.2.8 Speculative HTML parsing</a></li></ul></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
            <tag> æµè§ˆå™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>graphgl</title>
      <link href="/2023/06/15/graphql/"/>
      <url>/2023/06/15/graphql/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="graphgl"><a href="#graphgl" class="headerlink" title="graphgl"></a>graphgl</h1><h3 id="1-ä»€ä¹ˆæ˜¯-graphgl"><a href="#1-ä»€ä¹ˆæ˜¯-graphgl" class="headerlink" title="1. ä»€ä¹ˆæ˜¯ graphgl"></a>1. ä»€ä¹ˆæ˜¯ graphgl</h3><blockquote><p>GraphQL æ—¢æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ä¹Ÿæ˜¯ä¸€ä¸ªæ»¡è¶³ä½ æ•°æ®æŸ¥è¯¢çš„è¿è¡Œæ—¶ã€‚ GraphQL å¯¹ä½ çš„ API ä¸­çš„æ•°æ®æä¾›äº†ä¸€å¥—æ˜“äºç†è§£çš„å®Œæ•´æè¿°ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿå‡†ç¡®åœ°è·å¾—å®ƒéœ€è¦çš„æ•°æ®ï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•å†—ä½™ï¼Œä¹Ÿè®© API æ›´å®¹æ˜“åœ°éšç€æ—¶é—´æ¨ç§»è€Œæ¼”è¿›ï¼Œè¿˜èƒ½ç”¨äºæ„å»ºå¼ºå¤§çš„å¼€å‘è€…å·¥å…·ã€‚</p></blockquote><h3 id="2-graphgl-å’Œ-restful-åŒºåˆ«"><a href="#2-graphgl-å’Œ-restful-åŒºåˆ«" class="headerlink" title="2. graphgl å’Œ restful åŒºåˆ«"></a>2. graphgl å’Œ restful åŒºåˆ«</h3><p>æœ‰æœ¬è´¨ä¸ŠåŒºåˆ«ï¼Œrestful æ›´åƒæ˜¯ä¸€ç§è§„åˆ™ï¼Œä¸€ç§çº¦å®šã€‚</p><p>graphgl ä¹Ÿä¸ä¸€å®šéœ€è¦æŒ‰ç…§ restful è§„åˆ™ï¼Œä¹Ÿå¯ä»¥æ‰€æœ‰éƒ½ä½¿ç”¨ <code>post</code>.</p><p>æ‰€ä»¥ graphgl æŸ¥è¯¢è¯­è¨€ï¼ŒåŸºäºè¿™ç§æŸ¥è¯¢è¯­è¨€æ²Ÿé€šæ•°æ®ä¸¤è¾¹ï¼Œæ›´åƒæ˜¯è™šæ‹Ÿdomï¼Œæ˜¯ä¸€ä¸ªä¸­é—´å±‚ã€‚</p><p>ç„¶è€Œ restful åªæ˜¯ä¸€ç§è§„åˆ™å’Œçº¦å®šã€‚</p><h3 id="3-åŸºæœ¬è¯­æ³•"><a href="#3-åŸºæœ¬è¯­æ³•" class="headerlink" title="3. åŸºæœ¬è¯­æ³•"></a>3. åŸºæœ¬è¯­æ³•</h3><p>sechema æè¿° graphgl</p><p>åœ¨æè¿°ä¸­å®šä¹‰çªå˜ï¼Œè¾“å…¥ï¼ŒæŸ¥è¯¢ï¼Œç±»å‹ç­‰ç­‰ã€‚</p><ol><li>mutation çªå˜ï¼Œå®šä¹‰åˆ›å»ºå’Œæ›´æ–°</li><li>query å®šä¹‰æŸ¥è¯¢çš„æ–¹æ³•</li><li>input å®šä¹‰è¾“å…¥çš„ç±»å‹</li><li>type Message å®šä¹‰ä¸€ä¸ªç±»å‹å«åš Message</li></ol><p>è¿™äº›å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…é€šè¿‡graphglæ–¹æ³•å†™ã€‚</p><p>å­—ç¬¦ä¸²è§£æåå’Œä½¿ç”¨ graphglyä¸€æ ·</p><p>nodejs ç‰ˆæœ¬çš„ä½¿ç”¨æ–¹å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  graphql,</span><br><span class="line">  GraphQLSchema,</span><br><span class="line">  GraphQLObjectType,</span><br><span class="line">  GraphQLString,</span><br><span class="line">&#125; from &#x27;graphql&#x27;;</span><br><span class="line"></span><br><span class="line">var schema = new GraphQLSchema(&#123;</span><br><span class="line">  query: new GraphQLObjectType(&#123;</span><br><span class="line">    name: &#x27;RootQueryType&#x27;,</span><br><span class="line">    fields: &#123;</span><br><span class="line">      hello: &#123;</span><br><span class="line">        type: GraphQLString,</span><br><span class="line">        resolve() &#123;</span><br><span class="line">          return &#x27;world&#x27;;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å®šä¹‰äº†ä¸€ä¸ª query, nameï¼Œè¿”å› string <code>world</code>.</p><p>è¿™åªæ˜¯ä¸€ä¸ªåŸºç¡€çš„ä¾‹å­ï¼Œæ²¡æœ‰æäº¤ï¼Œæ›´æ–°ä¹‹ç±»çš„æ–¹å¼ã€‚</p><h3 id="4-httpè°ƒç”¨"><a href="#4-httpè°ƒç”¨" class="headerlink" title="4. httpè°ƒç”¨"></a>4. httpè°ƒç”¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@post</span><br><span class="line">http://localhost:4000/graphql</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &quot;&#123;hello&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//response</span><br><span class="line">&#123;</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;hello&quot;: &quot;Hello world!&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@get</span><br><span class="line">http://localhost:4000/graphql?query=hello</span><br></pre></td></tr></table></figure><p>å¸¦å‚æ•°çš„è¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:3000/info?query=&#123;getUser(id:1)&#123;name&#125;&#125;</span><br><span class="line"></span><br><span class="line">@post</span><br><span class="line">http://localhost:3000/info</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">query: &#123;</span><br><span class="line">getUser(id:1) &#123;</span><br><span class="line">name</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-nodejs-å®Œæ•´ç¤ºä¾‹"><a href="#5-nodejs-å®Œæ•´ç¤ºä¾‹" class="headerlink" title="5. nodejs å®Œæ•´ç¤ºä¾‹"></a>5. nodejs å®Œæ•´ç¤ºä¾‹</h3><p><strong>schemaLogin.js</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">const &#123; buildSchema &#125; = require(&quot;graphql&quot;);</span><br><span class="line"></span><br><span class="line">let schema = buildSchema(</span><br><span class="line">  `</span><br><span class="line">        input LoginInfo &#123;</span><br><span class="line">            name: String,</span><br><span class="line">            passwd: String,</span><br><span class="line">            captcha: String</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        type User &#123;</span><br><span class="line">            id: ID,</span><br><span class="line">            name: String,</span><br><span class="line">            sex: String</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        type Query &#123;</span><br><span class="line">            getUser(id: ID): User</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        type Mutation &#123;</span><br><span class="line">            login(user: LoginInfo): Boolean</span><br><span class="line">            register(user: LoginInfo): Int </span><br><span class="line">        &#125;</span><br><span class="line">    `</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const fakeDatabase = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">class User &#123;</span><br><span class="line">  constructor(id, name, passwd) &#123;</span><br><span class="line">    this.id = id;</span><br><span class="line">    this.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const root = &#123;</span><br><span class="line">  getUser: (&#123; id &#125;) =&gt; &#123;</span><br><span class="line">    let user = fakeDatabase[id];</span><br><span class="line">    if (!user) &#123;</span><br><span class="line">      throw new Error(&quot;404&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return new User(user.id, user.name);</span><br><span class="line">  &#125;,</span><br><span class="line">  login: (&#123; loginInfo &#125;) =&gt; &#123;</span><br><span class="line">    if (!loginInfo.captcha) throw new Error(&quot;captcha error&quot;);</span><br><span class="line">    if (!loginInfo.name || !loginInfo.passwd) throw new Error(&quot;params error&quot;);</span><br><span class="line"></span><br><span class="line">    for (let o in fakeDatabase) &#123;</span><br><span class="line">      if (o.name === loginInfo.name &amp;&amp; o.passwd === loginInfo.passwd)</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return false;</span><br><span class="line">  &#125;,</span><br><span class="line">  register: (&#123; loginInfo &#125;) =&gt; &#123;</span><br><span class="line">    if (!loginInfo.captcha) throw new Error(&quot;captcha error&quot;);</span><br><span class="line">    if (!loginInfo.name || !loginInfo.passwd) throw new Error(&quot;params error&quot;);</span><br><span class="line"></span><br><span class="line">    for (let o in fakeDatabase) &#123;</span><br><span class="line">      if (o.name === loginInfo.name) &#123;</span><br><span class="line">        throw new Error(&quot;name repeat&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //build id</span><br><span class="line">    var id = require(&quot;crypto&quot;).randomBytes(10).toString(&quot;hex&quot;);</span><br><span class="line">    fakeDatabase(&#123;</span><br><span class="line">      id,</span><br><span class="line">      name: loginInfo.name,</span><br><span class="line">      passwd: loginInfo.passwd,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    return 1;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  schema,</span><br><span class="line">  root,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>router&#x2F;index.js</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const &#123; schema, root &#125; = require(&quot;../common/graphql/login&quot;);</span><br><span class="line"></span><br><span class="line">router.use(</span><br><span class="line">  &quot;/info&quot;,</span><br><span class="line">  graphqlHTTP(&#123;</span><br><span class="line">    schema: schema,</span><br><span class="line">    rootValue: root,</span><br><span class="line">    graphiql: true,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><code>graphiql</code> è°ƒè¯•æ—¶å€™å¼€å¯ï¼Œå¯ä»¥æµ‹è¯•éªŒè¯æ¥å£</p><h3 id="6-å‰ç«¯è°ƒç”¨"><a href="#6-å‰ç«¯è°ƒç”¨" class="headerlink" title="6. å‰ç«¯è°ƒç”¨"></a>6. å‰ç«¯è°ƒç”¨</h3><p>é¦–å…ˆå¯ä»¥ç›´æ¥ä½¿ç”¨ axiosï¼Œ ç„¶åè·å–æ•°æ®ã€‚</p><p>å¦‚æœæ˜¯å‰ç«¯æ¡†æ¶ å¯ä»¥ä½¿ç”¨ é˜¿æ³¢ç½— + graqhgl-tag.</p><p>é˜¿æ³¢ç½—å‘èµ·å’Œç®¡ç†è¯·æ±‚ï¼Œgraqhql-tag è§£ææ–‡æœ¬</p><h3 id="7-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-graqhgl"><a href="#7-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-graqhgl" class="headerlink" title="7. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ graqhgl"></a>7. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ graqhgl</h3><ul><li>æ¥å£æ•°é‡ä¼—å¤šç»´æŠ¤æˆæœ¬é«˜æ¥å£</li><li>æ‰©å±•æˆæœ¬é«˜</li><li>æ¥å£å“åº”çš„æ•°æ®æ ¼å¼æ— æ³•é¢„çŸ¥</li><li>å‡å°‘æ— ç”¨æ•°æ®çš„è¯·æ±‚</li><li>æŒ‰éœ€è·å–å¼ºç±»å‹çº¦æŸï¼ˆAPIçš„æ•°æ®æ ¼å¼è®©å‰ç«¯æ¥å®šä¹‰ï¼Œè€Œä¸æ˜¯åç«¯å®šä¹‰ï¼‰</li></ul><p>å¯ä»¥æ–¹ä¾¿è¿›è¡Œæµ‹è¯•ï¼Œå‰ç«¯è‡ªå·±å†³å®šè¿”å›ä»€ä¹ˆï¼Œç»Ÿä¸€çš„æ¥å£ï¼Œè·¨å¹³å°ï¼Œç¡®å®æŒºå¥½çš„ã€‚</p><h3 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h3><p><a href="https://www.freecodecamp.org/chinese/news/a-detailed-guide-to-graphql/">https://www.freecodecamp.org/chinese/news/a-detailed-guide-to-graphql/</a><br><a href="https://www.npmjs.com/package/graphql">https://www.npmjs.com/package/graphql</a><br><a href="https://graphql.org/graphql-js/running-an-express-graphql-server/">https://graphql.org/graphql-js/running-an-express-graphql-server/</a><br><a href="https://github.com/graphql/graphql-js">https://github.com/graphql/graphql-js</a><br><a href="https://vue-apollo.netlify.app/zh-cn/guide/">https://vue-apollo.netlify.app/zh-cn/guide/</a><br><a href="https://github.com/apollographql/graphql-tag#readme">https://github.com/apollographql/graphql-tag#readme</a></p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
            <tag> åç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javascript ä¸­çš„è¿›åˆ¶è½¬æ¢</title>
      <link href="/2023/06/15/conversion/"/>
      <url>/2023/06/15/conversion/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>è¿›åˆ¶è½¬æ¢ï¼Œjavascript æœ‰å“ªäº›è¿›åˆ¶è½¬æ¢çš„æ–¹å¼ï¼Ÿ</p><h3 id="01-è¿›åˆ¶åœ¨-javascript-ä¸­æ˜¯å¦‚ä½•è¡¨ç°çš„ï¼Ÿ"><a href="#01-è¿›åˆ¶åœ¨-javascript-ä¸­æ˜¯å¦‚ä½•è¡¨ç°çš„ï¼Ÿ" class="headerlink" title="01. è¿›åˆ¶åœ¨ javascript ä¸­æ˜¯å¦‚ä½•è¡¨ç°çš„ï¼Ÿ"></a>01. è¿›åˆ¶åœ¨ javascript ä¸­æ˜¯å¦‚ä½•è¡¨ç°çš„ï¼Ÿ</h3><ol><li>åå…­è¿›åˆ¶ <code>0x</code> or <code>0X</code></li><li>å…«è¿›åˆ¶ <code>0o</code> or <code>0O</code></li><li>äºŒè¿›åˆ¶ <code>0b</code> or <code>0B</code></li></ol><p>åœ¨åé¢è·Ÿæ•°æ®å°±å¯ä»¥äº†ï¼Œå¸¸ç”¨çš„æœ€å¤šå°±è¿™äº›äº†</p><p>æ˜ç™½è¿›åˆ¶è½¬æ¢é¦–å…ˆéœ€è¦çŸ¥é“ï¼Œä»€ä¹ˆæ˜¯è¿›åˆ¶</p><h3 id="02-åŸç”Ÿçš„è½¬æ¢"><a href="#02-åŸç”Ÿçš„è½¬æ¢" class="headerlink" title="02. åŸç”Ÿçš„è½¬æ¢"></a>02. åŸç”Ÿçš„è½¬æ¢</h3><p>javascript é»˜è®¤10è¿›åˆ¶ï¼Œå…¶ä»–è¿›åˆ¶è½¬10è¿›åˆ¶å¾ˆæ–¹ä¾¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">parseInt(v, 2 or 8 or 16...) //other =&gt; 10è¿›åˆ¶</span><br><span class="line">Number() //other =&gt; 10è¿›åˆ¶</span><br><span class="line">+() //other =&gt; 10è¿›åˆ¶</span><br><span class="line">Number.prototype.toString() //åè¿›åˆ¶ =&gt; other æ”¯æŒå°æ•°ã€‚</span><br></pre></td></tr></table></figure><p>å…¶å®ç”¨æ³•éƒ½å¾ˆç®€å•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">const C161 = 0xaa;</span><br><span class="line">const C162 = &quot;0xAA&quot;;</span><br><span class="line"></span><br><span class="line">console.log(C161);</span><br><span class="line">console.log(C162);</span><br><span class="line">console.log(`----------------`);</span><br><span class="line"></span><br><span class="line">console.log(Number(C161));</span><br><span class="line">console.log(Number(C162));</span><br><span class="line">console.log(`----------------`);</span><br><span class="line"></span><br><span class="line">console.log(parseInt(C161));</span><br><span class="line">console.log(parseInt(C162));</span><br><span class="line">console.log(`----------------`);</span><br><span class="line"></span><br><span class="line">console.log(parseFloat(C161));</span><br><span class="line">console.log(parseFloat(C162));</span><br><span class="line">console.log(`----------------`);</span><br><span class="line"></span><br><span class="line">console.log(+C161);</span><br><span class="line">console.log(+C162);</span><br><span class="line">console.log(`----------------`);</span><br><span class="line"></span><br><span class="line">`11.11`.toString(2);</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨ parseInt è½¬æ¢ï¼Œ 16è¿›åˆ¶ok </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">parseInt(`0xAA`)</span><br><span class="line">parseInt(`0b111`)</span><br></pre></td></tr></table></figure><p>äºŒè¿›åˆ¶ä¸è¯†åˆ«å‰é¢çš„ <code>0b</code>, è¿˜æ˜¯éœ€è¦å†™å…¥å®Œæ•´å‚æ•°ï¼Œæœ€å¥½éƒ½å†™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">parseInt(`0xAA`, 16)</span><br><span class="line">parseInt(`0b111`, 2)</span><br></pre></td></tr></table></figure><p>ç›¸æ¯”ä¹‹ä¸‹, Number or + æ²¡æœ‰è¿™ç§é™åˆ¶ã€‚ä½†æ˜¯å´åˆæ— æ³•ä¸»åŠ¨é€‰æ‹©è¿›åˆ¶åŸºæ•°ã€‚</p><p>æ‰€ä»¥åŒºåˆ†äº†åº”ç”¨åœºæ™¯ã€‚</p><h3 id="03-å¦‚ä½•å¤„ç†å°æ•°"><a href="#03-å¦‚ä½•å¤„ç†å°æ•°" class="headerlink" title="03. å¦‚ä½•å¤„ç†å°æ•°"></a>03. å¦‚ä½•å¤„ç†å°æ•°</h3><p>å¦‚æœåœ¨javascriptä¸­ç›´æ¥å†™ <code>0b111.111</code> æ˜¯ä¼šæŠ¥é”™äº†ï¼Œ å¿…é¡»å†™ <code>&#39;0b111.111&#39;</code>.</p><p>ä¹Ÿå°±æ˜¯è¯´åŸç”Ÿ javascript æ˜¯æ— æ³•å¤„ç†å°æ•°çš„ï¼Œå½“ç„¶å¯ä»¥è‡ªå·±å»å†™ï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™</p><blockquote><p>ä»äºŒè¿›åˆ¶æ•°çš„æœ€ä½ä½å¼€å§‹ï¼Œæ¯ä¸€ä½ä¹˜ä»¥å¯¹åº”çš„2çš„å¹‚æ•°ï¼Œç„¶åå°†æœ€ç»ˆçš„ç»“æœå°æ•°éƒ¨åˆ†ä¸æ•´æ•°éƒ¨åˆ†åˆ†åˆ«ç›¸åŠ <br>å¯¹åº”çš„2çš„å¹‚ï¼Œä»¥ä¸ªä½ä¸º0ï¼Œå‘é«˜ä½ä¾æ¬¡å¢1ï¼Œå‘åœ°ä½ä¾æ¬¡å‡1ï¼›</p></blockquote><p>å¯¹åº”å…³ç³»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1010.1010</span><br></pre></td></tr></table></figure><p>0 * 2çš„0æ¬¡æ–¹ + 1 * 2çš„ä¸€æ¬¡æ–¹ï¼Œä»¥æ­¤ç±»æ¨</p><h3 id="03-å¦‚æœè‡ªå·±å»å†™ï¼Œæœ‰ä»€ä¹ˆæ€è·¯"><a href="#03-å¦‚æœè‡ªå·±å»å†™ï¼Œæœ‰ä»€ä¹ˆæ€è·¯" class="headerlink" title="03. å¦‚æœè‡ªå·±å»å†™ï¼Œæœ‰ä»€ä¹ˆæ€è·¯?"></a>03. å¦‚æœè‡ªå·±å»å†™ï¼Œæœ‰ä»€ä¹ˆæ€è·¯?</h3><p>é¦–å…ˆå†™ä¸€ä¸ªäºŒè¿›åˆ¶çš„æ•´æ•°è½¬æ¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function twoToTen(str) &#123;</span><br><span class="line">  if (typeof str !== `string`) return NaN;</span><br><span class="line"></span><br><span class="line">  let count = 0;</span><br><span class="line">  for (let i = 0; i&lt; str.length;i++) &#123;</span><br><span class="line">    count += Math.pow(2, i) * str.charAt(str.length - i -1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  console.log(`è¾“å…¥:$&#123;str&#125;`);</span><br><span class="line">  console.log(`è¾“å‡º:$&#123;count&#125;`);</span><br><span class="line">  return count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">twoToTen(`111`);</span><br></pre></td></tr></table></figure><p>å¦‚æœåŠ å…¥å°æ•°ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function twoToTen(str) &#123;</span><br><span class="line">  if (typeof str !== `string`) return NaN;</span><br><span class="line"></span><br><span class="line">  let arr = str.split(`.`);</span><br><span class="line">  let a = arr[0];</span><br><span class="line">  let b = arr[1];</span><br><span class="line"></span><br><span class="line">  let count = 0;</span><br><span class="line">  for (let i = 0; i &lt; a.length; i++) &#123;</span><br><span class="line">    count += Math.pow(2, i) * a.charAt(a.length - i - 1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  let count1 = 0;</span><br><span class="line">  for (let i = 0; i &lt; b.length; i++) &#123;</span><br><span class="line">    count1 += Math.pow(2, -(i + 1)) * a.charAt(i);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  console.log(`è¾“å…¥:$&#123;str&#125;`);</span><br><span class="line">  console.log(`è¾“å‡º:$&#123;count + count1&#125;`);</span><br><span class="line">  return count + count1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“çš„ç™¾åº¦ä¸€ä¸‹å°±æœ‰å…¬å¼ï¼Œå¹¶ä¸å¤æ‚ã€‚</p><p>æˆ‘è¿™é‡Œå¹¶æ²¡æœ‰è¿›è¡Œæ£€æŸ¥ï¼Œä»¥åŠé”™è¯¯å¤„ç†ï¼Œå¦‚æœéœ€è¦ï¼Œè¿˜æ˜¯è¦åŠ ä¸Šçš„ã€‚</p><h3 id="03-link"><a href="#03-link" class="headerlink" title="03. link"></a>03. link</h3><ol><li><a href="https://juejin.cn/post/7035844421522292750">ææ‡‚JavaScriptä¸­çš„è¿›åˆ¶ä¸è¿›åˆ¶è½¬æ¢</a></li><li><a href="https://baike.baidu.com/item/%E4%BA%8C%E8%BF%9B%E5%88%B6/361457?fromModule=lemma_search-box">ç™¾åº¦ç™¾ç§‘ äºŒè¿›åˆ¶</a></li><li><a href="https://baike.baidu.com/item/%E5%85%AB%E8%BF%9B%E5%88%B6?fromtitle=8%E8%BF%9B%E5%88%B6&fromid=17712662&fromModule=lemma_search-box">ç™¾åº¦ç™¾ç§‘ å…«è¿›åˆ¶</a></li><li><a href="https://baike.baidu.com/item/%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6/4162457?fromModule=lemma_search-box">ç™¾åº¦ç™¾ç§‘ åå…­è¿›åˆ¶</a></li></ol></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
            <tag> è¿›åˆ¶è½¬æ¢ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é˜²æŠ–å’ŒèŠ‚æµ</title>
      <link href="/2023/06/15/debounce_throttle%20copy/"/>
      <url>/2023/06/15/debounce_throttle%20copy/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="é˜²æŠ–å’ŒèŠ‚æµ"><a href="#é˜²æŠ–å’ŒèŠ‚æµ" class="headerlink" title="é˜²æŠ–å’ŒèŠ‚æµ"></a>é˜²æŠ–å’ŒèŠ‚æµ</h1><h3 id="1-åŸºæœ¬æ¦‚å¿µ"><a href="#1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1. åŸºæœ¬æ¦‚å¿µ"></a>1. åŸºæœ¬æ¦‚å¿µ</h3><blockquote><p>é˜²æŠ–ï¼ˆDebounceï¼‰å’ŒèŠ‚æµï¼ˆThrottleï¼‰éƒ½æ˜¯ç”¨äºé™åˆ¶å‡½æ•°æ‰§è¡Œé¢‘ç‡çš„æŠ€æœ¯ï¼Œå¸¸ç”¨äºä¼˜åŒ–æ€§èƒ½ã€å‡å°‘èµ„æºæ¶ˆè€—å’Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p><p>é˜²æŠ–çš„åŸç†æ˜¯åœ¨è§¦å‘äº‹ä»¶åï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆä¾‹å¦‚100æ¯«ç§’ï¼‰ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…æ²¡æœ‰å†æ¬¡è§¦å‘è¯¥äº‹ä»¶ï¼Œæ‰æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚å¦‚æœåœ¨ç­‰å¾…æ—¶é—´å†…åˆè§¦å‘äº†è¯¥äº‹ä»¶ï¼Œåˆ™é‡æ–°è®¡æ—¶ã€‚é˜²æŠ–å¸¸ç”¨äºå¤„ç†é¢‘ç¹è§¦å‘çš„äº‹ä»¶ï¼Œå¦‚çª—å£è°ƒæ•´ã€æœç´¢æ¡†è¾“å…¥ç­‰ã€‚</p><p>èŠ‚æµçš„åŸç†æ˜¯è§„å®šä¸€ä¸ªå›ºå®šçš„æ—¶é—´é—´éš”ï¼Œåœ¨è¯¥æ—¶é—´é—´éš”å†…åªä¼šæ‰§è¡Œä¸€æ¬¡ç›¸åº”çš„æ“ä½œã€‚å¦‚æœåœ¨æ—¶é—´é—´éš”å†…è§¦å‘äº†å¤šæ¬¡äº‹ä»¶ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡ä¼šæ‰§è¡Œæ“ä½œï¼Œå…¶ä½™çš„äº‹ä»¶ä¼šè¢«å¿½ç•¥ã€‚èŠ‚æµå¸¸ç”¨äºé™åˆ¶é«˜é¢‘ç‡è§¦å‘çš„äº‹ä»¶ï¼Œå¦‚æ»šåŠ¨äº‹ä»¶ã€é¼ æ ‡ç§»åŠ¨äº‹ä»¶ç­‰ã€‚</p></blockquote><p>æ„æ€å’Œæ˜ç¡®</p><ol><li>é˜²æŠ–å®šæ—¶æ‰§è¡Œæˆ–è€…éœ€è¦å¼€å…³å¼€å§‹æ‰§è¡Œï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå‰ææ¡ä»¶ï¼Œå°±æ˜¯éœ€è¦æŸä¸ªæ ‡å¿—æ²¡æœ‰æ‰§è¡Œä¸€æ®µæ—¶é—´</li><li>èŠ‚æµï¼Œå°±æ˜¯æˆ‘ä¸ç®¡è¿™äº›ï¼Œæˆ‘åªè®¤æ—¶é—´ï¼Œåˆ°æ—¶é—´æˆ‘å°±æ‰§è¡Œã€‚</li></ol><p>è¿™å°±æ˜¯é˜²æŠ–å’ŒèŠ‚æµçš„æ¦‚å¿µã€‚</p><h3 id="2-å®ç°æ–¹å¼"><a href="#2-å®ç°æ–¹å¼" class="headerlink" title="2. å®ç°æ–¹å¼"></a>2. å®ç°æ–¹å¼</h3><p><strong>é˜²æŠ–</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> t = <span class="title function_">settimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">//todo</span></span><br><span class="line">&#125;, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">execEvent</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="built_in">clearTimeout</span>(t);</span><br><span class="line">t = <span class="title function_">settimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">//todo</span></span><br><span class="line">&#125;, <span class="number">100</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å†™ä»–è ¢ï¼Œç”¨å¿…åŒ…å®ç°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">delay, func</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> timer;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">timer = <span class="built_in">setTimeout</span>(func, delay);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå¤–éƒ¨è°ƒç”¨å°±å¯ä»¥äº†ã€‚</p><p>åŒæ ·ï¼Œéœ€è¦ç›´æ¥åˆ¤æ–­æ—¶é—´ï¼Œä¹Ÿä½¿ç”¨å¿…åŒ…å»åš</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, interval</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> lastTime = <span class="number">0</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">new</span> <span class="title class_">Date</span>() - lastTime &gt; interval) &#123;</span><br><span class="line">lastTime = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="title function_">func</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚æ˜¯è¿™æ ·ï¼Œå¯ä»¥å†™çš„æ›´å¤æ‚ä¸€ç‚¹ï¼Œæ¯”å¦‚æ—¶é—´å¤„ç†ï¼Œæ¯”å¦‚è¿™é‡Œä¹Ÿæ²¡æœ‰å¤„ç†thisæŒ‡å‘ï¼Œä¹Ÿæ²¡æœ‰å¤„ç†å‚æ•°ï¼Œè¿™æ ·çš„ç®€å•ä¹Ÿè¯´æ¸…æ¥šäº†ã€‚</p><h3 id="3-åº”ç”¨åœºæ™¯"><a href="#3-åº”ç”¨åœºæ™¯" class="headerlink" title="3. åº”ç”¨åœºæ™¯"></a>3. åº”ç”¨åœºæ™¯</h3><p><strong>é˜²æŠ–</strong></p><blockquote><p>è¾“å…¥æ¡†æœç´¢ï¼šåœ¨ç”¨æˆ·è¿ç»­è¾“å…¥æœç´¢å…³é”®è¯æ—¶ï¼Œä½¿ç”¨é˜²æŠ–å¯ä»¥é¿å…é¢‘ç¹å‘é€è¯·æ±‚ï¼Œåªåœ¨ç”¨æˆ·è¾“å…¥å®Œæˆåä¸€æ®µæ—¶é—´å†…æ‰§è¡Œæœç´¢æ“ä½œã€‚<br>çª—å£è°ƒæ•´ï¼šåœ¨çª—å£å¤§å°è°ƒæ•´è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨é˜²æŠ–å¯ä»¥ç¡®ä¿åªåœ¨ç”¨æˆ·å®Œæˆè°ƒæ•´åæ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œé¿å…é¢‘ç¹è§¦å‘å’Œæ‰§è¡Œæ“ä½œã€‚<br>æŒ‰é’®ç‚¹å‡»ï¼šé˜²æ­¢ç”¨æˆ·åœ¨çŸ­æ—¶é—´å†…å¤šæ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œä½¿ç”¨é˜²æŠ–å¯ä»¥ç¡®ä¿åªå“åº”æœ€åä¸€æ¬¡ç‚¹å‡»ã€‚</p></blockquote><p><strong>èŠ‚æµ</strong></p><blockquote><p>é¡µé¢æ»šåŠ¨ï¼šåœ¨æ»šåŠ¨äº‹ä»¶è§¦å‘æ—¶ï¼Œä½¿ç”¨èŠ‚æµå¯ä»¥æ§åˆ¶å¤„ç†å‡½æ•°çš„æ‰§è¡Œé¢‘ç‡ï¼Œå‡å°‘æ»šåŠ¨äº‹ä»¶çš„å¤„ç†æ¬¡æ•°ï¼Œæå‡æ€§èƒ½ã€‚<br>é¼ æ ‡ç§»åŠ¨ï¼šåœ¨é¼ æ ‡ç§»åŠ¨äº‹ä»¶è§¦å‘æ—¶ï¼Œä½¿ç”¨èŠ‚æµå¯ä»¥é™åˆ¶äº‹ä»¶å¤„ç†å‡½æ•°çš„æ‰§è¡Œé¢‘ç‡ï¼Œå‡å°‘é¢‘ç¹çš„è®¡ç®—å’Œæ“ä½œï¼Œæé«˜é¡µé¢å“åº”é€Ÿåº¦ã€‚<br>é¡µé¢åˆ·æ–°ï¼šåœ¨é¡µé¢åˆ·æ–°æ—¶ï¼Œä½¿ç”¨èŠ‚æµå¯ä»¥é™åˆ¶èµ„æºåŠ è½½å’Œæ¸²æŸ“çš„é¢‘ç‡ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½è¿‡å¤šçš„èµ„æºå¯¼è‡´é¡µé¢å¡é¡¿ã€‚</p></blockquote><p>ç­‰ç­‰ç­‰ç­‰ã€‚</p><h3 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4. æ€»ç»“"></a>4. æ€»ç»“</h3><p>å…¶å®å†å¼€å¤´å°±è¯´æ˜äº†</p><blockquote><p>é˜²æŠ–ï¼ˆDebounceï¼‰å’ŒèŠ‚æµï¼ˆThrottleï¼‰éƒ½æ˜¯ç”¨äºé™åˆ¶å‡½æ•°æ‰§è¡Œé¢‘ç‡çš„æŠ€æœ¯ï¼Œå¸¸ç”¨äºä¼˜åŒ–æ€§èƒ½ã€å‡å°‘èµ„æºæ¶ˆè€—å’Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p></blockquote><p>æ‰€ä»¥å½“é‡è§å¯èƒ½ä¼šé¢‘ç¹è§¦å‘çš„æ—¶å€™ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ã€‚</p><p>å¯ä»¥ç›´æ¥ä½¿ç”¨ loadsh ä¸­çš„æ–¹æ³•ï¼Œå¤„ç†çš„å¾ˆå¥½ï¼Œç®€å•äº›å¯èƒ½å‡ºç°ä¸€äº›ä¸æ»¡è¶³çš„é—®é¢˜ï¼Œæ¯”å¦‚å‚æ•°ï¼Œæ¯”å¦‚å¼‚æ­¥æ‰§è¡Œè°ƒç”¨å’Œæ‰§è¡Œå®Œæˆæ˜¯ä¸ä¸€æ ·çš„ï¼Œæœ‰å¾ˆå¤šç»†èŠ‚éœ€è¦å¤„ç†ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é˜²æŠ–å’ŒèŠ‚æµ</title>
      <link href="/2023/06/15/debounce_throttle/"/>
      <url>/2023/06/15/debounce_throttle/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="é˜²æŠ–å’ŒèŠ‚æµ"><a href="#é˜²æŠ–å’ŒèŠ‚æµ" class="headerlink" title="é˜²æŠ–å’ŒèŠ‚æµ"></a>é˜²æŠ–å’ŒèŠ‚æµ</h1><h3 id="1-åŸºæœ¬æ¦‚å¿µ"><a href="#1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1. åŸºæœ¬æ¦‚å¿µ"></a>1. åŸºæœ¬æ¦‚å¿µ</h3><blockquote><p>é˜²æŠ–ï¼ˆDebounceï¼‰å’ŒèŠ‚æµï¼ˆThrottleï¼‰éƒ½æ˜¯ç”¨äºé™åˆ¶å‡½æ•°æ‰§è¡Œé¢‘ç‡çš„æŠ€æœ¯ï¼Œå¸¸ç”¨äºä¼˜åŒ–æ€§èƒ½ã€å‡å°‘èµ„æºæ¶ˆè€—å’Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p><p>é˜²æŠ–çš„åŸç†æ˜¯åœ¨è§¦å‘äº‹ä»¶åï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆä¾‹å¦‚100æ¯«ç§’ï¼‰ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…æ²¡æœ‰å†æ¬¡è§¦å‘è¯¥äº‹ä»¶ï¼Œæ‰æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚å¦‚æœåœ¨ç­‰å¾…æ—¶é—´å†…åˆè§¦å‘äº†è¯¥äº‹ä»¶ï¼Œåˆ™é‡æ–°è®¡æ—¶ã€‚é˜²æŠ–å¸¸ç”¨äºå¤„ç†é¢‘ç¹è§¦å‘çš„äº‹ä»¶ï¼Œå¦‚çª—å£è°ƒæ•´ã€æœç´¢æ¡†è¾“å…¥ç­‰ã€‚</p><p>èŠ‚æµçš„åŸç†æ˜¯è§„å®šä¸€ä¸ªå›ºå®šçš„æ—¶é—´é—´éš”ï¼Œåœ¨è¯¥æ—¶é—´é—´éš”å†…åªä¼šæ‰§è¡Œä¸€æ¬¡ç›¸åº”çš„æ“ä½œã€‚å¦‚æœåœ¨æ—¶é—´é—´éš”å†…è§¦å‘äº†å¤šæ¬¡äº‹ä»¶ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡ä¼šæ‰§è¡Œæ“ä½œï¼Œå…¶ä½™çš„äº‹ä»¶ä¼šè¢«å¿½ç•¥ã€‚èŠ‚æµå¸¸ç”¨äºé™åˆ¶é«˜é¢‘ç‡è§¦å‘çš„äº‹ä»¶ï¼Œå¦‚æ»šåŠ¨äº‹ä»¶ã€é¼ æ ‡ç§»åŠ¨äº‹ä»¶ç­‰ã€‚</p></blockquote><p>æ„æ€å’Œæ˜ç¡®</p><ol><li>é˜²æŠ–å®šæ—¶æ‰§è¡Œæˆ–è€…éœ€è¦å¼€å…³å¼€å§‹æ‰§è¡Œï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå‰ææ¡ä»¶ï¼Œå°±æ˜¯éœ€è¦æŸä¸ªæ ‡å¿—æ²¡æœ‰æ‰§è¡Œä¸€æ®µæ—¶é—´</li><li>èŠ‚æµï¼Œå°±æ˜¯æˆ‘ä¸ç®¡è¿™äº›ï¼Œæˆ‘åªè®¤æ—¶é—´ï¼Œåˆ°æ—¶é—´æˆ‘å°±æ‰§è¡Œã€‚</li></ol><p>è¿™å°±æ˜¯é˜²æŠ–å’ŒèŠ‚æµçš„æ¦‚å¿µã€‚</p><h3 id="2-å®ç°æ–¹å¼"><a href="#2-å®ç°æ–¹å¼" class="headerlink" title="2. å®ç°æ–¹å¼"></a>2. å®ç°æ–¹å¼</h3><p><strong>é˜²æŠ–</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> t = <span class="title function_">settimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">//todo</span></span><br><span class="line">&#125;, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">execEvent</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="built_in">clearTimeout</span>(t);</span><br><span class="line">t = <span class="title function_">settimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">//todo</span></span><br><span class="line">&#125;, <span class="number">100</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å†™ä»–è ¢ï¼Œç”¨å¿…åŒ…å®ç°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">delay, func</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> timer;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">timer = <span class="built_in">setTimeout</span>(func, delay);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå¤–éƒ¨è°ƒç”¨å°±å¯ä»¥äº†ã€‚</p><p>åŒæ ·ï¼Œéœ€è¦ç›´æ¥åˆ¤æ–­æ—¶é—´ï¼Œä¹Ÿä½¿ç”¨å¿…åŒ…å»åš</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, interval</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> lastTime = <span class="number">0</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">new</span> <span class="title class_">Date</span>() - lastTime &gt; interval) &#123;</span><br><span class="line">lastTime = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="title function_">func</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚æ˜¯è¿™æ ·ï¼Œå¯ä»¥å†™çš„æ›´å¤æ‚ä¸€ç‚¹ï¼Œæ¯”å¦‚æ—¶é—´å¤„ç†ï¼Œæ¯”å¦‚è¿™é‡Œä¹Ÿæ²¡æœ‰å¤„ç†thisæŒ‡å‘ï¼Œä¹Ÿæ²¡æœ‰å¤„ç†å‚æ•°ï¼Œè¿™æ ·çš„ç®€å•ä¹Ÿè¯´æ¸…æ¥šäº†ã€‚</p><h3 id="3-åº”ç”¨åœºæ™¯"><a href="#3-åº”ç”¨åœºæ™¯" class="headerlink" title="3. åº”ç”¨åœºæ™¯"></a>3. åº”ç”¨åœºæ™¯</h3><p><strong>é˜²æŠ–</strong></p><blockquote><p>è¾“å…¥æ¡†æœç´¢ï¼šåœ¨ç”¨æˆ·è¿ç»­è¾“å…¥æœç´¢å…³é”®è¯æ—¶ï¼Œä½¿ç”¨é˜²æŠ–å¯ä»¥é¿å…é¢‘ç¹å‘é€è¯·æ±‚ï¼Œåªåœ¨ç”¨æˆ·è¾“å…¥å®Œæˆåä¸€æ®µæ—¶é—´å†…æ‰§è¡Œæœç´¢æ“ä½œã€‚<br>çª—å£è°ƒæ•´ï¼šåœ¨çª—å£å¤§å°è°ƒæ•´è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨é˜²æŠ–å¯ä»¥ç¡®ä¿åªåœ¨ç”¨æˆ·å®Œæˆè°ƒæ•´åæ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œé¿å…é¢‘ç¹è§¦å‘å’Œæ‰§è¡Œæ“ä½œã€‚<br>æŒ‰é’®ç‚¹å‡»ï¼šé˜²æ­¢ç”¨æˆ·åœ¨çŸ­æ—¶é—´å†…å¤šæ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œä½¿ç”¨é˜²æŠ–å¯ä»¥ç¡®ä¿åªå“åº”æœ€åä¸€æ¬¡ç‚¹å‡»ã€‚</p></blockquote><p><strong>èŠ‚æµ</strong></p><blockquote><p>é¡µé¢æ»šåŠ¨ï¼šåœ¨æ»šåŠ¨äº‹ä»¶è§¦å‘æ—¶ï¼Œä½¿ç”¨èŠ‚æµå¯ä»¥æ§åˆ¶å¤„ç†å‡½æ•°çš„æ‰§è¡Œé¢‘ç‡ï¼Œå‡å°‘æ»šåŠ¨äº‹ä»¶çš„å¤„ç†æ¬¡æ•°ï¼Œæå‡æ€§èƒ½ã€‚<br>é¼ æ ‡ç§»åŠ¨ï¼šåœ¨é¼ æ ‡ç§»åŠ¨äº‹ä»¶è§¦å‘æ—¶ï¼Œä½¿ç”¨èŠ‚æµå¯ä»¥é™åˆ¶äº‹ä»¶å¤„ç†å‡½æ•°çš„æ‰§è¡Œé¢‘ç‡ï¼Œå‡å°‘é¢‘ç¹çš„è®¡ç®—å’Œæ“ä½œï¼Œæé«˜é¡µé¢å“åº”é€Ÿåº¦ã€‚<br>é¡µé¢åˆ·æ–°ï¼šåœ¨é¡µé¢åˆ·æ–°æ—¶ï¼Œä½¿ç”¨èŠ‚æµå¯ä»¥é™åˆ¶èµ„æºåŠ è½½å’Œæ¸²æŸ“çš„é¢‘ç‡ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½è¿‡å¤šçš„èµ„æºå¯¼è‡´é¡µé¢å¡é¡¿ã€‚</p></blockquote><p>ç­‰ç­‰ç­‰ç­‰ã€‚</p><h3 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4. æ€»ç»“"></a>4. æ€»ç»“</h3><p>å…¶å®å†å¼€å¤´å°±è¯´æ˜äº†</p><blockquote><p>é˜²æŠ–ï¼ˆDebounceï¼‰å’ŒèŠ‚æµï¼ˆThrottleï¼‰éƒ½æ˜¯ç”¨äºé™åˆ¶å‡½æ•°æ‰§è¡Œé¢‘ç‡çš„æŠ€æœ¯ï¼Œå¸¸ç”¨äºä¼˜åŒ–æ€§èƒ½ã€å‡å°‘èµ„æºæ¶ˆè€—å’Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p></blockquote><p>æ‰€ä»¥å½“é‡è§å¯èƒ½ä¼šé¢‘ç¹è§¦å‘çš„æ—¶å€™ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ã€‚</p><p>å¯ä»¥ç›´æ¥ä½¿ç”¨ loadsh ä¸­çš„æ–¹æ³•ï¼Œå¤„ç†çš„å¾ˆå¥½ï¼Œç®€å•äº›å¯èƒ½å‡ºç°ä¸€äº›ä¸æ»¡è¶³çš„é—®é¢˜ï¼Œæ¯”å¦‚å‚æ•°ï¼Œæ¯”å¦‚å¼‚æ­¥æ‰§è¡Œè°ƒç”¨å’Œæ‰§è¡Œå®Œæˆæ˜¯ä¸ä¸€æ ·çš„ï¼Œæœ‰å¾ˆå¤šç»†èŠ‚éœ€è¦å¤„ç†ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>restful</title>
      <link href="/2023/06/15/restful/"/>
      <url>/2023/06/15/restful/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><h1 id="restful"><a href="#restful" class="headerlink" title="restful"></a>restful</h1><p>restful åœ¨æˆ‘ä¹‹å‰åŸºç¡€çš„ç†è§£ä¹‹ä¸‹å…¶å®å°±æ˜¯å¯¹èµ„æºçš„å¢åˆ æŸ¥æ”¹ã€‚</p><p>ä¾‹å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/list/1</span><br><span class="line">/user/abcdefg</span><br></pre></td></tr></table></figure><p>get å¯¹åº”è·å–<br>post å¯¹åº”åˆ›å»ºå’Œæ›´æ–°<br>put æ›´æ–°<br>delete åˆ é™¤</p><p>http çš„å››ç§ç±»å‹å¯¹åº”å››ç§åŠ¨ä½œã€‚</p><p>ç†è§£åŸºæœ¬ä¸Šæ˜¯æ­£ç¡®çš„ã€‚</p><h3 id="01-è¯­ä¹‰è§£é‡Š"><a href="#01-è¯­ä¹‰è§£é‡Š" class="headerlink" title="01. è¯­ä¹‰è§£é‡Š"></a>01. è¯­ä¹‰è§£é‡Š</h3><p>restful &#x3D; Representational State Transfer &#x3D; è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–.</p><p>è¿™é‡Œå°‘äº†ä¸€ä¸ªä¸»è¯­èµ„æºï¼Œè¿™ä¸ªç†è®ºéƒ½æ˜¯ä¸ºäº†èµ„æºæœåŠ¡ï¼Œå¯ä»¥æŠŠç½‘ä¸Šçš„ä¸€åˆ‡ç†è§£ä¸ºèµ„æºï¼Œå›¾ç‰‡ï¼Œæ–‡æœ¬ï¼Œæ–‡ä»¶ï¼Œè§†é¢‘ï¼Œapiæ¥å£ï¼Œè·å–çš„åˆ—è¡¨ç­‰ç­‰</p><p>ç„¶è€Œé€šè¿‡ uri æ¥è§£é‡Šè¿™ä¸ªèµ„æºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get /user/abcdefg</span><br></pre></td></tr></table></figure><p>è·å–åå­—å«abcdefgçš„ç”¨æˆ·ä¿¡æ¯</p><h3 id="02-çŠ¶æ€è½¬æ¢"><a href="#02-çŠ¶æ€è½¬æ¢" class="headerlink" title="02. çŠ¶æ€è½¬æ¢"></a>02. çŠ¶æ€è½¬æ¢</h3><p>è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–çš„æ„æ€æ˜¯ http æ˜¯æ— çŠ¶æ€çš„ï¼Œå¦‚æœéœ€è¦çŠ¶æ€ï¼Œå°±éœ€è¦å€ŸåŠ© <code>get</code>,<code>post</code>,<code>delete</code>,<code>put</code> æ¥æ“ä½œæœåŠ¡å™¨ï¼Œè¿™ä¸ªå°±å«åšçŠ¶æ€è½¬åŒ–ã€‚</p><h3 id="03-æ€»ç»“"><a href="#03-æ€»ç»“" class="headerlink" title="03. æ€»ç»“"></a>03. æ€»ç»“</h3><ol><li>æ¯ä¸ª uri éƒ½ä»£è¡¨ä¸€ç§èµ„æº</li><li>å¯ä»¥é€šè¿‡ http çš„ä¸åŒ typeï¼Œæ¥è¡¨è¾¾åŠ¨ä½œï¼Œä¹Ÿå°±æ˜¯å¯¹æœåŠ¡å™¨èµ„æºè¿›è¡Œæ“ä½œ</li></ol><h3 id="04-è¯¯åŒº"><a href="#04-è¯¯åŒº" class="headerlink" title="04. è¯¯åŒº"></a>04. è¯¯åŒº</h3><ol><li>ä¸èƒ½æ–°å¢çš„åŠ¨ä½œ</li><li>ä¸è¦åŠ æ— ç”¨ä¿¡æ¯ï¼Œè¦ç²¾å‡†æè¿°èµ„æºå’Œæ“ä½œ</li></ol><p>æ¯”å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/2.0/user/1</span><br><span class="line">/tommy/msg/liya</span><br></pre></td></tr></table></figure><p>ç‰ˆæœ¬å·åº”è¯¥æ”¾åœ¨ http è¯·æ±‚é‡Œé¢<br><strong>msg</strong> å±äºæ–°çš„åŠ¨ä½œï¼Œåº”è¯¥æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post /msg</span><br></pre></td></tr></table></figure><p>åœ¨ data ä¸­è¡¨æ˜æ•°æ®ã€‚</p><p>è¿™é‡Œæ˜¯å‚è€ƒé˜®ä¸€å³°çš„æ–‡ç« </p><p><a href="https://www.ruanyifeng.com/blog/2011/09/restful.html">ç†è§£RESTfulæ¶æ„</a></p><p>å…¶ä»–æ–‡ç« é‡Œï¼Œå¯¹äºæ˜¯å¦åŠ å…¥ api ç‰ˆæœ¬å·ä¹‹ç±»çš„æ–¹å¼æ˜¯okçš„ï¼Œå¹¶ä¸”å¼ºè°ƒä½¿ç”¨çŠ¶æ€ç ã€‚</p></div>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> åç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>todo</title>
      <link href="/2023/01/14/todo/"/>
      <url>/2023/01/14/todo/</url>
      
        <content type="html"><![CDATA[<div class=".article-gallery"><p>è§¦å‘å¸ƒå±€ <a href="https://juejin.cn/post/7070092857754779661">https://juejin.cn/post/7070092857754779661</a><br>åŒæ­¥å¸ƒå±€ <a href="https://juejin.cn/post/7070092857754779661">https://juejin.cn/post/7070092857754779661</a></p><p>tcp æ…¢å¯åŠ¨</p><p>å­—æ¯â€™xâ€™åœ¨CSSä¸–ç•Œä¸­çš„è§’è‰²å’Œæ•…äº‹<br><a href="https://www.zhangxinxu.com/wordpress/2015/06/about-letter-x-of-css/">https://www.zhangxinxu.com/wordpress/2015/06/about-letter-x-of-css/</a></p><p>iterator &amp; generator</p><p>Proxy å¯¹æ¯” Object.define ä¼˜ç‚¹</p><p>Transition</p><p>setup æ˜¯æ€ä¹ˆè¿è¡Œçš„ï¼Ÿ</p><p>vue3 diff ç®—æ³•åŒºåˆ«</p><p>watch &amp; comput</p><p>vue3 PatchFlags</p><p>è§£å†³è·¨åŸŸé—®é¢˜çš„æ–¹æ³•</p><p>æµè§ˆå™¨çš„å­˜å‚¨æœ‰å“ªäº›åŠå®ƒä»¬é—´çš„åŒºåˆ«</p><p>å¾®å‰ç«¯</p><p>å‰ç«¯ä½ä»£ç çš„è®¤è¯†</p><p>Promise</p><p>æ— æ ·å¼å†…å®¹çš„é—ªå…‰ï¼ˆFOUCï¼‰ <a href="https://en.wikipedia.org/wiki/Flash_of_unstyled_content">https://en.wikipedia.org/wiki/Flash_of_unstyled_content</a></p><p>visibility: hidden å’Œ display: none çš„åŒºåˆ«ã€‚</p><p>css will-change å±æ€§</p><p>å¦‚ä½•åˆ©ç”¨ç»˜åˆ¶ï¼ˆé‡ç»˜ï¼‰åˆ†å±‚æœºåˆ¶ï¼Œè¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚</p><p>æµè§ˆå™¨æ€§èƒ½ä¼˜åŒ–</p><p>è¿­ä»£åè®® <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Iteration_protocols">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Iteration_protocols</a></p><p>javascript æ•°ç»„ï¼Œsetï¼Œmap ç­‰é›†åˆæˆ–è€…å­—å…¸ åœ¨éå†çš„æ—¶å€™ï¼Œå¦‚æœå‡ºç°äº†å˜åŒ–ï¼Œæ€ä¹ˆåº”ä»˜ï¼Ÿ</p><p>è‡ªå·±å†™æ•°ç»„çš„æ‰€æœ‰æ–¹æ³•</p><p>Object.create</p><p>instanceof vs. Array.isArray()<br>å½“æ£€æµ‹ Array å®ä¾‹æ—¶ï¼ŒArray.isArray ä¼˜äº instanceofï¼Œå› ä¸º Array.isArray èƒ½è·¨é¢†åŸŸå·¥ä½œã€‚<br>è¦çŸ¥é“è¿™ä¸ªç©¶ç«Ÿä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ</p><p>ç¨€ç–æ•°ç»„çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å †å†…å­˜</p><p>æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ</p><p>MutationObserver,queueMicrotask</p><p>module</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Learn/Performance">https://developer.mozilla.org/zh-CN/docs/Learn/Performance</a> webæ€§èƒ½ä¸“é¢˜</p><p>JavaScript Fetch API</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader">https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader</a> </p><p>Intersection_Observer_API</p><p>getBoundingClientRect</p><p>Service Worker é‡Œé¢ï¼Œæ‹¦æˆªç”¨æˆ·æäº¤çš„è¡¨å•ï¼Œä¿®æ”¹æŸäº›æ•°æ®ä»¥åï¼Œå†æäº¤ç»™æœåŠ¡å™¨ã€‚è¿™æ˜¯ä»€ä¹ˆï¼ŸForm Submission Interception</p><p>new window.AudioContext();</p><p>AbortController</p><p>Life of a frame &amp; requestIdleCallback è¿™ä¸ªå»ºè®®èŠ±ç‚¹æ—¶é—´çœ‹çœ‹<br> <a href="https://juejin.cn/post/6844903592831238157">https://juejin.cn/post/6844903592831238157</a><br> <a href="https://chromium.googlesource.com/chromium/src/+/refs/heads/main/docs/life_of_a_frame.md">https://chromium.googlesource.com/chromium/src/+/refs/heads/main/docs/life_of_a_frame.md</a></p><p> <a href="https://zh.javascript.info/arraybuffer-binary-arrays">https://zh.javascript.info/arraybuffer-binary-arrays</a></p></div>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
