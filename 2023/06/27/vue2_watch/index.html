<!DOCTYPE html>
<html lang="zh-Hans">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="Vue2.x watcher" />
    <meta name="hexo-theme-A4" content="v1.7.0" />
    <link rel="alternate icon" type="image/webp" href="/tblog/img/favicon.webp">
    <title>æˆå¤©ä¹±å†™ | ä»£ç å’Œç”Ÿæ´»</title>

    
        
            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/highlight/style1.css">

            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/a11y-dark.min.css">

            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/reset.css">

            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/markdown.css">

            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/fonts.css">
 
            <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
            

            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/ui.css">
 
            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/style.css">

    
            <!--è¿”å›é¡¶éƒ¨css-->
            
                
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/returnToTop.css">

                
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/unicons.css">

            
            
                <!--ç›®å½•-->
                
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/toc.css">

            

        
    

    
        
<link rel="stylesheet" href="/tblog/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/tblog/css/lightgallery-bundle.min.css">


<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/tblog/atom.xml" title="æˆå¤©ä¹±å†™" type="application/atom+xml">
</head>
    
    

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #e4e4e4 ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/tblog/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/tblog/">æˆå¤©ä¹±å†™</a> 
            <span class="description">ä¹±å†™ä¸œè¥¿çš„åœ°æ–¹ï¼Œè®²è®²ä»£ç å’Œç”Ÿæ´»</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/tblog/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/tblog/list/">æ–‡ç« </a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    Vue2.x watcher
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                    <span>æœ€è¿‘æ›´æ–°ï¼š2024-12-02</span> 
                
                
                    
                        &nbsp; | &nbsp;
                    
                     <span>å­—æ•°æ€»è®¡ï¼š2.1k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>é˜…è¯»ä¼°æ—¶ï¼š9åˆ†é’Ÿ</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span id="busuanzi_container_page_pv">
                        é˜…è¯»é‡ï¼š<span id="busuanzi_value_page_pv"></span>æ¬¡
                    </span>
                
            </div>
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#vue2-x-watcher"><span class="post-toc-text">vue2.x watcher</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#01-%E6%BA%90%E7%A0%81"><span class="post-toc-text">01. æºç </span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#02-%E6%80%BB%E7%BB%93"><span class="post-toc-text">02. æ€»ç»“</span></a></li></ol></li></ol></li></ol>
            
        
        <h1 id="vue2-x-watcher"><a href="#vue2-x-watcher" class="headerlink" title="vue2.x watcher"></a>vue2.x watcher</h1><h3 id="01-æºç "><a href="#01-æºç " class="headerlink" title="01. æºç "></a>01. æºç </h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Watcher</span> <span class="keyword">implements</span> <span class="title class_">DepTarget</span> &#123;</span><br><span class="line">  vm?: <span class="title class_">Component</span> | <span class="literal">null</span> <span class="comment">//ç»„ //ä»¶å®ä¾‹</span></span><br><span class="line">  <span class="attr">expression</span>: <span class="built_in">string</span> <span class="comment">//ç›‘è§†çš„è¡¨è¾¾å¼</span></span><br><span class="line">  <span class="attr">cb</span>: <span class="title class_">Function</span> <span class="comment">//å›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span> <span class="comment">//watch å”¯ä¸€id</span></span><br><span class="line">  <span class="attr">deep</span>: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦è¿›è¡Œæ·±åº¦ç›‘è§†</span></span><br><span class="line">  <span class="attr">user</span>: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦æ˜¯è‡ªå®šä¹‰watch</span></span><br><span class="line">  <span class="attr">lazy</span>: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦æ‡’æ‰§è¡Œ</span></span><br><span class="line">  <span class="attr">sync</span>: <span class="built_in">boolean</span> <span class="comment">//watch æ‰§è¡Œæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥</span></span><br><span class="line">  <span class="attr">dirty</span>: <span class="built_in">boolean</span> <span class="comment">//åœ¨ lazy = true çš„å‰æä¸‹ï¼Œå€¼æ˜¯å¦è¦é‡æ–°è®¡ç®—</span></span><br><span class="line">  <span class="attr">active</span>: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦å¤„äºæ¿€æ´»çŠ¶æ€</span></span><br><span class="line">  <span class="attr">deps</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Dep</span>&gt; <span class="comment">//ä¾èµ–åˆ—è¡¨</span></span><br><span class="line">  <span class="attr">newDeps</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Dep</span>&gt; <span class="comment">//ä¸´æ—¶ä¾èµ–åˆ—è¡¨</span></span><br><span class="line">  <span class="attr">depIds</span>: <span class="title class_">SimpleSet</span> <span class="comment">//ä¾èµ–çš„IDé›†åˆ</span></span><br><span class="line">  <span class="attr">newDepIds</span>: <span class="title class_">SimpleSet</span> <span class="comment">//ä¸´æ—¶ä¾èµ–åˆ—è¡¨ID</span></span><br><span class="line">  before?: <span class="title class_">Function</span> <span class="comment">//æ›´æ–°ä¹‹å‰çš„ hook å‡½æ•°</span></span><br><span class="line">  onStop?: <span class="title class_">Function</span> <span class="comment">//å½“å‰ watch è¢«åœæ­¢è°ƒç”¨ä»¥åçš„é’©å­å‡½æ•°</span></span><br><span class="line">  noRecurse?: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦é¿å…é€’å½’ç›‘è§†</span></span><br><span class="line">  <span class="attr">getter</span>: <span class="title class_">Function</span> <span class="comment">//è·å–å½“å‰ç›‘è§†çš„è¡¨è¾¾å¼çš„å€¼</span></span><br><span class="line">  <span class="attr">value</span>: <span class="built_in">any</span> <span class="comment">//å½“å‰å€¼</span></span><br><span class="line">  <span class="attr">post</span>: <span class="built_in">boolean</span> <span class="comment">//æ˜¯å¦æ˜¯åç½® watcherï¼ˆå³æ¸²æŸ“ watcherï¼‰ï¼Ÿ</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// dev only</span></span><br><span class="line">  onTrack?: (<span class="function">(<span class="params">event: DebuggerEvent</span>) =&gt;</span> <span class="built_in">void</span>) | <span class="literal">undefined</span></span><br><span class="line">  onTrigger?: (<span class="function">(<span class="params">event: DebuggerEvent</span>) =&gt;</span> <span class="built_in">void</span>) | <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    vm: Component | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">    expOrFn: <span class="built_in">string</span> | (() =&gt; <span class="built_in">any</span>),</span></span><br><span class="line"><span class="params">    cb: <span class="built_in">Function</span>,</span></span><br><span class="line"><span class="params">    options?: WatcherOptions | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">    isRenderWatcher?: <span class="built_in">boolean</span> <span class="comment">//å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºè¿™ä¸ª watcher æ˜¯å¦æ˜¯æ¸²æŸ“å‡½æ•° watcher</span></span></span><br><span class="line"><span class="params">  </span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è°ƒç”¨ recordEffectScope å‡½æ•°è®°å½• effect scopeï¼Œå…¶ä¸­ activeEffectScope è¡¨ç¤ºå½“å‰çš„æ¿€æ´»çš„ effect scopeã€‚  </span></span><br><span class="line">    <span class="title function_">recordEffectScope</span>(</span><br><span class="line">      <span class="variable language_">this</span>,</span><br><span class="line">      <span class="comment">// if the active effect scope is manually created (not a component scope),</span></span><br><span class="line">      <span class="comment">// prioritize it</span></span><br><span class="line">      activeEffectScope &amp;&amp; !activeEffectScope.<span class="property">_vm</span></span><br><span class="line">        ? activeEffectScope</span><br><span class="line">        : vm</span><br><span class="line">        ? vm.<span class="property">_scope</span></span><br><span class="line">        : <span class="literal">undefined</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¦‚æœ vm ä¸ä¸º nullï¼Œä¸” isRenderWatcher ä¸º trueï¼Œåˆ™å°† watcher å­˜å‚¨åœ¨ vm çš„ _watcher å±æ€§ä¸­ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> ((<span class="variable language_">this</span>.<span class="property">vm</span> = vm) &amp;&amp; isRenderWatcher) &#123;</span><br><span class="line">      vm.<span class="property">_watcher</span> = <span class="variable language_">this</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// options</span></span><br><span class="line">    <span class="keyword">if</span> (options) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">deep</span> = !!options.<span class="property">deep</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">user</span> = !!options.<span class="property">user</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">lazy</span> = !!options.<span class="property">lazy</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">sync</span> = !!options.<span class="property">sync</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">before</span> = options.<span class="property">before</span></span><br><span class="line">      <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onTrack</span> = options.<span class="property">onTrack</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onTrigger</span> = options.<span class="property">onTrigger</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">deep</span> = <span class="variable language_">this</span>.<span class="property">user</span> = <span class="variable language_">this</span>.<span class="property">lazy</span> = <span class="variable language_">this</span>.<span class="property">sync</span> = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cb</span> = cb</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">id</span> = ++uid <span class="comment">// uid for batching</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">active</span> = <span class="literal">true</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">post</span> = <span class="literal">false</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="variable language_">this</span>.<span class="property">lazy</span> <span class="comment">// for lazy watchers</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">deps</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDeps</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">depIds</span> = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDepIds</span> = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expression</span> = __DEV__ ? expOrFn.<span class="title function_">toString</span>() : <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">// parse expression for getter</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isFunction</span>(expOrFn)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">getter</span> = expOrFn</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">getter</span> = <span class="title function_">parsePath</span>(expOrFn)</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">getter</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">getter</span> = noop</span><br><span class="line">        __DEV__ &amp;&amp;</span><br><span class="line">          <span class="title function_">warn</span>(</span><br><span class="line">            <span class="string">`Failed watching path: &quot;<span class="subst">$&#123;expOrFn&#125;</span>&quot; `</span> +</span><br><span class="line">              <span class="string">&#x27;Watcher only accepts simple dot-delimited paths. &#x27;</span> +</span><br><span class="line">              <span class="string">&#x27;For full control, use a function instead.&#x27;</span>,</span><br><span class="line">            vm</span><br><span class="line">          )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">lazy</span> ? <span class="literal">undefined</span> : <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Evaluate the getter, and re-collect dependencies.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">pushTarget</span>(<span class="variable language_">this</span>) <span class="comment">//è¿›æ ˆï¼Œè¡¨ç¤ºæ­£åœ¨è®¡ç®—watchçš„å€¼</span></span><br><span class="line">    <span class="keyword">let</span> value</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="variable language_">this</span>.<span class="property">vm</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      value = <span class="variable language_">this</span>.<span class="property">getter</span>.<span class="title function_">call</span>(vm, vm) <span class="comment">//è·å–å€¼</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="attr">e</span>: <span class="built_in">any</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">user</span>) &#123;</span><br><span class="line">        <span class="title function_">handleError</span>(e, vm, <span class="string">`getter for watcher &quot;<span class="subst">$&#123;<span class="variable language_">this</span>.expression&#125;</span>&quot;`</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> e</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// &quot;touch&quot; every property so they are all tracked as</span></span><br><span class="line">      <span class="comment">// dependencies for deep watching</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">deep</span>) &#123; <span class="comment">//å¦‚æœè¦æ·±å…¥ç›‘è§†</span></span><br><span class="line">        <span class="comment">//traverse å‡½æ•°æ˜¯ç”¨æ¥éå†ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„çš„æ‰€æœ‰å­å±æ€§ï¼Œä»¥ä¾¿åœ¨è¿›è¡Œâ€œæ·±åº¦è§‚æµ‹â€ï¼ˆdeep watchï¼‰æ—¶èƒ½å¤Ÿå°†è¿™äº›å­å±æ€§å…¨éƒ¨æ³¨å†Œä¸ºä¾èµ–å…³ç³»ã€‚</span></span><br><span class="line">        <span class="comment">//traverse å‡½æ•°æ¥æ”¶ä¸€ä¸ª val å‚æ•°ï¼Œä»£è¡¨éœ€è¦éå†çš„å¯¹è±¡æˆ–æ•°ç»„ã€‚å‡½æ•°ä¸­é¦–å…ˆä¼šå¯¹ val è¿›è¡Œä¸€äº›åˆ¤æ–­ï¼Œä¾‹å¦‚å¦‚æœ val ä¸æ˜¯æ•°ç»„æˆ–å¯¹è±¡ï¼Œæˆ–è€…æ˜¯è¢«å†»ç»“çš„å¯¹è±¡ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ª VNodeï¼Œå°±ç›´æ¥è¿”å›ï¼Œä¸éœ€è¦ç»§ç»­éå†ã€‚</span></span><br><span class="line">        <span class="comment">//æ¥ä¸‹æ¥ä¼šåˆ¤æ–­ val æ˜¯å¦æ˜¯ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œå¦‚æœæ˜¯ï¼Œå°±ä¼šå°†å®ƒæ‰€å…³è”çš„ä¾èµ–çš„ id åŠ å…¥åˆ° seen é›†åˆä¸­ã€‚è¿™é‡Œçš„ seen é›†åˆæ˜¯ç”¨æ¥å»é‡çš„ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¿è¯åœ¨éå†ä¸€ä¸ªå¯¹è±¡æ—¶ä¸ä¼šå‡ºç°å¾ªç¯ä¾èµ–çš„æƒ…å†µã€‚ </span></span><br><span class="line">        <span class="comment">//æœ€åï¼Œå¦‚æœ val æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå°±å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ é€’å½’è°ƒç”¨ _traverse å‡½æ•°è¿›è¡Œéå†ï¼›å¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°±å¯¹å¯¹è±¡ä¸­çš„æ¯ä¸ªå±æ€§é€’å½’è°ƒç”¨ _traverse å‡½æ•°è¿›è¡Œéå†ã€‚å¦‚æœ val æ˜¯ä¸€ä¸ª Ref å¯¹è±¡ï¼Œåˆ™éå†å®ƒçš„ value å±æ€§ã€‚</span></span><br><span class="line">        <span class="comment">//è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯éå†ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ•°ç»„çš„æ‰€æœ‰å±æ€§æˆ–å…ƒç´ ï¼Œå¹¶ä¸”å°†éå†åˆ°çš„æ‰€æœ‰å±æ€§æˆ–å…ƒç´ éƒ½æ”¶é›†ä¸ºå“åº”å¼ä¾èµ–ï¼Œè¿™æ ·å½“å…¶ä¸­ä»»æ„ä¸€ä¸ªå±æ€§æˆ–å…ƒç´ å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒVue å°±èƒ½å¤ŸçŸ¥é“è¿™ä¸ªå˜åŒ–ï¼Œå¹¶ä¸”åŠæ—¶é€šçŸ¥è§†å›¾è¿›è¡Œæ›´æ–°ã€‚</span></span><br><span class="line">        <span class="title function_">traverse</span>(value) </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">popTarget</span>() <span class="comment">//å‡ºæ ˆ</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">cleanupDeps</span>() <span class="comment">//æ¸…é™¤æ‰€æœ‰Deps</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Add a dependency to this directive.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">addDep</span>(<span class="params">dep: Dep</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> id = dep.<span class="property">id</span></span><br><span class="line">    <span class="comment">//å¦‚æœä¸´æ—¶çš„IDé›†åˆæ²¡æœ‰åŒ…å«è¿™ä¸ªID</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">has</span>(id)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">add</span>(id) <span class="comment">//åŠ å…¥</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">newDeps</span>.<span class="title function_">push</span>(dep) <span class="comment">//åŠ å…¥ä¸´æ—¶ä¾èµ–çš„é›†åˆ</span></span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">depIds</span>.<span class="title function_">has</span>(id)) &#123; <span class="comment">//å¦‚æœä¾èµ–IDé›†åˆé‡Œé¢,æ²¡æœ‰</span></span><br><span class="line">        dep.<span class="title function_">addSub</span>(<span class="variable language_">this</span>) <span class="comment">//åœ¨Depä¸­åŠ å…¥è¿™ä¸ªwatch</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Clean up for dependency collection.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">cleanupDeps</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éå†depsï¼Œå¦‚æœæ²¡æœ‰åœ¨ newDepIds ï¼Œåˆ é™¤å½“å‰è¿™ä¸ª watch å®ä¾‹ã€‚</span></span><br><span class="line">    <span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="property">length</span></span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      <span class="keyword">const</span> dep = <span class="variable language_">this</span>.<span class="property">deps</span>[i]</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">has</span>(dep.<span class="property">id</span>)) &#123;</span><br><span class="line">        dep.<span class="title function_">removeSub</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°† newDepIds å’Œ newDeps èµ‹å€¼ç»™ depIds å’Œ deps ï¼Œä¸´æ—¶åˆ—è¡¨æ¸…ç©º</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">tmp</span>: <span class="built_in">any</span> = <span class="variable language_">this</span>.<span class="property">depIds</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">depIds</span> = <span class="variable language_">this</span>.<span class="property">newDepIds</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDepIds</span> = tmp</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">clear</span>()</span><br><span class="line">    tmp = <span class="variable language_">this</span>.<span class="property">deps</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">deps</span> = <span class="variable language_">this</span>.<span class="property">newDeps</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDeps</span> = tmp</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDeps</span>.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Subscriber interface.</span></span><br><span class="line"><span class="comment">   * Will be called when a dependency changes.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="comment">//åˆ¤æ–­lazy å¦‚æœæ˜¯ï¼Œdirty = trueï¼Œè¡¨ç¤ºå‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰é‡æ–°è®¡ç®—ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">lazy</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">sync</span>) &#123;</span><br><span class="line">      <span class="comment">//å¦‚æœ sync = trueï¼ŒåŒæ­¥æ‰§è¡Œï¼Œè°ƒç”¨run</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">run</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//å¦‚æœæ˜¯å¼‚æ­¥æ‰§è¡Œï¼ŒåŠ å…¥é˜Ÿåˆ—ã€‚</span></span><br><span class="line">      <span class="title function_">queueWatcher</span>(<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Scheduler job interface.</span></span><br><span class="line"><span class="comment">   * Will be called by the scheduler.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯ active</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">active</span>) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//è°ƒç”¨ get è·å– value</span></span><br><span class="line">      <span class="keyword">const</span> value = <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        <span class="comment">//å½“ æ–°æ—§ value ä¸ä¸€è‡´</span></span><br><span class="line">        <span class="comment">//å½“ æ–°å€¼ æ˜¯object</span></span><br><span class="line">        <span class="comment">//æˆ–è€…æ·±åº¦éå† deep = true</span></span><br><span class="line">        value !== <span class="variable language_">this</span>.<span class="property">value</span> ||</span><br><span class="line">        <span class="comment">// Deep watchers and watchers on Object/Arrays should fire even</span></span><br><span class="line">        <span class="comment">// when the value is the same, because the value may</span></span><br><span class="line">        <span class="comment">// have mutated.</span></span><br><span class="line">        <span class="title function_">isObject</span>(value) ||</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">deep</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="comment">// set new value</span></span><br><span class="line">        <span class="keyword">const</span> oldValue = <span class="variable language_">this</span>.<span class="property">value</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿™é‡Œå°±æ˜¯å›è°ƒï¼Œç”¨æˆ·è‡ªå®šä¹‰å› ä¸ºéœ€è¦æ–¹ä¾¿è°ƒè¯•ï¼Œæ‰€ä»¥ç”¨è¿™ç§æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">user</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> info = <span class="string">`callback for watcher &quot;<span class="subst">$&#123;<span class="variable language_">this</span>.expression&#125;</span>&quot;`</span></span><br><span class="line">          <span class="title function_">invokeWithErrorHandling</span>(</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cb</span>,</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">vm</span>,</span><br><span class="line">            [value, oldValue],</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">vm</span>,</span><br><span class="line">            info</span><br><span class="line">          )</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">cb</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, value, oldValue)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Evaluate the value of the watcher.</span></span><br><span class="line"><span class="comment">   * This only gets called for lazy watchers.</span></span><br><span class="line"><span class="comment">   * è¯„ä¼° watcher çš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">   * åªæœ‰æ‡’æƒ°çš„ watcher æ‰ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">   * è¿™ä¸ªéœ€è¦ç»“åˆåˆšæ‰çš„ upadte æ¥çœ‹ï¼Œå¦‚æœ this.lazy = true. é‚£ä¹ˆ dirty = trueï¼Œ ç„¶åæ‰§è¡Œè¿™ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">evaluate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Depend on all deps collected by this watcher.</span></span><br><span class="line"><span class="comment">   * æŠŠ deps å…¨éƒ¨éå†ï¼Œ depends å…¨éƒ¨æ‰§è¡Œåˆ°å½“å‰ Dep.target ä¸­</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">depend</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="property">length</span></span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">deps</span>[i].<span class="title function_">depend</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Remove self from all dependencies&#x27; subscriber list.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">teardown</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//_isBeingDestroyedï¼Œç”¨äºæ ‡è¯†è¯¥å®ä¾‹æ˜¯å¦æ­£åœ¨è¢«é”€æ¯ã€‚å½“è¿™ä¸ªæ ‡è®°ä¸º true æ—¶ï¼ŒVue ä¼šåœæ­¢ç»§ç»­è§‚å¯Ÿæ•°æ®ï¼Œå¹¶ä¸”åœ¨ä¸€äº›é’©å­å‡½æ•°ä¸­ï¼Œå¯èƒ½éœ€è¦åˆ¤æ–­è¿™ä¸ªæ ‡è®°æ¥å†³å®šæ˜¯å¦æ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚é¿å…åœ¨ç»„ä»¶å·²ç»è¢«é”€æ¯åè¿˜æ‰§è¡Œä¸€äº›å¼‚æ­¥æ“ä½œï¼Œä»è€Œé¿å…å¯èƒ½çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">vm</span> &amp;&amp; !<span class="variable language_">this</span>.<span class="property">vm</span>.<span class="property">_isBeingDestroyed</span>) &#123;</span><br><span class="line">      <span class="title function_">remove</span>(<span class="variable language_">this</span>.<span class="property">vm</span>.<span class="property">_scope</span>.<span class="property">effects</span>, <span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ˜¯å¦æ˜¯æ¿€æ´»çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">active</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="property">length</span></span><br><span class="line">      <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">        <span class="comment">//æ¸…é™¤æ‰€æœ‰å¼•ç”¨</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">deps</span>[i].<span class="title function_">removeSub</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//è®¾ç½®ä¸æ¿€æ´»</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">active</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//è§¦å‘é’©å­</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">onStop</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">onStop</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="02-æ€»ç»“"><a href="#02-æ€»ç»“" class="headerlink" title="02. æ€»ç»“"></a>02. æ€»ç»“</h3><p>watch åšäº†ä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p>ç”¨äºç›‘å¬ä¸€ä¸ªæ•°æ®å¯¹è±¡çš„å˜åŒ–ï¼Œå¹¶åœ¨å˜åŒ–æ—¶æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p>
<p>åœ¨åˆå§‹åŒ–æ—¶ï¼Œwatcher ä¼šæ”¶é›†ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯å°†å½“å‰çš„ watcher å¯¹è±¡èµ‹å€¼ç»™å½“å‰è®¿é—®çš„æ•°æ®å¯¹è±¡çš„ dep å®ä¾‹ï¼Œä»è€Œå»ºç«‹æ•°æ®å¯¹è±¡å’Œ watcher çš„å…³è”å…³ç³»ã€‚å½“æ•°æ®å¯¹è±¡çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œdep å®ä¾‹ä¼šé€šçŸ¥æ‰€æœ‰çš„ watcherï¼Œwatcher ä¼šé‡æ–°æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p>
<p>åœ¨æ‰§è¡Œå›è°ƒå‡½æ•°ä¹‹å‰ï¼Œwatcher è¿˜ä¼šè¿›è¡Œä¸€äº›ä¼˜åŒ–å¤„ç†ï¼Œæ¯”å¦‚åˆ¤æ–­å½“å‰å›è°ƒå‡½æ•°æ˜¯å¦æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå¦‚æœæ˜¯åˆ™å°†å…¶åŠ å…¥åˆ°å¼‚æ­¥é˜Ÿåˆ—ä¸­ï¼Œä»è€Œé¿å…è¿ç»­å¤šæ¬¡çš„æ›´æ–°æ“ä½œï¼Œæé«˜æ€§èƒ½ã€‚åŒæ—¶ï¼Œwatcher è¿˜æ”¯æŒä¸€äº›é«˜çº§ç‰¹æ€§ï¼Œæ¯”å¦‚ computedã€watchEffect ç­‰ã€‚</p>
</blockquote>
<p><code>get</code> æ–¹æ³•ä¸»ä½œç”¨è·å–è¡¨è¾¾å¼çš„å€¼ï¼Œå…¶ä¸­åŒ…å« Dep.target è¿›æ ˆå’Œå‡ºæ ˆçš„æ“ä½œï¼Œå¹¶ä¸”éå†è·å–çš„å€¼çš„æ‰€æœ‰å±æ€§ï¼Œå°†å…¶å“åº”å¼ã€‚</p>
<ol>
<li>pushTarget</li>
<li>è·å–è¡¨è¾¾å¼ value</li>
<li>traverse(value) è¿½ç§æ‰€æœ‰å±æ€§ï¼Œå“åº”å¼alue</li>
<li>popTarget() &#x2F;&#x2F;å‡ºæ ˆ</li>
<li>this.cleanupDeps() &#x2F;&#x2F;æ¸…ç†</li>
</ol>
<p><code>addDep</code> å¦‚æœä¸´æ—¶IDçš„é›†åˆæ²¡æœ‰åŒ…å«è¿™ä¸ªDepï¼Œé‚£ä¹ˆåœ¨ä¸´æ—¶IDé›†åˆä»¥åŠä¸´æ—¶é›†åˆä¸­åŠ å…¥ï¼Œç»§ç»­åˆ¤æ–­ï¼Œå¦‚æœä¾èµ–IDé›†åˆ(ä¸æ˜¯ä¸´æ—¶)æ²¡æœ‰åŒ…å«è¿™ä¸ªIDï¼Œé‚£ä¹ˆè¿™ä¸ªDep.addSub(this)</p>
<p><code>update</code> æ›´æ–°ï¼Œ3ç§æ›´æ–°</p>
<ol>
<li>æ‡’æ›´æ–° &#x3D;&gt; ditry &#x3D; true</li>
<li>!!sync &#x3D;&gt; run()</li>
<li>!sync &#x3D;&gt; è¿›å…¥é˜Ÿåˆ—</li>
</ol>
<p><code>evaluate</code> è·å– value èµ‹å€¼ï¼Œdirty &#x3D; falseã€‚</p>
<p><code>run</code> å¦‚æœæ˜¯å¦æ˜¯ <code>active</code>ï¼Œè·å–å€¼ï¼Œå¹¶ä¸”è°ƒç”¨ callbcak</p>
<p><code>depend</code> æŠŠ deps å…¨éƒ¨éå†ï¼Œ depends å…¨éƒ¨æ‰§è¡Œåˆ°å½“å‰ Dep.target ä¸­</p>
<p><code>teardown</code> æ¸…é™¤å…³äºè¿™ä¸ª dep ä¸­æ‰€æœ‰çš„å½“å‰ watcherã€‚</p>

    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-06-27</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« tommy</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tblog/tags/%E6%BA%90%E7%A0%81/'>
                            æºç 
                        </a>
                    
                        <a href='/tblog/tags/vue2/'>
                            vue2
                        </a>
                    
                        <a href='/tblog/tags/wather/'>
                            wather
                        </a>
                    
                </span>
             
             
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                
                    <span>ä¸Šä¸€ç¯‡ï¼š<a href='/tblog/2023/06/27/vue2_Dep/'>Vue2.x Dep</a></span>
                

                
                    <span class="post-footer-pre-next-last-span-right">ä¸‹ä¸€ç¯‡ï¼š<a href="/tblog/2023/06/26/vue_beforeUpdate/">Vue beforeUpdate</a>
                    </span>
                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2023 China 

            
                

            
        </span>
       
    
</div>



<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ğŸŒŠçœ‹è¿‡å¤§æµ·çš„äººä¸ä¼šå¿˜è®°æµ·çš„å¹¿é˜”ğŸŒŠ</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


    
        
<script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/highlight.min.js"></script>

        
<script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/highlightjs-line-numbers.js"></script>


        
<script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/randomHeaderContent.js"></script>

        <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
        
            
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

            
<script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/returnToTop.js"></script>

        
        
        <!--ç›®å½•-->
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
            
<script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/toc.js"></script>

        
    




<script src="/tblog/js/lightgallery/lightgallery.umd.min.js"></script>



<script src="/tblog/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="/tblog/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="/tblog/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="/tblog/js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="/tblog/js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="/tblog/js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // å¯ç”¨æ’ä»¶
            thumbnail: true,          // æ˜¾ç¤ºç¼©ç•¥å›¾
            zoom: true,               // å¯ç”¨ç¼©æ”¾åŠŸ
            rotate: true,             // å¯ç”¨æ—‹è½¬åŠŸèƒ½èƒ½
            autoplay: true,        // å¯ç”¨è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
            fullScreen: true,      // å¯ç”¨å…¨å±åŠŸèƒ½
            pager: false, //é¡µç ,
            zoomFromOrigin: true,   // ä»åŸå§‹ä½ç½®ç¼©æ”¾
            actualSize: true,       // å¯ç”¨æŸ¥çœ‹å®é™…å¤§å°çš„åŠŸèƒ½
            enableZoomAfter: 300,    // å»¶è¿Ÿç¼©æ”¾ï¼Œç¡®ä¿å›¾ç‰‡åŠ è½½å®Œæˆåå¯ç¼©æ”¾
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // ä¿®å¤é€‰æ‹©å™¨
    }
    
</script>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>