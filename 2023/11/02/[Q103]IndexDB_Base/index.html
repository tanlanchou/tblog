<!DOCTYPE html>
<html lang="zh-Hans">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="IndexDB API" />
    <meta name="hexo-theme-A4" content="v1.7.0" />
    <link rel="alternate icon" type="image/webp" href="/tblog/img/favicon.webp">
    <title>æˆå¤©ä¹±å†™ | ä»£ç å’Œç”Ÿæ´»</title>

    
        
            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/highlight/style1.css">

            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/a11y-dark.min.css">

            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/reset.css">

            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/markdown.css">

            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/fonts.css">
 
            <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
            

            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/ui.css">
 
            
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/style.css">

    
            <!--è¿”å›é¡¶éƒ¨css-->
            
                
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/returnToTop.css">

                
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/unicons.css">

            
            
                <!--ç›®å½•-->
                
<link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/toc.css">

            

        
    

    
        
<link rel="stylesheet" href="/tblog/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/tblog/css/lightgallery-bundle.min.css">


<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/tblog/atom.xml" title="æˆå¤©ä¹±å†™" type="application/atom+xml">
</head>
    
    

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #e4e4e4 ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/tblog/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/tblog/">æˆå¤©ä¹±å†™</a> 
            <span class="description">ä¹±å†™ä¸œè¥¿çš„åœ°æ–¹ï¼Œè®²è®²ä»£ç å’Œç”Ÿæ´»</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/tblog/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/tblog/list/">æ–‡ç« </a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    IndexDB API
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                    <span>æœ€è¿‘æ›´æ–°ï¼š2024-12-02</span> 
                
                
                    
                        &nbsp; | &nbsp;
                    
                     <span>å­—æ•°æ€»è®¡ï¼š3k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>é˜…è¯»ä¼°æ—¶ï¼š12åˆ†é’Ÿ</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span id="busuanzi_container_page_pv">
                        é˜…è¯»é‡ï¼š<span id="busuanzi_value_page_pv"></span>æ¬¡
                    </span>
                
            </div>
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#01-%E4%BB%80%E4%B9%88%E6%98%AFIndexDB"><span class="post-toc-text">01. ä»€ä¹ˆæ˜¯IndexDB?</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#02-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%94%AF%E6%8C%81%E9%97%AE%E9%A2%98"><span class="post-toc-text">02. æµè§ˆå™¨æ”¯æŒé—®é¢˜</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#03-%E5%A4%A7%E5%B0%8F"><span class="post-toc-text">03. å¤§å°</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#04-%E6%96%87%E6%A1%A3"><span class="post-toc-text">04. æ–‡æ¡£</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#05-Indexdb-amp-IDBFactory"><span class="post-toc-text">05. Indexdb &amp; IDBFactory</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#05-IDBFactory"><span class="post-toc-text">05. IDBFactory</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#06-IDBDatabase-transaction-method"><span class="post-toc-text">06. IDBDatabase: transaction() method</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#07-IDBTransaction"><span class="post-toc-text">07. IDBTransaction</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#08-IDBObjectStore"><span class="post-toc-text">08. IDBObjectStore</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#09-%E6%80%BB%E7%BB%93"><span class="post-toc-text">09. æ€»ç»“</span></a></li></ol>
            
        
        <h3 id="01-ä»€ä¹ˆæ˜¯IndexDB"><a href="#01-ä»€ä¹ˆæ˜¯IndexDB" class="headerlink" title="01. ä»€ä¹ˆæ˜¯IndexDB?"></a>01. ä»€ä¹ˆæ˜¯IndexDB?</h3><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API">https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API</a></p>
<blockquote>
<p>IndexedDB æ˜¯ä¸€ä¸ªäº‹åŠ¡å‹æ•°æ®åº“ç³»ç»Ÿï¼Œç±»ä¼¼äºåŸºäº SQL çš„ RDBMSã€‚ç„¶è€Œï¼Œä¸åƒ RDBMS ä½¿ç”¨å›ºå®šåˆ—è¡¨ï¼ŒIndexedDB æ˜¯ä¸€ä¸ªåŸºäº JavaScript çš„é¢å‘å¯¹è±¡æ•°æ®åº“ã€‚IndexedDB å…è®¸ä½ å­˜å‚¨å’Œæ£€ç´¢ç”¨é”®ç´¢å¼•çš„å¯¹è±¡ï¼›å¯ä»¥å­˜å‚¨ç»“æ„åŒ–å…‹éš†ç®—æ³•æ”¯æŒçš„ä»»ä½•å¯¹è±¡ã€‚ä½ åªéœ€è¦æŒ‡å®šæ•°æ®åº“æ¨¡å¼ï¼Œæ‰“å¼€ä¸æ•°æ®åº“çš„è¿æ¥ï¼Œç„¶åæ£€ç´¢å’Œæ›´æ–°ä¸€ç³»åˆ—äº‹åŠ¡ã€‚</p>
</blockquote>
<p>å…¶å®æ²¡å¾—é€‰, å¦‚æœè¦åœ¨æµè§ˆå™¨å­˜å‚¨å¤§é‡ä¸œè¥¿,ä½ åªèƒ½é€‰ IndexDB.</p>
<p>ä»–å¯ä»¥å¼‚æ­¥, æ”¯æŒäº‹åŠ¡, æœ‰ç´¢å¼•, å¯ä»¥è·¨åŸŸ. è€Œä¸”æ˜¯ NoSql.</p>
<p>è¿˜æœ‰å°±æ˜¯ä»–æ•°æ®æ˜¯ç»“æ„åŒ–çš„, è¯´äººè¯å°±æ˜¯, ä»–ç†è®ºä¸Šæ²¡æœ‰é™åˆ¶, ä½ å¯ä»¥å­˜ä»»ä½•ä¸œè¥¿.</p>
<h3 id="02-æµè§ˆå™¨æ”¯æŒé—®é¢˜"><a href="#02-æµè§ˆå™¨æ”¯æŒé—®é¢˜" class="headerlink" title="02. æµè§ˆå™¨æ”¯æŒé—®é¢˜"></a>02. æµè§ˆå™¨æ”¯æŒé—®é¢˜</h3><p><a target="_blank" rel="noopener" href="https://caniuse.com/?search=indexdb">https://caniuse.com/?search=indexdb</a></p>
<p>ç†è®ºä¸Šåªè¦ä½ ä¸å…¼å®¹ IE, é—®é¢˜éƒ½ä¸å¤§, å¦‚æœè¦å…¼å®¹IE, éœ€è¦è€ƒè™‘ IndexDBä¸åŒç‰ˆæœ¬çš„å†™æ³•å…¼å®¹æ€§é—®é¢˜</p>
<h3 id="03-å¤§å°"><a href="#03-å¤§å°" class="headerlink" title="03. å¤§å°"></a>03. å¤§å°</h3><p>ä¸åŒæµè§ˆå™¨å¤§å°ä¸åŒ, ä½†æ˜¯ä¹Ÿä¸å¥½æµ‹è¯•.</p>
<p>å› ä¸ºä½ éœ€è¦çœ‹æ¯ä¸ªæµè§ˆå™¨è‡ªå·±çš„å…¬å‘Š, å¹¶ä¸”ä½ ä¹Ÿä¸çŸ¥é“éšç€æ›´æ–°æ˜¯å¦ä¼šæœ‰è°ƒæ•´, æ¯ä¸ªç‰ˆæœ¬éƒ½å¯èƒ½ä¸å¤ªä¸€æ ·.</p>
<p>æŸ¥äº†åŠå¤©ä¹Ÿæ²¡æœ‰è°å»åšäº†ä¸€ä¸ªç»Ÿè®¡.</p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢ä»£ç è¿›è¡Œæ£€æµ‹.</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">navigator.<span class="property">storage</span>.<span class="title function_">estimate</span>().<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">estimate</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> usedSpaceInMB = estimate.<span class="property">usage</span> / <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">const</span> totalSpaceInMB = estimate.<span class="property">quota</span> / <span class="number">1024</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åªæ˜¯è¿™ä¸ªä»£ç ä¹Ÿæœ‰é—®é¢˜</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/StorageManager/estimate">https://developer.mozilla.org/zh-CN/docs/Web/API/StorageManager/estimate</a></p>
<blockquote>
<p>å®‰å…¨ä¸Šä¸‹æ–‡: æ­¤é¡¹åŠŸèƒ½ä»…åœ¨ä¸€äº›æ”¯æŒçš„æµè§ˆå™¨çš„å®‰å…¨ä¸Šä¸‹æ–‡ï¼ˆHTTPSï¼‰ä¸­å¯ç”¨ã€‚</p>
</blockquote>
<p>æµ‹è¯•çš„æ—¶å€™éœ€è¦æ³¨æ„</p>
<h3 id="04-æ–‡æ¡£"><a href="#04-æ–‡æ¡£" class="headerlink" title="04. æ–‡æ¡£"></a>04. æ–‡æ¡£</h3><p>é¦–å…ˆæ¨èçœ‹æ–‡æ¡£</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API">https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API</a></p>
<p>è¿™ä¸ªæ¯”è¾ƒå¤æ‚, ç®€å•ä½¿ç”¨çœ‹é˜®ä¸€å³°çš„ä¹Ÿè¡Œ</p>
<p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2018/07/indexeddb.html">https://www.ruanyifeng.com/blog/2018/07/indexeddb.html</a></p>
<p>å¼„æ‡‚, ç®€å•ä½¿ç”¨æ˜¯æ²¡é—®é¢˜äº†.</p>
<h3 id="05-Indexdb-amp-IDBFactory"><a href="#05-Indexdb-amp-IDBFactory" class="headerlink" title="05. Indexdb &amp; IDBFactory"></a>05. Indexdb &amp; IDBFactory</h3><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/IDBFactory">https://developer.mozilla.org/zh-CN/docs/Web/API/IDBFactory</a></p>
<p>IDBFactory å¯¹è±¡è¡¨ç¤º IndexedDB å·¥å‚ã€‚ å®ƒæä¾›æ‰“å¼€å’Œå…³é—­æ•°æ®åº“çš„æ–¹æ³•ã€‚</p>
<p>ä¹Ÿå°±æ˜¯ </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">indexedDB</span>.<span class="title function_">open</span>(name, version)</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">indexedDB</span>.<span class="title function_">deleteDatabase</span>(name)</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯, å¦‚æœ <code>open</code> çš„æ—¶å€™, æ•°æ®åº“ä¸å­˜åœ¨, ä¼šè‡ªåŠ¨åˆ›å»º.</p>
<p><code>open</code> å’Œ <code>deleteDatabase</code> éƒ½ä¼šè¿”å› <code>IDBOpenDBRequest</code></p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IDBOpenDBRequest">https://developer.mozilla.org/en-US/docs/Web/API/IDBOpenDBRequest</a></p>
<p><code>IDBOpenDBRequest</code> éœ€è¦æ³¨æ„ä¸‹é¢4ä¸ªäº‹ä»¶.</p>
<ol>
<li><code>blocked</code> <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IDBOpenDBRequest">https://developer.mozilla.org/en-US/docs/Web/API/IDBOpenDBRequest</a></li>
<li><code>upgradeneeded</code> <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IDBOpenDBRequest/upgradeneeded_event">https://developer.mozilla.org/en-US/docs/Web/API/IDBOpenDBRequest/upgradeneeded_event</a></li>
<li><code>error</code> <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IDBRequest/error_event">https://developer.mozilla.org/en-US/docs/Web/API/IDBRequest/error_event</a></li>
<li><code>success</code> <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IDBRequest/success_event">https://developer.mozilla.org/en-US/docs/Web/API/IDBRequest/success_event</a></li>
</ol>
<p><code>blocked</code></p>
<blockquote>
<p>å½“ä¸€ä¸ªç½‘é¡µæˆ–åº”ç”¨ç¨‹åºå°è¯•æ‰“å¼€ä¸€ä¸ªå·²ç»è¢«å…¶ä»–ç½‘é¡µæˆ–åº”ç”¨ç¨‹åºæ‰“å¼€å¹¶æ­£åœ¨æ‰§è¡Œå†™å…¥äº‹åŠ¡çš„æ•°æ®åº“æ—¶ï¼Œä¼šè§¦å‘ blocked äº‹ä»¶ã€‚</p>
</blockquote>
<p>æ‰€ä»¥è¿™ä¸ªäº‹ä»¶çš„åº”ç”¨åœºæ™¯å°±éœ€è¦è€ƒè™‘äº†, æˆ‘ç›®å‰è¦å†™çš„åœºæ™¯æ˜¯ä¸éœ€è¦è¿™ä¸ªäº‹ä»¶çš„.</p>
<p>å¦‚æœæœ‰è¿™ä¸ªå¤šç½‘é¡µä½¿ç”¨ indexDB çš„æƒ…å†µ, å°±éœ€è¦è€ƒè™‘äº†.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">addEventListener</span>(<span class="string">&quot;blocked&quot;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>

<p><code>upgradeneeded</code></p>
<blockquote>
<p>The upgradeneeded event is fired when an attempt was made to open a database with a version number higher than its current version. </p>
</blockquote>
<p>å­—é¢æ„æ€, åœ¨å°è¯•ç”¨ä¸€ä¸ªæ›´é«˜ç‰ˆæœ¬ç‰ˆæœ¬å·æ‰“å¼€æ•°æ®åº“çš„æ—¶å€™, å°±ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶.</p>
<p>å…¶å®è¿˜æœ‰ä¸€ä¸ªæƒ…å†µ, å°±æ˜¯é¦–æ¬¡æ‰“å¼€çš„æ—¶å€™.</p>
<h3 id="05-IDBFactory"><a href="#05-IDBFactory" class="headerlink" title="05. IDBFactory"></a>05. IDBFactory</h3><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase">https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase</a></p>
<p>IDBDatabase å°±æ˜¯å½“ä½ ä½¿ç”¨ open æ•°æ®åº“ä¹‹åçš„è¿”å›å€¼ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onsuccess = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    db = event.<span class="property">target</span>.<span class="property">result</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»–å¯ä»¥åšä»€ä¹ˆï¼Ÿ</p>
<p>é¦–å…ˆè·å–è¿™ä¸ªæ•°æ®åº“çš„åŸºæœ¬ä¿¡æ¯</p>
<ol>
<li>name æ•°æ®åº“åç§°</li>
<li>version æ•°æ®åº“ç‰ˆæœ¬</li>
<li>objectStoreNames è¡¨åç§°åˆé›†</li>
</ol>
<p>å…¶æ¬¡ï¼Œä¹Ÿå°±æ˜¯æœ€ä¸»è¦çš„</p>
<ol>
<li>close()</li>
<li>createObjectStore()</li>
<li>deleteObjectStore()</li>
<li>transaction()</li>
<li>versionchange</li>
</ol>
<p>è¿™é‡Œä¸»è¦è¯´å‰ä¸‰ä¸ªï¼Œç¬¬å››ä¸ªåé¢ç»§ç»­çœ‹ã€‚</p>
<p><code>close</code> å°±æ˜¯å…³é—­æ•°æ®åº“é“¾æ¥ã€‚åœ¨é€‚å½“çš„æ—¶å€™å…³é—­æ•°æ®åº“ï¼Œé¿å…é˜»å¡ï¼Œå†…å­˜è¿‡é«˜ç­‰é—®é¢˜</p>
<p><code>createObjectStore</code> åˆ›å»ºè¡¨</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/createObjectStore">https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/createObjectStore</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">createObjectStore</span>(name)</span><br><span class="line"><span class="title function_">createObjectStore</span>(name, options)</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸€ä¸‹è¯•ä¸€è¯•</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line"><span class="keyword">const</span> objectStore = db.<span class="title function_">createObjectStore</span>(<span class="string">&quot;user&quot;</span>, &#123;</span><br><span class="line">	<span class="attr">keyPath</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">	<span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">objectStore.<span class="title function_">add</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;tommy&quot;</span>, <span class="attr">age</span>: <span class="string">&quot;18&quot;</span>, <span class="attr">sex</span>: <span class="number">1</span> &#125;);</span><br><span class="line">objectStore.<span class="title function_">add</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;tommy1&quot;</span>, <span class="attr">age</span>: <span class="string">&quot;19&quot;</span>, <span class="attr">sex</span>: <span class="number">0</span> &#125;);</span><br><span class="line">objectStore.<span class="title function_">add</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;tommy2&quot;</span>, <span class="attr">age</span>: <span class="string">&quot;20&quot;</span>, <span class="attr">sex</span>: <span class="number">1</span> &#125;);</span><br><span class="line"></span><br><span class="line">db.<span class="title function_">close</span>();</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå»ºè®® <code>autoIncrement</code> è®¾ç½®ï¼Œä¸ç„¶ä½ éœ€è¦è‡ªå·±è®¾ç½® <code>id</code>.</p>
<p>å…¶æ¬¡ï¼Œ<code>createObjectStore</code> åªèƒ½åœ¨ <code>upgradeneeded</code> é˜¶æ®µä½¿ç”¨ï¼Œä¸ç„¶ä¼šæŠ¥é”™çš„.</p>
<p>è¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªè¡¨ï¼Œå¹¶ä¸”æ·»åŠ äº†3æ¡æ•°æ®ã€‚</p>
<p><code>deleteObjectStore</code> åˆ é™¤è¡¨</p>
<p>æœ€å¼€å§‹æœ‰ç‚¹æ‡µï¼Œå› ä¸ºåˆ é™¤ä¹Ÿä¸èƒ½ç›´æ¥åœ¨ <code>onsuccess</code>, ä¼šæŠ¥é”™ï¼Œå¦‚æœæƒ³è¦åœ¨ <code>upgradeneeded</code> ä½¿ç”¨ï¼Œéš¾é“æˆ‘ä¸æ›´æ”¹ç‰ˆæœ¬å°±ä¸èƒ½åˆ é™¤å—ï¼Ÿ</p>
<p>é—®äº†AIä¹‹åï¼Œç»™äº†ä¸€ä¸ªæ–¹æ¡ˆ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰“å¼€æ•°æ®åº“å¹¶è·å–æ•°æ®åº“è¿æ¥</span></span><br><span class="line"><span class="keyword">var</span> request = indexedDB.<span class="title function_">open</span>(<span class="string">&quot;myDatabase&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">request.<span class="property">onsuccess</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰§è¡Œç‰ˆæœ¬æ›´æ”¹äº‹åŠ¡</span></span><br><span class="line">    <span class="keyword">var</span> versionChange = db.<span class="title function_">setVersion</span>(<span class="number">2</span>); <span class="comment">// ä½¿ç”¨setVersionæ¥åˆ›å»ºç‰ˆæœ¬æ›´æ”¹äº‹åŠ¡</span></span><br><span class="line"></span><br><span class="line">    versionChange.<span class="property">onsuccess</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// åœ¨ç‰ˆæœ¬æ›´æ”¹äº‹åŠ¡ä¸­åˆ é™¤ Object Store</span></span><br><span class="line">        <span class="keyword">if</span> (db.<span class="property">objectStoreNames</span>.<span class="title function_">contains</span>(<span class="string">&quot;myObjectStore&quot;</span>)) &#123;</span><br><span class="line">            db.<span class="title function_">deleteObjectStore</span>(<span class="string">&quot;myObjectStore&quot;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Object Store &#x27;myObjectStore&#x27; deleted.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Object Store &#x27;myObjectStore&#x27; not found.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        versionChange = versionChange.<span class="property">transaction</span>;</span><br><span class="line">        versionChange.<span class="property">oncomplete</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Object Store deleted successfully.&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        versionChange.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error deleting Object Store: &quot;</span> + versionChange.<span class="property">error</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æˆ‘åœ¨ MDN ä¸­æœç´¢çš„æ—¶å€™ï¼Œæ²¡æœ‰å‘ç°è¿™ä¸ªæ–¹æ³•ï¼Œäºæ˜¯ google äº†ä¸€ä¸‹è¿™ä¸æ˜¯æ ‡å‡†æ–¹æ³•ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/9521689/getting-a-setversion-is-not-a-function-error-when-using-indexeddb">https://stackoverflow.com/questions/9521689/getting-a-setversion-is-not-a-function-error-when-using-indexeddb</a></p>
<p>MDN å®˜æ–¹ä¾‹å­å½“ä¸­ç¡®å®ä¹Ÿæ˜¯ç‰ˆæœ¬å˜æ›´çš„æ—¶å€™æ‰åˆ é™¤ <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/deleteObjectStore">https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/deleteObjectStore</a></p>
<p><code>versionchange</code></p>
<blockquote>
<p>The event is fired when a database structure change (upgradeneeded event send on an IDBOpenDBRequest or IDBFactory.deleteDatabase) was requested elsewhere (most probably in another window&#x2F;tab on the same computer). versionchange</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœå…¶ä»–é¡µé¢è§¦å‘å‡çº§, é‚£ä¹ˆè¿™ä¸ªé¡µé¢ä¹Ÿä¼šæ”¶åˆ°é€šçŸ¥.</p>
<h3 id="06-IDBDatabase-transaction-method"><a href="#06-IDBDatabase-transaction-method" class="headerlink" title="06. IDBDatabase: transaction() method"></a>06. IDBDatabase: transaction() method</h3><p>äº‹åŠ¡ï¼Œä»–å¯ä»¥åšä»€ä¹ˆï¼Ÿ</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/transaction">https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase/transaction</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">transaction</span>(storeNames)</span><br><span class="line"><span class="title function_">transaction</span>(storeNames, mode)</span><br><span class="line"><span class="title function_">transaction</span>(storeNames, mode, options)</span><br></pre></td></tr></table></figure>

<p><code>mode</code></p>
<ol>
<li><code>readonly</code></li>
<li><code>readwrite</code></li>
<li><code>versionchange</code></li>
</ol>
<p>æ¨¡å¼3ç§ï¼Œ1,2 æ˜¯æ‰“å¼€äº‹åŠ¡ä»¥åï¼Œ è¯»å†™è¿˜æ˜¯åªè¯»ï¼Œè¿™é‡Œéœ€è¦è¯´ä¸€ä¸‹ï¼Œç†è®ºä¸Š <code>readwrite</code> å¯ä»¥å…¨è¦†ç›– <code>readonly</code>. ä½†æ˜¯åˆ«ä¸€ç›´ä½¿ç”¨ <code>readwrite</code></p>
<blockquote>
<p>ä¸€æ¬¡åªèƒ½æ‰“å¼€ä¸€ä¸ªè¯»å†™äº‹åŠ¡ï¼Œå®ƒä¼šé”å®šæ•°æ®åº“ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åŒæ—¶è®¿é—®ã€‚<br>å½“æœ‰è¯»å†™äº‹åŠ¡å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œåªè¯»äº‹åŠ¡å°†è¢«é˜»å¡ï¼Œç›´åˆ°è¯»å†™äº‹åŠ¡å®Œæˆã€‚</p>
</blockquote>
<p>ä¸ç®¡æ˜¯æ€§èƒ½ä¸Šï¼Œè¿˜æ˜¯é˜»å¡ä¸Šï¼Œå¦‚æœåªéœ€è¦è¯»å–ï¼Œéƒ½åº”è¯¥é€‰å– <code>readonly</code>.</p>
<p><code>versionchange</code> æ˜¯æˆ‘çœ‹æ–‡æ¡£ä¸æ˜ç™½çš„ä¸€ä¸ªç‚¹ï¼Œä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªæ¨¡å¼ï¼Ÿ è€Œä¸”å†™æµ‹è¯•ä»£ç æ²¡ç”¨</p>
<blockquote>
<p>è¿™ç§ç±»å‹çš„äº‹åŠ¡å…è®¸è¯»å–ã€ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ã€‚ä¹Ÿèƒ½å¤Ÿåˆ›å»ºå’Œåˆ é™¤Storesï¼ˆæ•°æ®è¡¨ï¼‰å’Œç´¢å¼•ã€‚è¿™ç§ç±»å‹çš„äº‹åŠ¡ä¼šåœ¨ä¸€ä¸ªupgradeneededäº‹ä»¶è¢«è§¦å‘çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºï¼Œä¸èƒ½å¤Ÿæ‰‹åŠ¨åˆ›å»ºã€‚</p>
</blockquote>
<p>versionchange å¯ä»¥æ‰§è¡Œæ•°æ®åº“ç»“æ„çš„å‡çº§ã€åˆ›å»ºæ–°çš„å¯¹è±¡ä»“åº“ã€æ·»åŠ ç´¢å¼•ã€æ‰§è¡Œæ•°æ®è¿ç§»ç­‰æ“ä½œ</p>
<p>okï¼Œä¸Šä»£ç æµ‹è¯•ä¸€ä¸‹ã€‚</p>
<p>é¦–å…ˆæ˜¯ <code>readonly</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line"><span class="keyword">const</span> transaction = db.<span class="title function_">transaction</span>(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;readonly&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> objectStore = transaction.<span class="title function_">objectStore</span>(<span class="string">`user`</span>);</span><br><span class="line"><span class="keyword">const</span> results = objectStore.<span class="title function_">getAll</span>();</span><br><span class="line">results.<span class="property">onsuccess</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> r = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line">    <span class="keyword">if</span> (r &amp;&amp; r.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      r.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(item.<span class="property">name</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯æ­£å¸¸çš„, åœ¨åªè¯»æƒ…å†µå°è¯•äº†ä¸€ä¸‹ <code>add</code>, ç›´æ¥æŠ¥é”™</p>
<blockquote>
<p>Uncaught DOMException: Failed to execute â€˜addâ€™ on â€˜IDBObjectStoreâ€™: The transaction is read-only.</p>
</blockquote>
<p>å¦å¤–ä¸€ä¸ªæ¨¡å¼, <code>readwrite</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line"><span class="keyword">const</span> transaction = db.<span class="title function_">transaction</span>(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;readwrite&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> objectStore = transaction.<span class="title function_">objectStore</span>(<span class="string">`user`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = &#123; <span class="attr">name</span>: <span class="string">&quot;tommy3&quot;</span>, <span class="attr">age</span>: <span class="string">&quot;18&quot;</span>, <span class="attr">sex</span>: <span class="number">1</span> &#125;;</span><br><span class="line">objectStore.<span class="title function_">add</span>(data);</span><br><span class="line">db.<span class="title function_">close</span>();</span><br></pre></td></tr></table></figure>



<p>åŒæ ·çš„ä»£ç , å¦‚æœç”¨åœ¨è¯»å†™ä¸Š. ok.</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore">IDBObjectStore - Web APIs | MDN (mozilla.org)</a></p>
<p>è¿™é‡ŒåŒ…å«äº†å…¶ä»–è¿˜èƒ½åšçš„æ“ä½œ, ä½ ä½¿ç”¨äº‹åŠ¡, æœ€ç»ˆè¿˜æ˜¯è¦è½åœ¨è¿™ä¸Šé¢.</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>readwrite</code> å…¶å®ä¹Ÿæ˜¯å¯ä»¥è¯»çš„, ä½†æ˜¯å»ºè®®åˆ†å¼€, åŸå› åˆšæ‰è¯´æ¸…æ¥šäº†.</p>
<p><code>versionchange</code> </p>
<blockquote>
<p>Allows any operation to be performed, including ones that delete and create object stores and indexes. Transactions of this mode cannot run concurrently with other transactions. Transactions in this mode are known as â€œupgrade transactions.â€</p>
<p>å…è®¸æ‰§è¡Œä»»ä½•æ“ä½œï¼ŒåŒ…æ‹¬åˆ é™¤å’Œåˆ›å»ºå¯¹è±¡å­˜å‚¨å’Œç´¢å¼•çš„æ“ä½œã€‚æ­¤æ¨¡å¼çš„äº‹åŠ¡ä¸èƒ½ä¸å…¶ä»–äº‹åŠ¡å¹¶å‘è¿è¡Œã€‚æ­¤æ¨¡å¼çš„äº‹åŠ¡ç§°ä¸ºâ€œå‡çº§äº‹åŠ¡â€ã€‚</p>
<p>There is also another type of transactions: . It can do anything, but you canâ€™t generate it manually.versionchange A transaction can be automatically created by IndexedDB while opening the database for the handler. After creating the transaction, it is necessary to add an item to the store as follows:</p>
<p>è¿˜æœ‰å¦ä¸€ç§ç±»å‹çš„äº¤æ˜“ï¼šã€‚å®ƒå¯ä»¥åšä»»ä½•äº‹æƒ…ï¼Œä½†ä½ ä¸èƒ½æ‰‹åŠ¨ç”Ÿæˆå®ƒã€‚versionchange</p>
<p>åœ¨ä¸ºå¤„ç†ç¨‹åºæ‰“å¼€æ•°æ®åº“æ—¶ï¼ŒIndexedDBå¯ä»¥è‡ªåŠ¨åˆ›å»ºäº‹åŠ¡ã€‚åˆ›å»ºäº‹åŠ¡åï¼Œéœ€è¦å‘å­˜å‚¨ä¸­æ·»åŠ ä¸€ä¸ªé¡¹ç›®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´åœ¨è§¦å‘æ•°æ®åº“å‡çº§çš„æ—¶å€™, è‡ªåŠ¨è§¦å‘è¿™ä¸ªäº‹åŠ¡.</p>
<p>æˆ‘æœ€å¼€å§‹æœ‰ä¸€ä¸ªè¯¯è§£ï¼Œ å°±æ˜¯ä¸åŒç‰ˆæœ¬çš„æ•°æ®åº“, æ„å‘³ç€æœ¬åœ°æœ‰å¤šä¸ªæ•°æ®åº“, ä½ å¯ä»¥è®¿é—® <strong>version: 1</strong>, ä¹Ÿå¯ä»¥è®¿é—® <strong>version:2</strong></p>
<p>æ‰€ä»¥ä¹‹å‰æ‰¾äº†å¾ˆä¹…å…³äºæ•°æ®åº“è¿ç§»çš„é—®é¢˜, åæ¥æ˜ç™½äº†å…¶å®åªèƒ½è®¿é—®æœ€æ–°ç‰ˆæœ¬, ä¹Ÿä¸å­˜åœ¨è¿ç§»æ•°æ®è¿™ç§åšæ³•(é™¤éä½ æ˜¯è¿ç§» ObjectStore).</p>
<p>ä¸‹é¢æ˜¯æˆ‘å†™çš„ä¸€ä¸ªåˆ—å­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">onupgradeneeded</span>: <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line">  <span class="keyword">const</span> transaction = event.<span class="property">currentTarget</span>.<span class="property">transaction</span>;</span><br><span class="line">  <span class="keyword">const</span> roleObjectStore = db.<span class="title function_">createObjectStore</span>(<span class="string">&quot;role&quot;</span>, &#123; <span class="attr">keyPath</span>: <span class="string">&quot;id&quot;</span>, <span class="attr">autoIncrement</span>: <span class="literal">true</span>, &#125;);</span><br><span class="line">  roleObjectStore.<span class="title function_">add</span>(&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;admin&quot;</span>, <span class="attr">createTime</span>: <span class="string">&quot;2023-11-11&quot;</span> &#125;);</span><br><span class="line">  roleObjectStore.<span class="title function_">add</span>(&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;teacher&quot;</span>, <span class="attr">createTime</span>: <span class="string">&quot;2023-11-11&quot;</span> &#125;);</span><br><span class="line">  roleObjectStore.<span class="title function_">add</span>(&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;student&quot;</span>, <span class="attr">createTime</span>: <span class="string">&quot;2023-11-11&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> myStore = transaction.<span class="title function_">objectStore</span>(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">  myStore.<span class="title function_">openCursor</span>().<span class="property">onsuccess</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> cursor = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line">    <span class="keyword">if</span> (cursor) &#123;</span><br><span class="line">      <span class="keyword">const</span> updateData = cursor.<span class="property">value</span>;</span><br><span class="line">      updateData.<span class="property">phone</span> = <span class="string">`0000000`</span> + updateData.<span class="property">id</span>;</span><br><span class="line">      cursor.<span class="title function_">update</span>(updateData).<span class="property">onsuccess</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;updateData.name&#125;</span>æ›´æ–°äº†æ•°æ®`</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      cursor.<span class="title function_">continue</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Entries all displayed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æ‰§è¡Œäº†è¿™ä¸ªä»£ç ä»¥å, è€ç‰ˆæœ¬çš„æ•°æ®åº“å°±æ— æ³•è®¿é—®äº†.</p>
<h3 id="07-IDBTransaction"><a href="#07-IDBTransaction" class="headerlink" title="07. IDBTransaction"></a>07. IDBTransaction</h3><p>ä¹Ÿå°±æ˜¯ <code>trans1</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> trans1 = db.<span class="title function_">transaction</span>(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;readwrite&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æœ‰5ä¸ªå±æ€§</p>
<ol>
<li><code>db IDBDatabase</code> å¯¹è±¡çš„å¼•ç”¨</li>
<li><code>durability</code> å®šä¹‰äº†äº‹åŠ¡çš„æŒä¹…åŒ–è¡Œä¸ºï¼Œå³äº‹åŠ¡å¯¹æ•°æ®åº“çŠ¶æ€çš„æŒä¹…æ€§å½±å“ï¼ˆä½†æ˜¯æ˜¯åªè¯»çš„ï¼Œå…¶å®æˆ‘ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨ï¼‰</li>
<li><code>error</code> å¦‚æœäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯ï¼Œ<code>error</code> å±æ€§ä¼šè¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥é”™è¯¯çš„ <code>DOMError</code> å¯¹è±¡ã€‚</li>
<li><code>mode</code> ä½ åˆ›å»ºäº‹åŠ¡çš„æ˜¯ <code>mode</code></li>
<li><code>objectStoreNames</code> åŒ…å«æ­¤äº‹åŠ¡ä¸­æ‰€æœ‰å¯¹è±¡ä»“åº“åç§°çš„æ•°ç»„ã€‚</li>
</ol>
<p>3ä¸ªæ–¹æ³•</p>
<ol>
<li>abort() å°±æ˜¯ç›´æ¥ä¸­æ–­äº‹åŠ¡ï¼Œ ç„¶åå›æ»šï¼Œç„¶åä¼šè§¦å‘ <code>abort</code> äº‹ä»¶</li>
<li>commit() æäº¤äº‹åŠ¡</li>
<li>objectStore() è¿”å› <code>IDBObjectStore</code> å¯¹è±¡</li>
</ol>
<p>commit æ˜¯æˆ‘æ¯”è¾ƒç–‘æƒ‘çš„ä¸€ä¸ªç‚¹ï¼Œå› ä¸ºä¹‹å‰æˆ‘ä»æ¥æ²¡æœ‰ä½¿ç”¨ commit ä½†æ˜¯ä¾ç„¶å¯ä»¥æ­£å¸¸æäº¤</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line"><span class="keyword">const</span> transaction = db.<span class="title function_">transaction</span>(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;readwrite&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> objectStore = transaction.<span class="title function_">objectStore</span>(<span class="string">`user`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = &#123; <span class="attr">name</span>: <span class="string">&quot;tommy3&quot;</span>, <span class="attr">age</span>: <span class="string">&quot;18&quot;</span>, <span class="attr">sex</span>: <span class="number">1</span> &#125;;</span><br><span class="line">objectStore.<span class="title function_">add</span>(data);</span><br><span class="line">db.<span class="title function_">close</span>();</span><br></pre></td></tr></table></figure>

<p>æˆ‘å¯ä»¥ä¸åœçš„æ·»åŠ ï¼Œä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰å†™ <code>transaction.commit()</code>ï¼Œ </p>
<blockquote>
<p>Note that commit() doesnâ€™t normally have to be called â€” a transaction will automatically commit when all outstanding requests have been satisfied and no new requests have been made. commit() can be used to start the commit process without waiting for events from outstanding requests to be dispatched.</p>
</blockquote>
<p>æ²¡å¿…è¦æ˜¾å¼è°ƒç”¨ã€‚</p>
<p><strong>ä¸‰ä¸ªäº‹ä»¶</strong></p>
<ol>
<li><code>abort</code> äº‹åŠ¡æŠ¥é”™å’Œå–æ¶ˆçš„æ—¶å€™è§¦å‘</li>
<li><code>complete</code> äº‹åŠ¡å®Œæˆä¹‹åè§¦å‘</li>
<li><code>error</code></li>
</ol>
<h3 id="08-IDBObjectStore"><a href="#08-IDBObjectStore" class="headerlink" title="08. IDBObjectStore"></a>08. IDBObjectStore</h3><p>æ“ä½œæ•°æ®çš„æ ¸å¿ƒæ¥å£, åŒ…å«ä¸€å †å±æ€§å’Œæ–¹æ³•</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore">https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore</a></p>
<p>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„, å…¶å®ä½ æŒ¨ä¸ªè¯•ä¸€è¯•å°±çŸ¥é“æ€ä¹ˆç”¨äº†. </p>
<p>å”¯ä¸€å€¼å¾—ä¸€è¯´çš„æ˜¯æ¸¸æ ‡. ç¡®å®åœ¨å¤§é‡æ•°æ®éå†çš„æ—¶å€™, è¿˜æ˜¯å»ºè®®ä½¿ç”¨ä¸€ä¸‹.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">openCursor</span>()</span><br><span class="line"><span class="title function_">openCursor</span>(query)</span><br><span class="line"><span class="title function_">openCursor</span>(query, direction)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ˜¯å…·ä½“æ¸¸æ ‡çš„è¿”å›, å¯ä»¥ç›´æ¥ç¼–è¾‘æˆ–è€…åˆ é™¤, è¯¦æƒ…çœ‹ä¸‹é¢çš„é“¾æ¥</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IDBCursor">https://developer.mozilla.org/en-US/docs/Web/API/IDBCursor</a></p>
<h3 id="09-æ€»ç»“"><a href="#09-æ€»ç»“" class="headerlink" title="09. æ€»ç»“"></a>09. æ€»ç»“</h3><p>å…¶å®åˆ°è¿™é‡Œ, åŸºæœ¬ä½¿ç”¨å°±åº”è¯¥æ²¡æœ‰é—®é¢˜. è¯¥çŸ¥é“çš„æ–¹æ³•å°±éƒ½è¯¥çŸ¥é“äº†.</p>
<p>å‰©ä¸‹å°±æ˜¯çµæ´»åº”ç”¨çš„é—®é¢˜äº†.</p>
<p>è‡ªå·±å†™ä¸€ä¸ªåº”ç”¨å§</p>

    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-11-02</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« tommy</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tblog/tags/javascript/'>
                            javascript
                        </a>
                    
                        <a href='/tblog/tags/indexDB/'>
                            indexDB
                        </a>
                    
                        <a href='/tblog/tags/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AD%98%E5%82%A8/'>
                            æµè§ˆå™¨å­˜å‚¨
                        </a>
                    
                </span>
             
             
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                
                    <span>ä¸Šä¸€ç¯‡ï¼š<a href='/tblog/2023/12/01/javascript/url_open_software/'>url é€šè¿‡åè®®å¯åŠ¨åº”ç”¨ç¨‹åº</a></span>
                

                
                    <span class="post-footer-pre-next-last-span-right">ä¸‹ä¸€ç¯‡ï¼š<a href="/tblog/2023/09/03/%5BQ102%5Djavascript_this_link/">javascript this æŒ‡å‘</a>
                    </span>
                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2023 China 

            
                

            
        </span>
       
    
</div>



<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ğŸŒŠçœ‹è¿‡å¤§æµ·çš„äººä¸ä¼šå¿˜è®°æµ·çš„å¹¿é˜”ğŸŒŠ</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


    
        
<script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/highlight.min.js"></script>

        
<script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/highlightjs-line-numbers.js"></script>


        
<script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/randomHeaderContent.js"></script>

        <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
        
            
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

            
<script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/returnToTop.js"></script>

        
        
        <!--ç›®å½•-->
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
            
<script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/toc.js"></script>

        
    




<script src="/tblog/js/lightgallery/lightgallery.umd.min.js"></script>



<script src="/tblog/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="/tblog/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="/tblog/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="/tblog/js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="/tblog/js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="/tblog/js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // å¯ç”¨æ’ä»¶
            thumbnail: true,          // æ˜¾ç¤ºç¼©ç•¥å›¾
            zoom: true,               // å¯ç”¨ç¼©æ”¾åŠŸ
            rotate: true,             // å¯ç”¨æ—‹è½¬åŠŸèƒ½èƒ½
            autoplay: true,        // å¯ç”¨è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
            fullScreen: true,      // å¯ç”¨å…¨å±åŠŸèƒ½
            pager: false, //é¡µç ,
            zoomFromOrigin: true,   // ä»åŸå§‹ä½ç½®ç¼©æ”¾
            actualSize: true,       // å¯ç”¨æŸ¥çœ‹å®é™…å¤§å°çš„åŠŸèƒ½
            enableZoomAfter: 300,    // å»¶è¿Ÿç¼©æ”¾ï¼Œç¡®ä¿å›¾ç‰‡åŠ è½½å®Œæˆåå¯ç¼©æ”¾
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // ä¿®å¤é€‰æ‹©å™¨
    }
    
</script>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>